{
  "title": "docs",
  "description": "Documentation for docs",
  "content": {},
  "metadata": {
    "type": "root",
    "path": "/home/anhnh/CodeWiki/output/docs/All-Hands-AI--OpenHands-docs",
    "source": "deepwiki"
  },
  "subpages": [
    {
      "title": "overview",
      "description": null,
      "content": {
        "OpenHands Repository Overview": {
          "Purpose": "OpenHands is a comprehensive AI-powered software development platform that enables autonomous agents to perform complex coding tasks, web browsing, and system interactions. The platform provides a unified interface for AI agents to interact with development environments, execute code, manage files, browse the web, and integrate with various external services while maintaining security and user control.",
          "End-to-End Architecture": {
            "System Data Flow": "```\nsequenceDiagram\n    participant User\n    participant Frontend\n    participant Server\n    participant Agent\n    participant Runtime\n    participant LLM\n    participant Storage\n    \n    User->>Frontend: Initiate Task\n    Frontend->>Server: Create Conversation\n    Server->>Storage: Persist Session\n    Server->>Agent: Initialize Agent\n    Agent->>LLM: Get Instructions\n    Agent->>Runtime: Execute Actions\n    Runtime->>Runtime: Process Commands\n    Runtime-->>Agent: Observations\n    Agent->>LLM: Process Results\n    LLM-->>Agent: Next Actions\n    Agent-->>Server: Status Updates\n    Server-->>Frontend: Real-time Events\n    Frontend-->>User: Live Updates\n    Server->>Storage: Save Conversation\n```"
          },
          "Core Module Documentation": {
            "Frontend Modules": [
              "**[Frontend Core](frontend_core.md)** - Primary API layer providing unified interface for backend services, authentication management, Git operations, and conversation orchestration",
              "**[Frontend State Management](frontend_state_management.md)** - Redux-based state management handling conversation interactions, code editing, and system metrics tracking"
            ],
            "Core System Modules": [
              "**[Core Agent System](core_agent_system.md)** - Foundational infrastructure for agent lifecycle, state management, action parsing, and control flow mechanisms",
              "**[Agent Implementations](agent_implementations.md)** - Concrete agent implementations including CodeAct, Browsing, Visual Browsing, and specialized microagents",
              "**[Events and Actions](events_and_actions.md)** - Event-driven architecture foundation providing action-observation patterns and real-time streaming",
              "**[LLM Integration](llm_integration.md)** - Unified language model abstraction supporting multiple providers with advanced features like function calling and vision processing"
            ],
            "Runtime and Execution": [
              "**[Runtime System](runtime_system.md)** - Sandboxed execution environments supporting local, containerized, and cloud-based execution with comprehensive security controls",
              "**[Security System](security_system.md)** - Multi-layered security analysis using rule-based invariant checking and LLM-powered risk assessment"
            ],
            "Integration and Storage": [
              "**[Git Integrations](git_integrations.md)** - Unified interface for GitHub, GitLab, and Bitbucket with microagent discovery and repository management",
              "**[Storage System](storage_system.md)** - Comprehensive data persistence layer with pluggable backends for conversations, user data, and file operations",
              "**[Server and API](server_and_api.md)** - FastAPI-based web server infrastructure with WebSocket support, session management, and authentication"
            ],
            "Configuration and Specialized Systems": [
              "**[Core Configuration](core_configuration.md)** - Centralized configuration management for CLI, security, MCP servers, and Kubernetes deployments",
              "**[Microagent System](microagent_system.md)** - Lightweight, task-specific agents with dynamic loading and context-aware triggering"
            ],
            "Enterprise Features": [
              "**[Enterprise Integrations](enterprise_integrations.md)** - Platform integrations for GitHub, GitLab, Jira, and Slack with workflow automation capabilities",
              "**[Enterprise Server](enterprise_server.md)** - SaaS-specific server configuration with advanced authentication, user verification, and billing integration"
            ]
          },
          "Key Features": [
            "**Multi-Agent Architecture**: Specialized agents for different tasks (coding, browsing, analysis)",
            "**Sandboxed Execution**: Secure runtime environments with Docker and Kubernetes support",
            "**Real-time Collaboration**: WebSocket-based live updates and conversation streaming",
            "**Multi-Provider LLM Support**: Unified interface for OpenAI, Anthropic, Google, and local models",
            "**Enterprise Integration**: Native support for GitHub, GitLab, Jira, and Slack workflows",
            "**Extensible Plugin System**: Microagents and MCP server integration for custom functionality",
            "**Comprehensive Security**: Multi-layered security analysis and policy enforcement",
            "**Scalable Architecture**: Kubernetes-native deployment with horizontal scaling support"
          ],
          "Getting Started": [
            "**Installation**: Follow the setup instructions in the main repository README",
            "**Configuration**: Review [Core Configuration](core_configuration.md) for system setup",
            "**Agent Selection**: Choose appropriate agents from [Agent Implementations](agent_implementations.md)",
            "**Runtime Setup**: Configure execution environment via [Runtime System](runtime_system.md)",
            "**Integration**: Connect external services through [Git Integrations](git_integrations.md) and [Enterprise Integrations](enterprise_integrations.md)"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "core_agent_system",
      "description": null,
      "content": {
        "Core Agent System": {
          "Overview": "The Core Agent System is the foundational module of OpenHands that provides the essential infrastructure for agent-based task execution. It serves as the central orchestration layer that manages agent lifecycle, state transitions, action parsing, and control flow mechanisms. This system enables autonomous agents to interact with various environments while maintaining proper state management and execution control.",
          "Purpose": "The Core Agent System is designed to:\n\n['**Agent Management**: Provide a unified interface for different agent implementations through the abstract Agent base class', '**State Management**: Maintain comprehensive execution state including iteration tracking, budget control, and conversation history', '**Action Processing**: Parse and validate agent responses into executable actions through sophisticated parsing mechanisms', '**Control Flow**: Implement traffic control and execution limits to ensure safe and bounded agent operations', '**Integration Foundation**: Serve as the integration point for LLM services, runtime environments, and other system components']",
          "Architecture Overview": "The Core Agent System follows a layered architecture with clear separation of concerns:\n\n```\ngraph TB\n    subgraph \"Core Agent System\"\n        subgraph \"Agent Layer\"\n            A[Agent Base Class]\n            AR[Agent Registry]\n        end\n        \n        subgraph \"State Management Layer\"\n            S[State]\n            CF[Control Flags]\n            TCS[Traffic Control State]\n        end\n        \n        subgraph \"Action Processing Layer\"\n            AP[Action Parser]\n            RP[Response Parser]\n        end\n        \n        subgraph \"Integration Layer\"\n            LLM[LLM Integration]\n            RT[Runtime Integration]\n            ES[Event System]\n        end\n    end\n    \n    subgraph \"External Systems\"\n        AI[Agent Implementations]\n        EV[Events & Actions]\n        RTS[Runtime System]\n        LLMS[LLM Integration]\n    end\n    \n    A --> AI\n    AP --> EV\n    S --> ES\n    A --> LLMS\n    S --> RTS\n    \n    style A fill:#e1f5fe\n    style S fill:#f3e5f5\n    style AP fill:#e8f5e8\n```",
          "Core Components": {
            "1. Agent Management": "The agent management sub-module provides the foundational infrastructure for agent lifecycle and registration. It defines the abstract Agent base class that serves as the template for all agent implementations, manages agent discovery through a centralized registry, and handles integration with LLM services and tool systems.\n\n**Key Features:**\n\n['Abstract agent interface with standardized lifecycle methods', 'Centralized agent registry for dynamic agent discovery', 'Integrated LLM and prompt management', 'MCP (Model Context Protocol) tool support']\n\nFor detailed information, see [Agent Management](agent_management.md).",
            "2. State Management": "The state management sub-module maintains comprehensive execution state throughout agent operations. It tracks conversation history, manages control flags for iteration and budget limits, handles state persistence across sessions, and supports complex multi-agent delegation scenarios.\n\n**Key Features:**\n\n['Comprehensive state tracking with event history', 'Sophisticated control flag system for execution limits', 'Persistent state with save/restore capabilities', 'Multi-agent delegation support with metrics tracking']\n\nFor detailed information, see [State Management](state_management.md).",
            "3. Action Processing": "The action processing sub-module converts raw LLM responses into structured, executable actions. It implements a flexible parsing system that can handle multiple response formats, validates action parameters, and provides comprehensive error handling for malformed responses.\n\n**Key Features:**\n\n['Modular parser chain architecture', 'Comprehensive response validation', 'Extensible action type support', 'Robust error handling and recovery']\n\nFor detailed information, see [Action Processing](action_processing.md)."
          },
          "System Integration": {
            "Agent Implementations Integration": [
              "**Purpose**: Provides concrete agent implementations (CodeAct, Browsing, etc.)",
              "**Integration**: Through the Agent base class and registry system",
              "**Reference**: [Agent Implementations](agent_implementations.md)"
            ],
            "Events and Actions Integration": [
              "**Purpose**: Defines the event system and action types",
              "**Integration**: Through action parsing and state management",
              "**Reference**: [Events and Actions](events_and_actions.md)"
            ],
            "LLM Integration": [
              "**Purpose**: Provides language model services",
              "**Integration**: Through agent LLM configuration and prompt management",
              "**Reference**: [LLM Integration](llm_integration.md)"
            ],
            "Runtime System Integration": [
              "**Purpose**: Provides execution environments",
              "**Integration**: Through state management and action execution",
              "**Reference**: [Runtime System](runtime_system.md)"
            ]
          },
          "Data Flow": "```\nsequenceDiagram\n    participant U as User\n    participant A as Agent\n    participant S as State\n    participant AP as Action Parser\n    participant LLM as LLM Service\n    participant RT as Runtime\n    \n    U->>A: Initialize with task\n    A->>S: Create initial state\n    A->>LLM: Get system message\n    \n    loop Agent Execution\n        A->>S: Check control flags\n        S->>A: Validate limits\n        A->>LLM: Generate response\n        LLM->>AP: Raw response\n        AP->>AP: Parse to action\n        AP->>A: Structured action\n        A->>RT: Execute action\n        RT->>S: Update state\n        S->>S: Increment counters\n    end\n    \n    A->>S: Mark completion\n    S->>U: Return results\n```",
          "Configuration and Customization": {
            "Agent Configuration": [
              "**Config Model**: Each agent type can define its own configuration model",
              "**LLM Integration**: Configurable LLM settings per agent",
              "**Tool Management**: Support for custom tool sets and MCP integration"
            ],
            "State Configuration": [
              "**Control Limits**: Configurable iteration and budget limits",
              "**Persistence**: Customizable state storage and restoration",
              "**Metrics**: Comprehensive tracking of agent performance"
            ],
            "Parser Configuration": [
              "**Parser Chains**: Configurable action parser sequences",
              "**Error Handling**: Customizable error reporting and recovery",
              "**Validation Rules**: Extensible action validation framework"
            ]
          },
          "Error Handling and Recovery": {
            "Agent Errors": [
              "**Registration Errors**: Proper handling of duplicate or missing agent registrations",
              "**Initialization Errors**: Graceful handling of agent setup failures",
              "**Execution Errors**: State preservation during agent execution failures"
            ],
            "State Errors": [
              "**Persistence Errors**: Robust state save/restore with fallback mechanisms",
              "**Limit Violations**: Clear error reporting when limits are exceeded",
              "**Corruption Recovery**: State validation and recovery mechanisms"
            ],
            "Parsing Errors": [
              "**Format Errors**: Detailed error reporting for malformed responses",
              "**Validation Errors**: Clear feedback on action validation failures",
              "**Recovery Strategies**: Fallback parsing mechanisms"
            ]
          },
          "Performance Considerations": {
            "State Management": [
              "**Lazy Loading**: Event history loaded on demand through view system",
              "**Checksum Caching**: Efficient view caching with history change detection",
              "**Selective Persistence**: Only essential state data is persisted"
            ],
            "Action Processing": [
              "**Parser Optimization**: Efficient parser chain execution",
              "**Response Caching**: Avoid redundant parsing operations",
              "**Memory Management**: Proper cleanup of parsing artifacts"
            ],
            "Control Flow": [
              "**Efficient Limits**: O(1) limit checking operations",
              "**State Transitions**: Minimal overhead for state updates",
              "**Metric Tracking**: Efficient performance metric collection"
            ]
          },
          "Security Considerations": {
            "Agent Security": [
              "**Sandboxing**: Integration with secure runtime environments",
              "**Tool Restrictions**: Configurable tool access controls",
              "**Resource Limits**: Comprehensive resource usage controls"
            ],
            "State Security": [
              "**Data Isolation**: Proper session and user data separation",
              "**Secure Persistence**: Encrypted state storage capabilities",
              "**Access Controls**: User-based state access restrictions"
            ],
            "Action Security": [
              "**Validation**: Comprehensive action validation before execution",
              "**Sanitization**: Input sanitization in action parsing",
              "**Audit Trail**: Complete action execution logging"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Enhanced Multi-Agent**: Improved delegation and coordination mechanisms",
              "**Advanced Control**: More sophisticated limit and control mechanisms",
              "**Performance Optimization**: Further optimization of state and parsing operations",
              "**Security Hardening**: Enhanced security features and audit capabilities"
            ],
            "Extension Points": [
              "**Custom Agents**: Framework for developing custom agent types",
              "**Custom Parsers**: Easy integration of new action parsers",
              "**Custom Controls**: Extensible control flag implementations",
              "**Custom State**: Support for domain-specific state extensions"
            ]
          },
          "Related Documentation": {
            "Sub-Module Documentation": [
              "[Agent Management](agent_management.md) - Agent lifecycle and registration system",
              "[State Management](state_management.md) - Execution state and control mechanisms",
              "[Action Processing](action_processing.md) - Response parsing and action validation"
            ],
            "System Integration Documentation": [
              "[Agent Implementations](agent_implementations.md) - Concrete agent implementations",
              "[Events and Actions](events_and_actions.md) - Event system and action types",
              "[LLM Integration](llm_integration.md) - Language model integration",
              "[Runtime System](runtime_system.md) - Execution environments",
              "[Storage System](storage_system.md) - Data persistence and storage",
              "[Security System](security_system.md) - Security analysis and controls"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "agent_implementations",
      "description": null,
      "content": {
        "Agent Implementations Module": {
          "Overview": "This module implements the strategy pattern for agent specialization, where each agent inherits from the base `Agent` class but provides domain-specific capabilities, tools, and behaviors. The agents range from general-purpose code execution to specialized web browsing and read-only exploration.",
          "Architecture": "```\ngraph TB\n    subgraph \"Agent Implementations Module\"\n        subgraph \"CodeAct Agents\"\n            CA[CodeActAgent]\n            LA[LocAgent]\n            RA[ReadOnlyAgent]\n        end\n        \n        subgraph \"Browsing Agents\"\n            BA[BrowsingAgent]\n            VBA[VisualBrowsingAgent]\n        end\n        \n        subgraph \"Microagent System\"\n            TMA[TaskMicroagent]\n            KMA[KnowledgeMicroagent]\n            RMA[RepoMicroagent]\n        end\n    end\n    \n    subgraph \"Core Dependencies\"\n        Agent[Agent Base Class]\n        LLM[LLM Integration]\n        Runtime[Runtime System]\n        Events[Events & Actions]\n    end\n    \n    CA --> Agent\n    LA --> CA\n    RA --> CA\n    BA --> Agent\n    VBA --> Agent\n    \n    CA --> LLM\n    CA --> Runtime\n    CA --> Events\n    \n    BA --> LLM\n    VBA --> LLM\n    \n    TMA --> KMA\n    KMA --> RMA\n```",
          "Core Components": {
            "CodeAct Agent Family": {
              "CodeActAgent": "The flagship general-purpose agent implementing the CodeAct paradigm that consolidates actions into a unified code execution space.\n\n**Key Features:**\n\n['**Unified Action Space**: Combines conversation, bash commands, and Python execution', '**Tool Integration**: Supports 10+ specialized tools (Jupyter, browser, editor, etc.)', '**Memory Management**: Advanced conversation memory with condensation capabilities', '**Function Calling**: Native support for structured tool interactions', '**Plugin System**: Extensible sandbox plugin architecture']\n\n**Core Capabilities:**\n\n```\n# Available tools based on configuration\ntools = [\n    'cmd_run',      # Bash command execution\n    'think',        # Reasoning and planning\n    'finish',       # Task completion\n    'browser',      # Web browsing\n    'jupyter',      # Python code execution\n    'editor',       # File editing\n    'task_tracker'  # Task management\n]\n```",
              "LocAgent": "A specialized CodeActAgent optimized for location-aware and context-sensitive tasks.\n\n**Specializations:**\n\n['Custom tool set for location-based operations', 'Enhanced function calling for spatial reasoning', 'Inherits all CodeActAgent capabilities with domain-specific extensions']",
              "ReadOnlyAgent": "A safety-focused variant that provides exploration capabilities without modification permissions.\n\n**Safety Features:**\n\n['**Read-Only Tools**: Only grep, glob, view, think, finish, web_read', '**No MCP Support**: Explicitly disables MCP tools for security', '**Codebase Exploration**: Safe for understanding existing systems', '**Research Mode**: Ideal for analysis without side effects']"
            },
            "Browsing Agent Family": {
              "BrowsingAgent": "Specialized for web interaction using BrowserGym's high-level action space.\n\n**Web Capabilities:**\n\n['**Action Subsets**: Chat, BID (Browser Interaction Description), Navigation', '**Accessibility Tree**: Full webpage structure understanding', '**Error Recovery**: Automatic error handling with retry logic', '**Multi-Action**: Can perform multiple browser actions simultaneously']\n\n**Browser Actions:**\n\n```\naction_subsets = ['chat', 'bid']\nif USE_NAV:\n    action_subsets.append('nav')\n```",
              "VisualBrowsingAgent": "Enhanced browsing agent with visual understanding capabilities through webpage screenshots.\n\n**Visual Features:**\n\n['**Screenshot Analysis**: Processes webpage visual content', '**Set of Marks (SOM)**: Visual element identification system', '**Enhanced Action Space**: Includes tabs, infeasibility detection', '**Coordinate-Based Interaction**: Precise element targeting', '**Multi-Modal Prompting**: Combines text and visual information']"
            },
            "Microagent System": {
              "TaskMicroagent": "Specialized microagents that require user input and are triggered by specific commands.\n\n**Task Features:**\n\n['**Variable Extraction**: Parses `${variable_name}` patterns', '**Input Validation**: Ensures required parameters are provided', '**Trigger System**: Activated by `/{agent_name}` format', '**Dynamic Prompting**: Automatically requests missing variables']",
              "KnowledgeMicroagent": "Provides specialized expertise triggered by keywords in conversations.\n\n**Knowledge Features:**\n\n['**Trigger Matching**: Keyword-based activation system', '**Domain Expertise**: Language best practices, framework guidelines', '**Pattern Recognition**: Common development patterns and tool usage']",
              "RepoMicroagent": "Repository-specific knowledge and guidelines automatically loaded from project files.\n\n**Repository Integration:**\n\n['**Auto-Discovery**: Loads from `.openhands/microagents/repo.md`', '**Third-Party Support**: Handles `.cursorrules`, `agents.md` files', '**Legacy Support**: Processes `.openhands_instructions` files', '**Project Context**: Repository-specific workflows and conventions']"
            }
          },
          "Component Relationships": "```\ngraph LR\n    subgraph \"Inheritance Hierarchy\"\n        Agent --> CodeActAgent\n        CodeActAgent --> LocAgent\n        CodeActAgent --> ReadOnlyAgent\n        Agent --> BrowsingAgent\n        Agent --> VisualBrowsingAgent\n        \n        BaseMicroagent --> KnowledgeMicroagent\n        BaseMicroagent --> RepoMicroagent\n        KnowledgeMicroagent --> TaskMicroagent\n    end\n    \n    subgraph \"Tool Dependencies\"\n        CodeActAgent --> Tools[Tool System]\n        BrowsingAgent --> BrowserGym[BrowserGym Actions]\n        VisualBrowsingAgent --> Vision[Vision Processing]\n    end\n    \n    subgraph \"Configuration\"\n        All[All Agents] --> AgentConfig\n        All --> LLMRegistry\n    end\n```",
          "Data Flow": "```\nsequenceDiagram\n    participant User\n    participant Controller\n    participant Agent\n    participant LLM\n    participant Runtime\n    participant Tools\n    \n    User->>Controller: Task Request\n    Controller->>Agent: step(state)\n    \n    alt CodeActAgent\n        Agent->>Agent: Process conversation memory\n        Agent->>Agent: Condense history if needed\n        Agent->>LLM: completion(messages, tools)\n        LLM->>Agent: Response with tool calls\n        Agent->>Agent: response_to_actions()\n        Agent->>Controller: Action(s)\n        Controller->>Runtime: Execute action\n        Runtime->>Controller: Observation\n    else BrowsingAgent\n        Agent->>Agent: Process browser state\n        Agent->>Agent: Extract accessibility tree\n        Agent->>LLM: completion(messages)\n        LLM->>Agent: Browser command\n        Agent->>Controller: BrowseInteractiveAction\n        Controller->>Runtime: Execute browser action\n        Runtime->>Controller: BrowserOutputObservation\n    else TaskMicroagent\n        Agent->>Agent: Extract variables from content\n        Agent->>Agent: Check for missing inputs\n        Agent->>User: Request missing variables\n        User->>Agent: Provide inputs\n        Agent->>Agent: Process with complete context\n    end\n    \n    Controller->>User: Result/Response\n```",
          "Integration Points": {
            "Core Agent System Integration": [
              "**Base Agent Class**: All implementations extend `openhands.controller.agent.Agent`",
              "**Action Processing**: Leverages [action_processing](action_processing.md) for command parsing",
              "**State Management**: Integrates with [state_management](state_management.md) for conversation flow"
            ],
            "LLM Integration": [
              "**Model Support**: Compatible with all models in [llm_integration](llm_integration.md)",
              "**Function Calling**: Native support for structured tool interactions",
              "**Vision Models**: VisualBrowsingAgent requires vision-capable models",
              "**Caching**: Supports prompt caching for efficiency"
            ],
            "Runtime System Integration": [
              "**Sandbox Plugins**: CodeActAgent uses [runtime_system](runtime_system.md) plugins",
              "**Browser Runtime**: Browsing agents require browser-enabled runtimes",
              "**Security**: ReadOnlyAgent provides safe runtime interaction"
            ],
            "Events and Actions": [
              "**Action Types**: Generates actions defined in [events_and_actions](events_and_actions.md)",
              "**Observation Processing**: Handles all observation types from runtime",
              "**Event Streaming**: Supports real-time event processing"
            ]
          },
          "Configuration": {
            "Agent Selection": "```\n# Agent configuration mapping\nAGENT_CLASSES = {\n    'CodeActAgent': CodeActAgent,\n    'BrowsingAgent': BrowsingAgent,\n    'VisualBrowsingAgent': VisualBrowsingAgent,\n    'LocAgent': LocAgent,\n    'ReadOnlyAgent': ReadOnlyAgent,\n}\n```",
            "Tool Configuration": "```\n# CodeActAgent tool configuration\nconfig = AgentConfig(\n    enable_cmd=True,           # Bash commands\n    enable_jupyter=True,       # Python execution\n    enable_browsing=True,      # Web browsing\n    enable_editor=True,        # File editing\n    enable_think=True,         # Reasoning\n    enable_finish=True,        # Task completion\n    enable_plan_mode=False,    # Task tracking\n    enable_llm_editor=False,   # LLM-based editing\n)\n```",
            "Microagent Configuration": "```\n# Microagent metadata structure\nname: \"example-task\"\ntype: \"task\"\nversion: \"1.0\"\ntriggers: [\"/example\"]\ninputs:\n  - name: \"target\"\n    description: \"Target to process\"\n    required: true\n```"
          },
          "Usage Patterns": {
            "General Purpose Development": "```\n# Use CodeActAgent for comprehensive development tasks\nagent = CodeActAgent(config, llm_registry)\n# Supports: coding, debugging, file operations, web research\n```",
            "Safe Exploration": "```\n# Use ReadOnlyAgent for codebase analysis\nagent = ReadOnlyAgent(config, llm_registry)\n# Supports: code reading, pattern searching, documentation\n```",
            "Web Automation": "```\n# Use BrowsingAgent for web tasks\nagent = BrowsingAgent(config, llm_registry)\n# Supports: form filling, navigation, data extraction\n\n# Use VisualBrowsingAgent for complex visual web tasks\nagent = VisualBrowsingAgent(config, llm_registry)\n# Supports: screenshot analysis, visual element interaction\n```",
            "Specialized Tasks": "```\n# Use LocAgent for location-aware tasks\nagent = LocAgent(config, llm_registry)\n# Supports: spatial reasoning, location-based operations\n\n# Use TaskMicroagent for parameterized workflows\nmicroagent = TaskMicroagent.load(\"task.md\")\n# Supports: templated tasks, user input collection\n```"
          },
          "Error Handling": {
            "Browser Error Recovery": "```\n# BrowsingAgent error handling\nif last_obs.error:\n    error_prefix = get_error_prefix(last_obs.last_browser_action)\n    self.error_accumulator += 1\n    if self.error_accumulator > 5:\n        return MessageAction('Too many errors encountered. Task failed.')\n```",
            "Microagent Validation": "```\n# Microagent loading with validation\ntry:\n    agent = BaseMicroagent.load(file_path)\nexcept MicroagentValidationError as e:\n    logger.error(f'Validation error: {e}')\nexcept Exception as e:\n    logger.error(f'Loading error: {e}')\n```"
          },
          "Performance Considerations": {
            "Memory Management": [
              "**Conversation Condensation**: CodeActAgent automatically condenses long conversations",
              "**Event Filtering**: Browsing agents filter relevant observations",
              "**Tool Caching**: Reuses tool definitions across requests"
            ],
            "Model Optimization": [
              "**Short Descriptions**: Uses concise tool descriptions for token-limited models",
              "**Prompt Caching**: Leverages model-specific caching when available",
              "**Vision Processing**: Optimizes image handling for visual agents"
            ]
          },
          "Security Features": {
            "ReadOnlyAgent Safety": [
              "**Tool Restriction**: Only allows non-modifying operations",
              "**MCP Blocking**: Explicitly prevents MCP tool usage",
              "**Sandbox Isolation**: Runs in restricted runtime environment"
            ],
            "Input Validation": [
              "**Microagent Validation**: Strict metadata validation",
              "**Tool Parameter Checking**: Validates all tool inputs",
              "**Action Sanitization**: Cleans potentially harmful commands"
            ]
          },
          "Future Extensions": {
            "Planned Enhancements": [
              "**Multi-Agent Coordination**: Agent collaboration frameworks",
              "**Custom Tool Integration**: User-defined tool plugins",
              "**Advanced Memory**: Persistent knowledge across sessions",
              "**Performance Metrics**: Detailed agent performance tracking"
            ],
            "Integration Opportunities": [
              "**Enterprise Features**: Integration with [enterprise_integrations](enterprise_integrations.md)",
              "**Security Analysis**: Enhanced [security_system](security_system.md) integration",
              "**Storage Optimization**: Advanced [storage_system](storage_system.md) usage"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "events_and_actions",
      "description": null,
      "content": {
        "Events and Actions Module": {
          "Overview": "The `events_and_actions` module is the foundational event-driven architecture component of the OpenHands system. It provides the core abstractions and infrastructure for handling all system interactions through a unified event model. This module defines the base classes for events, actions, and observations, along with the streaming and storage mechanisms that enable real-time communication between different system components.",
          "Purpose": "The events_and_actions module serves as the central nervous system of OpenHands, enabling:\n\n['**Event-Driven Architecture**: All system interactions are modeled as events, providing a consistent and traceable communication pattern', '**Real-time Streaming**: Live event streaming capabilities for real-time system monitoring and interaction', '**Action-Observation Pattern**: A structured approach where actions trigger observations, creating a clear cause-and-effect relationship', '**Event Persistence**: Comprehensive event storage and retrieval mechanisms for system state management and debugging', '**Type Safety**: Strongly typed event system with enumerated action and observation types']",
          "Architecture Overview": "The module follows a hierarchical event model with three main categories:\n\n```\ngraph TB\n    Event[Event - Base Class] --> Action[Action]\n    Event --> Observation[Observation]\n    Event --> CustomEvents[Custom Events]\n    \n    Action --> ActionTypes[ActionType Enum<br/>- MESSAGE, READ, WRITE<br/>- RUN, BROWSE, EDIT<br/>- DELEGATE, FINISH, etc.]\n    \n    Observation --> ObservationTypes[ObservationType Enum<br/>- READ, WRITE, EDIT<br/>- RUN, BROWSE, CHAT<br/>- ERROR, SUCCESS, etc.]\n    \n    EventStream[EventStream] --> EventStore[EventStore]\n    EventStream --> Subscribers[Event Subscribers]\n    \n    EventStore --> Storage[(File Storage)]\n    Subscribers --> Controllers[Agent Controllers]\n    Subscribers --> Runtime[Runtime Systems]\n    Subscribers --> Server[Server Components]\n```",
          "Core Components": {
            "Event Hierarchy": "The module implements a three-tier event hierarchy:\n\n['**Base Event Class**: Provides common properties and metadata for all events', '**Action Events**: Represent requests or commands to be executed', '**Observation Events**: Represent responses or results from executed actions']",
            "Event Streaming System": "The event streaming system enables real-time event distribution across the system:\n\n['**EventStream**: Central event distribution hub with subscriber management', '**EventStreamSubscriber**: Enumerated subscriber types for different system components', '**Event Storage**: Persistent storage with caching and retrieval capabilities']",
            "Type System": "Strongly typed enumerations define all possible actions and observations:\n\n['**ActionType**: 25+ predefined action types covering file operations, execution, browsing, and system control', '**ObservationType**: Corresponding observation types for action results and system feedback']"
          },
          "Sub-modules": {
            "[Event Foundation](event_foundation.md)": "Core event classes and base functionality including the Event base class, Action and Observation hierarchies, EventSource types, and comprehensive metadata handling. This sub-module provides the fundamental building blocks for all system events.",
            "[Event Streaming](event_streaming.md)": "Real-time event distribution system featuring the EventStream class with subscriber management, event queuing, asynchronous processing capabilities, and the EventStoreABC interface for event persistence. This sub-module enables live communication across system components.",
            "[Type Definitions](type_definitions.md)": "Comprehensive type system defining all ActionType and ObservationType enumerations, security classifications, and confirmation statuses. This sub-module ensures type safety and provides the complete catalog of supported operations."
          },
          "Integration with Other Modules": "The events_and_actions module serves as the communication backbone for the entire OpenHands system:\n\n['**[core_agent_system](core_agent_system.md)**: Agents generate actions and consume observations through this module', '**[runtime_system](runtime_system.md)**: Runtime environments execute actions and produce observations', '**[server_and_api](server_and_api.md)**: Web interface subscribes to event streams for real-time updates', '**[llm_integration](llm_integration.md)**: LLM interactions are tracked through event metadata and metrics', '**[storage_system](storage_system.md)**: Event persistence leverages the storage system for conversation history']",
          "Event Flow Architecture": "```\nsequenceDiagram\n    participant Agent as Agent\n    participant EventStream as Event Stream\n    participant Runtime as Runtime\n    participant Storage as Storage\n    participant UI as User Interface\n    \n    Agent->>EventStream: Generate Action\n    EventStream->>Storage: Persist Event\n    EventStream->>Runtime: Notify Subscribers\n    Runtime->>Runtime: Execute Action\n    Runtime->>EventStream: Generate Observation\n    EventStream->>Storage: Persist Observation\n    EventStream->>Agent: Deliver Observation\n    EventStream->>UI: Stream Updates\n```",
          "Key Features": {
            "Event Metadata": [
              "**Timestamps**: ISO format timestamps for all events",
              "**Source Tracking**: Events tagged with source (agent, user, environment)",
              "**Causality**: Events can reference causing events for traceability",
              "**LLM Metrics**: Cost and performance tracking for AI-generated events",
              "**Tool Metadata**: Detailed information about tool calls and executions"
            ],
            "Security and Privacy": [
              "**Secret Redaction**: Automatic replacement of sensitive information in stored events",
              "**Security Risk Assessment**: Events can be classified by security risk level",
              "**Confirmation System**: High-risk actions can require user confirmation"
            ],
            "Performance Optimization": [
              "**Event Caching**: Page-based caching system for efficient event retrieval",
              "**Asynchronous Processing**: Non-blocking event processing with thread pools",
              "**Stream Filtering**: Efficient event filtering and search capabilities"
            ]
          },
          "Usage Patterns": {
            "Basic Event Creation": "```\nfrom openhands.events.action.action import Action\nfrom openhands.events.event import EventSource\n\n# Create and add an action to the event stream\naction = SomeAction(...)\nevent_stream.add_event(action, EventSource.AGENT)\n```",
            "Event Subscription": "```\nfrom openhands.events.stream import EventStreamSubscriber\n\n# Subscribe to events\nevent_stream.subscribe(\n    EventStreamSubscriber.AGENT_CONTROLLER,\n    callback_function,\n    \"unique_callback_id\"\n)\n```",
            "Event Filtering and Search": "```\n# Search for specific events\nevents = event_store.search_events(\n    start_id=0,\n    filter=EventFilter(include_types=(ActionType.READ,))\n)\n```\n\nThis module is essential for understanding how OpenHands components communicate and coordinate their activities through the event-driven architecture."
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "llm_integration",
      "description": null,
      "content": {
        "LLM Integration Module": {
          "Overview": "The LLM Integration module serves as the core language model abstraction layer for the OpenHands system, providing a unified interface for interacting with various Large Language Models (LLMs). This module handles model communication, response processing, cost tracking, token management, and advanced features like function calling, vision capabilities, and streaming responses.",
          "Purpose": "The module abstracts the complexity of working with different LLM providers and models, offering:\n\n['**Unified Interface**: Single API for multiple LLM providers (OpenAI, Anthropic, Google, etc.)', '**Advanced Features**: Function calling, vision processing, streaming responses, and prompt caching', '**Cost Management**: Automatic cost tracking and token usage monitoring', '**Reliability**: Built-in retry mechanisms and error handling', '**Flexibility**: Support for synchronous, asynchronous, and streaming operations', '**Routing**: Intelligent model selection based on task requirements']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"LLM Integration Module\"\n        subgraph \"Core LLM Classes\"\n            LLM[LLM - Base Implementation]\n            AsyncLLM[AsyncLLM - Async Operations]\n            StreamingLLM[StreamingLLM - Streaming Support]\n        end\n        \n        subgraph \"Router System\"\n            RouterLLM[RouterLLM - Base Router]\n            RouterImpl[Router Implementations]\n        end\n        \n        subgraph \"Mixins & Utilities\"\n            RetryMixin[RetryMixin - Retry Logic]\n            DebugMixin[DebugMixin - Logging & Debug]\n        end\n        \n        subgraph \"External Dependencies\"\n            LiteLLM[LiteLLM Library]\n            ModelFeatures[Model Features]\n            Config[LLM Configuration]\n        end\n    end\n    \n    subgraph \"Related Modules\"\n        CoreAgent[core_agent_system]\n        Events[events_and_actions]\n        Server[server_and_api]\n    end\n    \n    LLM --> RetryMixin\n    LLM --> DebugMixin\n    AsyncLLM --> LLM\n    StreamingLLM --> AsyncLLM\n    RouterLLM --> LLM\n    \n    LLM --> LiteLLM\n    LLM --> ModelFeatures\n    LLM --> Config\n    \n    CoreAgent --> LLM\n    Events --> LLM\n    Server --> LLM\n    \n    style LLM fill:#e1f5fe\n    style RouterLLM fill:#f3e5f5\n    style RetryMixin fill:#e8f5e8\n    style DebugMixin fill:#fff3e0\n```",
          "Sub-modules": {
            "Core LLM Implementation": "The foundational LLM classes providing different operational modes. See **[Core LLM Implementation](core_llm_implementation.md)** for detailed documentation:\n\n['**Base LLM**: Synchronous LLM operations with comprehensive feature support including function calling, vision, and cost tracking', '**Async LLM**: Asynchronous LLM operations for non-blocking calls with cancellation support', '**Streaming LLM**: Real-time streaming response handling for continuous output generation']",
            "Router System": "Intelligent model routing capabilities for optimized LLM selection. See **[Router System](router_system.md)** for detailed documentation:\n\n['**Router Base**: Abstract base class for implementing custom routing logic with multi-LLM support', '**Router Implementations**: Concrete router implementations for different routing strategies and use cases']",
            "Utility Mixins": "Reusable components providing cross-cutting functionality. See **[Utility Mixins](utility_mixins.md)** for detailed documentation:\n\n['**Retry Mixin**: Configurable retry logic with exponential backoff and intelligent error handling', '**Debug Mixin**: Comprehensive logging and debugging capabilities with structured message formatting']"
          },
          "Key Features": {
            "Multi-Provider Support": [
              "**OpenAI**: GPT models with function calling and vision",
              "**Anthropic**: Claude models with prompt caching and reasoning",
              "**Google**: Gemini models with multimodal capabilities",
              "**Local Models**: Ollama and other local deployments",
              "**Custom Providers**: Extensible architecture for new providers"
            ],
            "Advanced Capabilities": [
              "**Function Calling**: Native and mock function calling support",
              "**Vision Processing**: Image analysis and multimodal interactions",
              "**Prompt Caching**: Optimized token usage with cache management",
              "**Streaming Responses**: Real-time response generation",
              "**Cost Tracking**: Automatic cost calculation and monitoring"
            ],
            "Reliability Features": [
              "**Retry Logic**: Configurable retry with exponential backoff",
              "**Error Handling**: Comprehensive exception management",
              "**Rate Limiting**: Built-in rate limit handling",
              "**Timeout Management**: Configurable request timeouts"
            ]
          },
          "Integration Points": {
            "With Core Agent System": "The LLM Integration module is tightly integrated with the [core_agent_system](core_agent_system.md):\n\n['**Agent Management**: Agents use LLM instances for decision making and response generation', '**Action Processing**: Action parsers leverage LLM capabilities for parsing agent responses and converting between formats', '**State Management**: State management systems coordinate with LLM operations for maintaining conversation context']",
            "With Events and Actions": "Integration with [events_and_actions](events_and_actions.md) enables:\n\n['**Event-Driven Interactions**: LLM responses trigger events that flow through the system', '**Action-Based Processing**: LLM outputs are converted to structured actions for agent execution', '**Observation Handling**: System observations are formatted and fed back to LLMs for context']",
            "With Server and API": "The [server_and_api](server_and_api.md) module utilizes LLM integration for:\n\n['**WebSocket Streaming**: Real-time streaming responses through WebSocket connections', '**API Endpoints**: RESTful API operations powered by LLM capabilities', '**Session Management**: Persistent LLM state across user sessions and conversations']",
            "With Agent Implementations": "Various [agent_implementations](agent_implementations.md) depend on LLM integration:\n\n['**CodeAct Agents**: Use LLMs for code generation and execution planning', '**Browsing Agents**: Leverage vision-capable LLMs for web interaction', '**Specialized Agents**: Each agent type utilizes specific LLM features optimized for their tasks']",
            "With Configuration System": "The [core_configuration](core_configuration.md) module provides:\n\n['**LLM Configuration**: Centralized configuration management for all LLM settings', '**Security Settings**: API key management and security configurations', '**Environment-Specific Settings**: Different configurations for development, testing, and production']"
          },
          "Configuration": "The module supports extensive configuration through `LLMConfig`:\n\n```\n# Example configuration\nllm_config = LLMConfig(\n    model=\"gpt-4\",\n    api_key=\"your-api-key\",\n    temperature=0.7,\n    max_output_tokens=4096,\n    native_tool_calling=True,\n    caching_prompt=True,\n    num_retries=3\n)\n```",
          "Usage Examples": {
            "Basic LLM Usage": "```\nfrom openhands.llm.llm import LLM\nfrom openhands.core.config import LLMConfig\n\n# Initialize LLM\nconfig = LLMConfig(model=\"gpt-4\")\nllm = LLM(config=config, service_id=\"main\")\n\n# Make completion\nresponse = llm.completion(\n    messages=[{\"role\": \"user\", \"content\": \"Hello!\"}]\n)\n```",
            "Async Operations": "```\nfrom openhands.llm.async_llm import AsyncLLM\n\nasync_llm = AsyncLLM(config=config, service_id=\"async\")\nresponse = await async_llm.async_completion(\n    messages=[{\"role\": \"user\", \"content\": \"Hello!\"}]\n)\n```",
            "Streaming Responses": "```\nfrom openhands.llm.streaming_llm import StreamingLLM\n\nstreaming_llm = StreamingLLM(config=config, service_id=\"stream\")\nasync for chunk in streaming_llm.async_streaming_completion(\n    messages=[{\"role\": \"user\", \"content\": \"Tell me a story\"}]\n):\n    print(chunk['choices'][0]['delta'].get('content', ''), end='')\n```"
          },
          "Metrics and Monitoring": "The module provides comprehensive metrics tracking:\n\n['**Cost Tracking**: Per-request and accumulated costs', '**Token Usage**: Input, output, and cached token counts', '**Latency Monitoring**: Response time tracking', '**Error Rates**: Retry and failure statistics']",
          "Security Considerations": [
            "**API Key Management**: Secure handling of authentication credentials",
            "**Content Filtering**: Support for safety settings and content moderation",
            "**Rate Limiting**: Built-in protection against API abuse",
            "**Input Validation**: Comprehensive message and parameter validation"
          ],
          "Performance Optimization": [
            "**Prompt Caching**: Reduces token costs for repeated prompts",
            "**Connection Pooling**: Efficient HTTP connection management",
            "**Batch Processing**: Support for batch operations where available",
            "**Model Routing**: Intelligent model selection for optimal performance"
          ],
          "Error Handling": "The module implements robust error handling:\n\n['**Retry Logic**: Automatic retry for transient failures', '**Graceful Degradation**: Fallback mechanisms for service unavailability', '**Detailed Logging**: Comprehensive error reporting and debugging', '**User-Friendly Messages**: Clear error communication']",
          "Future Enhancements": [
            "**Multi-Modal Expansion**: Enhanced support for audio and video processing",
            "**Advanced Routing**: ML-based model selection optimization",
            "**Caching Improvements**: More sophisticated caching strategies",
            "**Performance Analytics**: Advanced performance monitoring and optimization"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "runtime_system",
      "description": null,
      "content": {
        "Runtime System": {
          "Overview": "The Runtime System is a core component of OpenHands that provides sandboxed execution environments for AI agents to interact with external systems. It abstracts the complexity of different execution environments while providing a consistent interface for command execution, file operations, browser interactions, and development tools.",
          "Purpose": "The Runtime System serves as the execution layer that:\n\n['**Provides Sandboxed Environments**: Isolates agent operations from the host system', '**Enables Multi-Platform Support**: Supports local, containerized, and cloud-based execution', '**Facilitates Tool Integration**: Integrates development tools like VSCode, Jupyter, and browsers', '**Manages Resource Lifecycle**: Handles creation, management, and cleanup of execution environments', '**Ensures Security**: Implements security controls and access restrictions']",
          "Architecture Overview": {
            "Component Relationships": "```\nclassDiagram\n    class Runtime {\n        <<abstract>>\n        +run(action) Observation\n        +read(action) Observation\n        +write(action) Observation\n        +edit(action) Observation\n        +browse(action) Observation\n        +connect() void\n        +close() void\n    }\n    \n    class LocalRuntime {\n        +execute_action(action) Observation\n        +_create_server() ServerInfo\n        +_wait_until_alive() bool\n    }\n    \n    class CLIRuntime {\n        +_execute_shell_command() CmdOutputObservation\n        +_execute_powershell_command() CmdOutputObservation\n        +_sanitize_filename() str\n    }\n    \n    class KubernetesRuntime {\n        +_init_k8s_resources() void\n        +_wait_until_ready() void\n        +_cleanup_k8s_resources() void\n    }\n    \n    class ActionExecutionClient {\n        <<abstract>>\n        +execute_action(action) Observation\n        +action_execution_server_url() str\n    }\n    \n    class Plugin {\n        <<abstract>>\n        +initialize(username) void\n        +run(action) Observation\n    }\n    \n    class RuntimeBuilder {\n        <<abstract>>\n        +build(path, tags) str\n        +image_exists(image_name) bool\n    }\n    \n    Runtime <|-- LocalRuntime\n    Runtime <|-- CLIRuntime\n    Runtime <|-- KubernetesRuntime\n    ActionExecutionClient <|-- LocalRuntime\n    ActionExecutionClient <|-- KubernetesRuntime\n    Runtime --> Plugin : uses\n    Runtime --> RuntimeBuilder : uses\n```"
          },
          "Core Components": {
            "Base Runtime (`openhands.runtime.base.Runtime`)": "The abstract base class that defines the runtime interface and common functionality:\n\n['**Environment Management**: Sets up initial environment variables and configurations', '**Action Execution**: Processes and routes different types of actions', '**File Operations**: Provides file read/write/edit capabilities', '**Git Integration**: Handles repository operations and version control', '**Security Integration**: Implements security analysis and controls', '**Plugin System**: Manages runtime plugins and extensions']",
            "Runtime Implementations": {
              "1. Local Runtime (`openhands.runtime.impl.local.local_runtime.LocalRuntime`)": "Executes actions directly on the local machine using subprocess:\n\n['**Direct Execution**: Runs commands without containerization', '**Development Focus**: Optimized for development and testing scenarios', '**Warm Server Support**: Maintains pre-warmed servers for faster startup', '**Resource Management**: Handles temporary workspaces and cleanup']",
              "2. CLI Runtime (`openhands.runtime.impl.cli.cli_runtime.CLIRuntime`)": "Lightweight runtime for command-line interface usage:\n\n['**Minimal Overhead**: Direct file system and subprocess operations', '**Cross-Platform**: Supports Windows PowerShell and Unix bash', '**No Sandboxing**: Executes directly on the host system', '**Development Tool**: Ideal for local development and testing']",
              "3. Kubernetes Runtime (`openhands.runtime.impl.kubernetes.kubernetes_runtime.KubernetesRuntime`)": "Cloud-native runtime for Kubernetes environments:\n\n['**Pod Management**: Creates and manages Kubernetes pods', '**Service Integration**: Exposes services and ingress for external access', '**Resource Control**: Implements resource limits and node selection', '**Persistent Storage**: Manages persistent volume claims for data persistence']"
            },
            "Runtime Builder (`openhands.runtime.builder.base.RuntimeBuilder`)": "Abstract interface for building runtime images:\n\n['**Image Building**: Defines interface for building container images', '**Platform Support**: Handles multi-platform builds', '**Tag Management**: Manages image tags and versioning', '**Existence Checking**: Verifies image availability']",
            "Plugin System (`openhands.runtime.plugins.requirement.Plugin`)": "Extensible plugin architecture for runtime capabilities:\n\n['**Plugin Interface**: Defines standard plugin contract', '**Initialization**: Handles plugin setup and configuration', '**Action Processing**: Processes plugin-specific actions', '**Requirement Management**: Manages plugin dependencies']"
          },
          "Sub-Modules": {
            "[Runtime Implementations](runtime_implementations.md)": "Detailed documentation of specific runtime implementations including Local, CLI, and Kubernetes runtimes with their unique features, configuration options, and use cases.",
            "[Plugin System](plugin_system.md)": "Comprehensive guide to the runtime plugin architecture, plugin development, and available plugins for extending runtime capabilities.",
            "[Builder System](builder_system.md)": "Documentation of the runtime image building system, builder implementations, and container image management for different runtime environments."
          },
          "Key Features": {
            "Multi-Runtime Support": "The system supports multiple execution environments:\n\n['**Local Runtime**: Direct local execution with Docker integration', '**CLI Runtime**: Lightweight command-line execution', '**Kubernetes Runtime**: Cloud-native container orchestration']",
            "Security Integration": "Built-in security features:\n\n['**Security Analysis**: Integrates with the [Security System](security_system.md)', '**Access Control**: Restricts file system access to workspace boundaries', '**Environment Isolation**: Provides sandboxed execution environments']",
            "Development Tools Integration": "Seamless integration with development tools:\n\n['**VSCode Server**: Provides web-based IDE access', '**Jupyter Notebooks**: Supports interactive Python execution', '**Browser Environment**: Enables web browsing and interaction']",
            "Git Operations": "Comprehensive Git support:\n\n['**Repository Cloning**: Automated repository setup', '**Branch Management**: Handles branch creation and switching', '**Authentication**: Integrates with Git provider tokens', '**Microagent Loading**: Loads organization-level configurations']"
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Agent as Core Agent\n    participant Runtime as Runtime Base\n    participant Impl as Runtime Implementation\n    participant External as External System\n    \n    Agent->>Runtime: Execute Action\n    Runtime->>Runtime: Security Analysis\n    Runtime->>Runtime: Environment Setup\n    Runtime->>Impl: Route to Implementation\n    Impl->>External: Execute Command/Operation\n    External-->>Impl: Return Result\n    Impl-->>Runtime: Observation\n    Runtime->>Runtime: Process Result\n    Runtime-->>Agent: Return Observation\n```",
          "Configuration": "Runtime configuration is managed through the OpenHands configuration system:\n\n```\nruntime: \"local\"  # or \"cli\", \"kubernetes\"\nsandbox:\n  runtime_container_image: \"ghcr.io/all-hands-ai/runtime:latest\"\n  timeout: 120\n  keep_runtime_alive: false\n  local_runtime_url: \"http://localhost\"\n  \nkubernetes:\n  namespace: \"openhands\"\n  resource_memory_limit: \"2Gi\"\n  resource_cpu_request: \"500m\"\n  pvc_storage_size: \"10Gi\"\n```",
          "Integration Points": {
            "With Core Agent System": [
              "**Action Processing**: Receives actions from [Core Agent System](core_agent_system.md)",
              "**State Management**: Coordinates with agent state management",
              "**Event Streaming**: Integrates with event stream for real-time updates"
            ],
            "With Events & Actions": [
              "**Action Execution**: Processes actions from [Events & Actions](events_and_actions.md)",
              "**Observation Generation**: Creates observations for agent feedback",
              "**Event Streaming**: Participates in the event streaming system"
            ],
            "With Security System": [
              "**Security Analysis**: Leverages [Security System](security_system.md) for command analysis",
              "**Risk Assessment**: Implements security controls and restrictions",
              "**Audit Logging**: Provides security audit trails"
            ]
          },
          "Usage Examples": {
            "Basic Runtime Usage": "```\nfrom openhands.runtime import get_runtime_cls\nfrom openhands.core.config import OpenHandsConfig\n\nconfig = OpenHandsConfig()\nruntime_cls = get_runtime_cls(config.runtime)\nruntime = runtime_cls(config, event_stream, llm_registry)\n\nawait runtime.connect()\nobservation = runtime.run(CmdRunAction(command=\"ls -la\"))\n```",
            "File Operations": "```\n# Read a file\nread_obs = runtime.read(FileReadAction(path=\"/workspace/file.txt\"))\n\n# Write a file\nwrite_obs = runtime.write(FileWriteAction(\n    path=\"/workspace/output.txt\",\n    content=\"Hello, World!\"\n))\n\n# Edit a file\nedit_obs = runtime.edit(FileEditAction(\n    path=\"/workspace/code.py\",\n    old_str=\"old_code\",\n    new_str=\"new_code\"\n))\n```"
          },
          "Best Practices": {
            "Runtime Selection": [
              "**Development**: Use CLI Runtime for local development",
              "**Production**: Use Kubernetes Runtime for scalable deployments",
              "**Testing**: Use Local Runtime for integration testing"
            ],
            "Resource Management": [
              "**Cleanup**: Always call `runtime.close()` to clean up resources",
              "**Timeouts**: Set appropriate timeouts for long-running operations",
              "**Memory Limits**: Configure appropriate resource limits for your use case"
            ],
            "Security Considerations": [
              "**Workspace Isolation**: Keep operations within designated workspace boundaries",
              "**Environment Variables**: Carefully manage sensitive environment variables",
              "**Network Access**: Control network access based on security requirements"
            ]
          },
          "Error Handling": "The runtime system provides comprehensive error handling:\n\n['**AgentRuntimeDisconnectedError**: Runtime connection lost', '**AgentRuntimeNotFoundError**: Runtime not available', '**PermissionError**: Access denied to resources', '**TimeoutError**: Operation exceeded time limits']",
          "Monitoring and Observability": {
            "Status Callbacks": "Runtime implementations support status callbacks for monitoring:\n\n```\ndef status_callback(level: str, status: RuntimeStatus, message: str):\n    logger.log(level, f\"Runtime {status}: {message}\")\n\nruntime = RuntimeClass(config, status_callback=status_callback)\n```",
            "Logging": "Comprehensive logging throughout the runtime system:\n\n['**Debug**: Detailed execution traces', '**Info**: General operational information', '**Warning**: Non-critical issues', '**Error**: Critical failures requiring attention']"
          },
          "Future Enhancements": [
            "**Remote Runtime**: Support for remote execution environments",
            "**Container Runtime**: Enhanced Docker-based runtime",
            "**Plugin Marketplace**: Extensible plugin ecosystem",
            "**Performance Optimization**: Improved startup times and resource usage",
            "**Enhanced Security**: Advanced security controls and monitoring"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "git_integrations",
      "description": null,
      "content": {
        "Git Integrations Module": {
          "Overview": "The `git_integrations` module provides a unified interface for integrating with multiple Git service providers (GitHub, GitLab, and Bitbucket). It implements a common protocol-based architecture that enables OpenHands to interact with different Git platforms through a standardized API, facilitating repository management, microagent discovery, and Git-based task automation.",
          "Architecture": "The module follows a layered architecture with abstract base classes and provider-specific implementations:\n\n```\ngraph TB\n    subgraph \"Protocol Layer\"\n        GitService[GitService Protocol]\n        InstallationsService[InstallationsService Protocol]\n    end\n    \n    subgraph \"Base Services\"\n        BaseGitService[BaseGitService ABC]\n    end\n    \n    subgraph \"Provider Mixins\"\n        GitHubMixin[GitHubMixinBase]\n        GitLabMixin[GitLabMixinBase]\n        BitBucketMixin[BitBucketMixinBase]\n    end\n    \n    subgraph \"HTTP Layer\"\n        HTTPClient[HTTPClient Protocol]\n    end\n    \n    subgraph \"Data Models\"\n        Repository[Repository]\n        User[User]\n        Branch[Branch]\n        SuggestedTask[SuggestedTask]\n        MicroagentResponse[MicroagentResponse]\n    end\n    \n    GitService --> BaseGitService\n    BaseGitService --> GitHubMixin\n    BaseGitService --> GitLabMixin\n    BaseGitService --> BitBucketMixin\n    \n    GitHubMixin --> HTTPClient\n    GitLabMixin --> HTTPClient\n    BitBucketMixin --> HTTPClient\n    \n    GitService --> Repository\n    GitService --> User\n    GitService --> Branch\n    GitService --> SuggestedTask\n    GitService --> MicroagentResponse\n```",
          "Core Components": {
            "Service Foundation": "The foundational layer defines the core protocols and base classes that establish the common interface for all Git service providers. This includes the GitService protocol that standardizes operations across providers, and the BaseGitService abstract class that provides shared functionality like microagent discovery and content parsing.\n\n** See detailed documentation: [Service Foundation](service_foundation.md)**",
            "Provider Implementations  ": "Provider-specific mixin classes that handle the unique aspects of each Git platform's API, authentication methods, and data formats. Each provider mixin extends the base service with platform-specific implementations while maintaining the common interface.\n\n** See detailed documentation: [Provider Implementations](provider_implementations.md)**",
            "Data Models and Types": "The module defines comprehensive data models and type definitions that represent Git concepts consistently across all providers, including repositories, users, branches, tasks, and microagent responses."
          },
          "Data Models": {
            "Core Data Structures": "```\nclassDiagram\n    class Repository {\n        +String id\n        +String full_name\n        +ProviderType git_provider\n        +Boolean is_public\n        +Integer stargazers_count\n        +String pushed_at\n        +OwnerType owner_type\n        +String main_branch\n    }\n    \n    class User {\n        +String id\n        +String login\n        +String avatar_url\n        +String name\n        +String email\n        +String company\n    }\n    \n    class Branch {\n        +String name\n        +String commit_sha\n        +Boolean protected\n        +String last_push_date\n    }\n    \n    class SuggestedTask {\n        +ProviderType git_provider\n        +TaskType task_type\n        +String repo\n        +Integer issue_number\n        +String title\n        +get_provider_terms()\n        +get_prompt_for_task()\n    }\n    \n    class MicroagentResponse {\n        +String name\n        +String path\n        +DateTime created_at\n    }\n    \n    class MicroagentContentResponse {\n        +String content\n        +String path\n        +List~String~ triggers\n        +String git_provider\n    }\n```",
            "Enumeration Types": [
              "**ProviderType**: GitHub, GitLab, Bitbucket, Enterprise SSO",
              "**TaskType**: Merge conflicts, failing checks, unresolved comments, open issues/PRs",
              "**OwnerType**: User or Organization ownership",
              "**RequestMethod**: GET/POST HTTP methods"
            ]
          },
          "Key Functionality": {
            "Microagent Discovery System": {
              "Discovery Process": [
                "**Root File Check**: Scans for `.cursorrules` file in repository root",
                "**Directory Detection**: Determines microagent directory path based on repository structure",
                "**File Filtering**: Identifies valid `.md` microagent files (excluding README.md)",
                "**Content Parsing**: Uses BaseMicroagent infrastructure to parse content and extract triggers",
                "**Response Generation**: Creates structured responses with metadata"
              ]
            },
            "Authentication and Token Management": "```\nsequenceDiagram\n    participant Client\n    participant Service\n    participant Provider\n    participant TokenStore\n    \n    Client->>Service: Initialize with credentials\n    Service->>TokenStore: Retrieve latest token\n    Service->>Provider: Make API request\n    alt Token expired\n        Provider-->>Service: 401 Unauthorized\n        Service->>TokenStore: Refresh token\n        Service->>Provider: Retry with new token\n    end\n    Provider-->>Service: API response\n    Service-->>Client: Parsed data\n```",
            "Repository Operations": "The module provides comprehensive repository management capabilities:\n\n['**Repository Search**: Query-based repository discovery with filtering', '**Pagination Support**: Efficient handling of large repository lists', '**Branch Management**: Branch listing, searching, and pagination', '**Details Retrieval**: Complete repository metadata and configuration']"
          },
          "Integration Points": {
            "Dependencies on Other Modules": "The git_integrations module has several key dependencies within the OpenHands system:\n\n['**[microagent_system](microagent_system.md)**: Uses BaseMicroagent for content parsing and trigger extraction', '**[storage_system](storage_system.md)**: Integrates with token and settings storage for authentication management', '**[server_and_api](server_and_api.md)**: Provides services consumed by web API endpoints', '**[frontend_core](frontend_core.md)**: Supports frontend Git service API calls']",
            "External Integration Points": "```\ngraph LR\n    subgraph \"External APIs\"\n        GH[GitHub API v3/v4]\n        GL[GitLab API v4/GraphQL]\n        BB[Bitbucket API 2.0]\n    end\n    \n    subgraph \"OpenHands Modules\"\n        GI[git_integrations]\n        MS[microagent_system]\n        SS[storage_system]\n        SA[server_and_api]\n    end\n    \n    GI --> GH\n    GI --> GL  \n    GI --> BB\n    GI --> MS\n    GI --> SS\n    SA --> GI\n```"
          },
          "Error Handling": "The module implements comprehensive error handling for various failure scenarios:\n\n['**AuthenticationError**: Invalid or expired authentication credentials', '**RateLimitError**: API rate limit exceeded', '**ResourceNotFoundError**: Requested resources (files, repositories) not found', '**MicroagentParseError**: Errors parsing microagent file content', '**UnknownException**: General communication or processing errors']",
          "Configuration and Setup": {
            "Authentication Configuration": "Each provider supports multiple authentication methods:\n\n```\n# GitHub\nservice = GitHubService(\n    user_id=\"user_123\",\n    token=SecretStr(\"ghp_token\"),\n    external_auth_id=\"oauth_id\",\n    external_token_manager=True\n)\n\n# GitLab (including self-hosted)\nservice = GitLabService(\n    user_id=\"user_123\", \n    token=SecretStr(\"glpat_token\"),\n    base_domain=\"gitlab.company.com\"\n)\n\n# Bitbucket\nservice = BitBucketService(\n    user_id=\"user_123\",\n    token=SecretStr(\"username:app_password\")\n)\n```",
            "Microagent Path Configuration": "The module automatically determines microagent paths based on repository structure:\n\n['**Standard repositories**: `.openhands/microagents/`', '**OpenHands config repositories**: `microagents/`', '**Custom paths**: Configurable through repository settings']"
          },
          "Usage Examples": {
            "Repository Discovery": "```\n# Search public repositories\nrepositories = await git_service.search_repositories(\n    query=\"machine learning\",\n    per_page=50,\n    sort=\"stars\",\n    order=\"desc\",\n    public=True\n)\n\n# Get user's repositories\nuser_repos = await git_service.get_all_repositories(\n    sort=\"updated\",\n    app_mode=AppMode.SaaS\n)\n```",
            "Microagent Management": "```\n# Discover microagents\nmicroagents = await git_service.get_microagents(\"owner/repo\")\n\n# Get microagent content with triggers\ncontent = await git_service.get_microagent_content(\n    repository=\"owner/repo\",\n    file_path=\".openhands/microagents/task_agent.md\"\n)\n```",
            "Task Automation": "```\n# Get suggested tasks\ntasks = await git_service.get_suggested_tasks()\n\n# Check PR status\nis_open = await git_service.is_pr_open(\"owner/repo\", 123)\n```"
          },
          "Performance Considerations": {
            "Optimization Strategies": [
              "**Lazy Loading**: Microagent content loaded on-demand, not during discovery",
              "**Pagination**: Efficient handling of large data sets",
              "**Token Caching**: Reduced authentication overhead",
              "**Error Retry**: Automatic handling of temporary failures"
            ],
            "Resource Management": [
              "**Connection Pooling**: Reuses HTTP connections where possible",
              "**Rate Limiting**: Respects provider API limits",
              "**Caching**: Repository and user data caching strategies",
              "**Batch Operations**: Efficient bulk data retrieval"
            ]
          },
          "Future Enhancements": [
            "**Additional Providers**: Support for more Git hosting platforms",
            "**Enhanced Caching**: More sophisticated caching strategies",
            "**Webhook Support**: Real-time repository event handling",
            "**Advanced Search**: Enhanced repository and content discovery",
            "**Bulk Operations**: Mass repository management capabilities"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "server_and_api",
      "description": null,
      "content": {
        "Server and API Module": {
          "Overview": "The `server_and_api` module serves as the core web server infrastructure for OpenHands, providing HTTP/WebSocket APIs, session management, conversation orchestration, and user authentication. This module acts as the primary interface between frontend clients and the underlying agent system, managing the complete lifecycle of user interactions with AI agents.",
          "Purpose": "The server_and_api module enables:\n\n['**Web Server Operations**: FastAPI-based HTTP server with WebSocket support for real-time communication', '**Session Management**: Lifecycle management of user sessions and agent conversations', '**Conversation Orchestration**: Coordination between multiple conversations and agent sessions', '**User Authentication**: Extensible authentication framework supporting multiple auth strategies', '**Request Processing**: Middleware for rate limiting, CORS handling, and request validation', '**Real-time Communication**: WebSocket-based event streaming for live agent interactions']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Client Layer\"\n        WEB[Web Frontend]\n        API[API Clients]\n    end\n    \n    subgraph \"Server and API Module\"\n        subgraph \"Web Server Layer\"\n            MW[Middleware Stack]\n            CORS[CORS Middleware]\n            RATE[Rate Limit Middleware]\n            CACHE[Cache Control Middleware]\n        end\n        \n        subgraph \"Session Management\"\n            WS[WebSession]\n            CM[ConversationManager]\n            AS[AgentSession]\n        end\n        \n        subgraph \"Authentication\"\n            UA[UserAuth]\n            AUTH[Auth Middleware]\n        end\n        \n        subgraph \"Configuration\"\n            SC[ServerConfig]\n            SI[ServerConfigInterface]\n        end\n        \n        subgraph \"Conversation Layer\"\n            CONV[ServerConversation]\n            ALI[AgentLoopInfo]\n        end\n    end\n    \n    subgraph \"Core System Dependencies\"\n        AGENT[Agent System]\n        RUNTIME[Runtime System]\n        STORAGE[Storage System]\n        EVENTS[Events & Actions]\n    end\n    \n    WEB --> MW\n    API --> MW\n    MW --> CORS\n    MW --> RATE\n    MW --> CACHE\n    MW --> UA\n    \n    UA --> WS\n    WS --> AS\n    CM --> WS\n    CM --> CONV\n    CM --> ALI\n    \n    AS --> AGENT\n    AS --> RUNTIME\n    CONV --> RUNTIME\n    WS --> STORAGE\n    WS --> EVENTS\n    \n    SC --> SI\n    SC --> CM\n    SC --> UA\n```",
          "Core Components": {
            "1. Session Management Layer": [
              "**[WebSession](session_management.md)**: Web server-bound session wrapper managing client connections and agent lifecycle",
              "**[AgentSession](session_management.md)**: Core agent session coordinating runtime environments and LLM interactions",
              "**Event Streaming**: Real-time event communication between client and agent systems"
            ],
            "2. Conversation Orchestration": [
              "**[ConversationManager](conversation_orchestration.md)**: Abstract conversation management with pluggable implementations",
              "**[ServerConversation](conversation_orchestration.md)**: Server-side conversation state and runtime management",
              "**[AgentLoopInfo](conversation_orchestration.md)**: Conversation metadata and status tracking"
            ],
            "3. Authentication & Authorization": [
              "**[UserAuth](authentication_system.md)**: Extensible authentication framework with multiple provider support",
              "**Authentication Types**: Cookie-based and bearer token authentication methods",
              "**Provider Integration**: Git provider tokens and custom secrets management"
            ],
            "4. Web Server Infrastructure": [
              "**[RateLimitMiddleware](web_infrastructure.md)**: Request rate limiting and DDoS protection",
              "**CORS Middleware**: Cross-origin request handling with localhost support",
              "**Cache Control**: Response caching strategies for static and dynamic content"
            ],
            "5. Configuration Management": [
              "**[ServerConfigInterface](configuration_management.md)**: Abstract server configuration with extensible patterns",
              "**Environment Integration**: Configuration loading from environment variables",
              "**Feature Flags**: Runtime feature toggling and deployment-specific settings"
            ]
          },
          "Sub-Module Documentation": {
            "Session Management": "The session management module provides the core infrastructure for managing web client sessions and their associated agent interactions. It consists of WebSession for client connection management and AgentSession for agent coordination, handling the complete lifecycle from connection to termination.\n\n**[ View Session Management Documentation](session_management.md)**",
            "Conversation Orchestration  ": "The conversation orchestration module manages multiple concurrent conversations and provides extensible conversation management strategies. It includes ConversationManager for abstract conversation handling, ServerConversation for state management, and AgentLoopInfo for tracking conversation metadata.\n\n**[ View Conversation Orchestration Documentation](conversation_orchestration.md)**",
            "Authentication System": "The authentication system provides a flexible, extensible framework for user authentication and authorization. It implements an abstract base class pattern supporting multiple authentication methods including cookie-based, bearer token, and custom provider integrations.\n\n**[ View Authentication System Documentation](authentication_system.md)**",
            "Web Infrastructure": "The web infrastructure module provides foundational web server components including middleware stack for CORS, rate limiting, and cache control. It handles request processing, WebSocket communication, and provides the core HTTP server infrastructure.\n\n**[ View Web Infrastructure Documentation](web_infrastructure.md)**",
            "Configuration Management": "The configuration management module handles server configuration through the ServerConfigInterface, providing environment-based configuration overrides, feature flags, and extensible configuration patterns for different deployment scenarios.\n\n**[ View Configuration Management Documentation](configuration_management.md)**"
          },
          "Key Interactions": {
            "Session Lifecycle Flow": "```\nsequenceDiagram\n    participant Client\n    participant WebSession\n    participant ConversationManager\n    participant AgentSession\n    participant Agent\n    participant Runtime\n    \n    Client->>WebSession: Connect via WebSocket\n    WebSession->>ConversationManager: attach_to_conversation()\n    ConversationManager->>WebSession: Return conversation\n    WebSession->>AgentSession: initialize_agent()\n    AgentSession->>Runtime: Create runtime\n    AgentSession->>Agent: Initialize agent\n    Agent->>Runtime: Setup sandbox\n    Runtime-->>AgentSession: Runtime ready\n    AgentSession-->>WebSession: Agent ready\n    WebSession-->>Client: Connection established\n    \n    Client->>WebSession: Send message\n    WebSession->>AgentSession: dispatch(event)\n    AgentSession->>Agent: Process message\n    Agent->>Runtime: Execute actions\n    Runtime-->>Agent: Observations\n    Agent-->>AgentSession: Response\n    AgentSession-->>WebSession: Event stream\n    WebSession-->>Client: Real-time updates\n```",
            "Authentication Flow": "```\nsequenceDiagram\n    participant Client\n    participant Middleware\n    participant UserAuth\n    participant Storage\n    participant Session\n    \n    Client->>Middleware: HTTP Request\n    Middleware->>UserAuth: get_user_auth()\n    UserAuth->>UserAuth: validate_credentials()\n    UserAuth->>Storage: get_user_settings()\n    Storage-->>UserAuth: User settings\n    UserAuth-->>Middleware: Auth context\n    Middleware->>Session: Create/attach session\n    Session-->>Client: Authenticated response\n```"
          },
          "Integration Points": {
            "Dependencies on Other Modules": [
              "**[Core Agent System](core_agent_system.md)**: Agent lifecycle management and action processing",
              "**[Runtime System](runtime_system.md)**: Sandbox execution and environment management  ",
              "**[Storage System](storage_system.md)**: Conversation persistence and user data storage",
              "**[Events & Actions](events_and_actions.md)**: Event streaming and action processing",
              "**[LLM Integration](llm_integration.md)**: Language model communication and management"
            ],
            "External Integrations": [
              "**Frontend Systems**: WebSocket and HTTP API endpoints for client communication",
              "**Authentication Providers**: OAuth, SAML, and custom authentication integrations",
              "**Monitoring Systems**: Metrics collection and health monitoring",
              "**Load Balancers**: Session affinity and distributed deployment support"
            ]
          },
          "Configuration": {
            "Environment Variables": "```\n# Server Configuration\nOPENHANDS_CONFIG_CLS=custom.config.CustomServerConfig\nCONVERSATION_MANAGER_CLASS=custom.manager.CustomConversationManager\n\n# Authentication\nGITHUB_APP_CLIENT_ID=your_github_client_id\nENABLE_BILLING=true\nHIDE_LLM_SETTINGS=false\n\n# CORS Configuration  \nPERMITTED_CORS_ORIGINS=http://localhost:3000,https://app.example.com\n\n# Storage Classes\nSETTINGS_STORE_CLASS=custom.storage.CustomSettingsStore\nSECRET_STORE_CLASS=custom.storage.CustomSecretsStore\nCONVERSATION_STORE_CLASS=custom.storage.CustomConversationStore\n```",
            "Extension Points": "The server_and_api module provides several extension points for customization:\n\n['**ConversationManager**: Custom conversation management strategies', '**UserAuth**: Custom authentication mechanisms  ', '**ServerConfig**: Custom server configuration classes', '**Storage Classes**: Custom storage implementations', '**Middleware**: Custom request processing middleware']"
          },
          "Performance Considerations": {
            "Scalability Features": [
              "**Async/Await**: Full asynchronous request handling",
              "**Connection Pooling**: Efficient WebSocket connection management",
              "**Rate Limiting**: Configurable request rate limiting",
              "**Session Affinity**: Support for distributed deployments",
              "**Resource Cleanup**: Automatic session and resource cleanup"
            ],
            "Monitoring & Observability": [
              "**Health Checks**: Built-in health monitoring endpoints",
              "**Metrics Collection**: Performance and usage metrics",
              "**Logging**: Structured logging with session context",
              "**Error Tracking**: Comprehensive error reporting and tracking"
            ]
          },
          "Security Features": {
            "Request Security": [
              "**CORS Protection**: Configurable cross-origin request handling",
              "**Rate Limiting**: DDoS protection and abuse prevention",
              "**Input Validation**: Request payload validation and sanitization",
              "**Authentication**: Multi-provider authentication support"
            ],
            "Session Security": [
              "**Session Isolation**: Secure session boundary enforcement",
              "**Token Management**: Secure token handling and rotation",
              "**Secret Management**: Encrypted secret storage and access",
              "**Audit Logging**: Security event logging and monitoring"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "storage_system",
      "description": null,
      "content": {
        "Storage System Documentation": {
          "Overview": "The OpenHands Storage System is a comprehensive data persistence layer that provides unified interfaces for storing and managing different types of application data. The system implements a pluggable architecture that allows for multiple storage backends while maintaining consistent APIs across the application.",
          "Purpose and Core Functionality": "The storage system serves as the central data persistence layer for OpenHands, handling:\n\n['**Conversation Management**: Storing conversation metadata, including user interactions, repository information, and session state', '**User Settings**: Persisting user preferences, configuration settings, and application state', '**Secrets Management**: Secure storage and retrieval of sensitive information like API keys and tokens', '**File Operations**: Providing abstracted file storage capabilities across different backends (local, cloud, memory)']",
          "Architecture Overview": "The storage system follows a layered architecture with abstract base classes defining contracts and concrete implementations providing specific storage mechanisms:\n\n```\ngraph TB\n    subgraph \"Storage System Architecture\"\n        subgraph \"Abstract Layer\"\n            CS[ConversationStore]\n            SS[SecretsStore]\n            STS[SettingsStore]\n            FS[FileStore]\n        end\n        \n        subgraph \"Implementation Layer\"\n            FCS[FileConversationStore]\n            FSS[FileSecretsStore]\n            FSTS[FileSettingsStore]\n            LFS[LocalFileStore]\n            S3FS[S3FileStore]\n            GCFS[GoogleCloudFileStore]\n            MFS[MemoryFileStore]\n        end\n        \n        subgraph \"Data Models\"\n            CM[ConversationMetadata]\n            US[UserSecrets]\n            SET[Settings]\n        end\n        \n        subgraph \"Integration Layer\"\n            WH[WebHookFileStore]\n            BWH[BatchedWebHookFileStore]\n        end\n    end\n    \n    CS --> FCS\n    SS --> FSS\n    STS --> FSTS\n    FS --> LFS\n    FS --> S3FS\n    FS --> GCFS\n    FS --> MFS\n    \n    FCS --> FS\n    FSS --> FS\n    FSTS --> FS\n    \n    FCS --> CM\n    FSS --> US\n    FSTS --> SET\n    \n    FS --> WH\n    WH --> BWH\n```",
          "System Components": {
            "Core Storage Interfaces": "The storage system is built around four primary abstract interfaces:\n\n['**ConversationStore**: Manages conversation metadata and session information', '**SecretsStore**: Handles secure storage of sensitive user data', '**SettingsStore**: Persists user preferences and configuration settings', '**FileStore**: Provides low-level file operations across different backends']",
            "Data Models": "The system uses well-defined data models to ensure type safety and consistency:\n\n['**ConversationMetadata**: Contains conversation details, repository information, cost metrics, and session state', '**UserSecrets**: Manages provider tokens and custom secrets with secure serialization', '**Settings**: Stores user preferences, LLM configurations, and application settings']",
            "Storage Backends": "The system supports multiple storage backends through the FileStore interface:\n\n['**Local Storage**: File system-based storage for development and single-user deployments', '**Cloud Storage**: S3 and Google Cloud Storage for scalable, distributed deployments', '**Memory Storage**: In-memory storage for testing and temporary data', '**Webhook Integration**: Real-time synchronization with external systems']"
          },
          "Sub-Module Architecture": {
            "Conversation Management": "**File**: [conversation_management.md](conversation_management.md)\n\nProvides persistent storage and management capabilities for conversation metadata, enabling OpenHands to maintain conversation history, user associations, and conversation lifecycle management. This module implements the ConversationStore abstract interface with support for metadata validation, search operations, and parallel data retrieval.",
            "User Data Management  ": "**File**: [user_data_management.md](user_data_management.md)\n\nManages secure storage of user-specific data including settings and secrets. This module handles sensitive information like API keys and authentication tokens through the SecretsStore interface, while managing user preferences and configuration through the SettingsStore interface. Both stores implement secure serialization and proper data validation.",
            "File Storage Infrastructure": "**File**: [file_storage_infrastructure.md](file_storage_infrastructure.md)\n\nProvides the foundational file storage capabilities that underpin all other storage operations. This module implements the FileStore abstract interface with support for multiple backends (local, S3, Google Cloud, memory) and includes webhook integration for real-time synchronization with external systems. The infrastructure supports both standard and batched webhook operations for optimal performance."
          },
          "Integration with Other Modules": {
            "Server and API Integration": [
              "**ConversationManager** ([server_and_api.md](server_and_api.md)): Uses ConversationStore for session management",
              "**UserAuth** ([server_and_api.md](server_and_api.md)): Integrates with SecretsStore for authentication tokens"
            ],
            "Configuration Management": [
              "**OpenHandsConfig** ([core_configuration.md](core_configuration.md)): Provides configuration for storage backends",
              "**SecurityConfig** ([core_configuration.md](core_configuration.md)): Defines security policies for sensitive data"
            ],
            "Git Integrations": [
              "**GitService** ([git_integrations.md](git_integrations.md)): Stores repository credentials and provider tokens through SecretsStore"
            ]
          },
          "Data Flow and Operations": "```\nsequenceDiagram\n    participant Client\n    participant Server\n    participant ConversationStore\n    participant FileStore\n    participant Backend\n    \n    Client->>Server: Create/Update Conversation\n    Server->>ConversationStore: save_metadata()\n    ConversationStore->>FileStore: write()\n    FileStore->>Backend: Store Data\n    Backend-->>FileStore: Confirmation\n    FileStore-->>ConversationStore: Success\n    ConversationStore-->>Server: Success\n    Server-->>Client: Response\n    \n    Client->>Server: Retrieve Conversation\n    Server->>ConversationStore: get_metadata()\n    ConversationStore->>FileStore: read()\n    FileStore->>Backend: Fetch Data\n    Backend-->>FileStore: Data\n    FileStore-->>ConversationStore: Data\n    ConversationStore-->>Server: ConversationMetadata\n    Server-->>Client: Conversation Data\n```",
          "Security and Data Protection": "The storage system implements several security measures:\n\n['**Secret Masking**: Sensitive data is automatically masked in serialization contexts', '**User Validation**: Conversation ownership validation prevents unauthorized access', '**Secure Serialization**: Custom serializers handle sensitive fields appropriately', '**Event Stream Protection**: Secrets are automatically masked from event streams']",
          "Configuration and Deployment": "The storage system supports flexible configuration through the OpenHands configuration system:\n\n```\n[core]\nfile_store = \"local\"  # Options: local, s3, google_cloud, memory\nfile_store_path = \"/path/to/storage\"\n\n# Webhook integration (optional)\nfile_store_web_hook_url = \"https://api.example.com/webhook\"\nfile_store_web_hook_batch = true\n\n[server]\nconversation_store_class = \"custom.ConversationStore\"\nsecrets_store_class = \"custom.SecretsStore\"\nsettings_store_class = \"custom.SettingsStore\"\n```",
          "Extension Points": "The storage system provides several extension points for customization:\n\n['**Custom Store Implementations**: Applications can implement custom storage backends', '**Webhook Integrations**: Real-time synchronization with external systems', '**Data Model Extensions**: Additional fields can be added to data models', '**Backend Plugins**: New storage backends can be added through the FileStore interface']",
          "Performance Considerations": [
            "**Async Operations**: All storage operations are asynchronous for better performance",
            "**Batch Processing**: Webhook operations support batching for improved throughput",
            "**Parallel Operations**: Multiple metadata operations can be executed in parallel",
            "**Caching**: Implementation-specific caching can be added at the FileStore level"
          ],
          "Error Handling and Reliability": "The storage system implements robust error handling:\n\n['**Retry Logic**: Webhook operations include automatic retry mechanisms', '**Validation**: Data models include comprehensive validation rules', '**Graceful Degradation**: Missing or corrupted data is handled gracefully', '**Logging**: Comprehensive logging for debugging and monitoring']\n\nThis storage system provides a solid foundation for OpenHands' data persistence needs while maintaining flexibility for different deployment scenarios and integration requirements."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "frontend_core",
      "description": null,
      "content": {
        "Frontend Core Module": {
          "Overview": "The `frontend_core` module serves as the primary API layer for the OpenHands frontend application, providing a comprehensive set of services for interacting with the backend systems. This module acts as the bridge between the React frontend and various backend services, handling authentication, conversation management, Git operations, and user interactions.",
          "Purpose": "The frontend_core module centralizes all API communications and provides:\n\n['**Unified API Interface**: Single point of access for all backend services', '**Authentication Management**: Handles user authentication and session management', '**Git Integration**: Provides comprehensive Git repository and branch management', '**Conversation Orchestration**: Manages AI agent conversations and interactions', '**User Management**: Handles user profile and preference operations']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Frontend Core Module\"\n        OH[OpenHands API Service]\n        AS[AuthService]\n        GS[GitService]\n        US[UserService]\n    end\n    \n    subgraph \"Backend Integration\"\n        SA[Server & API Module]\n        GI[Git Integrations Module]\n        CSM[Core Agent System]\n        SS[Storage System]\n    end\n    \n    subgraph \"Frontend State\"\n        FSM[Frontend State Management]\n    end\n    \n    OH --> SA\n    AS --> SA\n    GS --> GI\n    US --> SA\n    \n    OH -.-> FSM\n    AS -.-> FSM\n    GS -.-> FSM\n    US -.-> FSM\n    \n    OH --> CSM\n    OH --> SS\n```",
          "Core Components": {
            "1. OpenHands API Service (`frontend.src.api.open-hands.OpenHands`)": "The central API service that handles:\n\n['**Conversation Management**: Create, start, stop, and manage AI agent conversations', '**Feedback System**: Submit and retrieve user feedback for conversations', '**Workspace Operations**: File management, workspace downloads, and VSCode integration', '**Billing Integration**: Handle subscription and payment operations', '**Microagent Operations**: Manage and interact with specialized AI agents']",
            "2. Authentication Service (`frontend.src.api.auth-service.auth-service.api.AuthService`)": "Handles all authentication-related operations:\n\n['**Multi-mode Authentication**: Supports both SaaS and OSS authentication modes', '**GitHub Integration**: OAuth flow management for GitHub access tokens', '**Session Management**: Login/logout operations across different app modes']",
            "3. Git Service (`frontend.src.api.git-service.git-service.api.GitService`)": "Comprehensive Git operations management:\n\n['**Repository Discovery**: Search and browse user repositories across providers', '**Branch Management**: List, search, and manage repository branches', '**Installation Handling**: Manage GitHub App installations and permissions', '**Microagent Integration**: Repository-specific microagent discovery and content retrieval']",
            "4. User Service (`frontend.src.api.user-service.user-service.api.UserService`)": "User profile and information management:\n\n[\"**Profile Retrieval**: Get current user's Git profile information\", '**User Context**: Maintain user identity across sessions']"
          },
          "Integration Points": {
            "Backend Module Dependencies": "The frontend_core module integrates with several backend modules:\n\n['**[server_and_api](server_and_api.md)**: Primary backend API endpoints for conversations, authentication, and user management', '**[git_integrations](git_integrations.md)**: Git provider services for repository and branch operations', '**[core_agent_system](core_agent_system.md)**: Agent conversation management and control', '**[storage_system](storage_system.md)**: Persistent storage for conversations, files, and user data']",
            "Frontend State Integration": "Works closely with **[frontend_state_management](frontend_state_management.md)** to:\n\n['Synchronize API responses with application state', 'Manage loading states and error handling', 'Cache frequently accessed data', 'Provide real-time updates to UI components']"
          },
          "Data Flow Architecture": "```\nsequenceDiagram\n    participant UI as Frontend UI\n    participant FC as Frontend Core\n    participant SA as Server & API\n    participant GI as Git Integrations\n    participant CS as Core Agent System\n    \n    UI->>FC: User Action\n    FC->>SA: API Request\n    SA->>GI: Git Operations\n    SA->>CS: Agent Commands\n    CS-->>SA: Agent Response\n    GI-->>SA: Git Data\n    SA-->>FC: API Response\n    FC-->>UI: Updated State\n```",
          "Key Features": {
            "Conversation Management": [
              "Create and manage AI agent conversations",
              "Real-time conversation state tracking",
              "Session-based API key management",
              "Conversation history and search"
            ],
            "File Operations": [
              "Workspace file listing and retrieval",
              "Multi-file upload support",
              "Workspace zip download",
              "Real-time file change tracking"
            ],
            "Git Integration": [
              "Multi-provider repository access",
              "Branch discovery and management",
              "Installation-based repository filtering",
              "Microagent repository integration"
            ],
            "Feedback System": [
              "Conversation rating and feedback",
              "Event-specific feedback tracking",
              "Batch feedback operations",
              "Metadata-rich feedback storage"
            ],
            "Development Tools": [
              "VSCode integration URLs",
              "Runtime configuration access",
              "Trajectory analysis and debugging",
              "Git change visualization"
            ]
          },
          "Error Handling": "The module implements comprehensive error handling:\n\n['**Network Resilience**: Automatic retry mechanisms for failed requests', '**Authentication Errors**: Graceful handling of expired sessions', '**Provider Failures**: Fallback mechanisms for Git provider issues', '**Validation Errors**: Client-side validation before API calls']",
          "Security Considerations": [
            "**Session Management**: Secure API key handling per conversation",
            "**Provider Tokens**: Encrypted storage of Git provider tokens",
            "**CORS Handling**: Proper cross-origin request management",
            "**Input Validation**: Sanitization of user inputs before API calls"
          ],
          "Performance Optimizations": [
            "**Request Caching**: Intelligent caching of frequently accessed data",
            "**Pagination Support**: Efficient handling of large datasets",
            "**Lazy Loading**: On-demand loading of repository and branch data",
            "**Batch Operations**: Grouped API calls for improved performance"
          ],
          "Future Enhancements": [
            "**WebSocket Integration**: Real-time conversation updates",
            "**Offline Support**: Cached operations for offline scenarios",
            "**Advanced Search**: Enhanced repository and conversation search",
            "**Multi-tenant Support**: Enterprise-grade multi-tenancy features"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "frontend_state_management",
      "description": null,
      "content": {
        "Frontend State Management Module": {
          "Overview": "The Frontend State Management module is a critical component of the OpenHands system that manages the client-side application state using Redux Toolkit. This module provides centralized state management for the frontend application, handling conversation interactions, code editing, and system metrics tracking.",
          "Purpose": "This module serves as the single source of truth for frontend application state, enabling:\n\n['**Conversation Management**: Managing chat interactions, file uploads, and UI panel states', '**Code Editor State**: Tracking file contents, editor states, and unsaved changes', '**Metrics Tracking**: Monitoring system usage, costs, and token consumption', '**UI State Coordination**: Synchronizing various UI components and their states']",
          "Architecture Overview": "The module follows Redux Toolkit patterns with three main state slices that work together to provide comprehensive state management:\n\n```\ngraph TB\n    subgraph \"Frontend State Management\"\n        CS[ConversationState]\n        FS[FileState]\n        MS[MetricsState]\n    end\n    \n    subgraph \"External Dependencies\"\n        API[Frontend Core APIs]\n        UI[UI Components]\n        BACKEND[Server & API Module]\n    end\n    \n    CS --> UI\n    FS --> UI\n    MS --> UI\n    \n    API --> CS\n    API --> FS\n    API --> MS\n    \n    BACKEND --> API\n    \n    style CS fill:#e1f5fe\n    style FS fill:#f3e5f5\n    style MS fill:#e8f5e8\n```",
          "Core Components": {
            "1. ConversationState": "**Location**: `frontend.src.state.conversation-slice.ConversationState`\n\nManages all conversation-related state including:\n\n['**Panel Management**: Right panel visibility and tab selection', '**File Handling**: Image and file uploads with loading states', '**Message Flow**: Message composition and submission tracking', '**UI Behavior**: Suggestion visibility and agent loading states']\n\n**Key Features**:\n\n['Multi-tab support (editor, browser, jupyter, served, vscode, terminal)', 'Asynchronous file upload tracking', 'Message queuing and submission management', 'Dynamic UI state coordination']",
            "2. FileState": "**Location**: `frontend.src.state.code-slice.FileState`\n\nHandles code editor and file management state:\n\n['**File Content Tracking**: Saved vs unsaved content management', '**Active File Management**: Current file path and content', '**Multi-file Support**: Managing multiple open files simultaneously', '**Change Detection**: Tracking modifications and refresh states']\n\n**Key Features**:\n\n['Differential content tracking (saved vs unsaved)', 'Multi-file state management', 'Refresh mechanism for content synchronization', 'Path-based file identification']",
            "3. MetricsState": "**Location**: `frontend.src.state.metrics-slice.MetricsState`\n\nTracks system performance and usage metrics:\n\n['**Cost Tracking**: Real-time cost monitoring', '**Budget Management**: Task-based budget limits', '**Token Usage**: Comprehensive token consumption metrics', '**Performance Monitoring**: Context window and per-turn token tracking']\n\n**Key Features**:\n\n['Real-time cost calculation', 'Token usage breakdown (prompt, completion, cache)', 'Budget constraint monitoring', 'Performance analytics']"
          },
          "State Flow Architecture": "```\nsequenceDiagram\n    participant UI as UI Components\n    participant CS as ConversationState\n    participant FS as FileState\n    participant MS as MetricsState\n    participant API as Frontend APIs\n    \n    UI->>CS: User interaction\n    CS->>API: Request data/action\n    API->>CS: Update conversation state\n    \n    UI->>FS: File operations\n    FS->>API: File content requests\n    API->>FS: Update file states\n    \n    API->>MS: System metrics\n    MS->>UI: Display metrics\n    \n    Note over CS,MS: States work independently but coordinate through UI\n```",
          "Integration with Other Modules": {
            "Frontend Core Module": "The state management module works closely with the [frontend_core](frontend_core.md) module:\n\n['**API Services**: Receives data updates from OpenHands, AuthService, GitService, and UserService', '**State Synchronization**: Maintains consistency between frontend state and backend data']",
            "Server and API Module": "Integrates with the [server_and_api](server_and_api.md) module for:\n\n['**Real-time Updates**: WebSocket connections for live state updates', '**Session Management**: Coordinating with server-side session state', '**Conversation Orchestration**: Synchronizing with backend conversation management']"
          },
          "State Management Patterns": {
            "Redux Toolkit Implementation": [
              "**Immutable Updates**: Using Redux Toolkit's Immer integration",
              "**Action Creators**: Automatically generated action creators for type safety",
              "**Slice-based Organization**: Modular state management with clear boundaries"
            ],
            "Async State Handling": [
              "**Loading States**: Comprehensive loading state management for files and images",
              "**Error Boundaries**: Graceful error handling in state updates",
              "**Optimistic Updates**: UI responsiveness through optimistic state changes"
            ]
          },
          "Key Features": {
            "1. Conversation Management": [
              "Multi-tab interface support",
              "File and image upload handling",
              "Message composition and submission",
              "Agent interaction states",
              "UI panel coordination"
            ],
            "2. Code Editor Integration": [
              "Multi-file editing support",
              "Unsaved changes tracking",
              "Content synchronization",
              "Path-based file management"
            ],
            "3. System Monitoring": [
              "Real-time cost tracking",
              "Token usage analytics",
              "Budget management",
              "Performance metrics"
            ]
          },
          "Usage Patterns": {
            "State Updates": "```\n// Conversation state updates\ndispatch(setSelectedTab('editor'));\ndispatch(addFiles(uploadedFiles));\ndispatch(setShouldShownAgentLoading(true));\n\n// File state updates\ndispatch(setActiveFilepath('/path/to/file'));\ndispatch(addOrUpdateFileState({\n  path: '/path/to/file',\n  savedContent: 'original',\n  unsavedContent: 'modified'\n}));\n\n// Metrics updates\ndispatch(setMetrics({\n  cost: 0.05,\n  usage: { prompt_tokens: 100, completion_tokens: 50 }\n}));\n```",
            "State Selection": "```\n// Accessing state in components\nconst isRightPanelShown = useSelector(state => state.conversation.isRightPanelShown);\nconst fileStates = useSelector(state => state.code.fileStates);\nconst currentCost = useSelector(state => state.metrics.cost);\n```"
          },
          "Performance Considerations": {
            "State Normalization": [
              "Efficient file state management through path-based indexing",
              "Minimal re-renders through selective state updates",
              "Optimized loading state tracking"
            ],
            "Memory Management": [
              "Automatic cleanup of unused file states",
              "Efficient image and file handling",
              "Garbage collection of temporary states"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Persistent State**: Local storage integration for state persistence",
              "**Undo/Redo**: History management for editor operations",
              "**Collaborative Editing**: Multi-user state synchronization",
              "**Advanced Metrics**: Enhanced analytics and reporting"
            ],
            "Scalability Improvements": [
              "**State Partitioning**: Further modularization for large applications",
              "**Lazy Loading**: On-demand state initialization",
              "**Caching Strategies**: Improved performance through intelligent caching"
            ]
          },
          "Related Documentation": [
            "[Frontend Core Module](frontend_core.md) - API services and core frontend functionality",
            "[Server and API Module](server_and_api.md) - Backend integration and session management",
            "[Events and Actions Module](events_and_actions.md) - Event-driven architecture integration"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "core_configuration",
      "description": null,
      "content": {
        "Core Configuration Module": {
          "Overview": "The `core_configuration` module provides essential configuration management for the OpenHands system, handling various aspects of system setup including CLI settings, security configurations, MCP (Message Control Protocol) server management, and Kubernetes deployment parameters. This module serves as the foundation for configuring different operational modes and integrations within the OpenHands ecosystem.",
          "Purpose": "This module centralizes configuration management for:\n\n['**CLI Interface Settings**: Terminal and command-line interface preferences', '**Security Configuration**: Security policies, analyzers, and confirmation modes', '**MCP Server Management**: Configuration for various MCP server types and protocols', '**Kubernetes Deployment**: Container orchestration and resource management settings']",
          "Architecture Overview": "The core configuration module is structured around four main configuration domains, each handling specific aspects of system configuration:\n\n```\ngraph TB\n    subgraph \"Core Configuration Module\"\n        CLI[CLIConfig]\n        SEC[SecurityConfig]\n        MCP[MCPConfig/OpenHandsMCPConfig]\n        K8S[KubernetesConfig]\n    end\n    \n    subgraph \"MCP Server Types\"\n        SSE[MCPSSEServerConfig]\n        STDIO[MCPStdioServerConfig]\n        SHTTP[MCPSHTTPServerConfig]\n    end\n    \n    subgraph \"External Dependencies\"\n        RT[Runtime System]\n        LLM[LLM Integration]\n        SEC_SYS[Security System]\n        SRV[Server & API]\n    end\n    \n    CLI --> RT\n    SEC --> SEC_SYS\n    MCP --> SSE\n    MCP --> STDIO\n    MCP --> SHTTP\n    MCP --> RT\n    MCP --> LLM\n    K8S --> RT\n    K8S --> SRV\n    \n    style CLI fill:#e1f5fe\n    style SEC fill:#fff3e0\n    style MCP fill:#f3e5f5\n    style K8S fill:#e8f5e8\n```",
          "Component Relationships": "```\ngraph LR\n    subgraph \"Configuration Flow\"\n        TOML[TOML Files] --> PARSER[Configuration Parsers]\n        PARSER --> CLI_CFG[CLI Config]\n        PARSER --> SEC_CFG[Security Config]\n        PARSER --> MCP_CFG[MCP Config]\n        PARSER --> K8S_CFG[Kubernetes Config]\n    end\n    \n    subgraph \"Runtime Integration\"\n        CLI_CFG --> CLI_RT[CLI Runtime]\n        SEC_CFG --> SEC_ANALYZER[Security Analyzer]\n        MCP_CFG --> MCP_ROUTER[MCP Router]\n        K8S_CFG --> K8S_RT[Kubernetes Runtime]\n    end\n    \n    subgraph \"Validation & Processing\"\n        CLI_CFG --> VALIDATION[Configuration Validation]\n        SEC_CFG --> VALIDATION\n        MCP_CFG --> VALIDATION\n        K8S_CFG --> VALIDATION\n    end\n```",
          "Sub-modules": {
            "CLI Configuration": "**Documentation**: [cli_configuration.md](cli_configuration.md)\n\nManages command-line interface settings and terminal preferences. This lightweight configuration handles user interface modes and CLI-specific behaviors, providing essential settings for terminal-based interactions with the OpenHands system.\n\n**Core Components**: `CLIConfig`\n**Integration**: Primarily used by CLI runtime components and terminal interfaces",
            "Security Configuration  ": "**Documentation**: [security_configuration.md](security_configuration.md)\n\nHandles security-related settings including confirmation modes and security analyzer selection. This configuration module integrates with the [security_system.md](security_system.md) module to provide comprehensive security management across the OpenHands platform.\n\n**Core Components**: `SecurityConfig`\n**Integration**: Works with security analyzers, confirmation systems, and policy enforcement",
            "MCP Configuration": "**Documentation**: [mcp_configuration.md](mcp_configuration.md)\n\nManages Message Control Protocol server configurations supporting multiple server types and communication protocols. This is the most sophisticated configuration component, handling various server types, protocol management, and integration scenarios including search engine services.\n\n**Core Components**: `OpenHandsMCPConfig`, `MCPConfig`, `MCPSSEServerConfig`, `MCPStdioServerConfig`, `MCPSHTTPServerConfig`\n**Integration**: Connects with [llm_integration.md](llm_integration.md), [runtime_system.md](runtime_system.md), and external service providers",
            "Kubernetes Configuration": "**Documentation**: [kubernetes_configuration.md](kubernetes_configuration.md)\n\nProvides comprehensive Kubernetes deployment configuration including resource management, networking, and security settings. This configuration module integrates closely with the [runtime_system.md](runtime_system.md) for container orchestration and the [server_and_api.md](server_and_api.md) for service deployment.\n\n**Core Components**: `KubernetesConfig`\n**Integration**: Essential for Kubernetes runtime implementations, ingress management, and resource allocation"
          },
          "Integration Points": "The core configuration module integrates with several other system modules:\n\n['**[runtime_system.md](runtime_system.md)**: Provides configuration for runtime implementations', '**[security_system.md](security_system.md)**: Supplies security analyzer and policy settings', '**[llm_integration.md](llm_integration.md)**: MCP servers can integrate with LLM services', '**[server_and_api.md](server_and_api.md)**: Server configuration affects API behavior', '**[storage_system.md](storage_system.md)**: Configuration persistence and retrieval']",
          "Configuration Flow": "```\nsequenceDiagram\n    participant User\n    participant TOML as TOML Config\n    participant Parser as Config Parser\n    participant Validator as Validator\n    participant System as System Components\n    \n    User->>TOML: Define Configuration\n    TOML->>Parser: Load Configuration\n    Parser->>Validator: Validate Settings\n    Validator->>Parser: Return Validated Config\n    Parser->>System: Apply Configuration\n    System->>User: System Ready\n```",
          "Usage Patterns": {
            "Basic Configuration Loading": "```\n# CLI Configuration\ncli_config = CLIConfig(vi_mode=True)\n\n# Security Configuration\nsecurity_config = SecurityConfig(\n    confirmation_mode=True,\n    security_analyzer=\"llm_analyzer\"\n)\n\n# MCP Configuration with multiple server types\nmcp_config = MCPConfig(\n    sse_servers=[MCPSSEServerConfig(url=\"https://api.example.com\")],\n    stdio_servers=[MCPStdioServerConfig(name=\"tavily\", command=\"npx\")]\n)\n```",
            "TOML-based Configuration": "```\n[security]\nconfirmation_mode = true\nsecurity_analyzer = \"invariant_analyzer\"\n\n[mcp]\nsse_servers = [\"https://api.example.com\"]\n\n[kubernetes]\nnamespace = \"openhands\"\nresource_memory_limit = \"4Gi\"\n```"
          },
          "Error Handling and Validation": "All configuration components implement robust validation:\n\n['**Pydantic Models**: Type safety and automatic validation', '**Custom Validators**: Domain-specific validation logic', '**Error Propagation**: Clear error messages for configuration issues', '**TOML Integration**: Structured configuration file support']",
          "Best Practices": [
            "**Configuration Isolation**: Each configuration type handles its specific domain",
            "**Validation First**: All configurations are validated before use",
            "**Extensibility**: New configuration types can be easily added",
            "**Integration Ready**: Configurations are designed for system-wide integration",
            "**Error Clarity**: Validation errors provide clear guidance for fixes"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "microagent_system",
      "description": null,
      "content": {
        "Microagent System Documentation": {
          "Overview": "The Microagent System is a specialized component within the OpenHands platform that provides a flexible framework for creating, managing, and executing lightweight, task-specific agents. These microagents serve as modular extensions that can be dynamically loaded and triggered based on specific conditions, enabling enhanced functionality and specialized knowledge integration.",
          "Purpose and Core Functionality": "The microagent system enables:\n\n['**Dynamic Agent Loading**: Automatic discovery and loading of microagents from repository directories', '**Context-Aware Triggering**: Intelligent activation based on keywords, commands, or repository context', '**Specialized Knowledge Integration**: Repository-specific guidelines, framework expertise, and task automation', '**User Input Management**: Interactive task agents that can collect and process user inputs', '**MCP Tool Integration**: Support for Message Control Protocol (MCP) tools for extended capabilities']",
          "Architecture Overview": "The microagent system follows a hierarchical architecture with three main agent types and supporting infrastructure:\n\n```\ngraph TB\n    subgraph \"Microagent System Architecture\"\n        subgraph \"Core Components\"\n            TM[TaskMicroagent]\n            KM[KnowledgeMicroagent] \n            RM[RepoMicroagent]\n            BM[BaseMicroagent]\n        end\n        \n        subgraph \"Type System\"\n            MT[MicroagentType]\n            MR[MicroagentResponse]\n            MM[MicroagentMetadata]\n            IM[InputMetadata]\n        end\n        \n        subgraph \"External Dependencies\"\n            MCP[MCP Config]\n            EX[Exception Handling]\n        end\n        \n        BM --> TM\n        BM --> KM\n        BM --> RM\n        \n        TM --> MT\n        KM --> MT\n        RM --> MT\n        \n        MM --> IM\n        MM --> MCP\n        \n        BM --> MM\n        BM --> EX\n    end\n```",
          "Component Relationships": "```\ngraph LR\n    subgraph \"Agent Hierarchy\"\n        A[BaseMicroagent] --> B[KnowledgeMicroagent]\n        B --> C[TaskMicroagent]\n        A --> D[RepoMicroagent]\n    end\n    \n    subgraph \"Type Definitions\"\n        E[MicroagentType]\n        F[MicroagentMetadata]\n        G[InputMetadata]\n        H[MicroagentResponse]\n    end\n    \n    subgraph \"External Systems\"\n        I[MCP Config]\n        J[Exception System]\n        K[File System]\n        L[Frontmatter Parser]\n    end\n    \n    A --> E\n    A --> F\n    F --> G\n    F --> I\n    A --> J\n    A --> K\n    A --> L\n```",
          "Sub-Modules": {
            "Agent Implementations": "The core microagent implementations provide the foundation for all agent types in the system. This includes the base agent class and specialized implementations for different use cases.\n\n**Key Components:**\n\n['BaseMicroagent: Foundation class for all microagent types', 'TaskMicroagent: Interactive agents with user input capabilities', 'KnowledgeMicroagent: Keyword-triggered expertise agents', 'RepoMicroagent: Repository-specific knowledge agents']\n\nFor detailed information, see [Agent Implementations](agent_implementations.md).",
            "Type System": "The type system defines the data structures, enumerations, and response models that govern microagent behavior and metadata.\n\n**Key Components:**\n\n['MicroagentType: Enumeration of agent types', 'MicroagentResponse: API response models', 'MicroagentMetadata: Agent configuration and metadata', 'InputMetadata: User input specifications']\n\nFor detailed information, see [Type System](type_system.md)."
          },
          "Agent Types and Functionality": {
            "1. Repository Microagents (RepoMicroagent)": [
              "**Purpose**: Always-active agents containing repository-specific knowledge",
              "**Activation**: Automatically loaded when working with a repository",
              "**Use Cases**: Team practices, project conventions, custom workflows",
              "**File Sources**: `.openhands_instructions`, `.cursorrules`, `agents.md`"
            ],
            "2. Knowledge Microagents (KnowledgeMicroagent)": [
              "**Purpose**: Keyword-triggered agents providing specialized expertise",
              "**Activation**: Triggered by specific keywords in conversations",
              "**Use Cases**: Language best practices, framework guidelines, tool usage",
              "**Trigger System**: Configurable keyword matching"
            ],
            "3. Task Microagents (TaskMicroagent)": [
              "**Purpose**: Interactive agents requiring user input for task execution",
              "**Activation**: Command-based triggering (e.g., `/{agent_name}`)",
              "**Use Cases**: Complex workflows, parameterized tasks, interactive automation",
              "**Input System**: Structured input collection and validation"
            ]
          },
          "Data Flow and Processing": "```\nsequenceDiagram\n    participant U as User\n    participant L as Loader\n    participant A as Agent\n    participant M as Metadata\n    participant T as Trigger System\n    \n    U->>L: Load microagents from directory\n    L->>L: Scan for .md files and special files\n    L->>A: Parse frontmatter and content\n    A->>M: Validate metadata\n    M->>A: Return validated metadata\n    A->>L: Return initialized agent\n    L->>T: Register triggers\n    \n    Note over U,T: Runtime Execution\n    U->>T: Send message/command\n    T->>T: Match triggers\n    T->>A: Activate matching agent\n    A->>U: Execute and respond\n```",
          "Integration Points": {
            "Core Agent System Integration": [
              "**Agent Management**: Microagents extend the base agent functionality defined in [core_agent_system](core_agent_system.md)",
              "**Action Processing**: Leverages action parsing capabilities for command interpretation",
              "**State Management**: Integrates with traffic control and state management systems"
            ],
            "LLM Integration": [
              "**Language Model Access**: Microagents can utilize LLM capabilities through [llm_integration](llm_integration.md)",
              "**Response Processing**: Structured response handling and parsing",
              "**Context Management**: Maintains conversation context across interactions"
            ],
            "Configuration System": [
              "**MCP Configuration**: Integrates with [core_configuration](core_configuration.md) for MCP tool setup",
              "**Security Configuration**: Respects security policies and constraints",
              "**Runtime Configuration**: Adapts to different runtime environments"
            ],
            "Storage System": [
              "**File Storage**: Utilizes [storage_system](storage_system.md) for persistent microagent storage",
              "**Conversation Storage**: Maintains interaction history and context",
              "**Settings Management**: Stores user preferences and configurations"
            ]
          },
          "Key Features": {
            "Dynamic Loading and Discovery": [
              "Automatic scanning of repository directories",
              "Support for multiple file formats and naming conventions",
              "Graceful handling of validation errors and malformed files"
            ],
            "Flexible Triggering System": [
              "Keyword-based activation for knowledge agents",
              "Command-based activation for task agents",
              "Always-active repository agents"
            ],
            "Input Management": [
              "Structured input definitions with metadata",
              "Variable extraction from content templates",
              "Interactive user input collection"
            ],
            "MCP Tool Integration": [
              "Support for stdio-based MCP servers",
              "Tool configuration validation",
              "Runtime tool availability"
            ],
            "Error Handling and Validation": [
              "Comprehensive metadata validation",
              "Detailed error reporting with context",
              "Graceful degradation for invalid configurations"
            ]
          },
          "Usage Patterns": {
            "Repository Setup": "```\n# Example microagent file: .openhands/microagents/python-best-practices.md\n---\nname: python-best-practices\ntype: knowledge\ntriggers: [\"python\", \"pep8\", \"formatting\"]\nversion: \"1.0.0\"\n---\n\nWhen working with Python code, follow these best practices:\n- Use PEP 8 for code formatting\n- Include type hints for better code clarity\n- Write comprehensive docstrings\n```",
            "Task Agent Definition": "```\n# Example task agent: .openhands/microagents/deploy.md\n---\nname: deploy\ntype: task\ninputs:\n  - name: environment\n    description: Target deployment environment\n  - name: version\n    description: Version to deploy\n---\n\nDeploy application to ${environment} with version ${version}:\n1. Run tests\n2. Build artifacts\n3. Deploy to ${environment}\n```"
          },
          "Security Considerations": [
            "**Input Validation**: All user inputs are validated against defined schemas",
            "**File System Access**: Restricted to designated microagent directories",
            "**MCP Tool Security**: Only stdio servers are currently supported for security",
            "**Content Sanitization**: Frontmatter and content parsing with safety checks"
          ],
          "Performance Characteristics": [
            "**Lazy Loading**: Microagents are loaded on-demand",
            "**Efficient Triggering**: Fast keyword matching with minimal overhead",
            "**Memory Management**: Lightweight agent instances with shared metadata",
            "**Caching**: Parsed agents are cached for repeated use"
          ],
          "Future Enhancements": [
            "**Enhanced MCP Support**: Expansion to support SSE and HTTP MCP servers",
            "**Advanced Triggering**: Context-aware and semantic triggering mechanisms",
            "**Agent Composition**: Ability to chain and compose multiple microagents",
            "**Performance Optimization**: Improved loading and execution performance",
            "**Extended File Format Support**: Additional configuration file formats"
          ],
          "Related Documentation": [
            "[Core Agent System](core_agent_system.md) - Base agent functionality and management",
            "[LLM Integration](llm_integration.md) - Language model integration and capabilities",
            "[Core Configuration](core_configuration.md) - System configuration including MCP setup",
            "[Storage System](storage_system.md) - Persistent storage and data management",
            "[Events and Actions](events_and_actions.md) - Event handling and action processing"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "security_system",
      "description": null,
      "content": {
        "Security System Module": {
          "Overview": "The Security System module provides comprehensive security analysis capabilities for the OpenHands platform, focusing on evaluating agent actions for potential security risks. This module implements a pluggable architecture that supports multiple security analysis strategies, from rule-based invariant checking to LLM-powered risk assessment.",
          "Purpose": "The security system serves as a critical safety layer that:\n\n['**Analyzes agent actions** before execution to identify potential security risks', '**Provides risk assessment** using configurable security analyzers', '**Enables policy enforcement** through invariant-based monitoring', '**Supports multiple analysis strategies** for different security requirements', '**Integrates seamlessly** with the core agent system and action processing pipeline']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Security System Architecture\"\n        SA[SecurityAnalyzer Base] --> IA[InvariantAnalyzer]\n        SA --> LRA[LLMRiskAnalyzer]\n        \n        subgraph \"Invariant Analysis\"\n            IA --> IC[InvariantClient]\n            IA --> IP[InvariantParser]\n            IC --> DS[Docker Server]\n            IP --> TE[TraceElement]\n        end\n        \n        subgraph \"LLM Analysis\"\n            LRA --> ASR[ActionSecurityRisk]\n        end\n        \n        subgraph \"External Dependencies\"\n            DS --> INV[Invariant Server Container]\n            SA --> ACT[Action Events]\n            SA --> REQ[FastAPI Requests]\n        end\n    end\n    \n    classDef analyzer fill:#e1f5fe\n    classDef invariant fill:#f3e5f5\n    classDef llm fill:#e8f5e8\n    classDef external fill:#fff3e0\n    \n    class SA,IA,LRA analyzer\n    class IC,IP,TE invariant\n    class LRA,ASR llm\n    class DS,INV,ACT,REQ external\n```",
          "Core Components": {
            "Base Security Framework": [
              "**SecurityAnalyzer**: Abstract base class defining the security analysis interface",
              "**SecurityAnalyzers Registry**: Configuration mapping for available analyzer implementations"
            ],
            "Analysis Implementations": [
              "**InvariantAnalyzer**: Rule-based security analysis using external Invariant service",
              "**LLMRiskAnalyzer**: LLM-powered risk assessment based on action attributes"
            ],
            "Supporting Infrastructure": [
              "**InvariantClient**: Client interface for communicating with Invariant security service",
              "**TraceElement Parser**: Converts OpenHands events to Invariant-compatible trace format",
              "**Risk Assessment Types**: Standardized security risk levels and classifications"
            ]
          },
          "Sub-modules": {
            "[Invariant Analysis](invariant_analysis.md)": "Advanced rule-based security analysis using the Invariant Labs security service. This comprehensive sub-module provides:\n\n['Docker-containerized security analysis server management', 'Policy-based monitoring and real-time checking capabilities', 'Sophisticated trace-based action analysis', 'Integration with external Invariant Labs security platform', 'Session management and resource lifecycle handling']",
            "[LLM Risk Analysis](llm_risk_analysis.md)": "Lightweight security analysis that leverages LLM-provided risk assessments. This streamlined sub-module features:\n\n['Direct integration with LLM-generated security attributes', 'Minimal overhead analysis for performance-critical scenarios', 'Intelligent fallback risk assessment capabilities', 'Trust-based security evaluation approach']"
          },
          "Integration Points": {
            "Core Agent System Integration": "The security system integrates with the [core_agent_system](core_agent_system.md) module through:\n\n['**Action Processing**: Security analysis occurs during action validation', '**State Management**: Security state tracking through trace elements', '**Agent Management**: Risk-based action filtering and control']",
            "Events and Actions Integration": "Deep integration with [events_and_actions](events_and_actions.md) module:\n\n['**Action Analysis**: All agent actions are evaluated for security risks', '**Event Streaming**: Security events are part of the event stream', '**Risk Classification**: Actions are tagged with security risk levels']",
            "Server and API Integration": "Integration with [server_and_api](server_and_api.md) for:\n\n['**API Request Handling**: Security analysis of incoming requests', '**Middleware Integration**: Security checks in request processing pipeline', '**Session Security**: Security context maintenance across sessions']"
          },
          "Security Risk Levels": "The system uses a standardized risk classification:\n\n```\ngraph LR\n    subgraph \"ActionSecurityRisk Levels\"\n        U[UNKNOWN = -1] --> L[LOW = 0]\n        L --> M[MEDIUM = 1]\n        M --> H[HIGH = 2]\n    end\n    \n    classDef unknown fill:#f5f5f5\n    classDef low fill:#e8f5e8\n    classDef medium fill:#fff3e0\n    classDef high fill:#ffebee\n    \n    class U unknown\n    class L low\n    class M medium\n    class H high\n```",
          "Data Flow": "```\nsequenceDiagram\n    participant Agent as Agent System\n    participant SA as SecurityAnalyzer\n    participant IA as InvariantAnalyzer\n    participant IC as InvariantClient\n    participant IS as Invariant Server\n    \n    Agent->>SA: security_risk(action)\n    SA->>IA: Analyze action\n    IA->>IC: Parse action to trace\n    IC->>IS: Check policy compliance\n    IS-->>IC: Risk assessment\n    IC-->>IA: Analysis results\n    IA->>IA: Map to ActionSecurityRisk\n    IA-->>SA: Risk level\n    SA-->>Agent: Security decision\n```",
          "Configuration": "Security analyzers are configured through the `SecurityAnalyzers` registry:\n\n```\nSecurityAnalyzers = {\n    'invariant': InvariantAnalyzer,\n    'llm': LLMRiskAnalyzer,\n}\n```",
          "Usage Patterns": {
            "Basic Security Analysis": "```\nanalyzer = SecurityAnalyzer()\nrisk_level = await analyzer.security_risk(action)\n```",
            "Invariant-based Analysis": "```\nanalyzer = InvariantAnalyzer(policy=\"security_policy.txt\")\nrisk_level = await analyzer.security_risk(action)\nawait analyzer.close()  # Cleanup Docker resources\n```",
            "LLM Risk Analysis": "```\nanalyzer = LLMRiskAnalyzer()\nrisk_level = await analyzer.security_risk(action)\n```"
          },
          "Dependencies": {
            "Internal Dependencies": [
              "**Events System**: Action and observation event types",
              "**Core Configuration**: Security configuration settings",
              "**Runtime System**: Docker integration for Invariant analyzer",
              "**LLM Integration**: For LLM-based risk assessment"
            ],
            "External Dependencies": [
              "**Docker**: Required for InvariantAnalyzer container management",
              "**Invariant Labs Service**: External security analysis service",
              "**FastAPI**: For API request handling",
              "**Pydantic**: Data validation and serialization"
            ]
          },
          "Error Handling": "The security system implements robust error handling:\n\n['**Container Management**: Graceful Docker container lifecycle management', '**Network Resilience**: Timeout and retry mechanisms for external services', '**Fallback Strategies**: Default to safe risk levels when analysis fails', '**Resource Cleanup**: Proper cleanup of allocated resources']",
          "Performance Considerations": [
            "**Lazy Initialization**: Analyzers are initialized only when needed",
            "**Container Reuse**: Docker containers are reused across analysis sessions",
            "**Async Operations**: All analysis operations are asynchronous",
            "**Minimal Overhead**: LLM analyzer provides lightweight alternative"
          ],
          "Security Considerations": [
            "**Isolation**: Invariant analysis runs in isolated Docker containers",
            "**Policy Validation**: Security policies are validated before application",
            "**Risk Escalation**: Unknown risks are treated conservatively",
            "**Audit Trail**: All security decisions are logged for audit purposes"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "enterprise_integrations",
      "description": null,
      "content": {
        "Enterprise Integrations Module": {
          "Overview": "The Enterprise Integrations module provides comprehensive integration capabilities for OpenHands with various enterprise platforms including GitHub, GitLab, Jira, and Slack. This module enables seamless workflow automation, issue tracking, and collaborative development across multiple platforms through a unified interface.",
          "Architecture Overview": "The module follows a manager-based architecture where each platform integration is handled by a dedicated manager class that implements common integration patterns while providing platform-specific functionality.\n\n```\ngraph TB\n    subgraph \"Enterprise Integrations\"\n        EM[Enterprise Manager Layer]\n        \n        subgraph \"Platform Managers\"\n            GM[GitHub Manager]\n            GLM[GitLab Manager]\n            JM[Jira Manager]\n            SM[Slack Manager]\n        end\n        \n        subgraph \"Shared Components\"\n            MSG[Message Models]\n            JR[Job Results]\n            BASE[Base Manager]\n        end\n        \n        subgraph \"External Dependencies\"\n            TM[Token Manager]\n            DC[Data Collector]\n            CB[Callback Processors]\n        end\n    end\n    \n    subgraph \"Core System Dependencies\"\n        AUTH[Authentication System]\n        CONV[Conversation Management]\n        AGENT[Agent System]\n        STORAGE[Storage System]\n    end\n    \n    GM --> BASE\n    GLM --> BASE\n    JM --> BASE\n    SM --> BASE\n    \n    GM --> TM\n    GLM --> TM\n    JM --> TM\n    SM --> TM\n    \n    GM --> DC\n    GM --> CB\n    GLM --> CB\n    JM --> CB\n    SM --> CB\n    \n    EM --> AUTH\n    EM --> CONV\n    EM --> AGENT\n    EM --> STORAGE\n    \n    style EM fill:#e1f5fe\n    style GM fill:#f3e5f5\n    style GLM fill:#f3e5f5\n    style JM fill:#f3e5f5\n    style SM fill:#f3e5f5\n```",
          "Core Components": {
            "Platform Integration Managers": {
              "1. GitHub Manager (`enterprise.integrations.github.github_manager.GithubManager`)": [
                "**Purpose**: Manages GitHub App integrations, webhook processing, and repository interactions",
                "**Key Features**:",
                [
                  "GitHub App authentication and installation token management",
                  "Issue and PR comment processing",
                  "Automated reaction acknowledgments",
                  "Repository permission validation",
                  "Solvability analysis integration"
                ]
              ],
              "2. GitLab Manager (`enterprise.integrations.gitlab.gitlab_manager.GitlabManager`)": [
                "**Purpose**: Handles GitLab webhook events and merge request interactions",
                "**Key Features**:",
                [
                  "GitLab API integration",
                  "Issue and merge request comment handling",
                  "User permission validation",
                  "Project-based access control"
                ]
              ],
              "3. Jira Manager (`enterprise.integrations.jira.jira_manager.JiraManager`)": [
                "**Purpose**: Processes Jira webhook events and manages issue tracking workflows",
                "**Key Features**:",
                [
                  "Jira Cloud API integration",
                  "Issue comment and label-based triggers",
                  "Workspace-based authentication",
                  "Repository inference from issue descriptions"
                ]
              ],
              "4. Slack Manager (`enterprise.integrations.slack.slack_manager.SlackManager`)": [
                "**Purpose**: Manages Slack bot interactions and conversation workflows",
                "**Key Features**:",
                [
                  "Slack OAuth integration",
                  "Interactive repository selection forms",
                  "Thread-based conversation management",
                  "User authentication via JWT tokens"
                ]
              ]
            },
            "Shared Models and Types": {
              "Job Result Model (`enterprise.integrations.models.JobResult`)": [
                "**Purpose**: Standardizes job execution results across all platforms",
                "**Components**:",
                [
                  "Result status and explanation",
                  "Platform-agnostic result representation"
                ]
              ]
            }
          },
          "Integration Flow": "```\nsequenceDiagram\n    participant Platform as External Platform\n    participant Manager as Platform Manager\n    participant Auth as Authentication\n    participant Conv as Conversation System\n    participant Agent as Agent System\n    \n    Platform->>Manager: Webhook Event\n    Manager->>Manager: Validate Request\n    Manager->>Auth: Authenticate User\n    Auth-->>Manager: User Credentials\n    Manager->>Manager: Check Permissions\n    Manager->>Conv: Create/Update Conversation\n    Conv-->>Manager: Conversation ID\n    Manager->>Agent: Start Job\n    Manager->>Platform: Send Acknowledgment\n    Agent->>Conv: Process Task\n    Conv->>Manager: Status Updates\n    Manager->>Platform: Send Results\n```",
          "Sub-modules": {
            "[Platform Managers](platform_managers.md)": "Detailed documentation of individual platform manager implementations, including:\n\n['**GitHub Manager**: GitHub App integration, webhook processing, and repository interactions', '**GitLab Manager**: GitLab API integration and merge request workflows  ', '**Jira Manager**: Jira Cloud integration and issue tracking workflows', '**Slack Manager**: Slack bot interactions and conversation management']",
            "[Shared Infrastructure](shared_infrastructure.md)": "Common components, models, and utilities shared across all platform integrations, including:\n\n['**Job Result Models**: Standardized result representation across platforms', '**Message Handling**: Common message processing and routing patterns', '**Base Manager Functionality**: Shared integration patterns and utilities']"
          },
          "Dependencies": "The Enterprise Integrations module relies on several core system components:\n\n['**[Server and API](server_and_api.md)**: Authentication, session management, and conversation orchestration', '**[Storage System](storage_system.md)**: User data, secrets, and conversation persistence', '**[Core Agent System](core_agent_system.md)**: Agent execution and task processing', '**[Git Integrations](git_integrations.md)**: Repository access and version control operations']",
          "Key Features": {
            "1. Unified Integration Interface": [
              "Consistent manager-based architecture across all platforms",
              "Standardized message and job result models",
              "Common authentication and permission patterns"
            ],
            "2. Webhook Processing": [
              "Secure webhook validation and signature verification",
              "Event-driven job triggering based on platform-specific events",
              "Automatic user permission validation"
            ],
            "3. Conversation Management": [
              "Seamless integration with OpenHands conversation system",
              "Platform-specific callback processors for status updates",
              "Thread and context preservation across interactions"
            ],
            "4. Authentication & Security": [
              "OAuth integration for user authentication",
              "Token management and encryption",
              "Workspace and organization-level access control"
            ],
            "5. Repository Intelligence": [
              "Automatic repository inference from issue descriptions",
              "Interactive repository selection for ambiguous cases",
              "User repository access validation"
            ]
          },
          "Configuration": "Each platform manager requires specific configuration:\n\n['**GitHub**: App ID, private key, and installation management', '**GitLab**: OAuth credentials and project access tokens', '**Jira**: Cloud ID, service account credentials, and webhook secrets', '**Slack**: Bot tokens, OAuth configuration, and workspace management']",
          "Error Handling": "The module implements comprehensive error handling:\n\n['Authentication failures with user-friendly messages', 'Permission validation with appropriate error responses', 'Graceful degradation for missing configurations', 'Detailed logging for debugging and monitoring']",
          "Future Enhancements": "The module is designed for extensibility:\n\n['Additional platform integrations (Linear, Azure DevOps, etc.)', 'Enhanced repository intelligence and matching', 'Advanced workflow automation capabilities', 'Improved analytics and reporting features']"
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "enterprise_server",
      "description": null,
      "content": {
        "Enterprise Server Module": {
          "Overview": "The `enterprise_server` module provides the enterprise-grade server configuration and authentication infrastructure for OpenHands SaaS deployments. This module extends the base server functionality with enterprise-specific features including advanced authentication, user verification, billing integration, and enhanced security middleware.",
          "Purpose": "The enterprise server module serves as the foundation for OpenHands' Software-as-a-Service (SaaS) offering, providing:\n\n['**Enterprise Configuration Management**: SaaS-specific server configuration with feature flags and provider integrations', '**Advanced Authentication**: Multi-provider authentication with JWT token management and user verification', '**Security Middleware**: Enhanced request processing with authentication state management and cookie handling', '**Integration Support**: Built-in support for GitHub, GitLab, Bitbucket, and enterprise SSO providers']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Enterprise Server Module\"\n        Config[SaaSServerConfig]\n        Auth[UserVerifier]\n        Middleware[SetAuthCookieMiddleware]\n    end\n    \n    subgraph \"Base Server Infrastructure\"\n        BaseConfig[ServerConfig]\n        BaseAuth[UserAuth]\n        BaseMiddleware[Middleware]\n    end\n    \n    subgraph \"External Integrations\"\n        GitHub[GitHub API]\n        Sheets[Google Sheets]\n        JWT[JWT Tokens]\n        Providers[Auth Providers]\n    end\n    \n    Config --> BaseConfig\n    Auth --> Sheets\n    Auth --> GitHub\n    Middleware --> JWT\n    Middleware --> Providers\n    \n    Config --> Auth\n    Config --> Middleware\n    \n    classDef enterprise fill:#e1f5fe\n    classDef base fill:#f3e5f5\n    classDef external fill:#fff3e0\n    \n    class Config,Auth,Middleware enterprise\n    class BaseConfig,BaseAuth,BaseMiddleware base\n    class GitHub,Sheets,JWT,Providers external\n```",
          "Core Components": {
            "Configuration Management": "The enterprise server's configuration system provides SaaS-specific server settings, feature flag management, and multi-provider authentication setup. See **[Configuration Management](configuration_management.md)** for detailed implementation.\n\nKey capabilities:\n\n['SaaS-specific server configuration extending base OpenHands settings', 'Dynamic feature flag management for billing, integrations, and UI customization', 'Multi-provider authentication setup (GitHub, GitLab, Bitbucket, Enterprise SSO)', 'GitHub App integration with automatic slug retrieval', 'Maintenance window configuration and management']",
            "Authentication System  ": "The user verification system manages access control through allowlist-based user management with support for multiple verification sources. See **[Authentication System](authentication_system.md)** for comprehensive details.\n\nKey capabilities:\n\n['File-based user allowlist management', 'Google Sheets integration for dynamic user verification', 'Case-insensitive username matching', 'Configurable verification sources with fallback support', 'Environment-based activation control']",
            "Security Infrastructure": "Advanced middleware providing comprehensive authentication state management, secure cookie handling, and request security enforcement. See **[Security Infrastructure](security_infrastructure.md)** for complete implementation details.\n\nKey capabilities:\n\n['JWT token validation and refresh management', 'Secure cookie handling with proper security attributes', 'Terms of Service enforcement and verification', 'Email verification requirement enforcement', 'Authentication error handling and cleanup', 'GitLab repository synchronization on re-authentication']"
          },
          "Component Relationships": "```\ngraph LR\n    subgraph \"Request Flow\"\n        Request[HTTP Request] --> Middleware[SetAuthCookieMiddleware]\n        Middleware --> Auth[Authentication Check]\n        Auth --> Verify[UserVerifier]\n        Verify --> Config[SaaSServerConfig]\n        Config --> Response[HTTP Response]\n    end\n    \n    subgraph \"Configuration Flow\"\n        EnvVars[Environment Variables] --> Config\n        Config --> Features[Feature Flags]\n        Config --> Providers[Provider Setup]\n    end\n    \n    subgraph \"Verification Flow\"\n        User[User Request] --> Verify\n        Verify --> FileList[File-based List]\n        Verify --> SheetsAPI[Google Sheets API]\n        FileList --> Allow[Allow/Deny]\n        SheetsAPI --> Allow\n    end\n    \n    classDef flow fill:#e8f5e8\n    classDef component fill:#fff2cc\n    classDef external fill:#ffe6cc\n    \n    class Request,Response,User,Allow flow\n    class Middleware,Auth,Verify,Config component\n    class EnvVars,FileList,SheetsAPI,Features,Providers external\n```",
          "Integration with Other Modules": {
            "Server and API Module": [
              "Extends base [server_and_api](server_and_api.md) functionality with enterprise-specific configurations",
              "Inherits from `ServerConfig` and `UserAuth` base classes",
              "Integrates with conversation management and session handling"
            ],
            "Git Integrations Module": [
              "Leverages [git_integrations](git_integrations.md) for provider type definitions",
              "Supports GitHub, GitLab, and Bitbucket authentication flows",
              "Manages provider-specific client configurations"
            ],
            "Storage System Module": [
              "Configures enterprise-specific storage implementations from [storage_system](storage_system.md)",
              "Uses SaaS-optimized conversation, settings, and secrets stores",
              "Supports clustered storage architectures"
            ],
            "Core Configuration Module": [
              "Builds upon [core_configuration](core_configuration.md) patterns",
              "Implements enterprise security and authentication configurations",
              "Manages feature flags and deployment-specific settings"
            ]
          },
          "Key Features": {
            "Multi-Provider Authentication": [
              "**GitHub Integration**: OAuth flow with GitHub Apps support",
              "**GitLab Integration**: GitLab OAuth with repository synchronization",
              "**Bitbucket Integration**: Bitbucket OAuth support",
              "**Enterprise SSO**: Custom enterprise single sign-on integration"
            ],
            "Advanced Security": [
              "**JWT Token Management**: Secure token generation, validation, and refresh",
              "**Webhook Verification**: GitHub webhook signature verification",
              "**Cookie Security**: Secure cookie handling with domain and SameSite policies",
              "**Terms of Service Enforcement**: Automated TOS acceptance verification"
            ],
            "User Management": [
              "**Allowlist Verification**: File-based and Google Sheets user verification",
              "**Email Verification**: Email verification enforcement",
              "**Maintenance Windows**: Configurable maintenance mode support",
              "**Billing Integration**: Optional billing system integration"
            ],
            "Configuration Flexibility": [
              "**Feature Flags**: Runtime feature toggling for billing, LLM settings, and integrations",
              "**Environment-Based Config**: Comprehensive environment variable configuration",
              "**Provider Selection**: Dynamic provider configuration based on available credentials",
              "**Deployment Modes**: Support for different deployment architectures"
            ]
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant Middleware as SetAuthCookieMiddleware\n    participant Config as SaaSServerConfig\n    participant Verifier as UserVerifier\n    participant External as External Services\n    \n    Client->>Middleware: HTTP Request with Auth Cookie\n    Middleware->>Middleware: Extract JWT Token\n    Middleware->>Config: Validate Configuration\n    Config->>External: Verify GitHub App (if needed)\n    Middleware->>Verifier: Check User Allowlist\n    Verifier->>External: Query Google Sheets/File\n    External-->>Verifier: User Status\n    Verifier-->>Middleware: Allow/Deny\n    Middleware->>Middleware: Process Request\n    Middleware->>Client: HTTP Response with Updated Cookie\n```",
          "Environment Configuration": {
            "Authentication Configuration": [
              "`GITHUB_APP_CLIENT_ID`: GitHub application client ID",
              "`GITHUB_APP_PRIVATE_KEY`: GitHub application private key",
              "`GITHUB_APP_WEBHOOK_SECRET`: GitHub webhook secret for signature verification",
              "`GITLAB_APP_CLIENT_ID`: GitLab application client ID",
              "`BITBUCKET_APP_CLIENT_ID`: Bitbucket application client ID"
            ],
            "Feature Flags": [
              "`ENABLE_BILLING`: Enable billing system integration",
              "`HIDE_LLM_SETTINGS`: Hide LLM configuration from users",
              "`ENABLE_JIRA`: Enable Jira integration",
              "`ENABLE_JIRA_DC`: Enable Jira Data Center integration",
              "`ENABLE_LINEAR`: Enable Linear integration",
              "`ENABLE_ENTERPRISE_SSO`: Enable enterprise SSO support"
            ],
            "User Verification": [
              "`GITHUB_USER_LIST_FILE`: Path to file-based user allowlist",
              "`GITHUB_USERS_SHEET_ID`: Google Sheets ID for user verification",
              "`DISABLE_WAITLIST`: Disable user verification entirely"
            ],
            "System Configuration": [
              "`OPENHANDS_CONFIG_CLS`: Configuration class path",
              "`POSTHOG_CLIENT_KEY`: PostHog analytics client key",
              "`AUTH_URL`: Custom authentication URL",
              "`MAINTENANCE_START_TIME`: Maintenance window start time"
            ]
          },
          "Security Considerations": {
            "Token Security": [
              "JWT tokens use secure signing algorithms (RS256 for GitHub, HS256 for internal)",
              "Token expiration and refresh mechanisms prevent long-lived access",
              "Secure cookie attributes (HttpOnly, Secure, SameSite) protect against XSS and CSRF"
            ],
            "Webhook Security": [
              "HMAC-SHA256 signature verification for GitHub webhooks",
              "Constant-time comparison prevents timing attacks",
              "Proper error handling prevents information leakage"
            ],
            "User Verification": [
              "Multiple verification methods (file-based, Google Sheets) provide flexibility",
              "Case-insensitive username matching prevents bypass attempts",
              "Graceful fallback when verification services are unavailable"
            ]
          },
          "Deployment Considerations": {
            "High Availability": [
              "Supports clustered conversation management for horizontal scaling",
              "Stateless middleware design enables load balancing",
              "External service dependencies (GitHub, Google Sheets) have proper error handling"
            ],
            "Monitoring and Observability": [
              "Comprehensive logging throughout authentication flows",
              "PostHog integration for analytics and user behavior tracking",
              "Error tracking and debugging support"
            ],
            "Maintenance and Updates": [
              "Configurable maintenance windows with user notification",
              "Rolling update support through stateless design",
              "Environment-based configuration enables zero-downtime updates"
            ]
          },
          "Related Documentation": [
            "**[Configuration Management](configuration_management.md)**: Detailed SaaS server configuration",
            "**[Authentication System](authentication_system.md)**: User verification and allowlist management",
            "**[Security Infrastructure](security_infrastructure.md)**: Authentication middleware and security features",
            "**[Server and API](server_and_api.md)**: Base server infrastructure",
            "**[Git Integrations](git_integrations.md)**: Provider integration details",
            "**[Storage System](storage_system.md)**: Enterprise storage implementations"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "conversation_orchestration",
      "description": null,
      "content": {
        "Conversation Orchestration Module": {
          "Core Components": {
            "ConversationManager": "The `ConversationManager` is an abstract base class that defines the interface for managing conversations in OpenHands. It serves as an extension point that allows applications to customize conversation management behavior without modifying core OpenHands code.\n\n**Key Responsibilities:**\n\n['Managing conversation lifecycle (creation, attachment, detachment, cleanup)', 'Coordinating agent loop execution and monitoring', 'Handling WebSocket connections and event streaming', 'Managing session state and user authentication', 'Providing LLM completion services for conversations']\n\n**Extension Point Design:**\nApplications can provide custom implementations by:\n\n['Creating a class that inherits from `ConversationManager`', 'Implementing all required abstract methods', 'Setting `server_config.conversation_manager_class` to the fully qualified class name']",
            "ServerConversation": "The `ServerConversation` class represents an active conversation session on the server side. It encapsulates the runtime environment, event stream, and file storage for a specific conversation.\n\n**Key Features:**\n\n['Runtime management and connection handling', 'Event stream coordination', 'File storage integration', 'Security analyzer access through runtime', 'Support for both new and existing conversation attachment']",
            "AgentLoopInfo": "The `AgentLoopInfo` data class provides metadata about active agent loops, including their location, status, and associated resources.\n\n**Information Tracked:**\n\n['Conversation ID and URL location', 'Session API key for authentication', 'Event store reference', 'Conversation and runtime status']"
          },
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Conversation Orchestration Layer\"\n        CM[ConversationManager<br/>Abstract Base Class]\n        SC[ServerConversation<br/>Session Container]\n        ALI[AgentLoopInfo<br/>Loop Metadata]\n    end\n    \n    subgraph \"Session Management\"\n        AS[AgentSession<br/>Agent Controller]\n        WS[WebSession<br/>WebSocket Handler]\n    end\n    \n    subgraph \"Storage Layer\"\n        CS[ConversationStore<br/>Metadata Storage]\n        FS[FileStore<br/>File Operations]\n        ES[EventStream<br/>Event Processing]\n    end\n    \n    subgraph \"Runtime System\"\n        RT[Runtime<br/>Execution Environment]\n        SA[SecurityAnalyzer<br/>Security Validation]\n    end\n    \n    subgraph \"LLM Integration\"\n        LLM[LLM Registry<br/>Model Management]\n        AC[AgentController<br/>Agent Coordination]\n    end\n    \n    CM --> SC\n    CM --> ALI\n    CM --> AS\n    CM --> CS\n    CM --> FS\n    \n    SC --> ES\n    SC --> RT\n    SC --> FS\n    \n    AS --> AC\n    AS --> LLM\n    AS --> RT\n    \n    RT --> SA\n    \n    SC -.-> SA\n    \n    style CM fill:#e1f5fe\n    style SC fill:#f3e5f5\n    style ALI fill:#fff3e0\n```",
          "Component Relationships": "```\nclassDiagram\n    class ConversationManager {\n        <<abstract>>\n        +attach_to_conversation(sid, user_id)\n        +detach_from_conversation(conversation)\n        +join_conversation(sid, connection_id, settings, user_id)\n        +maybe_start_agent_loop(sid, settings, user_id, initial_msg, replay_json)\n        +get_agent_session(sid)\n        +close_session(sid)\n        +send_to_event_stream(connection_id, data)\n        +request_llm_completion(sid, service_id, llm_config, messages)\n    }\n    \n    class ServerConversation {\n        +sid: str\n        +file_store: FileStore\n        +event_stream: EventStream\n        +runtime: Runtime\n        +user_id: str\n        +connect()\n        +disconnect()\n        +security_analyzer\n    }\n    \n    class AgentLoopInfo {\n        +conversation_id: str\n        +url: str\n        +session_api_key: str\n        +event_store: EventStoreABC\n        +status: ConversationStatus\n        +runtime_status: RuntimeStatus\n    }\n    \n    class AgentSession {\n        +sid: str\n        +user_id: str\n        +event_stream: EventStream\n        +controller: AgentController\n        +runtime: Runtime\n        +start()\n        +close()\n        +get_state()\n    }\n    \n    ConversationManager --> ServerConversation : manages\n    ConversationManager --> AgentLoopInfo : tracks\n    ConversationManager --> AgentSession : coordinates\n    ServerConversation --> EventStream : uses\n    ServerConversation --> Runtime : manages\n    AgentSession --> AgentController : contains\n    AgentSession --> Runtime : uses\n```",
          "Data Flow Architecture": "```\nsequenceDiagram\n    participant Client\n    participant CM as ConversationManager\n    participant SC as ServerConversation\n    participant AS as AgentSession\n    participant RT as Runtime\n    participant ES as EventStream\n    \n    Client->>CM: join_conversation(sid, settings)\n    CM->>CM: attach_to_conversation(sid)\n    CM->>SC: create/retrieve ServerConversation\n    SC->>RT: connect()\n    SC->>ES: initialize EventStream\n    \n    CM->>AS: maybe_start_agent_loop()\n    AS->>RT: create runtime environment\n    AS->>AS: create AgentController\n    \n    loop Agent Execution\n        AS->>RT: execute actions\n        RT->>ES: emit events\n        ES->>CM: stream events\n        CM->>Client: send_to_event_stream()\n    end\n    \n    Client->>CM: close_session(sid)\n    CM->>SC: disconnect()\n    CM->>AS: close()\n    AS->>RT: cleanup\n```",
          "Process Flow Diagrams": {
            "Conversation Lifecycle Management": "```\nflowchart TD\n    Start([Client Connection]) --> Join[join_conversation]\n    Join --> Attach{attach_to_conversation}\n    \n    Attach -->|New| CreateSC[Create ServerConversation]\n    Attach -->|Existing| RetrieveSC[Retrieve ServerConversation]\n    \n    CreateSC --> ConnectRT[Connect Runtime]\n    RetrieveSC --> ConnectRT\n    \n    ConnectRT --> InitES[Initialize EventStream]\n    InitES --> StartLoop{maybe_start_agent_loop}\n    \n    StartLoop -->|Not Running| CreateAS[Create AgentSession]\n    StartLoop -->|Running| ReturnInfo[Return AgentLoopInfo]\n    \n    CreateAS --> InitRT[Initialize Runtime]\n    InitRT --> CreateCtrl[Create AgentController]\n    CreateCtrl --> RunLoop[Run Agent Loop]\n    \n    RunLoop --> Monitor[Monitor Execution]\n    Monitor --> Events[Stream Events]\n    Events --> Monitor\n    \n    Monitor --> Close{close_session}\n    Close --> Cleanup[Cleanup Resources]\n    Cleanup --> End([Session Closed])\n    \n    ReturnInfo --> Monitor\n```",
            "Agent Loop Coordination": "```\nflowchart LR\n    subgraph \"Loop Management\"\n        Check[Check Running Loops]\n        Start[Start New Loop]\n        Monitor[Monitor Status]\n        Stop[Stop Loop]\n    end\n    \n    subgraph \"Session Coordination\"\n        AS[AgentSession]\n        AC[AgentController]\n        RT[Runtime]\n    end\n    \n    subgraph \"Event Processing\"\n        ES[EventStream]\n        Emit[Emit Events]\n        Stream[Stream to Client]\n    end\n    \n    Check --> Start\n    Start --> AS\n    AS --> AC\n    AC --> RT\n    RT --> Emit\n    Emit --> ES\n    ES --> Stream\n    Stream --> Monitor\n    Monitor --> Stop\n    Stop --> Check\n```"
          },
          "Integration Points": {
            "Storage System Integration": "The conversation orchestration module integrates with the [storage_system](storage_system.md) through:\n\n['**ConversationStore**: For persisting conversation metadata and state', '**FileStore**: For managing conversation-related files and artifacts', '**EventStream**: For storing and retrieving conversation events']",
            "Session Management Integration": "Coordinates with [session_management](session_management.md) components:\n\n['**AgentSession**: Manages individual agent execution sessions', '**WebSession**: Handles WebSocket connections and client communication']",
            "Runtime System Integration": "Interfaces with the [runtime_system](runtime_system.md) for:\n\n['**Runtime**: Providing execution environments for agents', '**SecurityAnalyzer**: Ensuring secure code execution', '**Plugin System**: Managing runtime extensions']",
            "LLM Integration": "Connects to [llm_integration](llm_integration.md) for:\n\n['**LLM Registry**: Managing language model configurations', '**Completion Services**: Providing LLM services for conversations']"
          },
          "Configuration and Extension": {
            "Custom ConversationManager Implementation": "```\nclass CustomConversationManager(ConversationManager):\n    async def attach_to_conversation(self, sid: str, user_id: str | None = None):\n        # Custom conversation attachment logic\n        pass\n    \n    async def maybe_start_agent_loop(self, sid: str, settings: Settings, ...):\n        # Custom agent loop management\n        pass\n    \n    @classmethod\n    def get_instance(cls, sio, config, file_store, server_config, monitoring_listener):\n        return cls(sio, config, file_store, server_config, monitoring_listener)\n```",
            "Server Configuration": "```\n# In server configuration\nserver_config.conversation_manager_class = \"myapp.CustomConversationManager\"\n```"
          },
          "Status Management": {
            "Conversation Status States": [
              "**STARTING**: Conversation is initializing",
              "**RUNNING**: Agent is active and processing",
              "**STOPPED**: Conversation is paused/idle",
              "**ARCHIVED**: Conversation is permanently closed",
              "**ERROR**: System error occurred"
            ],
            "Runtime Status Tracking": [
              "**READY**: Runtime is operational",
              "**BUILDING_RUNTIME**: Runtime is being constructed",
              "**ERROR_***: Various error conditions",
              "**SETTING_UP_***: Initialization phases"
            ]
          },
          "Security Considerations": "The conversation orchestration module implements several security measures:\n\n['**User Authentication**: Validates user identity for conversation access', '**Session Isolation**: Ensures conversations are properly isolated', '**Security Analysis**: Integrates with the security system for code validation', '**Resource Management**: Prevents resource exhaustion through proper cleanup']",
          "Error Handling and Recovery": {
            "Connection Management": [
              "Automatic reconnection for dropped connections",
              "Graceful degradation when services are unavailable",
              "Proper cleanup of orphaned sessions"
            ],
            "State Recovery": [
              "Conversation state restoration from persistent storage",
              "Event stream replay capabilities",
              "Runtime reconnection and state synchronization"
            ]
          },
          "Monitoring and Observability": "The module provides comprehensive monitoring through:\n\n['**AgentLoopInfo**: Real-time status of active conversations', '**Event Streaming**: Complete audit trail of conversation activities', '**Status Callbacks**: Integration with monitoring systems', '**Performance Metrics**: Resource usage and execution timing']",
          "Related Modules": [
            "[session_management](session_management.md): WebSocket and agent session handling",
            "[storage_system](storage_system.md): Persistent storage for conversations",
            "[runtime_system](runtime_system.md): Agent execution environments",
            "[llm_integration](llm_integration.md): Language model services",
            "[events_and_actions](events_and_actions.md): Event processing foundation",
            "[core_agent_system](core_agent_system.md): Agent control and coordination"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "user_data_management",
      "description": null,
      "content": {
        "User Data Management Module": {
          "Core Components": {
            "SecretsStore": "Abstract base class for storing user secrets including provider tokens and custom secrets. Provides secure handling of sensitive data with proper serialization controls.",
            "SettingsStore  ": "Abstract base class for storing user settings and preferences. Manages persistent configuration data that affects user experience and agent behavior.",
            "UserSecrets": "Data model for user secrets containing provider tokens (for services like GitHub, GitLab) and custom secrets with secure serialization and validation.",
            "Settings": "Data model for user settings including agent preferences, LLM configuration, security settings, and other persistent user preferences."
          },
          "Architecture Overview": "```\ngraph TB\n    subgraph \"User Data Management\"\n        SS[SecretsStore]\n        STS[SettingsStore]\n        US[UserSecrets]\n        SET[Settings]\n    end\n    \n    subgraph \"Implementations\"\n        FSS[FileSecretsStore]\n        FSTS[FileSettingsStore]\n    end\n    \n    subgraph \"Server Integration\"\n        SM[Server Manager]\n        CM[ConversationManager]\n        WS[WebSession]\n    end\n    \n    subgraph \"Storage Backend\"\n        FS[FileStore]\n        S3[S3Store]\n        GCS[GoogleCloudStore]\n    end\n    \n    SS --> FSS\n    STS --> FSTS\n    FSS --> FS\n    FSTS --> FS\n    FS --> S3\n    FS --> GCS\n    \n    SM --> SS\n    SM --> STS\n    CM --> SS\n    CM --> STS\n    WS --> US\n    WS --> SET\n    \n    US --> SS\n    SET --> STS\n```",
          "Component Relationships": "```\nclassDiagram\n    class SecretsStore {\n        <<abstract>>\n        +load() UserSecrets\n        +store(secrets: UserSecrets)\n        +get_instance(config, user_id) SecretsStore\n    }\n    \n    class SettingsStore {\n        <<abstract>>\n        +load() Settings\n        +store(settings: Settings)\n        +get_instance(config, user_id) SettingsStore\n    }\n    \n    class UserSecrets {\n        +provider_tokens: MappingProxyType\n        +custom_secrets: MappingProxyType\n        +set_event_stream_secrets(stream)\n        +get_env_vars() dict\n        +get_custom_secrets_descriptions() dict\n    }\n    \n    class Settings {\n        +language: str\n        +agent: str\n        +max_iterations: int\n        +llm_model: str\n        +llm_api_key: SecretStr\n        +secrets_store: UserSecrets\n        +from_config() Settings\n        +merge_with_config_settings() Settings\n    }\n    \n    class FileSecretsStore {\n        +file_store: FileStore\n        +path: str\n        +load() UserSecrets\n        +store(secrets: UserSecrets)\n    }\n    \n    class FileSettingsStore {\n        +file_store: FileStore\n        +path: str\n        +load() Settings\n        +store(settings: Settings)\n    }\n    \n    SecretsStore <|-- FileSecretsStore\n    SettingsStore <|-- FileSettingsStore\n    UserSecrets --* Settings\n    FileSecretsStore --> FileStore\n    FileSettingsStore --> FileStore\n```",
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant Server\n    participant SettingsStore\n    participant SecretsStore\n    participant FileStore\n    \n    Client->>Server: Request user settings\n    Server->>SettingsStore: load()\n    SettingsStore->>FileStore: read(settings.json)\n    FileStore-->>SettingsStore: JSON data\n    SettingsStore-->>Server: Settings object\n    Server-->>Client: User settings\n    \n    Client->>Server: Update secrets\n    Server->>SecretsStore: store(secrets)\n    SecretsStore->>FileStore: write(secrets.json)\n    FileStore-->>SecretsStore: Success\n    SecretsStore-->>Server: Success\n    Server-->>Client: Confirmation\n```",
          "Security Architecture": "```\ngraph TB\n    subgraph \"Security Layers\"\n        SER[Secure Serialization]\n        MASK[Secret Masking]\n        VAL[Validation]\n        ENC[Encryption at Rest]\n    end\n    \n    subgraph \"Secret Types\"\n        PT[Provider Tokens]\n        CS[Custom Secrets]\n        API[API Keys]\n    end\n    \n    subgraph \"Access Control\"\n        CTX[Serialization Context]\n        PERM[User Permissions]\n        SCOPE[Secret Scope]\n    end\n    \n    PT --> SER\n    CS --> SER\n    API --> SER\n    \n    SER --> MASK\n    MASK --> VAL\n    VAL --> ENC\n    \n    CTX --> SER\n    PERM --> CTX\n    SCOPE --> CTX\n```",
          "Key Features": {
            "Extensible Storage Architecture": [
              "Abstract base classes allow custom implementations",
              "Plugin-based architecture via `get_impl()` utility",
              "Support for multiple storage backends (file, S3, Google Cloud)",
              "Configurable through server configuration"
            ],
            "Secure Secret Management": [
              "Immutable data structures using `MappingProxyType`",
              "Context-aware serialization with secret masking",
              "Secure handling of provider tokens and custom secrets",
              "Integration with event stream for secret masking"
            ],
            "User Settings Persistence": [
              "Comprehensive user preference storage",
              "LLM configuration management",
              "Agent behavior customization",
              "Security and confirmation mode settings"
            ],
            "Multi-User Support": [
              "User-scoped data isolation",
              "Configurable user identification",
              "Support for both authenticated and anonymous users"
            ]
          },
          "Integration Points": {
            "Server System Integration": "The module integrates with the [server_and_api](server_and_api.md) module through:\n\n['Server configuration for store implementations', 'Session management for user data access', 'Authentication system for user identification']",
            "Storage System Integration": "Built on the [storage_system](storage_system.md) foundation:\n\n['Uses FileStore for backend storage abstraction', 'Supports multiple storage providers', 'Consistent error handling and async operations']",
            "Configuration Integration": "Integrates with [core_configuration](core_configuration.md):\n\n['Loads default settings from configuration files', 'Merges user settings with system defaults', 'Supports environment-specific configurations']"
          },
          "Usage Patterns": {
            "Settings Management": "```\n# Load user settings\nsettings_store = await SettingsStoreImpl.get_instance(config, user_id)\nsettings = await settings_store.load()\n\n# Update settings\nsettings.agent = \"CodeActAgent\"\nsettings.max_iterations = 50\nawait settings_store.store(settings)\n```",
            "Secrets Management": "```\n# Load user secrets\nsecrets_store = await SecretsStoreImpl.get_instance(config, user_id)\nsecrets = await secrets_store.load()\n\n# Add provider token\nsecrets.provider_tokens[ProviderType.GITHUB] = ProviderToken(\n    token=\"ghp_...\",\n    host=\"github.com\"\n)\nawait secrets_store.store(secrets)\n```",
            "Event Stream Integration": "```\n# Mask secrets in event stream\nuser_secrets = await secrets_store.load()\nuser_secrets.set_event_stream_secrets(event_stream)\n```"
          },
          "Extension Points": {
            "Custom Store Implementation": "Applications can implement custom storage backends:\n\n```\nclass DatabaseSecretsStore(SecretsStore):\n    async def load(self) -> UserSecrets | None:\n        # Custom database implementation\n        pass\n    \n    async def store(self, secrets: UserSecrets) -> None:\n        # Custom database implementation\n        pass\n    \n    @classmethod\n    async def get_instance(cls, config, user_id):\n        # Custom instantiation logic\n        pass\n```",
            "Configuration Integration": "Set custom implementations in server configuration:\n\n```\nserver_config.secret_store_class = \"myapp.stores.DatabaseSecretsStore\"\nserver_config.settings_store_class = \"myapp.stores.DatabaseSettingsStore\"\n```"
          },
          "Security Considerations": {
            "Secret Protection": [
              "Secrets are masked by default in serialization",
              "Explicit context required to expose secret values",
              "Immutable data structures prevent accidental modification",
              "Secure deletion and cleanup of sensitive data"
            ],
            "Access Control": [
              "User-scoped data isolation",
              "Authentication-based access control",
              "Configurable permission models",
              "Audit trail capabilities"
            ],
            "Data Validation": [
              "Pydantic-based validation for all data models",
              "Type safety and constraint enforcement",
              "Sanitization of user inputs",
              "Error handling for malformed data"
            ]
          },
          "Performance Considerations": {
            "Caching Strategy": [
              "In-memory caching of frequently accessed settings",
              "Lazy loading of user data",
              "Efficient serialization/deserialization",
              "Minimal I/O operations"
            ],
            "Scalability": [
              "Async/await pattern for non-blocking operations",
              "Support for distributed storage backends",
              "Efficient data structures and algorithms",
              "Resource cleanup and memory management"
            ]
          },
          "Related Modules": [
            "[storage_system](storage_system.md) - Foundation storage infrastructure",
            "[server_and_api](server_and_api.md) - Server integration and session management",
            "[core_configuration](core_configuration.md) - Configuration management",
            "[git_integrations](git_integrations.md) - Provider token usage",
            "[llm_integration](llm_integration.md) - LLM configuration storage"
          ],
          "Future Enhancements": {
            "Planned Features": [
              "Encryption at rest for sensitive data",
              "Advanced access control and permissions",
              "Data migration and versioning support",
              "Enhanced audit logging and monitoring",
              "Multi-tenant data isolation improvements"
            ],
            "Extension Opportunities": [
              "Database-backed storage implementations",
              "Cloud-native secret management integration",
              "Advanced caching and performance optimizations",
              "Real-time data synchronization capabilities"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "file_storage_infrastructure",
      "description": null,
      "content": {
        "File Storage Infrastructure": {
          "Overview": "The File Storage Infrastructure module provides a unified, pluggable file storage abstraction layer for the OpenHands system. It enables seamless switching between different storage backends (local filesystem, cloud storage, in-memory) while maintaining a consistent interface for file operations across the entire system.\n\nThis module serves as the foundation for persistent data storage in OpenHands, supporting conversation data, agent states, configuration files, and other system artifacts. The architecture follows the Strategy pattern, allowing runtime selection of storage implementations based on deployment requirements and configuration.",
          "Architecture": {
            "Core Components": "The file storage infrastructure is built around several key components:\n\n['**FileStore (Abstract Base)**: Defines the contract for all storage implementations', '**Concrete Implementations**: Local, S3, Google Cloud, and In-Memory storage providers', '**Decorator Pattern**: WebHook and Batched WebHook wrappers for event notifications', '**Factory Pattern**: Centralized store instantiation and configuration']\n\n```\ngraph TB\n    subgraph \"File Storage Infrastructure\"\n        FS[FileStore<br/>Abstract Base Class]\n        \n        subgraph \"Core Implementations\"\n            LFS[LocalFileStore]\n            S3FS[S3FileStore]\n            GCFS[GoogleCloudFileStore]\n            IMFS[InMemoryFileStore]\n        end\n        \n        subgraph \"Decorator Implementations\"\n            WHFS[WebHookFileStore]\n            BWHFS[BatchedWebHookFileStore]\n        end\n        \n        subgraph \"Factory & Configuration\"\n            GFS[get_file_store]\n            LOC[locations.py]\n        end\n        \n        FS --> LFS\n        FS --> S3FS\n        FS --> GCFS\n        FS --> IMFS\n        FS --> WHFS\n        FS --> BWHFS\n        \n        WHFS -.-> LFS\n        WHFS -.-> S3FS\n        WHFS -.-> GCFS\n        WHFS -.-> IMFS\n        \n        BWHFS -.-> LFS\n        BWHFS -.-> S3FS\n        BWHFS -.-> GCFS\n        BWHFS -.-> IMFS\n        \n        GFS --> LFS\n        GFS --> S3FS\n        GFS --> GCFS\n        GFS --> IMFS\n        GFS --> WHFS\n        GFS --> BWHFS\n        \n        LOC --> GFS\n    end\n    \n    subgraph \"System Integration\"\n        CS[ConversationStore]\n        SS[SecretsStore]\n        STS[SettingsStore]\n        RT[Runtime System]\n        SRV[Server Components]\n    end\n    \n    CS --> FS\n    SS --> FS\n    STS --> FS\n    RT --> FS\n    SRV --> FS\n```",
            "Storage Implementations": {
              "Local File Store": [
                "**Purpose**: Filesystem-based storage for development and single-node deployments",
                "**Features**: Directory creation, path normalization, recursive operations",
                "**Use Cases**: Development environments, standalone deployments"
              ],
              "S3 File Store": [
                "**Purpose**: AWS S3 compatible object storage",
                "**Features**: Boto3 integration, configurable endpoints, SSL support",
                "**Use Cases**: Production cloud deployments, scalable storage"
              ],
              "Google Cloud File Store": [
                "**Purpose**: Google Cloud Storage integration",
                "**Features**: Native GCS client, authentication via service accounts",
                "**Use Cases**: Google Cloud Platform deployments"
              ],
              "In-Memory File Store": [
                "**Purpose**: Volatile storage for testing and temporary operations",
                "**Features**: Dictionary-based storage, fast access",
                "**Use Cases**: Unit testing, temporary data, development"
              ]
            },
            "Decorator Pattern Implementation": "The module implements webhook notifications using the Decorator pattern:\n\n```\ngraph LR\n    subgraph \"Decorator Pattern\"\n        Client[Client Code]\n        WH[WebHookFileStore]\n        BWH[BatchedWebHookFileStore]\n        Impl[Concrete Implementation]\n        \n        Client --> WH\n        Client --> BWH\n        WH --> Impl\n        BWH --> Impl\n        \n        WH -.-> WebHook[HTTP Webhook]\n        BWH -.-> BatchWebHook[Batched HTTP Webhook]\n    end\n```"
          },
          "Data Flow": {
            "File Operations Flow": "```\nsequenceDiagram\n    participant Client\n    participant Factory as get_file_store()\n    participant Store as FileStore Implementation\n    participant Backend as Storage Backend\n    participant Webhook as Webhook Service\n    \n    Client->>Factory: Request file store\n    Factory->>Store: Create configured store\n    Factory-->>Client: Return store instance\n    \n    Client->>Store: write(path, contents)\n    Store->>Backend: Store data\n    Backend-->>Store: Confirm storage\n    \n    alt Webhook Enabled\n        Store->>Webhook: Notify change\n        Webhook-->>Store: Acknowledge\n    end\n    \n    Store-->>Client: Operation complete\n    \n    Client->>Store: read(path)\n    Store->>Backend: Retrieve data\n    Backend-->>Store: Return data\n    Store-->>Client: Return contents\n```",
            "Configuration and Instantiation Flow": "```\ngraph TD\n    subgraph \"Configuration Flow\"\n        Config[System Configuration]\n        Env[Environment Variables]\n        \n        Config --> Type{Storage Type}\n        Env --> Type\n        \n        Type -->|local| LocalConfig[Local Path Configuration]\n        Type -->|s3| S3Config[AWS S3 Configuration]\n        Type -->|google_cloud| GCConfig[GCS Configuration]\n        Type -->|memory| MemConfig[In-Memory Configuration]\n        \n        LocalConfig --> Factory[get_file_store]\n        S3Config --> Factory\n        GCConfig --> Factory\n        MemConfig --> Factory\n        \n        Factory --> WebhookCheck{Webhook Enabled?}\n        WebhookCheck -->|Yes| WebhookWrapper[Webhook Decorator]\n        WebhookCheck -->|No| DirectStore[Direct Store]\n        \n        WebhookWrapper --> FinalStore[Final FileStore Instance]\n        DirectStore --> FinalStore\n    end\n```"
          },
          "Integration Points": {
            "Storage System Integration": "The file storage infrastructure integrates with other storage system components:\n\n['**[Conversation Management](conversation_management.md)**: Stores conversation metadata, events, and agent states', '**[User Data Management](user_data_management.md)**: Provides backend for secrets and settings storage', '**[Server and API](server_and_api.md)**: Supports session data and conversation orchestration', '**[Runtime System](runtime_system.md)**: Stores runtime artifacts and temporary files']",
            "Path Management": "The module uses standardized path conventions defined in `locations.py`:\n\n```\ngraph TD\n    subgraph \"Path Structure\"\n        Root[Storage Root]\n        \n        Root --> Users[users/]\n        Root --> Sessions[sessions/]\n        \n        Users --> UserID[\"user_id/\"]\n        UserID --> Conversations[conversations/]\n        Conversations --> ConvID[\"conversation_id/\"]\n        \n        Sessions --> SessionID[\"session_id/\"]\n        \n        ConvID --> Events[events/]\n        ConvID --> Metadata[metadata.json]\n        ConvID --> AgentState[agent_state.pkl]\n        ConvID --> InitData[init.json]\n        ConvID --> Stats[conversation_stats.pkl]\n        \n        Events --> EventFiles[\"event_id.json\"]\n    end\n```"
          },
          "Configuration": {
            "Environment Variables": {
              "Local Storage": [
                "`FILE_STORE_PATH`: Root directory for local storage"
              ],
              "S3 Storage": [
                "`AWS_ACCESS_KEY_ID`: AWS access key",
                "`AWS_SECRET_ACCESS_KEY`: AWS secret key",
                "`AWS_S3_BUCKET`: S3 bucket name",
                "`AWS_S3_ENDPOINT`: Custom S3 endpoint (optional)",
                "`AWS_S3_SECURE`: Enable SSL (default: true)"
              ],
              "Google Cloud Storage": [
                "`GOOGLE_APPLICATION_CREDENTIALS`: Service account credentials file",
                "`GOOGLE_CLOUD_BUCKET_NAME`: GCS bucket name"
              ],
              "Webhook Configuration": [
                "`SESSION_API_KEY`: API key for webhook authentication"
              ]
            },
            "Factory Configuration": "```\nstore = get_file_store(\n    file_store_type='s3',  # 'local', 's3', 'google_cloud', 'memory'\n    file_store_path='my-bucket',\n    file_store_web_hook_url='https://api.example.com/webhook',\n    file_store_web_hook_headers={'Authorization': 'Bearer token'},\n    file_store_web_hook_batch=True\n)\n```"
          },
          "Error Handling": {
            "Exception Hierarchy": "All storage implementations handle errors consistently:\n\n['**FileNotFoundError**: File or path does not exist', '**PermissionError**: Access denied or insufficient permissions', '**ConnectionError**: Network or service connectivity issues', '**ConfigurationError**: Invalid configuration or missing credentials']",
            "Retry Logic": "Webhook implementations include retry logic with exponential backoff:\n\n```\ngraph TD\n    Operation[File Operation]\n    Success{Success?}\n    Webhook[Send Webhook]\n    Retry{Retry?}\n    Backoff[Exponential Backoff]\n    \n    Operation --> Success\n    Success -->|Yes| Webhook\n    Success -->|No| Exception[Raise Exception]\n    \n    Webhook --> Retry\n    Retry -->|Yes| Backoff\n    Retry -->|No| Complete[Operation Complete]\n    Backoff --> Webhook\n```"
          },
          "Performance Considerations": {
            "Caching Strategy": [
              "**Local Storage**: Relies on OS filesystem caching",
              "**Cloud Storage**: Implements connection pooling and request batching",
              "**In-Memory**: Direct dictionary access for maximum speed"
            ],
            "Scalability Features": [
              "**Concurrent Operations**: Thread-safe implementations",
              "**Batch Operations**: Webhook batching for high-throughput scenarios",
              "**Connection Pooling**: Reused connections for cloud storage providers"
            ],
            "Monitoring and Observability": "The module integrates with the OpenHands logging system:\n\n['**Operation Logging**: All file operations are logged with appropriate levels', '**Error Tracking**: Detailed error information for debugging', '**Performance Metrics**: Operation timing and success rates']"
          },
          "Security": {
            "Access Control": [
              "**Path Sanitization**: Prevents directory traversal attacks",
              "**User Isolation**: User-specific path prefixes for multi-tenant deployments",
              "**Credential Management**: Secure handling of cloud storage credentials"
            ],
            "Data Protection": [
              "**Encryption in Transit**: HTTPS/TLS for cloud storage operations",
              "**Encryption at Rest**: Leverages cloud provider encryption features",
              "**Access Logging**: Comprehensive audit trail for file operations"
            ]
          },
          "Testing Strategy": {
            "Unit Testing": [
              "**Mock Implementations**: In-memory store for fast unit tests",
              "**Interface Compliance**: All implementations tested against common interface",
              "**Error Scenarios**: Comprehensive error condition testing"
            ],
            "Integration Testing": [
              "**Multi-Backend Testing**: Tests across all storage implementations",
              "**Webhook Testing**: End-to-end webhook notification testing",
              "**Performance Testing**: Load testing for scalability validation"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Compression Support**: Automatic compression for large files",
              "**Versioning**: File version management and history",
              "**Replication**: Multi-region storage replication",
              "**Caching Layer**: Distributed caching for frequently accessed files"
            ],
            "Extension Points": [
              "**Custom Backends**: Plugin architecture for additional storage providers",
              "**Middleware Pipeline**: Configurable processing pipeline for file operations",
              "**Event System**: Enhanced event notifications beyond webhooks"
            ]
          },
          "Related Documentation": [
            "[Storage System](storage_system.md) - Parent module overview",
            "[Conversation Management](conversation_management.md) - Primary consumer of file storage",
            "[User Data Management](user_data_management.md) - Secrets and settings storage",
            "[Server and API](server_and_api.md) - Web server integration",
            "[Runtime System](runtime_system.md) - Runtime artifact storage",
            "[Core Configuration](core_configuration.md) - System configuration management"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "invariant_analysis",
      "description": null,
      "content": {
        "Invariant Analysis Module": {
          "Overview": "The invariant_analysis module is a specialized security component within the broader [security_system](security_system.md) that leverages external security analysis services to evaluate agent actions against predefined security policies. It provides containerized security analysis through Docker integration and maintains persistent monitoring sessions for comprehensive security oversight.",
          "Architecture": "```\ngraph TB\n    subgraph \"Invariant Analysis Module\"\n        IA[InvariantAnalyzer]\n        IC[InvariantClient]\n        TE[TraceElement]\n        P[Parser]\n        N[Nodes]\n    end\n    \n    subgraph \"External Services\"\n        IS[Invariant Server]\n        DC[Docker Container]\n    end\n    \n    subgraph \"Core System\"\n        SA[SecurityAnalyzer]\n        A[Action]\n        ASR[ActionSecurityRisk]\n    end\n    \n    subgraph \"Event System\"\n        E[Event]\n        O[Observation]\n    end\n    \n    IA --> SA\n    IA --> IC\n    IA --> P\n    IC --> IS\n    IA --> DC\n    P --> TE\n    P --> N\n    P --> A\n    P --> O\n    IA --> ASR\n    \n    classDef module fill:#e1f5fe\n    classDef external fill:#fff3e0\n    classDef core fill:#f3e5f5\n    classDef event fill:#e8f5e8\n    \n    class IA,IC,TE,P,N module\n    class IS,DC external\n    class SA,A,ASR core\n    class E,O event\n```",
          "Core Components": {
            "InvariantAnalyzer": "The main security analyzer that orchestrates the security analysis process:\n\n```\ngraph LR\n    subgraph \"InvariantAnalyzer Lifecycle\"\n        I[Initialize] --> DC[Docker Container]\n        DC --> AC[API Connection]\n        AC --> PM[Policy Management]\n        PM --> AR[Action Risk Assessment]\n        AR --> C[Cleanup]\n    end\n    \n    subgraph \"Risk Assessment Flow\"\n        A[Action] --> PE[Parse Element]\n        PE --> TR[Update Trace]\n        TR --> MC[Monitor Check]\n        MC --> RR[Risk Result]\n    end\n```\n\n**Key Features:**\n\n['Docker-based containerized security analysis', 'Session-based monitoring with persistent state', 'Policy-driven risk assessment', 'Real-time action evaluation']\n\n**Risk Assessment Process:**\n\n['Parses incoming actions into trace elements', 'Maintains cumulative trace history', 'Evaluates actions against security policies', 'Returns structured risk assessments']",
            "InvariantClient": "HTTP client for communicating with the Invariant security service:\n\n```\ngraph TB\n    subgraph \"InvariantClient Structure\"\n        IC[InvariantClient]\n        P[Policy Manager]\n        M[Monitor Manager]\n        S[Session Manager]\n    end\n    \n    subgraph \"API Operations\"\n        SN[Session New]\n        PN[Policy New]\n        MN[Monitor New]\n        MC[Monitor Check]\n        PA[Policy Analyze]\n    end\n    \n    IC --> P\n    IC --> M\n    IC --> S\n    P --> PN\n    P --> PA\n    M --> MN\n    M --> MC\n    S --> SN\n    \n    classDef client fill:#e3f2fd\n    classDef manager fill:#f1f8e9\n    classDef api fill:#fff8e1\n    \n    class IC client\n    class P,M,S manager\n    class SN,PN,MN,MC,PA api\n```\n\n**Capabilities:**\n\n['Session lifecycle management', 'Policy creation and template retrieval', 'Monitor setup and real-time checking', 'Error handling and timeout management']",
            "Parser System": "Converts OpenHands events into Invariant-compatible trace elements:\n\n```\ngraph LR\n    subgraph \"Event Processing\"\n        A[Action] --> PA[parse_action]\n        O[Observation] --> PO[parse_observation]\n        PA --> TE[TraceElement]\n        PO --> TE\n    end\n    \n    subgraph \"Trace Elements\"\n        TE --> M[Message]\n        TE --> TC[ToolCall]\n        TE --> TO[ToolOutput]\n        TE --> F[Function]\n    end\n    \n    subgraph \"State Management\"\n        IS[InvariantState]\n        T[Trace History]\n        IS --> T\n    end\n```\n\n**Supported Conversions:**\n\n['**MessageAction**  Message nodes (user/assistant roles)', '**Actions with tools**  ToolCall + Function nodes', '**Observations**  ToolOutput nodes', '**State changes**  Filtered appropriately']"
          },
          "Integration Points": {
            "Security System Integration": "```\ngraph TB\n    subgraph \"Security System\"\n        SA[SecurityAnalyzer]\n        LRA[LLMRiskAnalyzer]\n        IA[InvariantAnalyzer]\n    end\n    \n    subgraph \"Core Agent System\"\n        A[Agent]\n        AP[ActionParser]\n        TCS[TrafficControlState]\n    end\n    \n    subgraph \"Events & Actions\"\n        AC[Action]\n        OB[Observation]\n        ASR[ActionSecurityRisk]\n    end\n    \n    SA --> IA\n    SA --> LRA\n    A --> SA\n    AP --> AC\n    AC --> IA\n    IA --> ASR\n    OB --> IA\n    \n    classDef security fill:#ffebee\n    classDef core fill:#e8f5e8\n    classDef events fill:#e3f2fd\n    \n    class SA,LRA,IA security\n    class A,AP,TCS core\n    class AC,OB,ASR events\n```",
            "Runtime Dependencies": "```\ngraph TB\n    subgraph \"External Dependencies\"\n        D[Docker Engine]\n        IS[Invariant Server Image]\n        N[Network Ports]\n    end\n    \n    subgraph \"Python Dependencies\"\n        DC[docker-py]\n        H[httpx]\n        P[pydantic]\n    end\n    \n    subgraph \"OpenHands Core\"\n        L[Logger]\n        E[Events System]\n        RU[Runtime Utils]\n    end\n    \n    IA[InvariantAnalyzer] --> D\n    IA --> IS\n    IA --> N\n    IA --> DC\n    IA --> H\n    IA --> P\n    IA --> L\n    IA --> E\n    IA --> RU\n```"
          },
          "Data Flow": {
            "Security Analysis Pipeline": "```\nsequenceDiagram\n    participant Agent\n    participant InvariantAnalyzer\n    participant Parser\n    participant InvariantClient\n    participant InvariantServer\n    \n    Agent->>InvariantAnalyzer: security_risk(action)\n    InvariantAnalyzer->>Parser: parse_element(trace, action)\n    Parser-->>InvariantAnalyzer: new_elements\n    InvariantAnalyzer->>InvariantAnalyzer: update trace\n    InvariantAnalyzer->>InvariantClient: monitor.check(past, pending)\n    InvariantClient->>InvariantServer: POST /monitor/{id}/check\n    InvariantServer-->>InvariantClient: risk_results\n    InvariantClient-->>InvariantAnalyzer: (results, error)\n    InvariantAnalyzer->>InvariantAnalyzer: get_risk(results)\n    InvariantAnalyzer-->>Agent: ActionSecurityRisk\n```",
            "Container Lifecycle": "```\nstateDiagram-v2\n    [*] --> Initializing\n    Initializing --> CheckingExisting: Docker client ready\n    CheckingExisting --> StartingExisting: Container exists (stopped)\n    CheckingExisting --> CreatingNew: No container found\n    StartingExisting --> WaitingForReady\n    CreatingNew --> WaitingForReady\n    WaitingForReady --> Ready: Container running\n    WaitingForReady --> Timeout: Timeout exceeded\n    Ready --> Processing: Handle requests\n    Processing --> Ready: Continue processing\n    Ready --> Stopping: close() called\n    Stopping --> [*]\n    Timeout --> [*]\n```"
          },
          "Configuration and Setup": {
            "Docker Requirements": "The module requires Docker to be running and accessible:\n\n```\n# Container configuration\ncontainer_name = 'openhands-invariant-server'\nimage_name = 'ghcr.io/invariantlabs-ai/server:openhands'\napi_host = 'http://localhost'\ntimeout = 180  # seconds\n```",
            "Policy Management": "Security policies can be:\n\n['**Template-based**: Retrieved from Invariant service defaults', '**Custom**: Provided during analyzer initialization', '**Dynamic**: Updated through the Policy API']",
            "Session Management": "Each analyzer instance maintains:\n\n['**Unique session ID**: For isolation between analysis sessions', '**Persistent trace**: Cumulative action history', '**Monitor state**: Policy evaluation context']"
          },
          "Error Handling": {
            "Container Management Errors": "```\ngraph TB\n    subgraph \"Error Scenarios\"\n        DE[Docker Engine Unavailable]\n        CF[Container Failure]\n        NE[Network Error]\n        TO[Timeout]\n    end\n    \n    subgraph \"Recovery Strategies\"\n        ER[Exception Raising]\n        LO[Logging]\n        RT[Retry Logic]\n        GD[Graceful Degradation]\n    end\n    \n    DE --> ER\n    CF --> RT\n    NE --> LO\n    TO --> GD\n```",
            "API Communication Errors": [
              "**Network timeouts**: Configurable timeout with retry logic",
              "**HTTP errors**: Proper error propagation and logging",
              "**Service unavailability**: Graceful degradation to unknown risk level"
            ]
          },
          "Performance Considerations": {
            "Resource Management": [
              "**Container reuse**: Existing containers are restarted rather than recreated",
              "**Port allocation**: Dynamic port finding to avoid conflicts",
              "**Memory efficiency**: Trace elements use Pydantic models for optimal serialization"
            ],
            "Scalability Factors": [
              "**Session isolation**: Multiple analyzer instances can run concurrently",
              "**Stateful analysis**: Trace history enables context-aware security analysis",
              "**Async compatibility**: Designed for async/await patterns"
            ]
          },
          "Security Implications": {
            "Isolation": [
              "**Containerized execution**: Security analysis runs in isolated Docker environment",
              "**Network boundaries**: Communication limited to HTTP API calls",
              "**Session separation**: Each analysis session maintains independent state"
            ],
            "Data Privacy": [
              "**Local processing**: Sensitive data processed within controlled environment",
              "**Configurable policies**: Security rules can be customized per deployment",
              "**Audit trail**: Complete trace history maintained for security review"
            ]
          },
          "Usage Examples": {
            "Basic Security Analysis": "```\n# Initialize analyzer with default policy\nanalyzer = InvariantAnalyzer()\n\n# Evaluate action security risk\nrisk = await analyzer.security_risk(action)\n\n# Cleanup resources\nawait analyzer.close()\n```",
            "Custom Policy Analysis": "```\n# Initialize with custom security policy\ncustom_policy = \"...\"\nanalyzer = InvariantAnalyzer(policy=custom_policy)\n\n# Process multiple actions\nfor action in actions:\n    risk = await analyzer.security_risk(action)\n    if risk == ActionSecurityRisk.HIGH:\n        # Handle high-risk action\n        pass\n```"
          },
          "Related Documentation": [
            "[security_system](security_system.md) - Overall security architecture",
            "[events_and_actions](events_and_actions.md) - Event system integration",
            "[core_agent_system](core_agent_system.md) - Agent integration points",
            "[runtime_system](runtime_system.md) - Docker and container management"
          ],
          "Future Enhancements": {
            "Planned Features": [
              "**Policy versioning**: Support for policy evolution and rollback",
              "**Batch analysis**: Efficient processing of multiple actions",
              "**Custom risk metrics**: Extended risk assessment capabilities",
              "**Integration APIs**: Enhanced integration with external security tools"
            ],
            "Optimization Opportunities": [
              "**Connection pooling**: Reuse HTTP connections for better performance",
              "**Caching strategies**: Cache policy evaluations for repeated patterns",
              "**Streaming analysis**: Real-time analysis of action streams",
              "**Distributed deployment**: Support for distributed security analysis"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "mcp_configuration",
      "description": null,
      "content": {
        "MCP Configuration Module": {
          "Overview": "The MCP Configuration module provides comprehensive configuration management for the Model Context Protocol (MCP) within the OpenHands system. This module enables seamless integration with external MCP servers through multiple communication protocols including Server-Sent Events (SSE), Standard I/O (stdio), and HTTP connections. It serves as the central configuration hub for managing MCP server connections, validation, and runtime integration.",
          "Core Purpose": "The module facilitates:\n\n['**Multi-Protocol MCP Integration**: Support for SSE, stdio, and HTTP-based MCP servers', '**Configuration Validation**: Robust validation of server configurations and connection parameters  ', '**Runtime Server Management**: Dynamic server configuration for different runtime environments', '**Search Engine Integration**: Automatic integration with search engines like Tavily', '**Enterprise Extensibility**: Pluggable configuration system for custom MCP implementations']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"MCP Configuration Module\"\n        OMCP[OpenHandsMCPConfig]\n        MC[MCPConfig]\n        \n        subgraph \"Server Configuration Types\"\n            SSE[MCPSSEServerConfig]\n            STDIO[MCPStdioServerConfig] \n            HTTP[MCPSHTTPServerConfig]\n        end\n        \n        subgraph \"Validation Layer\"\n            UV[URL Validator]\n            SV[Server Validator]\n            EV[Environment Validator]\n        end\n    end\n    \n    subgraph \"External Dependencies\"\n        CC[Core Configuration]\n        RT[Runtime System]\n        SE[Search Engine APIs]\n    end\n    \n    subgraph \"Integration Points\"\n        RS[Runtime Servers]\n        WS[Web Services]\n        API[External APIs]\n    end\n    \n    OMCP --> MC\n    MC --> SSE\n    MC --> STDIO\n    MC --> HTTP\n    \n    SSE --> UV\n    STDIO --> SV\n    HTTP --> UV\n    STDIO --> EV\n    \n    OMCP --> CC\n    OMCP --> SE\n    \n    MC --> RS\n    SSE --> WS\n    HTTP --> API\n    STDIO --> RS\n    \n    style OMCP fill:#e1f5fe\n    style MC fill:#f3e5f5\n    style SSE fill:#fff3e0\n    style STDIO fill:#fff3e0\n    style HTTP fill:#fff3e0\n```",
          "Component Architecture": {
            "Core Configuration Classes": {
              "OpenHandsMCPConfig": "The main configuration orchestrator that provides factory methods and integration logic.\n\n**Key Responsibilities:**\n\n['Search engine integration management', 'Default server configuration creation', 'Runtime-specific configuration adaptation', 'Extensible implementation loading']",
              "MCPConfig": "Central configuration container that manages all MCP server types and provides validation.\n\n**Key Features:**\n\n['Multi-server type management (SSE, stdio, HTTP)', 'TOML configuration parsing', 'Server validation and deduplication', 'Configuration merging capabilities']",
              "Server Configuration Types": "```\nclassDiagram\n    class MCPConfig {\n        +sse_servers: List[MCPSSEServerConfig]\n        +stdio_servers: List[MCPStdioServerConfig]\n        +shttp_servers: List[MCPSHTTPServerConfig]\n        +validate_servers()\n        +from_toml_section()\n        +merge()\n    }\n    \n    class MCPSSEServerConfig {\n        +url: str\n        +api_key: Optional[str]\n        +validate_url()\n    }\n    \n    class MCPStdioServerConfig {\n        +name: str\n        +command: str\n        +args: List[str]\n        +env: Dict[str, str]\n        +validate_server_name()\n        +validate_command()\n        +parse_args()\n        +parse_env()\n    }\n    \n    class MCPSHTTPServerConfig {\n        +url: str\n        +api_key: Optional[str]\n        +validate_url()\n    }\n    \n    class OpenHandsMCPConfig {\n        +add_search_engine()\n        +create_default_mcp_server_config()\n    }\n    \n    MCPConfig --> MCPSSEServerConfig\n    MCPConfig --> MCPStdioServerConfig\n    MCPConfig --> MCPSHTTPServerConfig\n    OpenHandsMCPConfig --> MCPConfig\n```"
            }
          },
          "Data Flow and Processing": {
            "Configuration Loading Flow": "```\nsequenceDiagram\n    participant App as Application\n    participant OMCP as OpenHandsMCPConfig\n    participant MC as MCPConfig\n    participant Validators as Validation Layer\n    participant Runtime as Runtime System\n    \n    App->>OMCP: Load MCP Configuration\n    OMCP->>MC: from_toml_section(data)\n    MC->>Validators: Validate server configs\n    Validators-->>MC: Validation results\n    MC->>MC: validate_servers()\n    MC-->>OMCP: Validated config\n    OMCP->>OMCP: add_search_engine()\n    OMCP->>OMCP: create_default_mcp_server_config()\n    OMCP-->>App: Complete MCP configuration\n    App->>Runtime: Deploy server configurations\n```",
            "Server Configuration Processing": "```\nflowchart TD\n    A[Raw Configuration] --> B{Configuration Type}\n    \n    B -->|SSE Server| C[MCPSSEServerConfig]\n    B -->|Stdio Server| D[MCPStdioServerConfig]\n    B -->|HTTP Server| E[MCPSHTTPServerConfig]\n    \n    C --> F[URL Validation]\n    D --> G[Command Validation]\n    D --> H[Args Parsing]\n    D --> I[Environment Parsing]\n    E --> F\n    \n    F --> J[Server Registry]\n    G --> J\n    H --> J\n    I --> J\n    \n    J --> K[Runtime Deployment]\n    \n    style A fill:#f9f9f9\n    style J fill:#e8f5e8\n    style K fill:#fff2cc\n```"
          },
          "Integration with System Components": {
            "Core Configuration Integration": "The module integrates with the [core_configuration](core_configuration.md) system to:\n\n['Access application-wide configuration settings', 'Retrieve API keys and authentication credentials', 'Coordinate with other configuration modules']",
            "Runtime System Integration": "Works closely with the [runtime_system](runtime_system.md) to:\n\n['Deploy stdio servers within runtime containers', 'Manage server lifecycle and health monitoring', 'Coordinate with different runtime implementations (Local, CLI, Kubernetes)']",
            "Server and API Integration": "Connects with [server_and_api](server_and_api.md) components for:\n\n['HTTP-based MCP server management', 'API endpoint configuration', 'Authentication and authorization handling']"
          },
          "Configuration Validation": {
            "URL Validation": "```\ndef _validate_mcp_url(url: str) -> str:\n    \"\"\"Comprehensive URL validation for MCP servers\"\"\"\n    # Validates scheme, netloc, and protocol compatibility\n    # Supports: http, https, ws, wss protocols\n```",
            "Server Name Validation": "```\n@field_validator('name', mode='before')\ndef validate_server_name(cls, v: str) -> str:\n    \"\"\"Validates stdio server names\"\"\"\n    # Ensures alphanumeric characters, hyphens, underscores only\n    # Prevents empty or invalid server names\n```",
            "Environment Variable Validation": "```\n@field_validator('env', mode='before')\ndef parse_env(cls, v) -> dict[str, str]:\n    \"\"\"Parses and validates environment variables\"\"\"\n    # Supports KEY=VALUE format\n    # Validates environment variable naming conventions\n```"
          },
          "Search Engine Integration": "The module provides automatic search engine integration through the Tavily MCP server:\n\n```\ngraph LR\n    A[OpenHandsConfig] --> B[Search API Key Check]\n    B --> C{Tavily Key?}\n    C -->|Yes| D[Create Tavily MCP Server]\n    C -->|No| E[Skip Search Integration]\n    D --> F[Add to Stdio Servers]\n    F --> G[Runtime Deployment]\n    \n    style D fill:#e8f5e8\n    style E fill:#ffebee\n```",
          "Configuration Examples": {
            "TOML Configuration": "```\n[mcp]\n# SSE Servers\nsse_servers = [\n    \"https://mcp-server.example.com/sse\",\n    { url = \"https://secure-mcp.example.com/sse\", api_key = \"secret-key\" }\n]\n\n# Stdio Servers\n[[mcp.stdio_servers]]\nname = \"file-manager\"\ncommand = \"python\"\nargs = [\"-m\", \"mcp_file_manager\"]\nenv = { \"DEBUG=1\", \"LOG_LEVEL=info\" }\n\n# HTTP Servers\nshttp_servers = [\n    { url = \"http://localhost:8080/mcp\", api_key = \"local-key\" }\n]\n```",
            "Programmatic Configuration": "```\nfrom openhands.core.config.mcp_config import MCPConfig, MCPStdioServerConfig\n\n# Create stdio server configuration\nstdio_server = MCPStdioServerConfig(\n    name=\"custom-tool\",\n    command=\"node\",\n    args=[\"--experimental-modules\", \"tool-server.js\"],\n    env={\"NODE_ENV\": \"production\"}\n)\n\n# Create complete MCP configuration\nmcp_config = MCPConfig(\n    stdio_servers=[stdio_server],\n    sse_servers=[],\n    shttp_servers=[]\n)\n```"
          },
          "Error Handling and Validation": {
            "Common Validation Errors": [
              "**Invalid URL Format**: Malformed URLs or unsupported protocols",
              "**Duplicate Server URLs**: Multiple servers with identical URLs",
              "**Invalid Server Names**: Names containing invalid characters",
              "**Malformed Environment Variables**: Incorrect KEY=VALUE format",
              "**Empty Required Fields**: Missing essential configuration parameters"
            ],
            "Error Recovery Strategies": [
              "**Graceful Degradation**: Continue with valid servers when some fail validation",
              "**Default Fallbacks**: Provide sensible defaults for optional parameters",
              "**Clear Error Messages**: Detailed validation error reporting",
              "**Configuration Suggestions**: Helpful hints for fixing common issues"
            ]
          },
          "Extensibility and Customization": {
            "Custom MCP Configuration Implementation": "The module supports custom implementations through environment variable configuration:\n\n```\n# Set custom implementation class\nos.environ['OPENHANDS_MCP_CONFIG_CLS'] = 'custom.mcp.CustomMCPConfig'\n\n# Implementation will be loaded dynamically\nOpenHandsMCPConfigImpl = get_impl(OpenHandsMCPConfig, openhands_mcp_config_cls)\n```",
            "Enterprise Extensions": "For enterprise deployments, the module can be extended to support:\n\n['Custom authentication mechanisms', 'Enterprise-specific MCP servers', 'Advanced security configurations', 'Compliance and audit logging']"
          },
          "Performance Considerations": {
            "Configuration Loading": [
              "**Lazy Validation**: Validation occurs only when needed",
              "**Caching**: Validated configurations are cached for reuse",
              "**Parallel Processing**: Multiple server validations can run concurrently"
            ],
            "Runtime Optimization": [
              "**Connection Pooling**: Efficient management of MCP server connections",
              "**Health Monitoring**: Automatic detection and handling of server failures",
              "**Load Balancing**: Distribution of requests across multiple servers"
            ]
          },
          "Security Features": {
            "API Key Management": [
              "**Secure Storage**: API keys are handled as SecretStr objects",
              "**Environment Variable Support**: Keys can be loaded from environment",
              "**Validation**: API key format validation for known providers"
            ],
            "URL Security": [
              "**Protocol Validation**: Only secure protocols are allowed",
              "**Domain Validation**: Comprehensive URL structure validation",
              "**Injection Prevention**: Protection against URL injection attacks"
            ]
          },
          "Monitoring and Debugging": {
            "Configuration Validation Logging": "```\nlogger.info('Adding search engine to MCP config')\nlogger.warning('No search engine API key found, skipping search engine')\n```",
            "Server Health Monitoring": "The module provides hooks for monitoring MCP server health and performance:\n\n['Connection status tracking', 'Response time monitoring', 'Error rate analysis', 'Automatic failover capabilities']"
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Dynamic Server Discovery**: Automatic detection of available MCP servers",
              "**Configuration Hot Reloading**: Runtime configuration updates without restart",
              "**Advanced Load Balancing**: Intelligent request routing based on server capabilities",
              "**Metrics Integration**: Comprehensive monitoring and analytics"
            ],
            "API Evolution": [
              "**GraphQL Support**: Enhanced query capabilities for MCP servers",
              "**WebSocket Improvements**: Better real-time communication support",
              "**Protocol Extensions**: Support for emerging MCP protocol features"
            ]
          },
          "Related Documentation": [
            "[Core Configuration](core_configuration.md) - Overall configuration system architecture",
            "[Runtime System](runtime_system.md) - Runtime environment integration",
            "[Server and API](server_and_api.md) - Web server and API management",
            "[Security System](security_system.md) - Security and validation frameworks"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "runtime_implementations",
      "description": null,
      "content": {
        "Runtime Implementations Module": {
          "Overview": "The `runtime_implementations` module provides concrete implementations of the OpenHands runtime system, enabling agents to execute actions in different environments. This module contains three primary runtime implementations that extend the base runtime architecture to support various deployment scenarios and execution environments.",
          "Purpose": "Runtime implementations serve as the execution layer between OpenHands agents and the underlying system environment. They provide:\n\n['**Sandboxed Execution**: Safe environments for running agent commands and code', '**Cross-Platform Support**: Different implementations for various deployment needs', '**Resource Management**: Efficient handling of system resources and processes', '**Security Isolation**: Controlled access to system resources and file operations']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Runtime Implementations\"\n        LR[LocalRuntime]\n        CR[CLIRuntime]\n        KR[KubernetesRuntime]\n    end\n    \n    subgraph \"Base Architecture\"\n        R[Runtime]\n        AEC[ActionExecutionClient]\n    end\n    \n    subgraph \"Core System Dependencies\"\n        AS[core_agent_system]\n        EA[events_and_actions]\n        LLM[llm_integration]\n    end\n    \n    LR --> AEC\n    KR --> AEC\n    CR --> R\n    AEC --> R\n    \n    LR -.-> AS\n    CR -.-> AS\n    KR -.-> AS\n    \n    LR -.-> EA\n    CR -.-> EA\n    KR -.-> EA\n    \n    LR -.-> LLM\n    CR -.-> LLM\n    KR -.-> LLM\n    \n    style LR fill:#e1f5fe\n    style CR fill:#f3e5f5\n    style KR fill:#e8f5e8\n```",
          "Core Components": {
            "LocalRuntime": "**File**: `openhands.runtime.impl.local.local_runtime.LocalRuntime`\n\nA development-focused runtime that executes the action execution server directly on the local machine without containerization. Provides direct access to the host system while maintaining some isolation through workspace management.\n\n**Key Features**:\n\n['Direct local execution without Docker overhead', 'Warm server management for improved performance', 'Cross-platform support (Windows/Unix)', 'Temporary workspace creation and management']",
            "CLIRuntime": "**File**: `openhands.runtime.impl.cli.cli_runtime.CLIRuntime`\n\nA lightweight runtime implementation that executes commands directly using subprocess and performs file operations using Python's standard library. Designed for environments where containerization is not available or desired.\n\n**Key Features**:\n\n['Direct subprocess execution', 'Native file system operations', 'Windows PowerShell integration', 'No browser functionality (by design)', 'Minimal resource overhead']",
            "KubernetesRuntime": "**File**: `openhands.runtime.impl.kubernetes.kubernetes_runtime.KubernetesRuntime`\n\nAn enterprise-grade runtime implementation that creates and manages pods in a Kubernetes cluster. Provides scalable, isolated execution environments with full resource management and networking capabilities.\n\n**Key Features**:\n\n['Pod-based execution environments', 'Persistent volume management', 'Ingress and service configuration', 'Resource limits and requests', 'VSCode server integration']"
          },
          "Implementation Patterns": {
            "Inheritance Hierarchy": "```\nclassDiagram\n    class Runtime {\n        <<abstract>>\n        +run(action) Observation\n        +connect() void\n        +close() void\n        +setup_initial_env() void\n    }\n    \n    class ActionExecutionClient {\n        +send_action_for_execution(action) Observation\n        +get_mcp_config() MCPConfig\n        +call_tool_mcp(action) Observation\n    }\n    \n    class LocalRuntime {\n        +execute_action(action) Observation\n        +_wait_until_alive() bool\n        +_create_server() ActionExecutionServerInfo\n    }\n    \n    class CLIRuntime {\n        +_execute_shell_command(command, timeout) CmdOutputObservation\n        +_execute_powershell_command(command, timeout) CmdOutputObservation\n        +_sanitize_filename(filename) str\n    }\n    \n    class KubernetesRuntime {\n        +_init_k8s_resources() void\n        +_wait_until_ready() void\n        +_cleanup_k8s_resources() void\n    }\n    \n    Runtime <|-- ActionExecutionClient\n    Runtime <|-- CLIRuntime\n    ActionExecutionClient <|-- LocalRuntime\n    ActionExecutionClient <|-- KubernetesRuntime\n```",
            "Common Execution Flow": "```\nsequenceDiagram\n    participant Agent\n    participant Runtime\n    participant Environment\n    \n    Agent->>Runtime: execute_action(action)\n    Runtime->>Runtime: validate_action()\n    Runtime->>Environment: prepare_execution_context()\n    Runtime->>Environment: execute_command()\n    Environment-->>Runtime: execution_result\n    Runtime->>Runtime: process_result()\n    Runtime-->>Agent: Observation\n```"
          },
          "Sub-Module Documentation": {
            "[Local Runtime](local_runtime.md)": "Development-focused runtime for direct local execution with warm server management and cross-platform support. Features warm server pooling, cross-platform compatibility, and direct host system access with workspace isolation.",
            "[CLI Runtime](cli_runtime.md)": "Lightweight runtime for direct command execution using subprocess, ideal for environments without containerization. Provides minimal overhead execution with native file operations and PowerShell integration on Windows.",
            "[Kubernetes Runtime](kubernetes_runtime.md)": "Enterprise-grade runtime for scalable pod-based execution in Kubernetes clusters with full resource management. Offers pod-based isolation, persistent storage, ingress configuration, and comprehensive resource management."
          },
          "Related Runtime Components": {
            "[Runtime System](runtime_system.md)": "The parent module that provides the base Runtime class and common runtime infrastructure. Runtime implementations extend this foundation to provide specific execution environments.",
            "[Builder System](builder_system.md)": "Responsible for constructing and configuring runtime instances. The builder system creates appropriate runtime implementations based on configuration and deployment requirements.",
            "[Plugin System](plugin_system.md)": "Provides extensibility through plugins that can be loaded into runtime environments. All runtime implementations support plugin loading for enhanced functionality."
          },
          "Integration Points": {
            "With Core Agent System": [
              "Receives actions from [core_agent_system](core_agent_system.md) agents",
              "Processes action execution requests through the controller layer",
              "Manages state transitions during action execution"
            ],
            "With Events and Actions": [
              "Implements action execution interfaces from [events_and_actions](events_and_actions.md)",
              "Converts actions to observations through runtime-specific execution",
              "Handles event streaming and observation generation"
            ],
            "With LLM Integration": [
              "Utilizes LLM registry from [llm_integration](llm_integration.md) for LLM-based file editing",
              "Supports MCP (Model Context Protocol) tool execution",
              "Integrates with LLM-powered development tools"
            ]
          },
          "Configuration and Setup": "Each runtime implementation supports different configuration options:\n\n['**LocalRuntime**: Workspace paths, server ports, warm server management', '**CLIRuntime**: Workspace isolation, PowerShell integration settings', '**KubernetesRuntime**: Cluster configuration, resource limits, ingress settings']",
          "Security Considerations": "Runtime implementations provide varying levels of security isolation:\n\n['**LocalRuntime**: Limited isolation, runs on host system with workspace restrictions', '**CLIRuntime**: Minimal isolation, direct system access with path sanitization', '**KubernetesRuntime**: Strong isolation through pod boundaries and resource limits']",
          "Performance Characteristics": [
            "**LocalRuntime**: Fast startup with warm server support, moderate resource usage",
            "**CLIRuntime**: Minimal overhead, fastest for simple operations",
            "**KubernetesRuntime**: Higher startup cost, excellent scalability and resource management"
          ],
          "Error Handling and Recovery": "All runtime implementations provide:\n\n['Graceful error handling with detailed error observations', 'Timeout management for long-running operations', 'Resource cleanup on failure or shutdown', 'Connection recovery mechanisms where applicable']"
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "cli_runtime",
      "description": null,
      "content": {
        "CLI Runtime Module": {
          "Overview": "The CLI Runtime module provides a local execution environment for OpenHands agents that runs commands directly on the host system without sandboxing. This runtime implementation executes shell commands using subprocess, performs file operations through Python's standard library, and provides cross-platform support including specialized Windows PowerShell integration.\n\n** Security Warning**: This runtime executes commands directly on the local system without sandboxing. Use with extreme caution in untrusted environments.",
          "Core Architecture": "```\ngraph TB\n    subgraph \"CLI Runtime Architecture\"\n        CLIRuntime[CLIRuntime]\n        \n        subgraph \"Execution Engines\"\n            ShellExec[Shell Command Execution]\n            PSExec[PowerShell Execution<br/>Windows Only]\n            FileOps[File Operations]\n        end\n        \n        subgraph \"Core Components\"\n            OHEditor[OHEditor<br/>File Editor]\n            Workspace[Workspace Management]\n            StreamCallback[Shell Stream Callback]\n        end\n        \n        subgraph \"Platform Support\"\n            UnixShell[Unix/Linux Shell<br/>bash -c]\n            WinPS[Windows PowerShell<br/>Session Management]\n        end\n    end\n    \n    CLIRuntime --> ShellExec\n    CLIRuntime --> PSExec\n    CLIRuntime --> FileOps\n    CLIRuntime --> OHEditor\n    CLIRuntime --> Workspace\n    CLIRuntime --> StreamCallback\n    \n    ShellExec --> UnixShell\n    PSExec --> WinPS\n    \n    style CLIRuntime fill:#e1f5fe\n    style ShellExec fill:#f3e5f5\n    style PSExec fill:#fff3e0\n    style FileOps fill:#e8f5e8\n```",
          "Component Relationships": "```\ngraph LR\n    subgraph \"Runtime System\"\n        BaseRuntime[Runtime<br/>Base Class]\n        CLIRuntime[CLIRuntime]\n        LocalRuntime[LocalRuntime]\n        KubernetesRuntime[KubernetesRuntime]\n    end\n    \n    subgraph \"Dependencies\"\n        OHEditor[OHEditor<br/>File Editor]\n        EventStream[EventStream]\n        OpenHandsConfig[OpenHandsConfig]\n        LLMRegistry[LLMRegistry]\n    end\n    \n    subgraph \"Actions & Observations\"\n        CmdRunAction[CmdRunAction]\n        FileEditAction[FileEditAction]\n        FileReadAction[FileReadAction]\n        FileWriteAction[FileWriteAction]\n        MCPAction[MCPAction]\n        \n        CmdOutputObservation[CmdOutputObservation]\n        FileEditObservation[FileEditObservation]\n        ErrorObservation[ErrorObservation]\n    end\n    \n    BaseRuntime --> CLIRuntime\n    BaseRuntime --> LocalRuntime\n    BaseRuntime --> KubernetesRuntime\n    \n    CLIRuntime --> OHEditor\n    CLIRuntime --> EventStream\n    CLIRuntime --> OpenHandsConfig\n    CLIRuntime --> LLMRegistry\n    \n    CLIRuntime --> CmdRunAction\n    CLIRuntime --> FileEditAction\n    CLIRuntime --> FileReadAction\n    CLIRuntime --> FileWriteAction\n    CLIRuntime --> MCPAction\n    \n    CLIRuntime --> CmdOutputObservation\n    CLIRuntime --> FileEditObservation\n    CLIRuntime --> ErrorObservation\n    \n    style CLIRuntime fill:#e1f5fe\n    style BaseRuntime fill:#f5f5f5\n```",
          "Data Flow Architecture": "```\nsequenceDiagram\n    participant Agent\n    participant CLIRuntime\n    participant ShellExec\n    participant FileSystem\n    participant PowerShell\n    \n    Note over Agent, PowerShell: Command Execution Flow\n    Agent->>CLIRuntime: CmdRunAction\n    CLIRuntime->>CLIRuntime: Check runtime initialized\n    \n    alt Windows Platform\n        CLIRuntime->>PowerShell: Execute via PowerShell session\n        PowerShell-->>CLIRuntime: Command output\n    else Unix/Linux Platform\n        CLIRuntime->>ShellExec: Execute via subprocess\n        ShellExec-->>CLIRuntime: Streamed output\n    end\n    \n    CLIRuntime-->>Agent: CmdOutputObservation\n    \n    Note over Agent, FileSystem: File Operations Flow\n    Agent->>CLIRuntime: FileReadAction/FileWriteAction\n    CLIRuntime->>CLIRuntime: Sanitize file path\n    CLIRuntime->>FileSystem: Read/Write operation\n    FileSystem-->>CLIRuntime: File content/status\n    CLIRuntime-->>Agent: FileReadObservation/FileWriteObservation\n    \n    Note over Agent, FileSystem: File Editing Flow\n    Agent->>CLIRuntime: FileEditAction\n    CLIRuntime->>CLIRuntime: Sanitize file path\n    CLIRuntime->>FileSystem: OHEditor operations\n    FileSystem-->>CLIRuntime: Edit results with diff\n    CLIRuntime-->>Agent: FileEditObservation\n```",
          "Key Features": {
            "1. Cross-Platform Command Execution": [
              "**Unix/Linux**: Uses `bash -c` with subprocess for shell command execution",
              "**Windows**: Integrates with PowerShell sessions for native Windows command support",
              "**Streaming Output**: Real-time command output streaming with callback support",
              "**Timeout Management**: Configurable command timeouts with graceful termination"
            ],
            "2. Workspace Management": [
              "**Isolated Workspace**: Creates temporary or uses configured workspace directories",
              "**Path Sanitization**: Enforces workspace boundaries to prevent path traversal attacks",
              "**File Operations**: Direct file system access within workspace constraints",
              "**Cross-Platform Paths**: Handles both Unix and Windows path conventions"
            ],
            "3. File System Operations": [
              "**Direct File Access**: Uses Python's standard library for file operations",
              "**Binary File Detection**: Prevents reading/editing of binary files",
              "**OHEditor Integration**: Advanced file editing capabilities with diff generation",
              "**Recursive Copy Operations**: Support for copying files and directories"
            ],
            "4. Security Features": [
              "**Workspace Isolation**: Restricts file operations to designated workspace",
              "**Path Validation**: Prevents access outside workspace boundaries",
              "**Binary File Protection**: Blocks operations on binary files",
              "**Permission Checks**: Validates file access permissions"
            ]
          },
          "Process Flow": "```\nflowchart TD\n    Start([Runtime Initialization]) --> CheckPlatform{Platform Check}\n    \n    CheckPlatform -->|Windows| InitPS[Initialize PowerShell Session]\n    CheckPlatform -->|Unix/Linux| InitShell[Initialize Shell Environment]\n    \n    InitPS --> SetupWorkspace[Setup Workspace Directory]\n    InitShell --> SetupWorkspace\n    \n    SetupWorkspace --> Ready[Runtime Ready]\n    \n    Ready --> ActionReceived{Action Received}\n    \n    ActionReceived -->|CmdRunAction| ExecuteCommand[Execute Command]\n    ActionReceived -->|FileReadAction| ReadFile[Read File]\n    ActionReceived -->|FileWriteAction| WriteFile[Write File]\n    ActionReceived -->|FileEditAction| EditFile[Edit File with OHEditor]\n    ActionReceived -->|MCPAction| ExecuteMCP[Execute MCP Tool]\n    \n    ExecuteCommand --> ValidateTimeout{Check Timeout}\n    ValidateTimeout -->|Within Limit| RunCommand[Run Command with Streaming]\n    ValidateTimeout -->|Exceeded| TerminateCommand[Terminate Command]\n    \n    RunCommand --> StreamOutput[Stream Output to Callback]\n    TerminateCommand --> StreamOutput\n    StreamOutput --> ReturnObservation[Return CmdOutputObservation]\n    \n    ReadFile --> SanitizePath[Sanitize File Path]\n    WriteFile --> SanitizePath\n    EditFile --> SanitizePath\n    \n    SanitizePath --> ValidatePath{Path Valid?}\n    ValidatePath -->|Yes| PerformOperation[Perform File Operation]\n    ValidatePath -->|No| ReturnError[Return Error Observation]\n    \n    PerformOperation --> ReturnObservation\n    ReturnError --> ActionReceived\n    ReturnObservation --> ActionReceived\n    \n    ExecuteMCP --> CheckWindows{Windows Platform?}\n    CheckWindows -->|Yes| MCPDisabled[Return MCP Disabled Error]\n    CheckWindows -->|No| CreateMCPClients[Create MCP Clients]\n    CreateMCPClients --> CallMCPTool[Call MCP Tool]\n    CallMCPTool --> ReturnObservation\n    MCPDisabled --> ActionReceived\n    \n    style Start fill:#e1f5fe\n    style Ready fill:#e8f5e8\n    style ReturnError fill:#ffebee\n```",
          "Integration Points": {
            "Runtime System Integration": "The CLI Runtime integrates with the broader [runtime system](runtime_system.md) as a concrete implementation of the base Runtime class:\n\n['**Base Runtime**: Inherits core runtime functionality and interfaces', '**Runtime Builder**: Can be instantiated through the runtime builder system', '**Plugin System**: Supports runtime plugins for extended functionality']",
            "Event System Integration": "Integrates with the [events and actions](events_and_actions.md) system:\n\n['**Action Processing**: Handles CmdRunAction, FileEditAction, FileReadAction, FileWriteAction, MCPAction', '**Observation Generation**: Produces CmdOutputObservation, FileEditObservation, FileReadObservation, FileWriteObservation, ErrorObservation', '**Event Streaming**: Supports real-time command output streaming']",
            "Agent System Integration": "Works with the [core agent system](core_agent_system.md):\n\n['**Agent Communication**: Receives actions from agents and returns observations', '**State Management**: Maintains runtime state and workspace information', '**Configuration**: Uses OpenHandsConfig for runtime configuration']"
          },
          "Configuration": {
            "Basic Configuration": "```\nfrom openhands.core.config import OpenHandsConfig\nfrom openhands.runtime.impl.cli.cli_runtime import CLIRuntime\n\nconfig = OpenHandsConfig(\n    workspace_base=\"/path/to/workspace\",  # Optional: Use specific workspace\n    sandbox=SandboxConfig(\n        timeout=30  # Command timeout in seconds\n    )\n)\n\nruntime = CLIRuntime(\n    config=config,\n    event_stream=event_stream,\n    llm_registry=llm_registry,\n    sid=\"session_id\"\n)\n```",
            "Environment Variables": "```\n# Set environment variables for the runtime session\nruntime.add_env_vars({\n    \"CUSTOM_VAR\": \"value\",\n    \"API_KEY\": SecretStr(\"secret_value\")\n})\n```",
            "MCP Configuration": "```\n# MCP (Model Context Protocol) configuration\n# Note: MCP is disabled on Windows\nmcp_config = runtime.get_mcp_config(\n    extra_stdio_servers=[\n        MCPStdioServerConfig(\n            name=\"custom_server\",\n            command=[\"python\", \"server.py\"]\n        )\n    ]\n)\n```"
          },
          "Platform-Specific Features": {
            "Windows Support": [
              "**PowerShell Integration**: Native PowerShell session management",
              "**Path Handling**: Windows-specific path resolution and validation",
              "**Error Handling**: Windows-specific error messages and handling",
              "**MCP Limitation**: MCP functionality is disabled on Windows"
            ],
            "Unix/Linux Support": [
              "**Bash Execution**: Uses `bash -c` for command execution",
              "**Process Groups**: Proper process group management for signal handling",
              "**MCP Support**: Full MCP (Model Context Protocol) support",
              "**Signal Handling**: SIGTERM/SIGKILL for process termination"
            ]
          },
          "Security Considerations": {
            "Workspace Isolation": [
              "All file operations are restricted to the designated workspace directory",
              "Path traversal attacks are prevented through path sanitization",
              "Absolute paths outside workspace are rejected"
            ],
            "Command Execution": [
              "No sandboxing - commands execute directly on the host system",
              "Process timeout management to prevent runaway processes",
              "Proper signal handling for process termination"
            ],
            "File System Access": [
              "Binary file detection prevents corruption",
              "Permission validation before file operations",
              "Workspace boundary enforcement"
            ]
          },
          "Error Handling": {
            "Common Error Scenarios": [
              "**Runtime Not Initialized**: Operations attempted before runtime setup",
              "**Path Traversal**: Attempts to access files outside workspace",
              "**Binary File Access**: Attempts to read/edit binary files",
              "**Command Timeout**: Long-running commands exceeding timeout limits",
              "**Permission Errors**: Insufficient permissions for file operations"
            ],
            "Error Recovery": [
              "Graceful process termination on timeout",
              "Detailed error messages with context",
              "Fallback mechanisms for platform-specific operations"
            ]
          },
          "Performance Characteristics": {
            "Command Execution": [
              "**Streaming Output**: Real-time output streaming reduces memory usage",
              "**Process Management**: Efficient subprocess handling with proper cleanup",
              "**Timeout Handling**: Prevents resource exhaustion from runaway processes"
            ],
            "File Operations": [
              "**Direct Access**: No overhead from containerization or virtualization",
              "**Efficient Copying**: Optimized file and directory copying operations",
              "**Memory Management**: Streaming operations for large files"
            ]
          },
          "Limitations": {
            "Functional Limitations": [
              "**No Browser Support**: Browser actions return error observations",
              "**No IPython Support**: Jupyter cell execution is not implemented",
              "**No Interactive Input**: Cannot send input to running processes",
              "**Windows MCP**: MCP functionality is disabled on Windows"
            ],
            "Security Limitations": [
              "**No Sandboxing**: Commands execute directly on host system",
              "**Host System Access**: Full access to host system within workspace",
              "**Process Privileges**: Inherits privileges of the parent process"
            ]
          },
          "Usage Examples": {
            "Basic Command Execution": "```\nfrom openhands.events.action import CmdRunAction\n\n# Execute a shell command\naction = CmdRunAction(command=\"ls -la\", timeout=10)\nobservation = runtime.run(action)\nprint(observation.content)  # Command output\nprint(observation.exit_code)  # Exit code\n```",
            "File Operations": "```\nfrom openhands.events.action import FileReadAction, FileWriteAction\n\n# Read a file\nread_action = FileReadAction(path=\"example.txt\")\nread_obs = runtime.read(read_action)\nprint(read_obs.content)\n\n# Write a file\nwrite_action = FileWriteAction(path=\"output.txt\", content=\"Hello World\")\nwrite_obs = runtime.write(write_action)\n```",
            "File Editing": "```\nfrom openhands.events.action import FileEditAction\n\n# Edit a file using OHEditor\nedit_action = FileEditAction(\n    path=\"script.py\",\n    command=\"str_replace\",\n    old_str=\"old_code\",\n    new_str=\"new_code\"\n)\nedit_obs = runtime.edit(edit_action)\nprint(edit_obs.diff)  # Shows the diff\n```",
            "Shell Output Streaming": "```\ndef output_callback(line: str):\n    print(f\"Command output: {line.strip()}\")\n\n# Subscribe to shell output streaming\nruntime.subscribe_to_shell_stream(output_callback)\n\n# Now all command output will be streamed to the callback\naction = CmdRunAction(command=\"long_running_command\")\nruntime.run(action)\n```"
          },
          "Related Documentation": [
            "[Runtime System](runtime_system.md) - Overall runtime architecture and base classes",
            "[Local Runtime](local_runtime.md) - Docker-based local runtime implementation",
            "[Kubernetes Runtime](kubernetes_runtime.md) - Kubernetes-based runtime implementation",
            "[Events and Actions](events_and_actions.md) - Action and observation system",
            "[Core Agent System](core_agent_system.md) - Agent architecture and communication",
            "[Core Configuration](core_configuration.md) - Configuration system and options"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "local_runtime",
      "description": null,
      "content": {
        "Local Runtime Module": {
          "Overview": "The Local Runtime module provides a development-focused runtime implementation that executes the action execution server directly on the local machine without containerization. This runtime is designed for development environments where Docker may not be available or desired, offering direct access to the host system while maintaining the OpenHands runtime interface.\n\n**Key Features:**\n\n['Direct local execution without Docker containers', 'Cross-platform support (Windows, macOS, Linux) with platform-specific adaptations', 'Warm server pooling for improved performance', 'Session-based server management', 'Integration with local development tools (VSCode, tmux)', 'Workspace isolation through temporary directories']\n\n**Warning:** This runtime provides **NO SANDBOX ISOLATION** and should only be used in controlled development environments.",
          "Architecture": {
            "Core Components": "```\ngraph TB\n    subgraph \"Local Runtime Architecture\"\n        LR[LocalRuntime] --> AEC[ActionExecutionClient]\n        AEC --> RT[Runtime Base]\n        \n        LR --> AESI[ActionExecutionServerInfo]\n        LR --> WSM[Workspace Management]\n        LR --> SPM[Server Process Management]\n        \n        subgraph \"Server Management\"\n            RS[Running Servers Dict]\n            WS[Warm Servers Pool]\n            SPM --> RS\n            SPM --> WS\n        end\n        \n        subgraph \"Process Lifecycle\"\n            SC[Server Creation]\n            SL[Server Lifecycle]\n            SC --> SL\n            SL --> LT[Log Threading]\n        end\n        \n        subgraph \"Platform Support\"\n            WIN[Windows Support]\n            UNIX[Unix/Linux Support]\n            MAC[macOS Support]\n        end\n    end\n```",
            "Class Hierarchy": "```\nclassDiagram\n    Runtime <|-- ActionExecutionClient\n    ActionExecutionClient <|-- LocalRuntime\n    \n    class Runtime {\n        +sid: str\n        +config: OpenHandsConfig\n        +plugins: list[PluginRequirement]\n        +connect()\n        +close()\n        +run_action(action)\n    }\n    \n    class ActionExecutionClient {\n        +session: HttpSession\n        +action_semaphore: Semaphore\n        +send_action_for_execution()\n        +check_if_alive()\n    }\n    \n    class LocalRuntime {\n        +server_process: subprocess.Popen\n        +_temp_workspace: str\n        +_execution_server_port: int\n        +_vscode_port: int\n        +_app_ports: list[int]\n        +connect()\n        +execute_action()\n        +close()\n    }\n    \n    class ActionExecutionServerInfo {\n        +process: subprocess.Popen\n        +execution_server_port: int\n        +vscode_port: int\n        +app_ports: list[int]\n        +log_thread: threading.Thread\n        +temp_workspace: str\n    }\n```"
          },
          "Core Functionality": {
            "Server Management": {
              "Global Server Tracking": [
                "**Running Servers**: Dictionary mapping session IDs to active server processes",
                "**Warm Servers**: Pool of pre-initialized servers for faster startup",
                "**Session Isolation**: Each conversation gets its own server instance"
              ],
              "Server Lifecycle": "```\nsequenceDiagram\n    participant Client as LocalRuntime\n    participant Pool as Warm Server Pool\n    participant Server as Action Server\n    participant Process as Server Process\n    \n    Client->>Pool: Check for warm server\n    alt Warm server available\n        Pool->>Client: Return warm server\n        Client->>Server: Configure workspace\n    else No warm server\n        Client->>Process: Create new server\n        Process->>Server: Start action server\n        Server->>Client: Server ready\n    end\n    \n    Client->>Server: Execute actions\n    Server->>Client: Return observations\n    \n    Note over Client,Process: On close/cleanup\n    Client->>Process: Terminate server\n    Client->>Pool: Clean up resources\n```"
            },
            "Workspace Management": {
              "Workspace Isolation": [
                "**Temporary Workspaces**: Created per session when no base path specified",
                "**Mounted Workspaces**: Use existing directories when `workspace_base` configured",
                "**Cross-Platform Paths**: Handles Windows and Unix path differences"
              ],
              "Directory Structure": "```\nworkspace/\n .openhands/\n    microagents/\n    setup.sh\n    pre-commit.sh\n project_files/\n temp_session_data/\n```"
            },
            "Platform-Specific Adaptations": {
              "Windows Support": [
                "**PowerShell Integration**: Uses PowerShell for environment variable management",
                "**Limited tmux**: Warns about tmux limitations on Windows",
                "**Path Handling**: Adapts to Windows path conventions",
                "**User ID Handling**: Uses default values for Windows compatibility"
              ],
              "Unix/Linux Support": [
                "**tmux Integration**: Full terminal multiplexer support",
                "**Bash Environment**: Native bash shell integration",
                "**User Management**: Proper UID/username handling",
                "**Git Configuration**: Full git integration support"
              ]
            }
          },
          "Dependencies and Integration": {
            "Runtime System Integration": "```\ngraph LR\n    subgraph \"Runtime System\"\n        LR[Local Runtime] --> RB[Runtime Base]\n        LR --> AEC[ActionExecutionClient]\n        LR --> RU[Runtime Utils]\n    end\n    \n    subgraph \"Core Agent System\"\n        LR --> AS[Agent System]\n        AS --> AP[Action Parser]\n        AS --> SM[State Management]\n    end\n    \n    subgraph \"Events and Actions\"\n        LR --> EA[Event System]\n        EA --> AC[Actions]\n        EA --> OB[Observations]\n    end\n    \n    subgraph \"Plugin System\"\n        LR --> PS[Plugin System]\n        PS --> VSC[VSCode Plugin]\n        PS --> JP[Jupyter Plugin]\n    end\n```",
            "External Dependencies": "```\ngraph TB\n    subgraph \"System Dependencies\"\n        PY[Python Interpreter]\n        JUP[Jupyter]\n        TMUX[tmux - Unix only]\n        GIT[Git]\n    end\n    \n    subgraph \"Python Dependencies\"\n        HTTP[httpx]\n        TEN[tenacity]\n        LTMUX[libtmux - Unix only]\n    end\n    \n    subgraph \"OpenHands Modules\"\n        CFG[Core Config]\n        EVT[Events System]\n        LLM[LLM Integration]\n        SEC[Security System]\n    end\n    \n    LR[Local Runtime] --> PY\n    LR --> HTTP\n    LR --> CFG\n    LR --> EVT\n```"
          },
          "Configuration and Setup": {
            "Environment Variables": "| Variable | Description | Default |\n|----------|-------------|---------|\n| `INITIAL_NUM_WARM_SERVERS` | Number of warm servers to create on startup | `0` |\n| `DESIRED_NUM_WARM_SERVERS` | Target number of warm servers to maintain | `0` |\n| `SKIP_DEPENDENCY_CHECK` | Skip dependency validation | `false` |\n| `LOCAL_RUNTIME_MODE` | Enable local runtime mode | `1` |\n| `VSCODE_PORT` | VSCode server port | Auto-assigned |\n| `SESSION_API_KEY` | API key for session authentication | None |",
            "Dependency Requirements": {
              "Required Dependencies": [
                "**Python**: Compatible Python interpreter",
                "**Jupyter**: For IPython cell execution",
                "**Git**: For repository operations",
                "**httpx**: For HTTP client operations",
                "**tenacity**: For retry logic"
              ],
              "Platform-Specific Dependencies": [
                "**Unix/Linux**: `tmux`, `libtmux`",
                "**Windows**: PowerShell (built-in)"
              ]
            },
            "Setup Process": "```\nflowchart TD\n    Start[Runtime Setup] --> Check[Check Dependencies]\n    Check --> |Pass| Warm[Create Warm Servers]\n    Check --> |Fail| Error[Raise Setup Error]\n    \n    Warm --> |Success| Ready[Runtime Ready]\n    Warm --> |Partial| Warn[Log Warnings]\n    Warn --> Ready\n    \n    Error --> End[Setup Failed]\n    Ready --> End[Setup Complete]\n```"
          },
          "Process Management": {
            "Server Creation Process": "```\nsequenceDiagram\n    participant LR as LocalRuntime\n    participant SP as Server Process\n    participant WS as Workspace\n    participant LOG as Log Thread\n    \n    LR->>WS: Create temp workspace\n    LR->>SP: Start server process\n    SP->>SP: Initialize action server\n    LR->>LOG: Start log monitoring\n    LOG->>LR: Stream server logs\n    SP->>LR: Server ready signal\n    LR->>LR: Store server info\n```",
            "Warm Server Management": {
              "Warm Server Lifecycle": [
                "**Creation**: Servers created during setup or after action execution",
                "**Pooling**: Stored in global `_WARM_SERVERS` list",
                "**Assignment**: Assigned to new sessions on demand",
                "**Cleanup**: Terminated when no active sessions remain"
              ],
              "Benefits": [
                "**Faster Startup**: Eliminates server initialization time",
                "**Resource Efficiency**: Reuses initialized processes",
                "**Scalability**: Maintains desired server count automatically"
              ]
            }
          },
          "Error Handling and Recovery": {
            "Connection Management": "```\nstateDiagram-v2\n    [*] --> Disconnected\n    Disconnected --> Connecting: connect()\n    Connecting --> Connected: Server Ready\n    Connecting --> Error: Connection Failed\n    Connected --> Executing: execute_action()\n    Executing --> Connected: Action Complete\n    Executing --> Error: Execution Failed\n    Error --> Reconnecting: Retry Logic\n    Reconnecting --> Connected: Recovery Success\n    Reconnecting --> Disconnected: Recovery Failed\n    Connected --> Disconnected: close()\n```",
            "Error Types and Handling": "| Error Type | Cause | Recovery Strategy |\n|------------|-------|------------------|\n| `AgentRuntimeDisconnectedError` | Server process died | Restart server process |\n| `RuntimeError` | Server startup failure | Clean up and retry |\n| `TimeoutError` | Action execution timeout | Cancel action, maintain connection |\n| `PermissionError` | File system access denied | Convert to ErrorObservation |\n| `NetworkError` | HTTP communication failure | Retry with exponential backoff |"
          },
          "Security Considerations": {
            "Sandbox Limitations": "** CRITICAL WARNING**: Local Runtime provides **NO SANDBOXING**\n\n['**Direct Host Access**: Actions execute directly on the host system', \"**File System Access**: Full access to user's file system\", '**Network Access**: Unrestricted network connectivity', '**Process Execution**: Can execute arbitrary system commands']",
            "Recommended Usage": [
              "**Development Only**: Use only in controlled development environments",
              "**Trusted Code**: Only execute trusted agent code",
              "**Isolated Environment**: Consider using virtual machines or containers",
              "**Regular Backups**: Maintain backups of important data"
            ],
            "Security Analyzer Integration": "The runtime integrates with the [Security System](security_system.md) when configured:\n\n```\n# Security analyzer initialization\nif self.config.security.security_analyzer:\n    analyzer_cls = options.SecurityAnalyzers.get(\n        self.config.security.security_analyzer, SecurityAnalyzer\n    )\n    self.security_analyzer = analyzer_cls()\n```"
          },
          "Performance Optimization": {
            "Warm Server Strategy": "```\ngraph LR\n    subgraph \"Performance Optimization\"\n        WS[Warm Servers] --> FS[Fast Startup]\n        WS --> RR[Resource Reuse]\n        WS --> SC[Scalable Concurrency]\n        \n        FS --> IT[Improved Throughput]\n        RR --> IT\n        SC --> IT\n    end\n```",
            "Resource Management": [
              "**Memory Efficiency**: Reuses server processes",
              "**CPU Optimization**: Minimizes process creation overhead",
              "**I/O Optimization**: Streams logs asynchronously",
              "**Network Efficiency**: Maintains persistent HTTP connections"
            ]
          },
          "Integration Examples": {
            "Basic Usage": "```\nfrom openhands.runtime.impl.local.local_runtime import LocalRuntime\nfrom openhands.core.config import OpenHandsConfig\n\n# Initialize runtime\nconfig = OpenHandsConfig()\nruntime = LocalRuntime(\n    config=config,\n    event_stream=event_stream,\n    llm_registry=llm_registry,\n    sid='development-session'\n)\n\n# Connect and execute\nawait runtime.connect()\nobservation = await runtime.execute_action(action)\nruntime.close()\n```",
            "With Warm Servers": "```\nimport os\n\n# Configure warm servers\nos.environ['INITIAL_NUM_WARM_SERVERS'] = '2'\nos.environ['DESIRED_NUM_WARM_SERVERS'] = '3'\n\n# Setup runtime class\nLocalRuntime.setup(config, headless_mode=False)\n\n# Create runtime instances - will use warm servers\nruntime = LocalRuntime(config, event_stream, llm_registry)\n```"
          },
          "Related Documentation": [
            "**[Runtime System](runtime_system.md)**: Overall runtime architecture and base classes",
            "**[CLI Runtime](cli_runtime.md)**: Command-line interface runtime implementation  ",
            "**[Kubernetes Runtime](kubernetes_runtime.md)**: Container orchestration runtime",
            "**[Core Agent System](core_agent_system.md)**: Agent execution and control",
            "**[Events and Actions](events_and_actions.md)**: Event-driven action execution",
            "**[Plugin System](plugin_system.md)**: Runtime plugin architecture",
            "**[Security System](security_system.md)**: Security analysis and protection"
          ],
          "Troubleshooting": {
            "Common Issues": [
              "**Dependency Missing**: Ensure all required dependencies are installed",
              "**Port Conflicts**: Check for port availability in configured ranges",
              "**Permission Errors**: Verify file system permissions",
              "**Process Cleanup**: Ensure proper server process termination",
              "**Windows Limitations**: Some features require WSL or alternative solutions"
            ],
            "Debug Configuration": "```\n# Enable debug logging\nimport logging\nlogging.getLogger('openhands.runtime.impl.local').setLevel(logging.DEBUG)\n\n# Skip dependency checks for testing\nos.environ['SKIP_DEPENDENCY_CHECK'] = '1'\n```",
            "Monitoring": [
              "**Server Logs**: Monitor action execution server output",
              "**Process Status**: Check server process health",
              "**Resource Usage**: Monitor memory and CPU consumption",
              "**Connection Status**: Verify HTTP client connectivity"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "web_infrastructure",
      "description": null,
      "content": {
        "Web Infrastructure Module": {
          "Overview": "The web_infrastructure module provides essential HTTP middleware components for the OpenHands server infrastructure. This module focuses on request processing, security, and performance optimization through specialized middleware implementations that handle CORS policies, caching strategies, and rate limiting mechanisms.",
          "Core Components": {
            "RateLimitMiddleware": "The primary component that implements request rate limiting to protect the server from abuse and ensure fair resource allocation across clients."
          },
          "Architecture": "```\ngraph TB\n    subgraph \"Web Infrastructure Layer\"\n        RL[RateLimitMiddleware]\n        CC[CacheControlMiddleware]\n        LC[LocalhostCORSMiddleware]\n        IRL[InMemoryRateLimiter]\n    end\n    \n    subgraph \"FastAPI Framework\"\n        REQ[HTTP Request]\n        RES[HTTP Response]\n        APP[FastAPI Application]\n    end\n    \n    subgraph \"Server Layer\"\n        WS[WebSession]\n        CM[ConversationManager]\n        UA[UserAuth]\n    end\n    \n    REQ --> LC\n    LC --> CC\n    CC --> RL\n    RL --> IRL\n    RL --> APP\n    APP --> RES\n    \n    RL -.-> WS\n    RL -.-> CM\n    RL -.-> UA\n    \n    style RL fill:#e1f5fe\n    style IRL fill:#f3e5f5\n    style LC fill:#e8f5e8\n    style CC fill:#fff3e0\n```",
          "Component Details": {
            "RateLimitMiddleware": "The `RateLimitMiddleware` is a FastAPI/Starlette middleware that provides request rate limiting functionality to protect the server from excessive requests.\n\n**Key Features:**\n\n['**Request Throttling**: Limits the number of requests per client within a specified time window', '**Selective Application**: Only applies rate limiting to specific request paths (excludes static assets)', '**Configurable Responses**: Returns HTTP 429 (Too Many Requests) with appropriate retry headers', \"**Integration Ready**: Works seamlessly with FastAPI's middleware stack\"]\n\n**Configuration:**\n\n['Uses `InMemoryRateLimiter` for tracking request history', 'Configurable request limits and time windows', 'Optional sleep mechanism for gradual throttling']",
            "Supporting Components": {
              "InMemoryRateLimiter": "An in-memory rate limiting implementation that tracks request history per client IP address.\n\n**Features:**\n\n['**Time-based Windows**: Tracks requests within configurable time periods', '**Automatic Cleanup**: Removes expired request records to prevent memory leaks', '**Gradual Throttling**: Optional sleep mechanism before rejecting requests', '**IP-based Tracking**: Uses client IP addresses as rate limiting keys']",
              "LocalhostCORSMiddleware": "Custom CORS middleware that provides flexible cross-origin request handling.\n\n**Features:**\n\n['**Localhost Bypass**: Automatically allows requests from localhost/127.0.0.1', '**Environment Configuration**: Supports `PERMITTED_CORS_ORIGINS` environment variable', '**Standard Compliance**: Falls back to standard CORS rules for non-localhost origins']",
              "CacheControlMiddleware": "Middleware for managing HTTP caching behavior across different resource types.\n\n**Features:**\n\n['**Asset Optimization**: Aggressive caching for fingerprinted static assets', '**Dynamic Content**: Disables caching for dynamic API responses', '**Performance Headers**: Sets appropriate Cache-Control, Pragma, and Expires headers']"
            }
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant CORS as LocalhostCORSMiddleware\n    participant Cache as CacheControlMiddleware\n    participant Rate as RateLimitMiddleware\n    participant Limiter as InMemoryRateLimiter\n    participant App as FastAPI App\n    \n    Client->>CORS: HTTP Request\n    CORS->>CORS: Check Origin Policy\n    CORS->>Cache: Forward Request\n    Cache->>Rate: Forward Request\n    Rate->>Rate: Check if Rate Limited Path\n    \n    alt Rate Limited Path\n        Rate->>Limiter: Check Rate Limit\n        Limiter->>Limiter: Clean Old Requests\n        Limiter->>Limiter: Add Current Request\n        \n        alt Within Limit\n            Limiter-->>Rate: Allow\n            Rate->>App: Forward Request\n            App-->>Rate: Response\n        else Exceeded Limit (Soft)\n            Limiter->>Limiter: Sleep\n            Limiter-->>Rate: Allow After Sleep\n            Rate->>App: Forward Request\n            App-->>Rate: Response\n        else Exceeded Limit (Hard)\n            Limiter-->>Rate: Reject\n            Rate-->>Client: 429 Too Many Requests\n        end\n    else Non-Rate Limited Path\n        Rate->>App: Forward Request\n        App-->>Rate: Response\n    end\n    \n    Rate->>Cache: Response\n    Cache->>Cache: Add Cache Headers\n    Cache->>CORS: Response\n    CORS-->>Client: HTTP Response\n```",
          "Integration Points": {
            "Server and API Module": "The web_infrastructure module integrates closely with the [server_and_api](server_and_api.md) module:\n\n['**WebSession Integration**: Rate limiting protects session endpoints from abuse', '**ConversationManager Protection**: Prevents overwhelming conversation processing endpoints', '**UserAuth Coordination**: Works with authentication middleware for comprehensive security']",
            "Configuration Management": "Integrates with [core_configuration](core_configuration.md) for:\n\n['**Environment Variables**: CORS origins configuration', '**Security Settings**: Rate limiting parameters', '**Performance Tuning**: Cache control policies']"
          },
          "Security Considerations": {
            "Rate Limiting Strategy": "```\ngraph LR\n    subgraph \"Rate Limiting Levels\"\n        A[No Limit] --> B[Soft Limit<br/>Sleep Delay]\n        B --> C[Hard Limit<br/>Reject Request]\n    end\n    \n    subgraph \"Request Types\"\n        D[Static Assets<br/>No Rate Limit]\n        E[API Endpoints<br/>Rate Limited]\n        F[Authentication<br/>Rate Limited]\n    end\n    \n    D --> A\n    E --> B\n    F --> C\n    \n    style A fill:#e8f5e8\n    style B fill:#fff3e0\n    style C fill:#ffebee\n```",
            "CORS Security Model": [
              "**Localhost Development**: Permissive for local development",
              "**Production Origins**: Strict whitelist-based approach",
              "**Credential Handling**: Supports authenticated cross-origin requests"
            ]
          },
          "Performance Optimization": {
            "Caching Strategy": [
              "**Static Assets**: Long-term caching with immutable headers",
              "**Dynamic Content**: Aggressive no-cache policies",
              "**Fingerprinted Resources**: Maximum cache efficiency"
            ],
            "Memory Management": [
              "**Request History Cleanup**: Automatic removal of expired rate limit records",
              "**Efficient Data Structures**: Uses defaultdict for optimal memory usage",
              "**Configurable Retention**: Time-based cleanup prevents memory leaks"
            ]
          },
          "Configuration Examples": {
            "Rate Limiting Configuration": "```\n# Basic rate limiter setup\nrate_limiter = InMemoryRateLimiter(\n    requests=10,        # Allow 10 requests\n    seconds=60,         # Per 60 seconds\n    sleep_seconds=1     # Sleep 1 second on soft limit\n)\n\n# Apply to FastAPI app\napp.add_middleware(RateLimitMiddleware, rate_limiter=rate_limiter)\n```",
            "CORS Configuration": "```\n# Environment variable for allowed origins\nexport PERMITTED_CORS_ORIGINS=\"https://app.example.com,https://admin.example.com\"\n```"
          },
          "Error Handling": {
            "Rate Limit Responses": [
              "**Status Code**: 429 Too Many Requests",
              "**Retry Header**: Includes Retry-After header",
              "**JSON Response**: Structured error message",
              "**Client Guidance**: Clear indication of rate limit violation"
            ],
            "CORS Failures": [
              "**Origin Validation**: Proper handling of disallowed origins",
              "**Preflight Requests**: Correct OPTIONS request processing",
              "**Error Responses**: Standard CORS error handling"
            ]
          },
          "Monitoring and Observability": {
            "Rate Limiting Metrics": [
              "**Request Counts**: Per-client request tracking",
              "**Rejection Rates**: Monitor rate limit violations",
              "**Response Times**: Impact of sleep delays on performance"
            ],
            "Performance Monitoring": [
              "**Cache Hit Rates**: Static asset caching effectiveness",
              "**Middleware Latency**: Processing time for each middleware layer",
              "**Memory Usage**: Rate limiter memory consumption patterns"
            ]
          },
          "Future Enhancements": {
            "Distributed Rate Limiting": [
              "**Redis Backend**: Replace in-memory storage for multi-instance deployments",
              "**Consistent Hashing**: Distribute rate limiting across multiple servers",
              "**Cluster Coordination**: Synchronized rate limiting in containerized environments"
            ],
            "Advanced Security Features": [
              "**IP Whitelisting**: Bypass rate limits for trusted sources",
              "**Dynamic Rate Limits**: Adjust limits based on server load",
              "**Behavioral Analysis**: Detect and prevent abuse patterns"
            ]
          },
          "Dependencies": "This module depends on:\n\n['**FastAPI/Starlette**: Core web framework and middleware infrastructure', '**Standard Library**: datetime, collections, urllib for core functionality', '**Environment Configuration**: OS environment variables for CORS settings']",
          "Related Documentation": [
            "[Server and API](server_and_api.md) - Main server infrastructure and session management",
            "[Authentication System](authentication_system.md) - User authentication and authorization",
            "[Core Configuration](core_configuration.md) - System configuration management",
            "[Security System](security_system.md) - Comprehensive security analysis and protection"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "codeact_agents",
      "description": null,
      "content": {
        "CodeAct Agents Module": {
          "Architecture Overview": "```\ngraph TB\n    subgraph \"CodeAct Agents Module\"\n        CA[CodeActAgent]\n        LA[LocAgent]\n        ROA[ReadOnlyAgent]\n        \n        subgraph \"Tools & Function Calling\"\n            CFT[CodeAct Function Tools]\n            LFT[Loc Function Tools]\n            RFT[ReadOnly Function Tools]\n        end\n        \n        subgraph \"Core Tools\"\n            BT[Bash Tool]\n            IPT[IPython Tool]\n            ET[Editor Tools]\n            BRT[Browser Tool]\n            TT[Think Tool]\n            FT[Finish Tool]\n            CTT[Condensation Tool]\n            TTT[Task Tracker Tool]\n        end\n    end\n    \n    subgraph \"Dependencies\"\n        direction TB\n        AGT[Agent Base Class]\n        LLM[LLM Integration]\n        STATE[State Management]\n        MEMORY[Conversation Memory]\n        CONDENSER[Memory Condenser]\n        RUNTIME[Runtime System]\n    end\n    \n    CA --> AGT\n    LA --> CA\n    ROA --> CA\n    \n    CA --> CFT\n    LA --> LFT\n    ROA --> RFT\n    \n    CFT --> BT\n    CFT --> IPT\n    CFT --> ET\n    CFT --> BRT\n    CFT --> TT\n    CFT --> FT\n    CFT --> CTT\n    CFT --> TTT\n    \n    CA --> LLM\n    CA --> STATE\n    CA --> MEMORY\n    CA --> CONDENSER\n    CA --> RUNTIME\n    \n    classDef agent fill:#e1f5fe\n    classDef tool fill:#f3e5f5\n    classDef dependency fill:#fff3e0\n    \n    class CA,LA,ROA agent\n    class BT,IPT,ET,BRT,TT,FT,CTT,TTT tool\n    class AGT,LLM,STATE,MEMORY,CONDENSER,RUNTIME dependency\n```",
          "Core Components": {
            "CodeActAgent": "The primary agent implementation that consolidates LLM actions into a unified code action space.\n\n**Key Features:**\n\n['**Unified Action Space**: Combines conversation and code execution into a single interface', '**Multi-Tool Support**: Integrates bash commands, Python execution, file editing, and web browsing', '**Memory Management**: Uses conversation memory and condensation for efficient context handling', '**Function Calling**: Supports structured tool invocation through LLM function calling']\n\n**Core Capabilities:**\n\n['**Converse**: Natural language communication with users', '**CodeAct**: Task execution through code (bash commands and Python)', '**File Operations**: Reading, editing, and managing files', '**Web Browsing**: Interactive web navigation and content extraction', '**Task Management**: Planning and tracking task progress']",
            "LocAgent": "A specialized variant of CodeActAgent with location-aware capabilities.\n\n**Specializations:**\n\n['Inherits all CodeActAgent functionality', 'Uses custom function calling implementation for location-specific operations', 'Optimized for tasks requiring spatial or location-based reasoning']",
            "ReadOnlyAgent": "A safety-focused variant that restricts operations to read-only tools.\n\n**Safety Features:**\n\n['**Read-Only Operations**: Only allows non-destructive operations', '**Safe Exploration**: Ideal for codebase analysis without modification risk', '**Restricted Tool Set**: Limited to grep, glob, view, think, finish, and web_read tools', '**MCP Tool Restriction**: Explicitly disables MCP tools for additional safety']"
          },
          "Tool System Architecture": "```\ngraph LR\n    subgraph \"Tool Categories\"\n        subgraph \"Execution Tools\"\n            BASH[Bash Command Tool]\n            PYTHON[IPython Tool]\n        end\n        \n        subgraph \"File Tools\"\n            EDITOR[String Replace Editor]\n            LLMEDITOR[LLM-Based Editor]\n        end\n        \n        subgraph \"Navigation Tools\"\n            BROWSER[Browser Tool]\n            TASK[Task Tracker]\n        end\n        \n        subgraph \"Communication Tools\"\n            THINK[Think Tool]\n            FINISH[Finish Tool]\n            CONDENSE[Condensation Request]\n        end\n    end\n    \n    subgraph \"Agent Configurations\"\n        CA_CONFIG[CodeActAgent Config]\n        LA_CONFIG[LocAgent Config]\n        ROA_CONFIG[ReadOnlyAgent Config]\n    end\n    \n    CA_CONFIG --> BASH\n    CA_CONFIG --> PYTHON\n    CA_CONFIG --> EDITOR\n    CA_CONFIG --> LLMEDITOR\n    CA_CONFIG --> BROWSER\n    CA_CONFIG --> TASK\n    CA_CONFIG --> THINK\n    CA_CONFIG --> FINISH\n    CA_CONFIG --> CONDENSE\n    \n    LA_CONFIG --> BASH\n    LA_CONFIG --> PYTHON\n    LA_CONFIG --> EDITOR\n    LA_CONFIG --> BROWSER\n    LA_CONFIG --> THINK\n    LA_CONFIG --> FINISH\n    \n    ROA_CONFIG --> THINK\n    ROA_CONFIG --> FINISH\n    ROA_CONFIG -.-> BROWSER\n    \n    classDef execution fill:#ffcdd2\n    classDef file fill:#c8e6c9\n    classDef navigation fill:#bbdefb\n    classDef communication fill:#f8bbd9\n    classDef config fill:#fff9c4\n    \n    class BASH,PYTHON execution\n    class EDITOR,LLMEDITOR file\n    class BROWSER,TASK navigation\n    class THINK,FINISH,CONDENSE communication\n    class CA_CONFIG,LA_CONFIG,ROA_CONFIG config\n```",
          "Agent Lifecycle and Processing Flow": "```\nsequenceDiagram\n    participant User\n    participant Agent\n    participant LLM\n    participant Tools\n    participant Runtime\n    participant Memory\n    \n    User->>Agent: Initial Message\n    Agent->>Memory: Process Events\n    Memory->>Agent: Condensed History\n    Agent->>Agent: Build Messages\n    Agent->>LLM: Send Messages + Tools\n    LLM->>Agent: Response with Tool Calls\n    Agent->>Agent: Parse Response to Actions\n    \n    loop For Each Action\n        Agent->>Tools: Execute Tool\n        Tools->>Runtime: Perform Operation\n        Runtime->>Tools: Return Result\n        Tools->>Agent: Tool Response\n        Agent->>Memory: Store Observation\n    end\n    \n    Agent->>User: Final Response\n```",
          "Memory and Context Management": "```\ngraph TB\n    subgraph \"Memory System\"\n        CM[Conversation Memory]\n        CONDENSER[Memory Condenser]\n        \n        subgraph \"Memory Operations\"\n            PROCESS[Process Events]\n            CONDENSE[Condense History]\n            CACHE[Apply Caching]\n        end\n    end\n    \n    subgraph \"State Management\"\n        STATE[Current State]\n        HISTORY[Event History]\n        METADATA[LLM Metadata]\n    end\n    \n    subgraph \"LLM Integration\"\n        MESSAGES[Message Construction]\n        CONTEXT[Context Window Management]\n        CACHING[Prompt Caching]\n    end\n    \n    STATE --> CM\n    HISTORY --> CONDENSER\n    \n    CM --> PROCESS\n    CONDENSER --> CONDENSE\n    CM --> CACHE\n    \n    PROCESS --> MESSAGES\n    CONDENSE --> CONTEXT\n    CACHE --> CACHING\n    \n    MESSAGES --> LLM[LLM Completion]\n    CONTEXT --> LLM\n    CACHING --> LLM\n    \n    classDef memory fill:#e8f5e8\n    classDef state fill:#fff3e0\n    classDef llm fill:#e3f2fd\n    \n    class CM,CONDENSER,PROCESS,CONDENSE,CACHE memory\n    class STATE,HISTORY,METADATA state\n    class MESSAGES,CONTEXT,CACHING,LLM llm\n```",
          "Configuration and Customization": {
            "Agent Configuration Options": "```\ngraph LR\n    subgraph \"Agent Config\"\n        SYSTEM[System Prompt]\n        TOOLS_CONFIG[Tool Configuration]\n        MEMORY_CONFIG[Memory Configuration]\n        LLM_CONFIG[LLM Configuration]\n    end\n    \n    subgraph \"Tool Toggles\"\n        CMD[enable_cmd]\n        THINK[enable_think]\n        FINISH[enable_finish]\n        BROWSE[enable_browsing]\n        JUPYTER[enable_jupyter]\n        PLAN[enable_plan_mode]\n        EDITOR[enable_editor]\n        LLM_EDITOR[enable_llm_editor]\n        CONDENSE[enable_condensation_request]\n    end\n    \n    TOOLS_CONFIG --> CMD\n    TOOLS_CONFIG --> THINK\n    TOOLS_CONFIG --> FINISH\n    TOOLS_CONFIG --> BROWSE\n    TOOLS_CONFIG --> JUPYTER\n    TOOLS_CONFIG --> PLAN\n    TOOLS_CONFIG --> EDITOR\n    TOOLS_CONFIG --> LLM_EDITOR\n    TOOLS_CONFIG --> CONDENSE\n    \n    classDef config fill:#f3e5f5\n    classDef toggle fill:#e8f5e8\n    \n    class SYSTEM,TOOLS_CONFIG,MEMORY_CONFIG,LLM_CONFIG config\n    class CMD,THINK,FINISH,BROWSE,JUPYTER,PLAN,EDITOR,LLM_EDITOR,CONDENSE toggle\n```"
          },
          "Integration Points": {
            "Dependencies on Other Modules": [
              "**[core_agent_system](core_agent_system.md)**: Base Agent class and state management",
              "**[llm_integration](llm_integration.md)**: LLM communication and routing",
              "**[events_and_actions](events_and_actions.md)**: Action and observation handling",
              "**[runtime_system](runtime_system.md)**: Code execution environment",
              "**Memory System**: Conversation memory and condensation capabilities"
            ],
            "Runtime Requirements": "```\ngraph TB\n    subgraph \"Runtime Dependencies\"\n        PLUGINS[Sandbox Plugins]\n        SKILLS[Agent Skills Requirement]\n        JUPYTER[Jupyter Requirement]\n    end\n    \n    subgraph \"Platform Support\"\n        LINUX[Linux Support]\n        WINDOWS[Windows Support]\n        MACOS[macOS Support]\n    end\n    \n    subgraph \"Tool Limitations\"\n        BROWSE_WIN[Browser Tool - Windows Limited]\n        MCP_RO[MCP Tools - ReadOnly Disabled]\n    end\n    \n    PLUGINS --> SKILLS\n    PLUGINS --> JUPYTER\n    \n    LINUX --> BROWSE_WIN\n    WINDOWS --> BROWSE_WIN\n    \n    classDef requirement fill:#ffcdd2\n    classDef platform fill:#c8e6c9\n    classDef limitation fill:#fff3e0\n    \n    class PLUGINS,SKILLS,JUPYTER requirement\n    class LINUX,WINDOWS,MACOS platform\n    class BROWSE_WIN,MCP_RO limitation\n```"
          },
          "Usage Patterns": {
            "CodeActAgent Usage": "```\n# Standard usage for general-purpose tasks\nagent = CodeActAgent(config, llm_registry)\naction = agent.step(state)\n```",
            "LocAgent Usage": "```\n# For location-aware tasks\nagent = LocAgent(config, llm_registry)\naction = agent.step(state)\n```",
            "ReadOnlyAgent Usage": "```\n# For safe codebase exploration\nagent = ReadOnlyAgent(config, llm_registry)\naction = agent.step(state)  # Only read-only operations\n```"
          },
          "Function Calling Architecture": "```\ngraph TB\n    subgraph \"Function Calling Flow\"\n        RESPONSE[LLM Response]\n        PARSER[Response Parser]\n        ACTIONS[Action List]\n        QUEUE[Pending Actions Queue]\n    end\n    \n    subgraph \"Tool Execution\"\n        TOOL_CALL[Tool Call]\n        TOOL_EXEC[Tool Execution]\n        OBSERVATION[Observation]\n    end\n    \n    subgraph \"Agent Variants\"\n        CA_FC[CodeAct Function Calling]\n        LA_FC[Loc Function Calling]\n        RO_FC[ReadOnly Function Calling]\n    end\n    \n    RESPONSE --> PARSER\n    PARSER --> ACTIONS\n    ACTIONS --> QUEUE\n    QUEUE --> TOOL_CALL\n    TOOL_CALL --> TOOL_EXEC\n    TOOL_EXEC --> OBSERVATION\n    \n    CA_FC --> PARSER\n    LA_FC --> PARSER\n    RO_FC --> PARSER\n    \n    classDef flow fill:#e3f2fd\n    classDef execution fill:#f3e5f5\n    classDef variant fill:#e8f5e8\n    \n    class RESPONSE,PARSER,ACTIONS,QUEUE flow\n    class TOOL_CALL,TOOL_EXEC,OBSERVATION execution\n    class CA_FC,LA_FC,RO_FC variant\n```",
          "Error Handling and Safety": {
            "Safety Mechanisms": [
              "**ReadOnlyAgent**: Prevents destructive operations",
              "**Tool Validation**: Checks tool availability and compatibility",
              "**Platform Checks**: Validates tool support on current platform",
              "**MCP Tool Control**: Selective enabling/disabling of external tools"
            ],
            "Error Recovery": [
              "**Pending Actions Queue**: Maintains action continuity across errors",
              "**State Validation**: Ensures valid conversation state",
              "**Memory Condensation**: Handles context overflow gracefully"
            ]
          },
          "Performance Considerations": {
            "Memory Optimization": [
              "**Event Condensation**: Reduces memory footprint of long conversations",
              "**Message Caching**: Optimizes repeated LLM calls",
              "**Tool Description Optimization**: Adjusts tool descriptions based on LLM model"
            ],
            "Execution Efficiency": [
              "**Pending Actions**: Batches multiple actions for efficient execution",
              "**Tool Selection**: Dynamic tool loading based on configuration",
              "**Context Management**: Intelligent context window utilization"
            ]
          },
          "Future Extensions": "The CodeAct Agents module is designed for extensibility:\n\n['**New Agent Types**: Easy addition of specialized agent variants', '**Tool Integration**: Modular tool system for new capabilities', '**Memory Strategies**: Pluggable memory and condensation approaches', '**Platform Support**: Expandable runtime environment support']\n\nThis module serves as the foundation for intelligent code-aware AI agents that can understand, navigate, and interact with software development environments while maintaining safety and efficiency."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "event_foundation",
      "description": null,
      "content": {
        "Event Foundation Module": {
          "Overview": "The event_foundation module defines the base classes and enums that form the foundation of OpenHands' event-driven architecture. It provides three primary abstractions:\n\n['**Event**: The base class for all system events with metadata, timing, and source tracking', '**Action**: Events that represent executable operations initiated by agents or users', '**Observation**: Events that capture environmental responses and system state changes']\n\nThis module serves as the cornerstone for the broader [events_and_actions](events_and_actions.md) system, enabling loose coupling between system components while maintaining comprehensive event tracking and metadata management.",
          "Architecture": "```\nclassDiagram\n    class Event {\n        <<abstract>>\n        +int id\n        +string message\n        +string timestamp\n        +EventSource source\n        +int cause\n        +float timeout\n        +Metrics llm_metrics\n        +ToolCallMetadata tool_call_metadata\n        +string response_id\n        +set_hard_timeout(value, blocking)\n    }\n    \n    class Action {\n        <<abstract>>\n        +bool runnable\n        +ActionConfirmationStatus confirmation_status\n        +ActionSecurityRisk security_risk\n    }\n    \n    class Observation {\n        +string content\n    }\n    \n    class EventSource {\n        <<enumeration>>\n        AGENT\n        USER\n        ENVIRONMENT\n    }\n    \n    class ActionConfirmationStatus {\n        <<enumeration>>\n        CONFIRMED\n        REJECTED\n        AWAITING_CONFIRMATION\n    }\n    \n    class ActionSecurityRisk {\n        <<enumeration>>\n        UNKNOWN\n        LOW\n        MEDIUM\n        HIGH\n    }\n    \n    class FileEditSource {\n        <<enumeration>>\n        LLM_BASED_EDIT\n        OH_ACI\n    }\n    \n    class FileReadSource {\n        <<enumeration>>\n        OH_ACI\n        DEFAULT\n    }\n    \n    class RecallType {\n        <<enumeration>>\n        WORKSPACE_CONTEXT\n        KNOWLEDGE\n    }\n    \n    Event <|-- Action\n    Event <|-- Observation\n    Event --> EventSource\n    Action --> ActionConfirmationStatus\n    Action --> ActionSecurityRisk\n    Event --> FileEditSource\n    Event --> FileReadSource\n    Event --> RecallType\n```",
          "Core Components": {
            "Event Base Class": "The `Event` class serves as the foundational abstraction for all system events, providing:\n\n**Core Properties:**\n\n['`id`: Unique identifier for event tracking and correlation', '`message`: Human-readable description of the event', '`timestamp`: ISO format timestamp for temporal ordering', '`source`: Origin classification (AGENT, USER, ENVIRONMENT)', '`cause`: Reference to triggering event for causality chains']\n\n**Metadata Support:**\n\n['`llm_metrics`: Cost and performance metrics for LLM operations', '`tool_call_metadata`: Detailed information about tool invocations', '`response_id`: LLM response correlation identifier']\n\n**Timeout Management:**\n\n['`timeout`: Configurable execution timeout', '`set_hard_timeout()`: Blocking timeout configuration']",
            "Action Class": "Actions represent executable operations within the system:\n\n```\nstateDiagram-v2\n    [*] --> AWAITING_CONFIRMATION\n    AWAITING_CONFIRMATION --> CONFIRMED: User/System Approval\n    AWAITING_CONFIRMATION --> REJECTED: User/System Denial\n    CONFIRMED --> [*]: Execute Action\n    REJECTED --> [*]: Cancel Action\n```\n\n**Security Integration:**\n\n['Risk assessment through `ActionSecurityRisk` levels', 'Confirmation workflow via `ActionConfirmationStatus`', 'Integration with [security_system](security_system.md) for risk analysis']",
            "Observation Class": "Observations capture environmental responses and system state:\n\n['**Content Storage**: Flexible content field for various data types', '**Truncation Support**: Automatic content truncation for large observations', '**Event Inheritance**: Full event metadata and tracking capabilities']"
          },
          "Event Source Classification": "```\ngraph TD\n    A[Event Sources] --> B[AGENT]\n    A --> C[USER]\n    A --> D[ENVIRONMENT]\n    \n    B --> B1[Agent Actions]\n    B --> B2[Agent Observations]\n    B --> B3[Agent State Changes]\n    \n    C --> C1[User Commands]\n    C --> C2[User Inputs]\n    C --> C3[User Confirmations]\n    \n    D --> D1[Runtime Responses]\n    D --> D2[File System Changes]\n    D --> D3[External API Results]\n```",
          "Integration Points": {
            "Core Agent System": [
              "Events flow through [core_agent_system](core_agent_system.md) for processing",
              "Action parsing and response handling via [action_processing](action_processing.md)",
              "State management integration through [state_management](state_management.md)"
            ],
            "Event Streaming": [
              "Foundation for [event_streaming](event_streaming.md) infrastructure",
              "Event store persistence through `EventStoreABC` implementations",
              "Real-time event distribution via `EventStreamSubscriber`"
            ],
            "Type System Integration": [
              "Concrete action types defined in [type_definitions](type_definitions.md)",
              "`ActionType` and `ObservationType` enumerations",
              "Type-safe event creation and handling"
            ]
          },
          "Data Flow": "```\nsequenceDiagram\n    participant A as Agent\n    participant E as Event Foundation\n    participant S as Event Store\n    participant R as Runtime\n    \n    A->>E: Create Action\n    E->>E: Set metadata & timestamp\n    E->>S: Store event\n    S->>R: Execute action\n    R->>E: Create Observation\n    E->>E: Link to causing action\n    E->>S: Store observation\n    S->>A: Return observation\n```",
          "Specialized Event Types": {
            "File Operations": [
              "`FileEditSource`: Tracks edit operation origins (LLM vs ACI)",
              "`FileReadSource`: Categorizes file read operations",
              "Integration with [storage_system](storage_system.md) for persistence"
            ],
            "Microagent Integration": [
              "`RecallType`: Defines retrievable information categories",
              "Workspace context and knowledge retrieval",
              "Connection to [microagent_system](microagent_system.md)"
            ]
          },
          "Event Lifecycle Management": "```\ngraph LR\n    A[Event Creation] --> B[Metadata Assignment]\n    B --> C[Source Classification]\n    C --> D[Timestamp Recording]\n    D --> E[ID Assignment]\n    E --> F[Storage/Processing]\n    F --> G[Causality Linking]\n    G --> H[Timeout Handling]\n```",
          "Best Practices": {
            "Event Creation": [
              "Always set appropriate `EventSource` for proper routing",
              "Include meaningful messages for debugging and logging",
              "Set timeouts for long-running operations"
            ],
            "Metadata Management": [
              "Attach LLM metrics for cost tracking and optimization",
              "Use tool call metadata for debugging and analysis",
              "Maintain causality chains through proper `cause` setting"
            ],
            "Security Considerations": [
              "Classify action security risks appropriately",
              "Implement confirmation workflows for high-risk operations",
              "Integration with [security_system](security_system.md) for comprehensive analysis"
            ]
          },
          "Performance Considerations": [
            "**Memory Management**: Large observation content is automatically truncated",
            "**Metadata Overhead**: Optional metadata fields minimize memory footprint",
            "**Timestamp Efficiency**: ISO format strings balance readability and performance",
            "**ID Management**: Integer IDs provide efficient event correlation"
          ],
          "Related Modules": [
            "**[events_and_actions](events_and_actions.md)**: Complete event system architecture",
            "**[event_streaming](event_streaming.md)**: Real-time event distribution",
            "**[type_definitions](type_definitions.md)**: Concrete event type implementations",
            "**[core_agent_system](core_agent_system.md)**: Event processing and routing",
            "**[security_system](security_system.md)**: Event security analysis",
            "**[microagent_system](microagent_system.md)**: Specialized event handling"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "conversation_management",
      "description": null,
      "content": {
        "Conversation Management Module": {
          "Overview": "The conversation_management module implements an abstract storage layer for conversation metadata, enabling OpenHands to maintain conversation history, user associations, and conversation-specific settings. It provides a pluggable architecture that allows different storage backends while maintaining a consistent interface for conversation operations.",
          "Architecture": "```\ngraph TB\n    subgraph \"Conversation Management Architecture\"\n        CS[ConversationStore<br/>Abstract Base Class]\n        CM[ConversationMetadata<br/>Data Model]\n        CMRS[ConversationMetadataResultSet<br/>Search Results]\n        \n        subgraph \"Server Integration\"\n            SCM[ServerConversationManager<br/>Orchestration Layer]\n            SC[ServerConversation<br/>Session Handler]\n            ES[EventStream<br/>Event Processing]\n        end\n        \n        subgraph \"Storage Implementations\"\n            FSS[FileSystemStore<br/>File-based Storage]\n            DBS[DatabaseStore<br/>Database Storage]\n            CS3[CloudStore<br/>Cloud Storage]\n        end\n        \n        CS -.-> FSS\n        CS -.-> DBS\n        CS -.-> CS3\n        \n        SCM --> CS\n        SCM --> SC\n        SC --> ES\n        \n        CS --> CM\n        CS --> CMRS\n    end\n    \n    subgraph \"External Dependencies\"\n        CONFIG[OpenHandsConfig<br/>Configuration]\n        FS[FileStore<br/>File Storage]\n        RT[Runtime<br/>Execution Environment]\n    end\n    \n    CS --> CONFIG\n    SCM --> FS\n    SC --> RT\n```",
          "Core Components": {
            "ConversationStore": "The `ConversationStore` is an abstract base class that defines the interface for conversation metadata persistence. It provides a pluggable architecture allowing applications to customize storage backends.\n\n**Key Features:**\n\n['Abstract interface for conversation metadata operations', 'User validation and access control', 'Parallel metadata retrieval capabilities', 'Extensible design for custom implementations']\n\n**Core Methods:**\n\n['`save_metadata()`: Store conversation metadata', '`get_metadata()`: Retrieve conversation metadata', '`delete_metadata()`: Remove conversation metadata', '`search()`: Query conversations with pagination', '`validate_metadata()`: Verify user access permissions']",
            "ConversationMetadata": "The `ConversationMetadata` data model represents the complete metadata for a conversation, including user associations, repository information, and usage metrics.\n\n**Key Attributes:**\n\n['`conversation_id`: Unique conversation identifier', '`user_id`: Associated user identifier', '`selected_repository`: Repository context', '`git_provider`: Git service provider', '`title`: Human-readable conversation title', '`trigger`: Conversation initiation source', '`llm_model`: Language model used', 'Cost and token tracking metrics']",
            "ConversationMetadataResultSet": "A container for paginated search results that includes conversation metadata and pagination information."
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant ConversationManager\n    participant ConversationStore\n    participant ServerConversation\n    participant EventStream\n    \n    Client->>ConversationManager: Join Conversation\n    ConversationManager->>ConversationStore: get_metadata(conversation_id)\n    ConversationStore-->>ConversationManager: ConversationMetadata\n    \n    ConversationManager->>ConversationStore: validate_metadata(conversation_id, user_id)\n    ConversationStore-->>ConversationManager: validation_result\n    \n    alt Valid Access\n        ConversationManager->>ServerConversation: Create/Attach\n        ServerConversation->>EventStream: Initialize\n        EventStream-->>ServerConversation: Event Stream Ready\n        ServerConversation-->>ConversationManager: Conversation Ready\n        ConversationManager-->>Client: AgentLoopInfo\n    else Invalid Access\n        ConversationManager-->>Client: Access Denied\n    end\n    \n    Client->>ConversationManager: Send Message\n    ConversationManager->>ServerConversation: Process Message\n    ServerConversation->>EventStream: Add Event\n    EventStream->>EventStream: Notify Subscribers\n    \n    ConversationManager->>ConversationStore: save_metadata(updated_metadata)\n    ConversationStore-->>ConversationManager: Success\n```",
          "Integration Points": {
            "Server Integration": "The conversation_management module integrates closely with the [server_and_api](server_and_api.md) module through:\n\n['**ConversationManager**: Orchestrates conversation lifecycle and integrates with ConversationStore', '**ServerConversation**: Manages individual conversation sessions and event streams', '**Session Management**: Handles user sessions and conversation attachments']",
            "Event System Integration": "Integration with the [events_and_actions](events_and_actions.md) module provides:\n\n['**EventStream**: Real-time event processing and distribution', '**Event Storage**: Persistent event history through EventStore', '**Subscriber Management**: Event notification system for conversation updates']",
            "Storage System Integration": "As part of the broader [storage_system](storage_system.md), it coordinates with:\n\n['**FileStore**: File-based storage operations', '**SecretsStore**: Secure credential management', '**SettingsStore**: User preference storage']"
          },
          "Component Relationships": "```\ngraph LR\n    subgraph \"Conversation Management\"\n        CS[ConversationStore]\n        CM[ConversationMetadata]\n        CMRS[ConversationMetadataResultSet]\n    end\n    \n    subgraph \"Server Layer\"\n        SCM[ConversationManager]\n        SC[ServerConversation]\n        WS[WebSession]\n    end\n    \n    subgraph \"Event System\"\n        ES[EventStream]\n        ESS[EventStreamSubscriber]\n        ESA[EventStoreABC]\n    end\n    \n    subgraph \"Storage System\"\n        FS[FileStore]\n        SS[SecretsStore]\n        STS[SettingsStore]\n    end\n    \n    subgraph \"Runtime System\"\n        RT[Runtime]\n        RB[RuntimeBuilder]\n    end\n    \n    CS --> CM\n    CS --> CMRS\n    SCM --> CS\n    SCM --> SC\n    SC --> ES\n    SC --> RT\n    ES --> ESS\n    ES --> ESA\n    SCM --> FS\n    \n    CS -.-> SS\n    CS -.-> STS\n    SC -.-> FS\n```",
          "Usage Patterns": {
            "Basic Conversation Operations": "```\n# Get conversation store instance\nstore = await ConversationStore.get_instance(config, user_id)\n\n# Create new conversation metadata\nmetadata = ConversationMetadata(\n    conversation_id=\"conv_123\",\n    user_id=\"user_456\",\n    title=\"Code Review Task\",\n    selected_repository=\"owner/repo\",\n    git_provider=ProviderType.GITHUB\n)\n\n# Save metadata\nawait store.save_metadata(metadata)\n\n# Retrieve metadata\nretrieved = await store.get_metadata(\"conv_123\")\n\n# Validate user access\nis_valid = await store.validate_metadata(\"conv_123\", \"user_456\")\n\n# Search conversations\nresults = await store.search(limit=10)\n```",
            "Conversation Lifecycle Management": "```\n# Through ConversationManager\nconversation_manager = ConversationManager.get_instance(...)\n\n# Join conversation\nagent_loop_info = await conversation_manager.join_conversation(\n    sid=\"session_123\",\n    connection_id=\"conn_456\",\n    settings=settings,\n    user_id=\"user_789\"\n)\n\n# Start agent loop\nawait conversation_manager.maybe_start_agent_loop(\n    sid=\"session_123\",\n    settings=settings,\n    user_id=\"user_789\",\n    initial_user_msg=message\n)\n\n# Send events to conversation\nawait conversation_manager.send_event_to_conversation(\n    sid=\"session_123\",\n    data=event_data\n)\n```"
          },
          "Configuration and Extensibility": {
            "Custom Store Implementation": "Applications can provide custom ConversationStore implementations:\n\n```\nclass CustomConversationStore(ConversationStore):\n    async def save_metadata(self, metadata: ConversationMetadata) -> None:\n        # Custom storage logic\n        pass\n    \n    async def get_metadata(self, conversation_id: str) -> ConversationMetadata:\n        # Custom retrieval logic\n        pass\n    \n    # Implement other abstract methods...\n    \n    @classmethod\n    async def get_instance(cls, config: OpenHandsConfig, user_id: str | None) -> ConversationStore:\n        return cls(config, user_id)\n```",
            "Configuration Integration": "The module integrates with OpenHands configuration system:\n\n```\n# In server configuration\nserver_config.conversation_store_class = \"myapp.storage.CustomConversationStore\"\n```"
          },
          "Security Considerations": {
            "Access Control": [
              "**User Validation**: `validate_metadata()` ensures users can only access their own conversations",
              "**Session Security**: Integration with authentication system through user_id validation",
              "**Data Isolation**: Conversation metadata is isolated by user context"
            ],
            "Data Protection": [
              "**Secret Management**: Integration with SecretsStore for sensitive data",
              "**Event Stream Security**: Secure event processing with secret replacement",
              "**Audit Trail**: Complete conversation history through EventStream"
            ]
          },
          "Performance Characteristics": {
            "Scalability Features": [
              "**Parallel Operations**: `get_all_metadata()` supports concurrent metadata retrieval",
              "**Pagination**: Search operations support efficient pagination",
              "**Caching**: EventStream implements page-based caching for performance",
              "**Async Operations**: Full async/await support for non-blocking operations"
            ],
            "Optimization Strategies": [
              "**Lazy Loading**: Metadata loaded on-demand",
              "**Batch Operations**: Support for bulk metadata operations",
              "**Connection Pooling**: Efficient resource management through abstract interface",
              "**Event Batching**: EventStream batches events for efficient processing"
            ]
          },
          "Error Handling": {
            "Exception Management": [
              "**Validation Errors**: Proper handling of invalid conversation access",
              "**Storage Errors**: Graceful degradation for storage failures",
              "**Connection Errors**: Robust error handling for network issues",
              "**Resource Cleanup**: Proper cleanup of resources and connections"
            ],
            "Monitoring and Logging": [
              "**Operation Logging**: Comprehensive logging of conversation operations",
              "**Performance Metrics**: Integration with monitoring systems",
              "**Error Tracking**: Detailed error reporting and tracking",
              "**Usage Analytics**: Conversation usage and performance analytics"
            ]
          },
          "Future Considerations": {
            "Planned Enhancements": [
              "**Multi-tenant Support**: Enhanced isolation for enterprise deployments",
              "**Advanced Search**: Full-text search capabilities for conversation content",
              "**Backup and Recovery**: Automated backup and disaster recovery features",
              "**Performance Optimization**: Advanced caching and indexing strategies"
            ],
            "Extension Points": [
              "**Custom Metadata Fields**: Support for application-specific metadata",
              "**Event Hooks**: Pluggable event handlers for conversation lifecycle",
              "**Storage Adapters**: Additional storage backend implementations",
              "**Analytics Integration**: Enhanced analytics and reporting capabilities"
            ]
          },
          "Related Documentation": [
            "[server_and_api](server_and_api.md) - Server orchestration and API management",
            "[events_and_actions](events_and_actions.md) - Event system and action processing",
            "[storage_system](storage_system.md) - Complete storage architecture",
            "[user_data_management](user_data_management.md) - User-specific data handling",
            "[file_storage_infrastructure](file_storage_infrastructure.md) - File storage operations"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "platform_managers",
      "description": null,
      "content": {
        "Platform Managers Module": {
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Platform Managers\"\n        GM[GithubManager]\n        GLM[GitlabManager]\n        JM[JiraManager]\n        SM[SlackManager]\n    end\n    \n    subgraph \"Core Infrastructure\"\n        TM[TokenManager]\n        CC[ConversationManager]\n        UA[UserAuth]\n        IS[IntegrationStore]\n    end\n    \n    subgraph \"External Platforms\"\n        GH[GitHub]\n        GL[GitLab]\n        JIRA[Jira]\n        SLACK[Slack]\n    end\n    \n    subgraph \"OpenHands Core\"\n        AGT[Agent System]\n        RT[Runtime System]\n        LLM[LLM Integration]\n    end\n    \n    GH -->|Webhooks| GM\n    GL -->|Webhooks| GLM\n    JIRA -->|Webhooks| JM\n    SLACK -->|Events| SM\n    \n    GM --> TM\n    GLM --> TM\n    JM --> TM\n    SM --> TM\n    \n    GM --> CC\n    GLM --> CC\n    JM --> CC\n    SM --> CC\n    \n    JM --> IS\n    SM --> IS\n    \n    CC --> AGT\n    CC --> RT\n    CC --> LLM\n```",
          "Component Dependencies": "```\ngraph LR\n    subgraph \"Platform Managers Dependencies\"\n        PM[Platform Managers] --> SI[shared_infrastructure]\n        PM --> SSM[server_and_api]\n        PM --> STO[storage_system]\n        PM --> GIT[git_integrations]\n        PM --> LLM[llm_integration]\n        PM --> CSA[core_agent_system]\n    end\n    \n    SI --> |JobResult| PM\n    SSM --> |ConversationManager, UserAuth| PM\n    STO --> |Various Stores| PM\n    GIT --> |Git Services| PM\n    LLM --> |LLM Services| PM\n    CSA --> |Agent Orchestration| PM\n```",
          "Core Components": {
            "GithubManager": "The GitHub integration manager handles GitHub App webhooks and orchestrates automated issue and pull request resolution.\n\n**Key Responsibilities:**\n\n['Process GitHub webhooks (issues, comments, PR events)', 'Validate user permissions and repository access', 'Manage GitHub App installation tokens', \"Coordinate with GitHub's API for reactions and comments\", 'Trigger solvability analysis for issues']\n\n**Authentication Flow:**\n\n```\nsequenceDiagram\n    participant GH as GitHub\n    participant GM as GithubManager\n    participant TM as TokenManager\n    participant UA as UserAuth\n    \n    GH->>GM: Webhook Event\n    GM->>GM: Validate Installation\n    GM->>TM: Get Installation Token\n    GM->>GM: Check User Permissions\n    GM->>UA: Authenticate User\n    GM->>GH: Add Reaction (eyes)\n    GM->>GM: Start Job\n```",
            "GitlabManager": "The GitLab integration manager processes GitLab webhooks and manages merge request and issue automation.\n\n**Key Responsibilities:**\n\n['Handle GitLab webhook events', 'Validate user access permissions', 'Manage GitLab API interactions', 'Coordinate conversation creation and updates']\n\n**Workflow Process:**\n\n```\nflowchart TD\n    A[GitLab Webhook] --> B{Valid Event?}\n    B -->|No| C[Ignore]\n    B -->|Yes| D[Check User Permissions]\n    D --> E{Has Write Access?}\n    E -->|No| F[Reject]\n    E -->|Yes| G[Create GitLab View]\n    G --> H[Start Job]\n    H --> I[Register Callback]\n    I --> J[Send Response]\n```",
            "JiraManager": "The Jira integration manager handles Jira Cloud webhooks and manages issue-based task automation.\n\n**Key Responsibilities:**\n\n['Process Jira webhook events (comments, label updates)', 'Validate webhook signatures for security', 'Manage workspace and user authentication', 'Handle repository selection for issue context', 'Coordinate with Jira Cloud API']\n\n**Security Validation:**\n\n```\nsequenceDiagram\n    participant J as Jira\n    participant JM as JiraManager\n    participant WS as Workspace Store\n    \n    J->>JM: Webhook + Signature\n    JM->>JM: Extract Workspace Name\n    JM->>WS: Get Workspace Config\n    JM->>JM: Validate HMAC Signature\n    alt Valid Signature\n        JM->>JM: Process Event\n    else Invalid Signature\n        JM->>JM: Reject Request\n    end\n```",
            "SlackManager": "The Slack integration manager processes Slack events and manages conversational AI interactions within Slack workspaces.\n\n**Key Responsibilities:**\n\n['Handle Slack app mentions and interactions', 'Manage OAuth authentication flow', 'Process repository selection through interactive forms', 'Coordinate conversation threading']\n\n**Repository Selection Flow:**\n\n```\nflowchart TD\n    A[Slack Mention] --> B{User Authenticated?}\n    B -->|No| C[Send OAuth Link]\n    B -->|Yes| D[Parse Message for Repo]\n    D --> E{Repo Inferred?}\n    E -->|Yes| F[Start Job]\n    E -->|No| G[Show Repo Selection Form]\n    G --> H[User Selects Repo]\n    H --> F\n```"
          },
          "Data Flow Architecture": "```\nflowchart TB\n    subgraph \"Incoming Events\"\n        WH[Webhooks/Events]\n    end\n    \n    subgraph \"Platform Managers\"\n        PM[Platform Manager]\n        AUTH[Authentication]\n        PERM[Permission Check]\n        VIEW[View Creation]\n    end\n    \n    subgraph \"Conversation System\"\n        CONV[Conversation Creation]\n        CB[Callback Registration]\n        TMPL[Template Rendering]\n    end\n    \n    subgraph \"Agent Execution\"\n        AGT[Agent Runtime]\n        TASK[Task Execution]\n        RESP[Response Generation]\n    end\n    \n    subgraph \"Response Delivery\"\n        API[Platform API]\n        NOTIF[Notifications]\n    end\n    \n    WH --> PM\n    PM --> AUTH\n    AUTH --> PERM\n    PERM --> VIEW\n    VIEW --> CONV\n    CONV --> CB\n    CB --> TMPL\n    TMPL --> AGT\n    AGT --> TASK\n    TASK --> RESP\n    RESP --> API\n    API --> NOTIF\n```",
          "Integration Patterns": {
            "Common Manager Interface": "All platform managers inherit from a base `Manager` class and implement common patterns:\n\n```\nclass Manager:\n    async def receive_message(self, message: Message) -> None\n    async def send_message(self, message: Message, view: ViewInterface) -> None\n    async def is_job_requested(self, message: Message) -> bool\n    async def start_job(self, view: ViewInterface) -> None\n```",
            "Authentication Strategy": "```\ngraph TD\n    A[Platform Event] --> B[Extract User ID]\n    B --> C[Lookup Internal User]\n    C --> D{User Found?}\n    D -->|No| E[Send Auth Link]\n    D -->|Yes| F[Get Provider Token]\n    F --> G[Validate Permissions]\n    G --> H{Has Access?}\n    H -->|No| I[Reject Request]\n    H -->|Yes| J[Proceed with Job]\n```",
            "Error Handling Strategy": "Each manager implements comprehensive error handling:\n\n['**Authentication Errors**: Redirect to login/setup', '**Permission Errors**: Inform user of access requirements', '**Configuration Errors**: Guide user to proper setup', '**Runtime Errors**: Graceful degradation with user notification']"
          },
          "Security Considerations": {
            "Webhook Validation": [
              "**GitHub**: Installation-based authentication with GitHub App",
              "**GitLab**: Project-level permission validation",
              "**Jira**: HMAC signature verification with workspace secrets",
              "**Slack**: OAuth-based user authentication"
            ],
            "Token Management": "All managers integrate with the centralized [server_and_api](server_and_api.md) token management system:\n\n['Secure token storage and retrieval', 'Provider-specific token handling', 'Automatic token refresh where supported', 'Encrypted storage of sensitive credentials']"
          },
          "Configuration Requirements": {
            "Environment Variables": "Each platform manager requires specific configuration:\n\n```\n# GitHub\nGITHUB_APP_CLIENT_ID: \"github_app_id\"\nGITHUB_APP_PRIVATE_KEY: \"private_key_pem\"\n\n# Slack\nSLACK_CLIENT_ID: \"slack_app_client_id\"\nJWT_SECRET: \"jwt_signing_secret\"\n\n# Jira (per workspace)\nJIRA_CLOUD_ID: \"workspace_cloud_id\"\nJIRA_WEBHOOK_SECRET: \"webhook_secret\"\n```",
            "Database Schema": "Platform managers rely on integration-specific storage schemas:\n\n['**SlackUser**: Maps Slack users to OpenHands users', '**JiraWorkspace**: Stores Jira workspace configurations', '**JiraUser**: Links Jira users to internal authentication']"
          },
          "Performance Considerations": {
            "Async Processing": "All managers are built with async/await patterns for:\n\n['Non-blocking webhook processing', 'Concurrent API calls', 'Efficient resource utilization']",
            "Caching Strategy": [
              "Installation tokens cached for GitHub",
              "User authentication cached across requests",
              "Repository lists cached per user session"
            ]
          },
          "Integration with Core Systems": {
            "Conversation Management": "Platform managers integrate with [server_and_api](server_and_api.md) conversation management:\n\n```\n# Create conversation with platform context\nconversation_id = await view.create_new_conversation(\n    jinja_env, provider_tokens, metadata\n)\n\n# Register platform-specific callback processor\nregister_callback_processor(conversation_id, processor)\n```",
            "Agent Orchestration": "Jobs are coordinated with the [core_agent_system](core_agent_system.md):\n\n['Repository context injection', 'Task-specific agent selection', 'Runtime environment configuration']",
            "Storage Integration": "Platform managers utilize [storage_system](storage_system.md) components:\n\n['Conversation persistence', 'User settings and secrets', 'Integration-specific data storage']"
          },
          "Monitoring and Observability": {
            "Logging Strategy": "Comprehensive logging across all managers:\n\n['Structured logging with context', 'User and platform identification', 'Error tracking and debugging', 'Performance metrics']",
            "Health Checks": "Each manager provides health monitoring:\n\n['Webhook endpoint availability', 'Authentication service status', 'Platform API connectivity', 'Database connection health']"
          },
          "Future Extensibility": "The platform managers architecture supports:\n\n['**New Platform Integration**: Following established patterns', '**Enhanced Security**: Additional validation layers', '**Advanced Workflows**: Multi-platform coordination', '**Analytics Integration**: Usage and performance tracking']",
          "Related Documentation": [
            "[shared_infrastructure](shared_infrastructure.md) - Common models and utilities",
            "[server_and_api](server_and_api.md) - Authentication and conversation management",
            "[storage_system](storage_system.md) - Data persistence layers",
            "[git_integrations](git_integrations.md) - Git service abstractions",
            "[core_agent_system](core_agent_system.md) - Agent orchestration"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "plugin_system",
      "description": null,
      "content": {
        "Plugin System": {
          "Overview": "The plugin system is built around a simple but powerful abstraction that allows external components to be seamlessly integrated into the OpenHands runtime environment. Plugins operate as independent modules that can process actions and generate observations, extending the capabilities of agents beyond the core runtime functionality.",
          "Architecture": "```\ngraph TB\n    subgraph \"Runtime System\"\n        R[Runtime] --> PL[Plugin Loader]\n        PL --> PR[Plugin Registry]\n        PR --> P1[Plugin Instance 1]\n        PR --> P2[Plugin Instance 2]\n        PR --> PN[Plugin Instance N]\n    end\n    \n    subgraph \"Plugin Interface\"\n        PI[Plugin Base Class]\n        PI --> |implements| P1\n        PI --> |implements| P2\n        PI --> |implements| PN\n    end\n    \n    subgraph \"Event System\"\n        A[Action] --> P1\n        P1 --> O1[Observation]\n        A --> P2\n        P2 --> O2[Observation]\n    end\n    \n    subgraph \"Plugin Requirements\"\n        REQ[PluginRequirement]\n        REQ --> |specifies| P1\n        REQ --> |specifies| P2\n    end\n    \n    style PI fill:#e1f5fe\n    style REQ fill:#f3e5f5\n    style R fill:#e8f5e8\n```",
          "Core Components": {
            "Plugin Base Class": "The `Plugin` class serves as the abstract base class for all plugin implementations:\n\n```\nclass Plugin:\n    \"\"\"Base class for a plugin.\n\n    This will be initialized by the runtime client, which will run inside docker.\n    \"\"\"\n\n    name: str\n\n    @abstractmethod\n    async def initialize(self, username: str) -> None:\n        \"\"\"Initialize the plugin.\"\"\"\n        pass\n\n    @abstractmethod\n    async def run(self, action: Action) -> Observation:\n        \"\"\"Run the plugin for a given action.\"\"\"\n        pass\n```\n\n**Key Characteristics:**\n\n['**Abstract Interface**: Defines the contract that all plugins must implement', '**Asynchronous Operations**: Both initialization and execution are async for non-blocking operations', '**Action-Observation Pattern**: Follows the core OpenHands event model', '**Runtime Integration**: Designed to run within the runtime environment (typically Docker)']",
            "PluginRequirement": "The `PluginRequirement` dataclass specifies plugin dependencies:\n\n```\n@dataclass\nclass PluginRequirement:\n    \"\"\"Requirement for a plugin.\"\"\"\n\n    name: str\n```\n\n**Purpose:**\n\n['**Dependency Declaration**: Specifies which plugins are needed by a runtime', '**Plugin Discovery**: Enables the runtime to locate and load required plugins', '**Configuration Management**: Provides a simple way to configure plugin dependencies']"
          },
          "Integration with Runtime System": {
            "Plugin Lifecycle": [
              "**Loading Phase**",
              [
                "Runtime reads plugin requirements from configuration",
                "Plugin loader instantiates required plugins",
                "Each plugin undergoes initialization with user context"
              ],
              "**Execution Phase**",
              [
                "Actions are routed to appropriate plugins",
                "Plugins process actions asynchronously",
                "Observations are generated and returned to the event system"
              ],
              "**Cleanup Phase**",
              [
                "Plugins are properly disposed when runtime shuts down",
                "Resources are cleaned up and connections closed"
              ]
            ]
          },
          "Plugin Types and Examples": {
            "Built-in Plugin Types": "The system supports various plugin types, including:\n\n['**VSCode Plugin**: Provides IDE functionality within the runtime', '**Jupyter Plugin**: Enables notebook-style code execution', '**Development Tools**: Various development and debugging utilities']",
            "Plugin Implementation Pattern": "```\nclass CustomPlugin(Plugin):\n    name = \"custom_plugin\"\n    \n    async def initialize(self, username: str) -> None:\n        # Setup plugin resources\n        self.username = username\n        self.initialized = True\n    \n    async def run(self, action: Action) -> Observation:\n        # Process the action and return observation\n        if isinstance(action, CustomAction):\n            result = await self.process_custom_action(action)\n            return CustomObservation(content=result)\n        \n        return ErrorObservation(\"Unsupported action type\")\n```"
          },
          "Data Flow": "```\nflowchart LR\n    subgraph \"Input Processing\"\n        UA[User Action] --> AP[Action Parser]\n        AP --> A[Action Object]\n    end\n    \n    subgraph \"Plugin System\"\n        A --> PR[Plugin Router]\n        PR --> P[Plugin Instance]\n        P --> PP[Plugin Processor]\n    end\n    \n    subgraph \"Output Generation\"\n        PP --> O[Observation]\n        O --> ES[Event Stream]\n        ES --> UI[User Interface]\n    end\n    \n    style P fill:#e1f5fe\n    style PP fill:#e1f5fe\n```",
          "Configuration and Management": {
            "Plugin Requirements Configuration": "Plugins are specified in the runtime configuration:\n\n```\nplugins = [\n    PluginRequirement(name=\"vscode\"),\n    PluginRequirement(name=\"jupyter\"),\n    PluginRequirement(name=\"custom_tool\")\n]\n\nruntime = Runtime(\n    config=config,\n    plugins=plugins,\n    # ... other parameters\n)\n```",
            "Dynamic Plugin Loading": "The runtime system supports dynamic plugin loading based on:\n\n['**Configuration Settings**: Plugins specified in runtime config', '**Environment Detection**: Automatic plugin loading based on environment', '**User Preferences**: User-specific plugin preferences']"
          },
          "Error Handling and Resilience": {
            "Error Handling Strategies": [
              "**Graceful Degradation**: Failed plugins don't crash the entire runtime",
              "**Error Propagation**: Plugin errors are converted to error observations",
              "**Retry Mechanisms**: Transient failures can be retried automatically",
              "**Fallback Options**: Alternative plugins can be used if primary plugins fail"
            ]
          },
          "Security Considerations": {
            "Plugin Isolation": [
              "**Sandboxed Execution**: Plugins run within the runtime's security context",
              "**Resource Limits**: Plugins are subject to runtime resource constraints",
              "**Permission Model**: Plugins inherit runtime permissions but can be further restricted"
            ],
            "Security Analysis Integration": "The plugin system integrates with the [security_system](security_system.md) for:\n\n['**Plugin Validation**: Security analysis of plugin code and behavior', '**Risk Assessment**: Evaluation of plugin security implications', '**Compliance Checking**: Ensuring plugins meet security requirements']"
          },
          "Performance Considerations": {
            "Asynchronous Operations": [
              "**Non-blocking Execution**: Plugin operations don't block the runtime",
              "**Concurrent Processing**: Multiple plugins can execute simultaneously",
              "**Resource Management**: Efficient resource utilization across plugins"
            ],
            "Optimization Strategies": [
              "**Lazy Loading**: Plugins are loaded only when needed",
              "**Caching**: Plugin results can be cached for repeated operations",
              "**Connection Pooling**: Shared resources across plugin instances",
              "**Memory Management**: Proper cleanup of plugin resources"
            ]
          },
          "Integration Points": {
            "Event System Integration": "The plugin system is tightly integrated with the [events_and_actions](events_and_actions.md) module:\n\n['**Action Processing**: Plugins consume Action objects', '**Observation Generation**: Plugins produce Observation objects', '**Event Streaming**: Plugin outputs flow through the event stream']",
            "Runtime System Integration": "Plugins are managed by the [runtime_system](runtime_system.md):\n\n['**Lifecycle Management**: Runtime controls plugin initialization and cleanup', '**Resource Allocation**: Runtime provides resources to plugins', '**Environment Setup**: Runtime prepares the environment for plugin execution']",
            "LLM Integration": "Plugins can leverage the [llm_integration](llm_integration.md) system:\n\n['**AI-Powered Plugins**: Plugins can use LLM capabilities', '**Context Sharing**: Plugins can share context with LLM operations', '**Intelligent Processing**: LLM-enhanced plugin functionality']"
          },
          "Development Guidelines": {
            "Creating Custom Plugins": [
              "**Inherit from Plugin**: Extend the base Plugin class",
              "**Implement Required Methods**: Provide initialize() and run() implementations",
              "**Handle Errors Gracefully**: Convert exceptions to appropriate observations",
              "**Follow Async Patterns**: Use async/await for non-blocking operations",
              "**Document Behavior**: Clearly document plugin capabilities and limitations"
            ],
            "Testing Plugins": [
              "**Unit Testing**: Test plugin logic in isolation",
              "**Integration Testing**: Test plugin interaction with runtime",
              "**Performance Testing**: Validate plugin performance characteristics",
              "**Security Testing**: Ensure plugin security compliance"
            ],
            "Best Practices": [
              "**Resource Management**: Properly manage plugin resources and connections",
              "**Error Handling**: Implement comprehensive error handling",
              "**Documentation**: Provide clear documentation for plugin usage",
              "**Versioning**: Use semantic versioning for plugin releases",
              "**Compatibility**: Ensure backward compatibility when possible"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Plugin Marketplace**: Central repository for community plugins",
              "**Hot Reloading**: Dynamic plugin updates without runtime restart",
              "**Plugin Composition**: Ability to chain plugins together",
              "**Advanced Security**: Enhanced security model for plugin execution",
              "**Performance Monitoring**: Built-in performance monitoring for plugins"
            ],
            "Extension Points": "The plugin system is designed to be extensible:\n\n['**Custom Plugin Types**: Support for domain-specific plugin types', '**Plugin Communication**: Inter-plugin communication mechanisms', '**Configuration Management**: Advanced plugin configuration options', '**Monitoring Integration**: Integration with monitoring and observability tools']"
          },
          "Related Documentation": [
            "[runtime_system](runtime_system.md) - Core runtime architecture and plugin management",
            "[events_and_actions](events_and_actions.md) - Event system that plugins integrate with",
            "[security_system](security_system.md) - Security analysis and validation for plugins",
            "[core_agent_system](core_agent_system.md) - Agent system that utilizes plugin capabilities"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "authentication_system",
      "description": null,
      "content": {
        "Authentication System": {
          "Overview": "The authentication system is designed as a pluggable architecture that allows different authentication implementations while maintaining a consistent interface. It handles user identity verification, access token management, user settings and secrets storage, and enterprise-grade access control features.",
          "Architecture": "```\ngraph TB\n    subgraph \"Authentication Layer\"\n        UA[UserAuth Abstract Base]\n        UV[UserVerifier]\n        SAC[SetAuthCookieMiddleware]\n    end\n    \n    subgraph \"Storage Layer\"\n        SS[SecretsStore]\n        STS[SettingsStore]\n    end\n    \n    subgraph \"Configuration Layer\"\n        SC[ServerConfigInterface]\n        SEC[SecurityConfig]\n    end\n    \n    subgraph \"External Services\"\n        GS[Google Sheets]\n        KC[Keycloak]\n        FL[File System]\n    end\n    \n    UA --> SS\n    UA --> STS\n    UV --> GS\n    UV --> FL\n    SAC --> UA\n    SAC --> KC\n    SC --> SEC\n    \n    classDef abstract fill:#e1f5fe\n    classDef concrete fill:#f3e5f5\n    classDef external fill:#fff3e0\n    \n    class UA,SS,STS,SC abstract\n    class UV,SAC concrete\n    class GS,KC,FL external\n```",
          "Core Components": {
            "UserAuth (Abstract Base Class)": "The `UserAuth` class serves as the foundation for all authentication implementations in OpenHands. It defines the contract that all authentication providers must implement.\n\n**Key Responsibilities:**\n\n['User identity management (ID, email)', 'Access token handling', 'Provider token management', 'User settings and secrets access', 'Authentication type identification']\n\n**Extension Point:**\nApplications can provide custom authentication by:\n\n['Inheriting from `UserAuth`', 'Implementing all abstract methods', 'Setting `server_config.user_auth_class` to the implementation class name']",
            "UserVerifier (Enterprise)": "The `UserVerifier` class provides enterprise-grade user access control through allowlist management.\n\n**Features:**\n\n['File-based user allowlists', 'Google Sheets integration for dynamic user management', 'Environment-based configuration', 'Flexible user verification strategies']\n\n**Configuration:**\n\n['`GITHUB_USER_LIST_FILE`: Path to text file containing allowed usernames', '`GITHUB_USERS_SHEET_ID`: Google Sheets ID for dynamic user management', '`DISABLE_WAITLIST`: Flag to disable user verification entirely']"
          },
          "Authentication Flow": "```\nsequenceDiagram\n    participant Client\n    participant Middleware as SetAuthCookieMiddleware\n    participant UserAuth\n    participant Storage as Storage Layer\n    participant External as External Services\n    \n    Client->>Middleware: HTTP Request with Auth\n    Middleware->>Middleware: Check TOS Acceptance\n    Middleware->>UserAuth: Get User Auth Instance\n    UserAuth->>External: Validate Credentials\n    External-->>UserAuth: Auth Response\n    UserAuth->>Storage: Load User Data\n    Storage-->>UserAuth: User Settings/Secrets\n    UserAuth-->>Middleware: Authenticated User\n    Middleware->>Middleware: Update Auth Cookie\n    Middleware-->>Client: Response with Updated Cookie\n```",
          "User Verification Process": "```\nflowchart TD\n    A[User Request] --> B{Waitlist Disabled?}\n    B -->|Yes| G[Allow Access]\n    B -->|No| C{File Users Configured?}\n    C -->|Yes| D[Check File Allowlist]\n    C -->|No| E{Sheets Configured?}\n    D --> F{User in File?}\n    E --> H[Check Sheets Allowlist]\n    F -->|Yes| G\n    F -->|No| E\n    H --> I{User in Sheets?}\n    I -->|Yes| G\n    I -->|No| J[Deny Access]\n    E -->|No| J\n```",
          "Data Flow": "```\ngraph LR\n    subgraph \"Request Processing\"\n        REQ[HTTP Request]\n        MW[Middleware]\n        AUTH[Authentication]\n    end\n    \n    subgraph \"User Data\"\n        ID[User ID]\n        EMAIL[User Email]\n        TOKENS[Access Tokens]\n        SETTINGS[User Settings]\n        SECRETS[User Secrets]\n    end\n    \n    subgraph \"Storage Systems\"\n        FS[File System]\n        DB[Database]\n        EXT[External APIs]\n    end\n    \n    REQ --> MW\n    MW --> AUTH\n    AUTH --> ID\n    AUTH --> EMAIL\n    AUTH --> TOKENS\n    AUTH --> SETTINGS\n    AUTH --> SECRETS\n    \n    SETTINGS --> FS\n    SECRETS --> DB\n    TOKENS --> EXT\n```",
          "Component Interactions": "```\ngraph TB\n    subgraph \"Web Layer\"\n        HTTP[HTTP Request]\n        COOKIE[Auth Cookie]\n    end\n    \n    subgraph \"Middleware Layer\"\n        SAC[SetAuthCookieMiddleware]\n        RLM[RateLimitMiddleware]\n    end\n    \n    subgraph \"Authentication Core\"\n        UA[UserAuth Implementation]\n        UV[UserVerifier]\n    end\n    \n    subgraph \"Data Access\"\n        SS[SecretsStore]\n        STS[SettingsStore]\n    end\n    \n    subgraph \"External Integration\"\n        KC[Keycloak]\n        GS[Google Sheets]\n        FILE[File System]\n    end\n    \n    HTTP --> SAC\n    COOKIE --> SAC\n    SAC --> UA\n    SAC --> KC\n    UA --> SS\n    UA --> STS\n    UV --> GS\n    UV --> FILE\n    \n    HTTP --> RLM\n    RLM --> SAC\n```",
          "Key Features": {
            "Flexible Authentication Architecture": [
              "Abstract base class allows multiple authentication implementations",
              "Pluggable design supports various authentication providers",
              "Consistent interface across different authentication strategies"
            ],
            "Enterprise Access Control": [
              "File-based and Google Sheets-based user allowlists",
              "Dynamic user verification with real-time updates",
              "Environment-based configuration for different deployment scenarios"
            ],
            "Secure Session Management": [
              "JWT-based authentication with secure cookie handling",
              "Automatic token refresh and session management",
              "Terms of Service (TOS) acceptance tracking and enforcement"
            ],
            "User Data Management": [
              "Secure storage of user secrets and settings",
              "Abstract storage interfaces for flexible data persistence",
              "User-specific data isolation and access control"
            ],
            "Middleware Integration": [
              "Authentication middleware for request processing",
              "Rate limiting integration for security",
              "Cookie management and security headers"
            ]
          },
          "Security Features": {
            "Token Management": [
              "Secure JWT token handling with signature verification",
              "Automatic token refresh and expiration management",
              "Secure cookie attributes (HttpOnly, Secure, SameSite)"
            ],
            "Access Control": [
              "User allowlist verification for enterprise deployments",
              "Terms of Service acceptance enforcement",
              "Email verification requirements"
            ],
            "Error Handling": [
              "Comprehensive authentication error handling",
              "Secure error responses without information leakage",
              "Automatic logout on authentication failures"
            ]
          },
          "Configuration": {
            "Environment Variables": "**User Verification:**\n\n['`GITHUB_USER_LIST_FILE`: Path to file containing allowed GitHub usernames', '`GITHUB_USERS_SHEET_ID`: Google Sheets ID for dynamic user management', \"`DISABLE_WAITLIST`: Set to 'true' to disable user verification\"]\n\n**Security:**\n\n['`JWT_SECRET`: Secret key for JWT token signing', 'Cookie security settings based on deployment environment']",
            "Server Configuration": "The authentication system integrates with the broader server configuration through the `ServerConfigInterface`, allowing for:\n\n['Authentication provider configuration', 'Security policy settings', 'Integration with external services']"
          },
          "Integration Points": {
            "Storage System Integration": "The authentication system integrates closely with the [storage_system](storage_system.md) module:\n\n['**SecretsStore**: Manages user API keys, tokens, and sensitive data', '**SettingsStore**: Handles user preferences and configuration settings']",
            "Configuration Management": "Integration with [core_configuration](core_configuration.md) module:\n\n['**SecurityConfig**: Authentication and security policy configuration', '**ServerConfig**: Server-wide authentication settings']",
            "Session Management": "Coordination with [session_management](session_management.md) module:\n\n['User session lifecycle management', 'Session-based authentication state', 'Multi-session support for enterprise users']"
          },
          "Implementation Examples": {
            "Custom Authentication Provider": "```\nclass CustomUserAuth(UserAuth):\n    async def get_user_id(self) -> str | None:\n        # Custom user ID retrieval logic\n        pass\n    \n    async def get_user_email(self) -> str | None:\n        # Custom email retrieval logic\n        pass\n    \n    # Implement other abstract methods...\n```",
            "User Verification Setup": "```\n# File-based user verification\nuser_verifier = UserVerifier()\nis_allowed = user_verifier.is_user_allowed(\"github_username\")\n\n# Check if verification is active\nif user_verifier.is_active():\n    # Apply user verification logic\n    pass\n```"
          },
          "Error Handling": "The authentication system provides comprehensive error handling for various scenarios:\n\n['**NoCredentialsError**: Missing or invalid authentication credentials', '**AuthError**: General authentication failures', '**EmailNotVerifiedError**: Unverified email addresses', '**TosNotAcceptedError**: Terms of Service not accepted', '**CookieError**: Invalid or expired authentication cookies']",
          "Best Practices": {
            "Security": [
              "Always use HTTPS in production environments",
              "Implement proper JWT secret rotation",
              "Set appropriate cookie security attributes",
              "Regularly audit user access lists"
            ],
            "Performance": [
              "Cache user verification results when appropriate",
              "Implement efficient token refresh strategies",
              "Use connection pooling for external service integrations"
            ],
            "Monitoring": [
              "Log authentication events for security auditing",
              "Monitor failed authentication attempts",
              "Track user verification patterns",
              "Alert on suspicious authentication activities"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "Multi-factor authentication (MFA) support",
              "OAuth 2.0 provider integration",
              "Advanced user role and permission management",
              "Audit logging and compliance features"
            ],
            "Extensibility": "The modular design allows for easy extension with:\n\n['Additional authentication providers', 'Custom user verification strategies', 'Enhanced security features', 'Integration with enterprise identity systems']"
          },
          "Related Documentation": [
            "[server_and_api](server_and_api.md) - Overall server architecture and API design",
            "[storage_system](storage_system.md) - User data storage and management",
            "[core_configuration](core_configuration.md) - System configuration and security settings",
            "[session_management](session_management.md) - Session lifecycle and management"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "shared_infrastructure",
      "description": null,
      "content": {
        "Shared Infrastructure Module": {
          "Overview": "This module is part of the enterprise integrations system and provides shared infrastructure components that enable consistent communication and data exchange between different platform integrations (GitHub, GitLab, Jira, Slack, etc.). It establishes common patterns for job execution, result handling, and cross-platform messaging.",
          "Architecture": "```\ngraph TB\n    subgraph \"Shared Infrastructure\"\n        SI[shared_infrastructure]\n        SI --> JR[JobResult]\n        SI --> JC[JobContext]\n        SI --> MSG[Message]\n        SI --> ST[SourceType]\n        SI --> GRJ[GithubResolverJob]\n    end\n    \n    subgraph \"Platform Managers\"\n        PM[platform_managers]\n        PM --> GH[GithubManager]\n        PM --> GL[GitlabManager]\n        PM --> JM[JiraManager]\n        PM --> SM[SlackManager]\n    end\n    \n    subgraph \"Core System\"\n        CS[core_agent_system]\n        CS --> AS[AgentState]\n    end\n    \n    PM --> SI\n    SI --> CS\n    \n    style SI fill:#e1f5fe\n    style PM fill:#f3e5f5\n    style CS fill:#e8f5e8\n```",
          "Core Components": {
            "JobResult": "The `JobResult` class represents the outcome of a job execution within the enterprise integration system.\n\n**Attributes:**\n\n['`result: str` - The primary result or output of the job', '`explanation: str` - Detailed explanation of the job execution and results']\n\n**Purpose:**\n\n['Standardizes job outcome representation across all platform integrations', 'Provides consistent result format for job tracking and reporting', 'Enables uniform error handling and success reporting']",
            "JobContext": "The `JobContext` class encapsulates all contextual information required for job execution across different platforms.\n\n**Attributes:**\n\n['`issue_id: str` - Unique identifier for the issue being processed', '`issue_key: str` - Platform-specific key for the issue', '`user_msg: str` - User message or instruction', '`user_email: str` - Email of the requesting user', '`display_name: str` - Display name of the user', '`platform_user_id: str` - Platform-specific user identifier (optional)', '`workspace_name: str` - Name of the workspace or organization', '`base_api_url: str` - Base API URL for the platform (optional)', '`issue_title: str` - Title of the issue (optional)', '`issue_description: str` - Description of the issue (optional)']\n\n**Purpose:**\n\n['Provides comprehensive context for job execution', 'Enables platform-agnostic job processing', 'Supports user identification and workspace management']",
            "Message": "The `Message` class defines a standardized messaging format for cross-platform communication.\n\n**Attributes:**\n\n['`source: SourceType` - The source platform of the message', '`message: str | dict` - The message content (string or structured data)', '`ephemeral: bool` - Whether the message is temporary (default: False)']\n\n**Purpose:**\n\n['Standardizes message format across different platforms', 'Supports both simple text and structured message content', 'Enables ephemeral messaging for temporary notifications']",
            "SourceType": "An enumeration defining supported platform types within the enterprise integration system.\n\n**Values:**\n\n['`GITHUB` - GitHub platform integration', '`GITLAB` - GitLab platform integration', '`OPENHANDS` - Internal OpenHands platform', '`SLACK` - Slack messaging platform', '`JIRA` - Atlassian Jira issue tracking', '`JIRA_DC` - Jira Data Center deployment', '`LINEAR` - Linear issue tracking platform']\n\n**Purpose:**\n\n['Provides type safety for platform identification', 'Enables platform-specific logic and routing', 'Supports extensibility for new platform integrations']",
            "GithubResolverJob": "A specialized job class for GitHub-specific operations and issue resolution.\n\n**Attributes:**\n\n['`type: SourceType` - Source type (typically GITHUB)', '`status: AgentState` - Current state of the job execution', '`result: JobResult` - Job execution result', '`owner: str` - GitHub repository owner', '`repo: str` - GitHub repository name', '`installation_token: str` - GitHub App installation token', '`issue_number: int` - GitHub issue number', '`runtime_id: int` - Runtime environment identifier', '`created_at: int` - Job creation timestamp', '`completed_at: int` - Job completion timestamp']\n\n**Purpose:**\n\n['Specializes job handling for GitHub platform', 'Tracks GitHub-specific metadata and authentication', 'Provides timeline tracking for job execution']"
          },
          "Dependencies": "```\ngraph LR\n    subgraph \"External Dependencies\"\n        PYDANTIC[Pydantic BaseModel]\n        ENUM[Python Enum]\n    end\n    \n    subgraph \"Internal Dependencies\"\n        AGENT_STATE[AgentState]\n    end\n    \n    subgraph \"Shared Infrastructure\"\n        SI[shared_infrastructure]\n    end\n    \n    PYDANTIC --> SI\n    ENUM --> SI\n    AGENT_STATE --> SI\n    \n    style PYDANTIC fill:#fff3e0\n    style ENUM fill:#fff3e0\n    style AGENT_STATE fill:#e8f5e8\n    style SI fill:#e1f5fe\n```",
          "Integration Patterns": {
            "Job Lifecycle Management": "```\nsequenceDiagram\n    participant PM as Platform Manager\n    participant SI as Shared Infrastructure\n    participant AS as Agent System\n    \n    PM->>SI: Create JobContext\n    SI->>AS: Initialize with AgentState\n    AS->>SI: Update job status\n    SI->>PM: Return JobResult\n    PM->>SI: Log completion timestamp\n```",
            "Cross-Platform Messaging": "```\nflowchart TD\n    A[Platform Event] --> B[Create Message]\n    B --> C{Source Type?}\n    C -->|GITHUB| D[GitHub Handler]\n    C -->|GITLAB| E[GitLab Handler]\n    C -->|SLACK| F[Slack Handler]\n    C -->|JIRA| G[Jira Handler]\n    D --> H[Process Message]\n    E --> H\n    F --> H\n    G --> H\n    H --> I[JobResult]\n```"
          },
          "Usage Examples": {
            "Creating a Job Context": "```\nfrom enterprise.integrations.models import JobContext, SourceType\n\ncontext = JobContext(\n    issue_id=\"12345\",\n    issue_key=\"PROJ-123\",\n    user_msg=\"Please fix the bug in authentication\",\n    user_email=\"developer@company.com\",\n    display_name=\"John Developer\",\n    workspace_name=\"engineering-team\",\n    issue_title=\"Authentication Bug\",\n    issue_description=\"Users cannot log in with SSO\"\n)\n```",
            "Processing Job Results": "```\nfrom enterprise.integrations.models import JobResult, Message, SourceType\n\n# Create a result\nresult = JobResult()\nresult.result = \"Issue resolved successfully\"\nresult.explanation = \"Fixed authentication flow and updated tests\"\n\n# Create notification message\nmessage = Message(\n    source=SourceType.GITHUB,\n    message=\"Issue has been resolved and PR is ready for review\",\n    ephemeral=False\n)\n```"
          },
          "Related Modules": [
            "**[platform_managers](platform_managers.md)** - Implements platform-specific managers that utilize these shared models",
            "**[core_agent_system](core_agent_system.md)** - Provides AgentState enumeration used in job tracking",
            "**[enterprise_server](enterprise_server.md)** - Server infrastructure that processes jobs using these models"
          ],
          "Extension Points": "The shared infrastructure module is designed for extensibility:\n\n['**New Platform Types**: Add new values to `SourceType` enum for additional platform integrations', '**Enhanced Job Context**: Extend `JobContext` with platform-specific fields as needed', '**Specialized Job Types**: Create new job classes following the `GithubResolverJob` pattern', '**Message Types**: Extend `Message` class for platform-specific messaging requirements']",
          "Best Practices": [
            "**Type Safety**: Always use `SourceType` enum values instead of string literals",
            "**Context Completeness**: Populate all relevant `JobContext` fields for comprehensive job tracking",
            "**Result Documentation**: Provide detailed explanations in `JobResult` for debugging and auditing",
            "**Message Clarity**: Use structured message content for complex notifications",
            "**Timestamp Tracking**: Always set creation and completion timestamps for job lifecycle management"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "configuration_management",
      "description": null,
      "content": {
        "Configuration Management Module": {
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Configuration Management Architecture\"\n        SI[ServerConfigInterface] --> SC[ServerConfig]\n        SI --> SSC[SaaSServerConfig]\n        \n        subgraph \"Configuration Sources\"\n            ENV[Environment Variables]\n            GH_API[GitHub API]\n            AUTH_CONST[Auth Constants]\n        end\n        \n        subgraph \"Configuration Categories\"\n            APP[App Mode Settings]\n            AUTH[Authentication Config]\n            FEAT[Feature Flags]\n            INT[Integration Settings]\n            MAINT[Maintenance Config]\n        end\n        \n        ENV --> SSC\n        GH_API --> SSC\n        AUTH_CONST --> SSC\n        \n        SSC --> APP\n        SSC --> AUTH\n        SSC --> FEAT\n        SSC --> INT\n        SSC --> MAINT\n        \n        SC --> APP\n        SC --> AUTH\n        SC --> FEAT\n    end\n```",
          "Core Components": {
            "ServerConfigInterface": "Abstract base class defining the configuration contract for all server configurations.\n\n**Key Responsibilities:**\n\n['Defines configuration verification interface', 'Establishes frontend configuration contract', 'Provides type safety for configuration attributes']\n\n**Abstract Methods:**\n\n['`verify_config()`: Validates configuration settings', '`get_config()`: Returns frontend-compatible configuration dictionary']",
            "SaaSServerConfig": "Enterprise-grade configuration implementation for SaaS deployments with advanced features and integrations.\n\n**Key Features:**\n\n['GitHub App integration with automatic slug retrieval', 'JWT token signing and webhook signature verification', 'Multi-provider authentication support', 'Maintenance window management', 'Enterprise feature flags', 'Specialized storage and authentication classes']"
          },
          "Configuration Hierarchy": "```\nclassDiagram\n    class ServerConfigInterface {\n        <<abstract>>\n        +CONFIG_PATH: str\n        +APP_MODE: AppMode\n        +POSTHOG_CLIENT_KEY: str\n        +GITHUB_CLIENT_ID: str\n        +verify_config()* void\n        +get_config()* dict\n    }\n    \n    class ServerConfig {\n        +app_mode: AppMode.OSS\n        +settings_store_class: str\n        +conversation_manager_class: str\n        +user_auth_class: str\n        +verify_config() void\n        +get_config() dict\n    }\n    \n    class SaaSServerConfig {\n        +app_mode: AppMode.SAAS\n        +enable_billing: bool\n        +hide_llm_settings: bool\n        +auth_url: str\n        +app_slug: str\n        +maintenance_start_time: str\n        +_get_app_slug() void\n        +verify_config() void\n        +get_config() dict\n    }\n    \n    ServerConfigInterface <|-- ServerConfig\n    ServerConfigInterface <|-- SaaSServerConfig\n```",
          "Configuration Flow": "```\nsequenceDiagram\n    participant App as Application\n    participant Config as SaaSServerConfig\n    participant GitHub as GitHub API\n    participant Env as Environment\n    \n    App->>Config: Initialize\n    Config->>Env: Load environment variables\n    Config->>Config: _get_app_slug()\n    Config->>GitHub: Generate JWT token\n    Config->>GitHub: GET /app (with JWT)\n    GitHub-->>Config: App metadata\n    Config->>Config: Extract app slug\n    App->>Config: verify_config()\n    Config->>Config: Validate required settings\n    App->>Config: get_config()\n    Config-->>App: Frontend configuration\n```",
          "Environment Variables": {
            "Core Configuration": [
              "`OPENHANDS_CONFIG_CLS`: Configuration class path",
              "`POSTHOG_CLIENT_KEY`: Analytics client key",
              "`AUTH_URL`: Authentication service URL"
            ],
            "Feature Flags": [
              "`ENABLE_BILLING`: Enable billing features",
              "`HIDE_LLM_SETTINGS`: Hide LLM configuration UI",
              "`ENABLE_JIRA`: Enable Jira integration",
              "`ENABLE_JIRA_DC`: Enable Jira Data Center",
              "`ENABLE_LINEAR`: Enable Linear integration"
            ],
            "Authentication Providers": [
              "`GITHUB_APP_CLIENT_ID`: GitHub OAuth client ID",
              "`GITHUB_APP_PRIVATE_KEY`: GitHub App private key",
              "`GITHUB_APP_WEBHOOK_SECRET`: GitHub webhook secret",
              "`GITLAB_APP_CLIENT_ID`: GitLab OAuth client ID",
              "`BITBUCKET_APP_CLIENT_ID`: Bitbucket OAuth client ID",
              "`ENABLE_ENTERPRISE_SSO`: Enable enterprise SSO"
            ],
            "Maintenance": [
              "`MAINTENANCE_START_TIME`: Scheduled maintenance timestamp"
            ]
          },
          "Integration Points": {
            "Storage System Integration": "The configuration management module integrates with the [storage_system](storage_system.md) by specifying storage implementation classes:\n\n```\n# SaaS-specific storage implementations\nsettings_store_class: str = 'storage.saas_settings_store.SaasSettingsStore'\nsecret_store_class: str = 'storage.saas_secrets_store.SaasSecretsStore'\nconversation_store_class: str = 'storage.saas_conversation_store.SaasConversationStore'\n```",
            "Authentication System Integration": "Works closely with the [authentication_system](authentication_system.md) to configure user authentication:\n\n```\nuser_auth_class: str = 'server.auth.saas_user_auth.SaasUserAuth'\n```",
            "Git Integrations": "Configures supported Git providers from [git_integrations](git_integrations.md):\n\n```\ngraph LR\n    Config[Configuration] --> Providers[Provider Detection]\n    Providers --> GitHub[GitHub Integration]\n    Providers --> GitLab[GitLab Integration]\n    Providers --> Bitbucket[Bitbucket Integration]\n    Providers --> SSO[Enterprise SSO]\n```"
          },
          "Security Features": {
            "JWT Token Management": "```\ndef sign_token(payload: dict[str, object], jwt_secret: str, algorithm='HS256') -> str:\n    \"\"\"Signs a JWT token with configurable algorithm support.\"\"\"\n```",
            "Webhook Signature Verification": "```\ndef verify_signature(payload: bytes, signature: str):\n    \"\"\"Verifies GitHub webhook signatures using HMAC-SHA256.\"\"\"\n```",
            "Security Considerations": [
              "JWT tokens use RS256 algorithm for GitHub App authentication",
              "Webhook signatures verified using HMAC-SHA256",
              "Clock skew tolerance (60 seconds) for JWT timestamps",
              "Secure comparison using `hmac.compare_digest()`"
            ]
          },
          "Configuration Validation": "```\nflowchart TD\n    Start([Configuration Init]) --> CheckCls{Config Class Set?}\n    CheckCls -->|No| Error1[Raise ValueError]\n    CheckCls -->|Yes| CheckPosthog{PostHog Key Set?}\n    CheckPosthog -->|No| Error2[Raise ValueError]\n    CheckPosthog -->|Yes| CheckGitHub{GitHub Client ID?}\n    CheckGitHub -->|No| Error3[Raise ValueError]\n    CheckGitHub -->|Yes| ValidateApp[Validate GitHub App]\n    ValidateApp --> Success[Configuration Valid]\n    \n    Error1 --> End([End])\n    Error2 --> End\n    Error3 --> End\n    Success --> End\n```",
          "Frontend Configuration": "The module provides a structured configuration object for frontend consumption:\n\n```\n{\n  \"APP_MODE\": \"saas\",\n  \"APP_SLUG\": \"openhands-app\",\n  \"GITHUB_CLIENT_ID\": \"client_id\",\n  \"POSTHOG_CLIENT_KEY\": \"analytics_key\",\n  \"FEATURE_FLAGS\": {\n    \"ENABLE_BILLING\": true,\n    \"HIDE_LLM_SETTINGS\": false,\n    \"ENABLE_JIRA\": true,\n    \"ENABLE_JIRA_DC\": false,\n    \"ENABLE_LINEAR\": true\n  },\n  \"PROVIDERS_CONFIGURED\": [\"github\", \"gitlab\", \"enterprise_sso\"],\n  \"MAINTENANCE\": {\n    \"startTime\": \"2025-07-29T14:18:01.219616-04:00\"\n  },\n  \"AUTH_URL\": \"https://auth.example.com\"\n}\n```",
          "Error Handling": {
            "Configuration Errors": [
              "Missing required environment variables",
              "Invalid GitHub App credentials",
              "Failed GitHub API requests",
              "Missing app slug in API response"
            ],
            "Runtime Errors": [
              "JWT token generation failures",
              "Webhook signature verification failures",
              "Network connectivity issues with GitHub API"
            ]
          },
          "Best Practices": {
            "Environment Management": [
              "Use environment-specific configuration files",
              "Validate all required variables at startup",
              "Implement graceful degradation for optional features",
              "Use secure defaults for sensitive settings"
            ],
            "Security": [
              "Rotate GitHub App private keys regularly",
              "Validate webhook signatures for all incoming requests",
              "Use appropriate JWT expiration times",
              "Implement proper error handling without exposing secrets"
            ],
            "Monitoring": [
              "Log configuration validation results",
              "Monitor GitHub API rate limits",
              "Track feature flag usage",
              "Alert on configuration validation failures"
            ]
          },
          "Related Modules": [
            "**[authentication_system](authentication_system.md)**: User authentication configuration",
            "**[storage_system](storage_system.md)**: Storage backend configuration",
            "**[git_integrations](git_integrations.md)**: Git provider integration settings",
            "**[server_and_api](server_and_api.md)**: Server infrastructure configuration",
            "**[enterprise_integrations](enterprise_integrations.md)**: Enterprise platform integrations"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "service_foundation",
      "description": null,
      "content": {
        "Service Foundation Module": {
          "Overview": "The Service Foundation module (`openhands.integrations.service_types`) provides the foundational abstractions and protocols for Git service integrations within the OpenHands system. This module defines the core interfaces, data models, and base implementations that enable seamless integration with various Git providers (GitHub, GitLab, Bitbucket) while maintaining a consistent API across different provider implementations.",
          "Core Purpose": [
            "**Unified Git Provider Interface**: Establishes a common protocol for interacting with different Git service providers",
            "**Microagent Integration**: Provides standardized mechanisms for discovering and managing microagents across repositories",
            "**Task Management**: Defines structures for automated task suggestions and repository operations",
            "**Authentication Abstraction**: Standardizes authentication patterns across different Git providers"
          ],
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Service Foundation Layer\"\n        GitService[GitService Protocol]\n        BaseGitService[BaseGitService ABC]\n        InstallationsService[InstallationsService Protocol]\n    end\n    \n    subgraph \"Data Models\"\n        User[User Model]\n        Repository[Repository Model]\n        Branch[Branch Model]\n        Comment[Comment Model]\n        SuggestedTask[SuggestedTask Model]\n        CreateMicroagent[CreateMicroagent Model]\n    end\n    \n    subgraph \"Provider Implementations\"\n        GitHub[GitHub Service]\n        GitLab[GitLab Service]\n        Bitbucket[Bitbucket Service]\n    end\n    \n    subgraph \"Integration Points\"\n        MicroagentSystem[Microagent System]\n        ServerAPI[Server & API]\n        EnterpriseIntegrations[Enterprise Integrations]\n    end\n    \n    GitService --> BaseGitService\n    BaseGitService --> GitHub\n    BaseGitService --> GitLab\n    BaseGitService --> Bitbucket\n    \n    GitService --> User\n    GitService --> Repository\n    GitService --> Branch\n    GitService --> Comment\n    GitService --> SuggestedTask\n    \n    GitHub --> MicroagentSystem\n    GitLab --> MicroagentSystem\n    Bitbucket --> MicroagentSystem\n    \n    GitService --> ServerAPI\n    GitService --> EnterpriseIntegrations\n    \n    InstallationsService --> GitHub\n    InstallationsService --> GitLab\n    InstallationsService --> Bitbucket\n```",
          "Core Components": {
            "GitService Protocol": "The primary interface defining the contract for all Git service implementations:\n\n```\nclassDiagram\n    class GitService {\n        <<protocol>>\n        +__init__(user_id, token, external_auth_id, ...)\n        +get_latest_token() SecretStr\n        +get_user() User\n        +search_repositories(...) List[Repository]\n        +get_all_repositories(...) List[Repository]\n        +get_paginated_repos(...) List[Repository]\n        +get_suggested_tasks() List[SuggestedTask]\n        +get_repository_details_from_repo_name(...) Repository\n        +get_branches(...) List[Branch]\n        +get_paginated_branches(...) PaginatedBranchesResponse\n        +search_branches(...) List[Branch]\n        +get_microagents(...) List[MicroagentResponse]\n        +get_microagent_content(...) MicroagentContentResponse\n        +get_pr_details(...) dict\n        +is_pr_open(...) bool\n    }\n```",
            "BaseGitService Abstract Base Class": "Provides common functionality and abstract methods for concrete implementations:\n\n```\nclassDiagram\n    class BaseGitService {\n        <<abstract>>\n        +provider: str\n        +_make_request(url, params, method)* tuple\n        +_get_cursorrules_url(repository)* str\n        +_get_microagents_directory_url(...)* str\n        +_get_microagents_directory_params(...)* dict\n        +_is_valid_microagent_file(item)* bool\n        +_get_file_name_from_item(item)* str\n        +_get_file_path_from_item(...)* str\n        +_determine_microagents_path(repository) str\n        +_create_microagent_response(...) MicroagentResponse\n        +_parse_microagent_content(...) MicroagentContentResponse\n        +_fetch_cursorrules_content(...) Any\n        +_check_cursorrules_file(...) MicroagentResponse\n        +_process_microagents_directory(...) List[MicroagentResponse]\n        +get_microagents(repository) List[MicroagentResponse]\n        +_truncate_comment(...) str\n    }\n```"
          },
          "Data Models": {
            "Core Entity Models": "```\nerDiagram\n    User {\n        string id\n        string login\n        string avatar_url\n        string company\n        string name\n        string email\n    }\n    \n    Repository {\n        string id\n        string full_name\n        ProviderType git_provider\n        bool is_public\n        int stargazers_count\n        string link_header\n        string pushed_at\n        OwnerType owner_type\n        string main_branch\n    }\n    \n    Branch {\n        string name\n        string commit_sha\n        bool protected\n        string last_push_date\n    }\n    \n    Comment {\n        string id\n        string body\n        string author\n        datetime created_at\n        datetime updated_at\n        bool system\n    }\n    \n    SuggestedTask {\n        ProviderType git_provider\n        TaskType task_type\n        string repo\n        int issue_number\n        string title\n    }\n    \n    Repository ||--o{ Branch : contains\n    Repository ||--o{ Comment : has\n    User ||--o{ Repository : owns\n```",
            "Enumeration Types": "```\nclassDiagram\n    class ProviderType {\n        <<enumeration>>\n        GITHUB\n        GITLAB\n        BITBUCKET\n        ENTERPRISE_SSO\n    }\n    \n    class TaskType {\n        <<enumeration>>\n        MERGE_CONFLICTS\n        FAILING_CHECKS\n        UNRESOLVED_COMMENTS\n        OPEN_ISSUE\n        OPEN_PR\n        CREATE_MICROAGENT\n    }\n    \n    class OwnerType {\n        <<enumeration>>\n        USER\n        ORGANIZATION\n    }\n    \n    class RequestMethod {\n        <<enumeration>>\n        POST\n        GET\n    }\n```"
          },
          "Microagent Integration": "The service foundation provides comprehensive microagent discovery and management capabilities:\n\n```\nsequenceDiagram\n    participant Client\n    participant GitService\n    participant BaseGitService\n    participant MicroagentSystem\n    participant GitProvider\n    \n    Client->>GitService: get_microagents(repository)\n    GitService->>BaseGitService: get_microagents(repository)\n    \n    BaseGitService->>BaseGitService: _determine_microagents_path()\n    BaseGitService->>BaseGitService: _check_cursorrules_file()\n    BaseGitService->>GitProvider: fetch .cursorrules\n    GitProvider-->>BaseGitService: cursorrules content\n    \n    BaseGitService->>BaseGitService: _process_microagents_directory()\n    BaseGitService->>GitProvider: fetch microagents directory\n    GitProvider-->>BaseGitService: directory contents\n    \n    BaseGitService->>BaseGitService: _create_microagent_response()\n    BaseGitService-->>GitService: List[MicroagentResponse]\n    GitService-->>Client: microagents list\n    \n    Client->>GitService: get_microagent_content(repo, path)\n    GitService->>GitProvider: fetch file content\n    GitProvider-->>GitService: raw content\n    GitService->>MicroagentSystem: parse content\n    MicroagentSystem-->>GitService: parsed microagent\n    GitService-->>Client: MicroagentContentResponse\n```",
          "Task Suggestion System": "The module includes a sophisticated task suggestion system that analyzes repositories and suggests actionable tasks:\n\n```\nflowchart TD\n    A[Repository Analysis] --> B{Task Type Detection}\n    \n    B --> C[Merge Conflicts]\n    B --> D[Failing Checks]\n    B --> E[Unresolved Comments]\n    B --> F[Open Issues]\n    B --> G[Open PRs]\n    B --> H[Create Microagent]\n    \n    C --> I[Generate Prompt]\n    D --> I\n    E --> I\n    F --> I\n    G --> I\n    H --> I\n    \n    I --> J[Provider-Specific Terms]\n    J --> K[Template Rendering]\n    K --> L[Task Suggestion]\n```",
          "Error Handling": "The module defines a comprehensive error hierarchy for robust error handling:\n\n```\nclassDiagram\n    class ValueError {\n        <<built-in>>\n    }\n    \n    class AuthenticationError {\n        +message: str\n    }\n    \n    class UnknownException {\n        +message: str\n    }\n    \n    class RateLimitError {\n        +message: str\n    }\n    \n    class ResourceNotFoundError {\n        +message: str\n    }\n    \n    class MicroagentParseError {\n        +message: str\n    }\n    \n    ValueError <|-- AuthenticationError\n    ValueError <|-- UnknownException\n    ValueError <|-- RateLimitError\n    ValueError <|-- ResourceNotFoundError\n    ValueError <|-- MicroagentParseError\n```",
          "Integration Dependencies": "The service foundation module integrates with several other system components:\n\n```\ngraph LR\n    ServiceFoundation[Service Foundation] --> MicroagentSystem[microagent_system.md]\n    ServiceFoundation --> ServerAPI[server_and_api.md]\n    ServiceFoundation --> EnterpriseIntegrations[enterprise_integrations.md]\n    ServiceFoundation --> CoreConfig[core_configuration.md]\n    \n    ProviderImplementations[provider_implementations.md] --> ServiceFoundation\n    \n    subgraph \"External Dependencies\"\n        Jinja2[Jinja2 Templates]\n        Pydantic[Pydantic Models]\n        AsyncHTTP[Async HTTP Clients]\n    end\n    \n    ServiceFoundation --> Jinja2\n    ServiceFoundation --> Pydantic\n    ServiceFoundation --> AsyncHTTP\n```",
          "Provider Implementation Pattern": "The module establishes a clear pattern for implementing provider-specific services:\n\n```\nsequenceDiagram\n    participant ConcreteService\n    participant BaseGitService\n    participant GitProvider\n    \n    Note over ConcreteService: Implements GitService Protocol\n    ConcreteService->>BaseGitService: Inherits common functionality\n    \n    ConcreteService->>ConcreteService: Implement abstract methods\n    Note over ConcreteService: _make_request()<br/>_get_cursorrules_url()<br/>_get_microagents_directory_url()<br/>etc.\n    \n    ConcreteService->>GitProvider: Provider-specific API calls\n    GitProvider-->>ConcreteService: Provider response\n    \n    ConcreteService->>BaseGitService: Use common processing\n    BaseGitService-->>ConcreteService: Standardized response\n```",
          "Configuration and Authentication": "The service foundation supports multiple authentication patterns:\n\n['**Direct Token Authentication**: Using provider-specific tokens', '**External Authentication**: Integration with external auth systems', '**Enterprise SSO**: Support for enterprise single sign-on', '**Token Management**: Automatic token refresh and validation']",
          "Key Features": {
            "Repository Management": [
              "Repository discovery and search",
              "Branch management and pagination",
              "Repository metadata extraction",
              "Access control validation"
            ],
            "Microagent Discovery": [
              "Automatic microagent detection in repositories",
              "Support for `.cursorrules` files",
              "Microagent content parsing and validation",
              "Template-based microagent creation"
            ],
            "Task Automation": [
              "Intelligent task suggestion based on repository state",
              "Provider-specific prompt generation",
              "Template-driven task descriptions",
              "Multi-provider task normalization"
            ],
            "Performance Optimization": [
              "Paginated API responses",
              "Efficient directory scanning",
              "Content truncation for large responses",
              "Caching-friendly data structures"
            ]
          },
          "Usage Patterns": "The service foundation enables consistent usage patterns across all Git providers:\n\n```\n# Initialize service (provider-specific implementation)\nservice = GitHubService(user_id=\"user123\", token=SecretStr(\"token\"))\n\n# Common operations work across all providers\nuser = await service.get_user()\nrepositories = await service.get_all_repositories(sort=\"updated\", app_mode=AppMode.OSS)\nmicroagents = await service.get_microagents(\"owner/repo\")\ntasks = await service.get_suggested_tasks()\n```",
          "Related Documentation": [
            "[Provider Implementations](provider_implementations.md) - Concrete implementations for GitHub, GitLab, and Bitbucket",
            "[Microagent System](microagent_system.md) - Microagent parsing and execution system",
            "[Server and API](server_and_api.md) - Web API integration points",
            "[Enterprise Integrations](enterprise_integrations.md) - Enterprise-specific Git service features",
            "[Core Configuration](core_configuration.md) - Configuration management for Git services"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "session_management",
      "description": null,
      "content": {
        "Session Management Module": {
          "Overview": "The session management module consists of two primary components that work together to provide a complete session management solution:\n\n['**WebSession**: Web server-bound session wrapper that manages client connections and communication', '**AgentSession**: Core agent session that coordinates runtime environments and LLM interactions']\n\nThis module serves as the bridge between the web interface and the underlying agent execution system, handling real-time communication, state management, and resource coordination.",
          "Architecture": "```\ngraph TB\n    subgraph \"Client Layer\"\n        WC[Web Client]\n        SIO[Socket.IO Connection]\n    end\n    \n    subgraph \"Session Management\"\n        WS[WebSession]\n        AS[AgentSession]\n        ES[EventStream]\n    end\n    \n    subgraph \"Core Systems\"\n        AC[AgentController]\n        RT[Runtime]\n        AG[Agent]\n        LLM[LLM Registry]\n    end\n    \n    subgraph \"Storage & State\"\n        FS[FileStore]\n        MEM[Memory]\n        STATE[State Management]\n    end\n    \n    WC --> SIO\n    SIO --> WS\n    WS --> AS\n    AS --> ES\n    AS --> AC\n    AS --> RT\n    AS --> AG\n    WS --> LLM\n    AS --> FS\n    AS --> MEM\n    AC --> STATE\n    \n    WS -.->|Status Updates| SIO\n    ES -.->|Events| WS\n```",
          "Core Components": {
            "WebSession": "The `WebSession` class manages individual web client connections and serves as the primary interface between the frontend and backend systems.\n\n**Key Responsibilities:**\n\n['WebSocket connection management via Socket.IO', 'Real-time event streaming to clients', 'Session lifecycle coordination', 'Error handling and status reporting', 'Agent initialization and configuration']\n\n**Key Attributes:**\n\n['`sid`: Stable conversation identifier', '`sio`: Socket.IO server instance', '`agent_session`: Associated AgentSession instance', '`config`: OpenHands configuration', '`llm_registry`: LLM access registry', '`file_store`: File storage interface']",
            "AgentSession": "The `AgentSession` class coordinates the core agent execution environment, managing runtime connections, agent controllers, and memory systems.\n\n**Key Responsibilities:**\n\n['Runtime environment initialization', 'Agent controller creation and management', 'Memory system setup', 'Event stream coordination', 'State persistence and restoration', 'Resource cleanup']\n\n**Key Attributes:**\n\n['`controller`: AgentController instance', '`runtime`: Runtime environment', '`event_stream`: Event communication stream', '`memory`: Agent memory system', '`llm_registry`: LLM registry access']"
          },
          "Component Interactions": "```\nsequenceDiagram\n    participant Client\n    participant WebSession\n    participant AgentSession\n    participant Runtime\n    participant Agent\n    participant EventStream\n    \n    Client->>WebSession: Connect via Socket.IO\n    WebSession->>AgentSession: Create session\n    AgentSession->>Runtime: Initialize runtime\n    Runtime-->>AgentSession: Runtime ready\n    AgentSession->>Agent: Create agent\n    Agent-->>AgentSession: Agent ready\n    AgentSession->>EventStream: Setup event stream\n    EventStream-->>WebSession: Subscribe to events\n    WebSession-->>Client: Session ready\n    \n    Client->>WebSession: Send message\n    WebSession->>EventStream: Add user event\n    EventStream->>Agent: Process event\n    Agent->>Runtime: Execute action\n    Runtime-->>Agent: Return observation\n    Agent-->>EventStream: Emit response\n    EventStream-->>WebSession: Forward event\n    WebSession-->>Client: Send response\n```",
          "Session Lifecycle": "```\nstateDiagram-v2\n    [*] --> Created: WebSession instantiated\n    Created --> Initializing: initialize_agent() called\n    Initializing --> RuntimeSetup: Create runtime\n    RuntimeSetup --> AgentSetup: Runtime connected\n    AgentSetup --> MemorySetup: Agent created\n    MemorySetup --> ControllerSetup: Memory initialized\n    ControllerSetup --> Ready: Controller created\n    Ready --> Running: Process events\n    Running --> Running: Handle user interactions\n    Running --> Closing: close() called\n    Closing --> Closed: Resources cleaned up\n    Closed --> [*]\n    \n    Initializing --> Error: Initialization failed\n    RuntimeSetup --> Error: Runtime connection failed\n    AgentSetup --> Error: Agent creation failed\n    Error --> Closing: Cleanup on error\n```",
          "Data Flow": "```\nflowchart LR\n    subgraph \"Input Flow\"\n        UI[User Interface]\n        WS1[WebSession]\n        ES1[EventStream]\n    end\n    \n    subgraph \"Processing\"\n        CTRL[AgentController]\n        AGT[Agent]\n        RT[Runtime]\n    end\n    \n    subgraph \"Output Flow\"\n        ES2[EventStream]\n        WS2[WebSession]\n        CLIENT[Client]\n    end\n    \n    UI -->|User Actions| WS1\n    WS1 -->|Events| ES1\n    ES1 -->|User Events| CTRL\n    CTRL -->|Actions| AGT\n    AGT -->|Commands| RT\n    RT -->|Observations| AGT\n    AGT -->|Responses| ES2\n    ES2 -->|Agent Events| WS2\n    WS2 -->|Real-time Updates| CLIENT\n```",
          "Key Features": {
            "Real-time Communication": [
              "WebSocket-based bidirectional communication",
              "Asynchronous event streaming",
              "Status update broadcasting",
              "Error propagation to clients"
            ],
            "Session State Management": [
              "Persistent session storage",
              "State restoration across reconnections",
              "Event history maintenance",
              "Configuration persistence"
            ],
            "Resource Management": [
              "Runtime environment lifecycle",
              "Memory system coordination",
              "File storage integration",
              "Cleanup on session termination"
            ],
            "Error Handling": [
              "Graceful error recovery",
              "Client error notification",
              "Resource cleanup on failures",
              "Detailed error logging"
            ]
          },
          "Integration Points": {
            "Dependencies on Other Modules": "The session management module integrates with several other system modules:\n\n['**[Core Agent System](core_agent_system.md)**: Uses Agent, AgentController, and state management components', '**[Events and Actions](events_and_actions.md)**: Leverages EventStream, Event, Action, and Observation systems', '**[Runtime System](runtime_system.md)**: Manages Runtime instances and their lifecycle', '**[LLM Integration](llm_integration.md)**: Accesses LLM services through LLMRegistry', '**[Storage System](storage_system.md)**: Uses FileStore for persistent storage', '**[Server and API](server_and_api.md)**: Integrates with ConversationManager and server infrastructure']",
            "Configuration Integration": "```\ngraph LR\n    subgraph \"Configuration Sources\"\n        UC[User Config]\n        SC[Server Config]\n        AC[Agent Config]\n        LC[LLM Config]\n    end\n    \n    subgraph \"Session Management\"\n        WS[WebSession]\n        AS[AgentSession]\n    end\n    \n    UC --> WS\n    SC --> WS\n    AC --> AS\n    LC --> AS\n    \n    WS -->|Merged Config| AS\n```"
          },
          "Usage Patterns": {
            "Session Creation": "```\n# WebSession initialization\nsession = WebSession(\n    sid=session_id,\n    config=openhands_config,\n    llm_registry=llm_registry,\n    conversation_stats=stats,\n    file_store=file_store,\n    sio=socketio_server,\n    user_id=user_id\n)\n\n# Agent initialization\nawait session.initialize_agent(\n    settings=user_settings,\n    initial_message=message,\n    replay_json=replay_data\n)\n```",
            "Event Handling": "```\n# Event dispatch from client\nawait session.dispatch(event_data)\n\n# Event streaming to client\nsession.on_event(agent_event)\n```",
            "Session Cleanup": "```\n# Graceful session termination\nawait session.close()\n```"
          },
          "Performance Considerations": {
            "Asynchronous Operations": [
              "Non-blocking event processing",
              "Concurrent session handling",
              "Efficient WebSocket management",
              "Background task coordination"
            ],
            "Resource Optimization": [
              "Lazy resource initialization",
              "Efficient memory usage",
              "Connection pooling",
              "Cleanup automation"
            ],
            "Scalability Features": [
              "Session isolation",
              "Resource sharing where appropriate",
              "Configurable timeouts",
              "Memory management"
            ]
          },
          "Security Considerations": {
            "Session Security": [
              "Session ID validation",
              "User authentication integration",
              "Resource access control",
              "Secure communication channels"
            ],
            "Data Protection": [
              "Sensitive data handling",
              "Secure storage integration",
              "Error message sanitization",
              "Access logging"
            ]
          },
          "Monitoring and Observability": {
            "Logging Integration": [
              "Structured logging with session context",
              "Performance metrics collection",
              "Error tracking and reporting",
              "Debug information capture"
            ],
            "Health Monitoring": [
              "Session lifecycle tracking",
              "Resource usage monitoring",
              "Connection status reporting",
              "Performance metrics"
            ]
          },
          "Error Handling Strategies": {
            "Connection Management": [
              "WebSocket reconnection handling",
              "Session recovery mechanisms",
              "Graceful degradation",
              "Client notification systems"
            ],
            "Resource Recovery": [
              "Runtime reconnection",
              "State restoration",
              "Memory recovery",
              "File system consistency"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "kubernetes_runtime",
      "description": null,
      "content": {
        "Kubernetes Runtime Module": {
          "Overview": "The Kubernetes Runtime module provides a cloud-native runtime implementation for OpenHands that deploys and manages agent execution environments as Kubernetes pods. This module enables scalable, containerized execution of OpenHands agents in Kubernetes clusters, supporting both local development (Kind) and production deployments.",
          "Architecture": "The KubernetesRuntime extends the ActionExecutionClient to provide Kubernetes-native runtime capabilities, managing the complete lifecycle of containerized agent environments including pod creation, service exposure, ingress configuration, and resource cleanup.\n\n```\ngraph TB\n    subgraph \"Kubernetes Runtime Architecture\"\n        KR[KubernetesRuntime]\n        AEC[ActionExecutionClient]\n        K8sAPI[Kubernetes API Client]\n        \n        subgraph \"Kubernetes Resources\"\n            POD[Runtime Pod]\n            SVC[Service]\n            VSVC[VSCode Service]\n            ING[Ingress]\n            PVC[Persistent Volume Claim]\n        end\n        \n        subgraph \"Configuration\"\n            KC[KubernetesConfig]\n            OHC[OpenHandsConfig]\n        end\n    end\n    \n    KR --> AEC\n    KR --> K8sAPI\n    KR --> KC\n    KR --> OHC\n    \n    K8sAPI --> POD\n    K8sAPI --> SVC\n    K8sAPI --> VSVC\n    K8sAPI --> ING\n    K8sAPI --> PVC\n    \n    POD --> |Mounts| PVC\n    SVC --> |Exposes| POD\n    VSVC --> |VSCode Access| POD\n    ING --> |External Access| VSVC\n```",
          "Core Components": {
            "KubernetesRuntime Class": "The main runtime implementation that orchestrates Kubernetes resources for agent execution environments.\n\n**Key Responsibilities:**\n\n['Pod lifecycle management (creation, monitoring, cleanup)', 'Service and ingress configuration for external access', 'Persistent volume management for workspace data', 'VSCode server integration for development workflows', 'Resource cleanup and garbage collection']\n\n**Configuration Dependencies:**\n\n['Requires `[kubernetes]` section in OpenHands configuration', 'Integrates with [core_configuration](core_configuration.md) for cluster settings', 'Uses [runtime_system](runtime_system.md) base classes and interfaces']"
          },
          "Resource Management": {
            "Kubernetes Resource Lifecycle": "```\nsequenceDiagram\n    participant Client\n    participant KR as KubernetesRuntime\n    participant K8s as Kubernetes API\n    participant Pod as Runtime Pod\n    \n    Client->>KR: connect()\n    KR->>K8s: Check existing pod\n    alt Pod exists and attach_to_existing=true\n        K8s-->>KR: Pod found\n        KR->>Pod: Attach to existing\n    else Create new resources\n        KR->>K8s: Create PVC\n        KR->>K8s: Create Pod\n        KR->>K8s: Create Services\n        KR->>K8s: Create Ingress\n        K8s-->>Pod: Pod starting\n        KR->>Pod: Wait for ready\n    end\n    Pod-->>KR: Ready signal\n    KR-->>Client: Connected\n    \n    Note over Client,Pod: Agent execution phase\n    \n    Client->>KR: close()\n    KR->>K8s: Cleanup resources\n    K8s->>Pod: Delete pod\n    K8s->>K8s: Delete services/ingress\n```",
            "Resource Naming Convention": "The module uses consistent naming patterns for Kubernetes resources:\n\n['**Pod**: `openhands-runtime-{session_id}`', '**Service**: `{pod_name}-svc`', '**VSCode Service**: `{pod_name}-svc-code`', '**Ingress**: `{pod_name}-ingress-code`', '**PVC**: `{pod_name}-pvc`']"
          },
          "Network Configuration": {
            "Port Management": "```\ngraph LR\n    subgraph \"External Access\"\n        ING[Ingress]\n        DNS[\"DNS: sid.domain\"]\n    end\n    \n    subgraph \"Kubernetes Services\"\n        SVC[\"Runtime Service :8080\"]\n        VSVC[\"VSCode Service :8081\"]\n    end\n    \n    subgraph \"Pod Ports\"\n        HTTP[\"HTTP :8080\"]\n        VSCODE[\"VSCode :8081\"]\n        APP1[\"App Port :30082\"]\n        APP2[\"App Port :30083\"]\n    end\n    \n    DNS --> ING\n    ING --> VSVC\n    SVC --> HTTP\n    VSVC --> VSCODE\n    HTTP --> |Action Execution| APP1\n    HTTP --> |Application Hosting| APP2\n```",
            "Service Architecture": [
              "**Runtime Service**: ClusterIP service exposing the action execution server",
              "**VSCode Service**: ClusterIP service for development environment access",
              "**Ingress**: External access to VSCode with TLS support and custom domains",
              "**Internal URLs**: Service discovery via Kubernetes DNS"
            ]
          },
          "Data Persistence": {
            "Workspace Management": "```\ngraph TB\n    subgraph \"Storage Architecture\"\n        PVC[Persistent Volume Claim]\n        SC[Storage Class]\n        PV[Persistent Volume]\n        \n        subgraph \"Pod Mount\"\n            WS[Workspace Mount]\n            CODE[Code Directory]\n        end\n    end\n    \n    SC --> PV\n    PVC --> PV\n    PV --> WS\n    WS --> CODE\n    \n    note1[Storage Size: Configurable]\n    note2[Access Mode: ReadWriteOnce]\n    note3[Mount Path: /openhands/code/]\n    \n    PVC -.-> note1\n    PVC -.-> note2\n    WS -.-> note3\n```"
          },
          "Integration Points": {
            "Runtime System Integration": "The KubernetesRuntime integrates with several system components:\n\n['**[runtime_system](runtime_system.md)**: Extends base Runtime and ActionExecutionClient classes', '**[core_configuration](core_configuration.md)**: Uses KubernetesConfig for cluster-specific settings', '**[events_and_actions](events_and_actions.md)**: Processes events through EventStream integration', '**[llm_integration](llm_integration.md)**: Provides LLM access within containerized environments']",
            "Configuration Dependencies": "```\ngraph LR\n    subgraph \"Configuration Flow\"\n        OHC[OpenHandsConfig]\n        KC[KubernetesConfig]\n        SC[SandboxConfig]\n        \n        subgraph \"Runtime Settings\"\n            NS[Namespace]\n            IMG[Container Image]\n            RES[Resource Limits]\n            NET[Network Config]\n        end\n    end\n    \n    OHC --> KC\n    OHC --> SC\n    KC --> NS\n    KC --> NET\n    SC --> IMG\n    KC --> RES\n```"
          },
          "Operational Features": {
            "Health Monitoring": "The runtime implements comprehensive health checking:\n\n['**Pod Readiness**: Kubernetes readiness probes on `/alive` endpoint', '**Connection Retry**: Tenacity-based retry logic with exponential backoff', '**Status Callbacks**: Real-time status updates to client applications', '**Graceful Shutdown**: Proper resource cleanup on termination']",
            "Development Support": [
              "**VSCode Integration**: Full IDE access with token-based authentication",
              "**Port Forwarding**: Automatic exposure of application ports",
              "**Debug Mode**: Enhanced logging and debugging capabilities",
              "**Attach Mode**: Connect to existing pods for development workflows"
            ],
            "Security Features": "```\ngraph TB\n    subgraph \"Security Architecture\"\n        RBAC[RBAC Permissions]\n        SC[Security Context]\n        NET[Network Policies]\n        TLS[TLS Certificates]\n        \n        subgraph \"Pod Security\"\n            PRIV[Privileged Mode]\n            USER[User Context]\n            CAPS[Capabilities]\n        end\n        \n        subgraph \"Network Security\"\n            ING[Ingress TLS]\n            SVC[Service Mesh]\n            DNS[DNS Security]\n        end\n    end\n    \n    RBAC --> SC\n    SC --> PRIV\n    SC --> USER\n    NET --> SVC\n    TLS --> ING\n```"
          },
          "Error Handling": {
            "Exception Management": "The module provides robust error handling for common failure scenarios:\n\n['**AgentRuntimeDisconnectedError**: Pod connection failures or network issues', '**AgentRuntimeNotFoundError**: Resource creation or initialization failures', '**Kubernetes API Exceptions**: Cluster connectivity and permission issues', '**Timeout Handling**: Configurable timeouts for pod startup and readiness']",
            "Recovery Mechanisms": [
              "**Automatic Retry**: Built-in retry logic for transient failures",
              "**Resource Cleanup**: Automatic cleanup on failure to prevent resource leaks",
              "**Graceful Degradation**: Fallback behaviors for non-critical failures",
              "**Status Reporting**: Detailed error reporting through status callbacks"
            ]
          },
          "Performance Considerations": {
            "Resource Optimization": [
              "**Resource Requests/Limits**: Configurable CPU and memory constraints",
              "**Node Selection**: Support for node selectors and tolerations",
              "**Storage Classes**: Optimized storage backend selection",
              "**Image Pull Optimization**: Support for image pull secrets and caching"
            ],
            "Scalability Features": [
              "**Multi-tenant Support**: Session-based resource isolation",
              "**Cluster Integration**: Native Kubernetes scaling and scheduling",
              "**Resource Pooling**: Efficient resource utilization across sessions",
              "**Cleanup Automation**: Automatic resource garbage collection"
            ]
          },
          "Usage Patterns": {
            "Basic Runtime Creation": "```\nruntime = KubernetesRuntime(\n    config=config,\n    event_stream=event_stream,\n    llm_registry=llm_registry,\n    sid='session-123',\n    plugins=plugins,\n    env_vars=env_vars\n)\n\nawait runtime.connect()\n# Runtime is now available for agent execution\n```",
            "Development Workflow": "```\n# Attach to existing pod for development\nruntime = KubernetesRuntime(\n    config=config,\n    event_stream=event_stream,\n    llm_registry=llm_registry,\n    sid='dev-session',\n    attach_to_existing=True\n)\n\n# Access VSCode URL for development\nvscode_url = runtime.vscode_url\n```"
          },
          "Monitoring and Observability": {
            "Logging Integration": "The runtime provides comprehensive logging through the OpenHands logging system:\n\n['**Structured Logging**: JSON-formatted logs with contextual information', '**Debug Mode**: Enhanced logging for troubleshooting', '**Performance Metrics**: Resource usage and timing information', '**Audit Trail**: Complete lifecycle event logging']",
            "Health Endpoints": [
              "**Readiness Probe**: `/alive` endpoint for Kubernetes health checks",
              "**Status Callbacks**: Real-time status updates for monitoring systems",
              "**Resource Metrics**: Pod and container resource utilization"
            ]
          },
          "Best Practices": {
            "Configuration Management": [
              "**Resource Limits**: Always configure appropriate CPU and memory limits",
              "**Storage Planning**: Size PVCs appropriately for workspace requirements",
              "**Network Security**: Use TLS certificates for production ingress",
              "**Node Placement**: Configure node selectors for workload isolation"
            ],
            "Operational Guidelines": [
              "**Cleanup Strategy**: Configure appropriate cleanup policies for resource management",
              "**Monitoring Setup**: Implement comprehensive monitoring for pod health",
              "**Backup Procedures**: Regular backup of persistent volume data",
              "**Security Hardening**: Follow Kubernetes security best practices"
            ]
          },
          "Related Documentation": [
            "**[runtime_system](runtime_system.md)**: Base runtime architecture and interfaces",
            "**[core_configuration](core_configuration.md)**: Configuration management and KubernetesConfig",
            "**[local_runtime](local_runtime.md)**: Local development runtime comparison",
            "**[cli_runtime](cli_runtime.md)**: CLI-based runtime alternative",
            "**[events_and_actions](events_and_actions.md)**: Event processing and action execution"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "core_llm_implementation",
      "description": null,
      "content": {
        "Core LLM Implementation": {
          "Overview": "This module implements three primary LLM classes that form the backbone of OpenHands' language model interactions:\n\n['**LLM**: Synchronous language model interface with comprehensive feature support', '**AsyncLLM**: Asynchronous variant for non-blocking operations', '**StreamingLLM**: Real-time streaming interface for continuous response generation']\n\nThe implementation abstracts away provider-specific details while maintaining full access to advanced features like function calling, vision capabilities, prompt caching, and cost tracking.",
          "Architecture": "```\ngraph TB\n    subgraph \"Core LLM Implementation\"\n        LLM[LLM<br/>Synchronous Interface]\n        AsyncLLM[AsyncLLM<br/>Asynchronous Interface]\n        StreamingLLM[StreamingLLM<br/>Streaming Interface]\n    end\n    \n    subgraph \"Mixins & Utilities\"\n        RetryMixin[RetryMixin<br/>Retry Logic]\n        DebugMixin[DebugMixin<br/>Debug & Logging]\n        Metrics[Metrics<br/>Usage Tracking]\n        ModelFeatures[Model Features<br/>Capability Detection]\n    end\n    \n    subgraph \"External Dependencies\"\n        LiteLLM[LiteLLM<br/>Provider Abstraction]\n        Providers[LLM Providers<br/>OpenAI, Anthropic, etc.]\n    end\n    \n    subgraph \"Configuration\"\n        LLMConfig[LLMConfig<br/>Model Configuration]\n    end\n    \n    LLM --> RetryMixin\n    LLM --> DebugMixin\n    LLM --> Metrics\n    LLM --> ModelFeatures\n    \n    AsyncLLM --> LLM\n    StreamingLLM --> AsyncLLM\n    \n    LLM --> LiteLLM\n    LiteLLM --> Providers\n    \n    LLM --> LLMConfig\n    AsyncLLM --> LLMConfig\n    StreamingLLM --> LLMConfig\n```",
          "Component Relationships": "```\nclassDiagram\n    class LLM {\n        +config: LLMConfig\n        +metrics: Metrics\n        +model_info: ModelInfo\n        +completion()\n        +get_token_count()\n        +vision_is_active()\n        +is_function_calling_active()\n        +is_caching_prompt_active()\n        +format_messages_for_llm()\n    }\n    \n    class AsyncLLM {\n        +async_completion()\n        -_call_acompletion()\n    }\n    \n    class StreamingLLM {\n        +async_streaming_completion()\n    }\n    \n    class RetryMixin {\n        +retry_decorator()\n    }\n    \n    class DebugMixin {\n        +log_prompt()\n        +log_response()\n    }\n    \n    LLM --|> RetryMixin\n    LLM --|> DebugMixin\n    AsyncLLM --|> LLM\n    StreamingLLM --|> AsyncLLM\n```",
          "Core Components": {
            "LLM Class": "The base synchronous LLM class provides the primary interface for language model interactions.\n\n**Key Features:**\n\n['**Provider Abstraction**: Unified interface across multiple LLM providers', '**Function Calling**: Native and mock function calling support', '**Vision Capabilities**: Multi-modal input processing', '**Prompt Caching**: Intelligent caching for repeated prompts', '**Cost Tracking**: Comprehensive usage and cost monitoring', '**Token Management**: Accurate token counting and context window handling', '**Retry Logic**: Robust error handling with exponential backoff']\n\n**Configuration Integration:**\n\n['Integrates with [core_configuration](core_configuration.md) for model settings', 'Supports dynamic configuration through LLMConfig', 'Handles provider-specific parameters and authentication']",
            "AsyncLLM Class": "Extends the base LLM class with asynchronous capabilities for non-blocking operations.\n\n**Key Features:**\n\n['**Non-blocking Operations**: Async/await pattern support', '**Cancellation Support**: Graceful request cancellation', '**Concurrent Processing**: Multiple simultaneous requests', '**Resource Management**: Proper cleanup and error handling']",
            "StreamingLLM Class": "Provides real-time streaming capabilities for continuous response generation.\n\n**Key Features:**\n\n['**Real-time Streaming**: Chunk-by-chunk response processing', '**Cancellation Handling**: Mid-stream request cancellation', '**Progressive Updates**: Incremental response building', '**Resource Efficiency**: Memory-efficient streaming processing']"
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant LLM\n    participant LiteLLM\n    participant Provider\n    participant Metrics\n    \n    Client->>LLM: completion(messages, tools)\n    LLM->>LLM: format_messages_for_llm()\n    LLM->>LLM: convert function calls (if needed)\n    LLM->>LiteLLM: litellm_completion()\n    LiteLLM->>Provider: API Request\n    Provider-->>LiteLLM: Response\n    LiteLLM-->>LLM: ModelResponse\n    LLM->>LLM: convert response (if needed)\n    LLM->>Metrics: record usage & cost\n    LLM->>LLM: log_response()\n    LLM-->>Client: Formatted Response\n```",
          "Feature Detection and Capabilities": "The module includes sophisticated feature detection for different model capabilities:\n\n```\ngraph LR\n    subgraph \"Model Features\"\n        FC[Function Calling]\n        Vision[Vision Support]\n        Cache[Prompt Caching]\n        Reasoning[Reasoning Effort]\n        StopWords[Stop Words]\n    end\n    \n    subgraph \"Detection Logic\"\n        ModelInfo[Model Info<br/>from LiteLLM]\n        ConfigOverride[Configuration<br/>Overrides]\n        ProviderCheck[Provider-specific<br/>Checks]\n    end\n    \n    ModelInfo --> FC\n    ModelInfo --> Vision\n    ModelInfo --> Cache\n    ConfigOverride --> FC\n    ConfigOverride --> Vision\n    ProviderCheck --> Reasoning\n    ProviderCheck --> StopWords\n```",
          "Function Calling Implementation": "The module supports both native and mock function calling:\n\n```\nflowchart TD\n    Start[Function Call Request]\n    Native{Native Support?}\n    \n    Native -->|Yes| DirectCall[Direct LiteLLM Call]\n    Native -->|No| MockCall[Mock Function Calling]\n    \n    MockCall --> Convert[Convert to Prompt Format]\n    Convert --> AddStops[Add Stop Words]\n    AddStops --> LLMCall[LLM Completion]\n    LLMCall --> ParseResponse[Parse Response]\n    ParseResponse --> ConvertBack[Convert to Function Format]\n    \n    DirectCall --> Response[Function Call Response]\n    ConvertBack --> Response\n```",
          "Integration Points": {
            "With Core Agent System": [
              "Provides LLM services to [core_agent_system](core_agent_system.md) components",
              "Handles agent message formatting and response processing",
              "Supports tool/function calling for agent actions"
            ],
            "With Router System": [
              "Base classes extended by [router_system](router_system.md) components",
              "Provides foundation for load balancing and failover",
              "Maintains consistent interface across routing strategies"
            ],
            "With Utility Mixins": [
              "Integrates [utility_mixins](utility_mixins.md) for enhanced functionality",
              "Retry logic for robust error handling",
              "Debug capabilities for development and troubleshooting"
            ],
            "With Events and Actions": [
              "Processes messages from [events_and_actions](events_and_actions.md) system",
              "Formats action requests for LLM consumption",
              "Converts LLM responses back to system events"
            ]
          },
          "Error Handling and Resilience": "```\ngraph TB\n    Request[LLM Request]\n    \n    subgraph \"Error Handling\"\n        Retry[Retry Logic]\n        Backoff[Exponential Backoff]\n        Fallback[Provider Fallback]\n        Circuit[Circuit Breaker]\n    end\n    \n    subgraph \"Exception Types\"\n        API[API Connection Error]\n        Rate[Rate Limit Error]\n        Service[Service Unavailable]\n        Timeout[Timeout Error]\n        NoResponse[No Response Error]\n    end\n    \n    Request --> API\n    Request --> Rate\n    Request --> Service\n    Request --> Timeout\n    Request --> NoResponse\n    \n    API --> Retry\n    Rate --> Retry\n    Service --> Retry\n    Timeout --> Retry\n    NoResponse --> Retry\n    \n    Retry --> Backoff\n    Backoff --> Fallback\n    Fallback --> Circuit\n```",
          "Performance and Monitoring": {
            "Metrics Collection": [
              "**Token Usage**: Input/output token tracking",
              "**Cost Monitoring**: Real-time cost calculation and accumulation",
              "**Latency Tracking**: Response time measurement",
              "**Cache Performance**: Hit/miss ratios for prompt caching",
              "**Error Rates**: Failure tracking and analysis"
            ],
            "Optimization Features": [
              "**Prompt Caching**: Reduces redundant processing",
              "**Token Counting**: Accurate context window management",
              "**Connection Pooling**: Efficient HTTP connection reuse",
              "**Request Batching**: Where supported by providers"
            ]
          },
          "Configuration and Customization": "The module supports extensive configuration through LLMConfig:\n\n['**Model Selection**: Support for 100+ models across providers', '**Authentication**: API key and credential management', '**Performance Tuning**: Temperature, top-p, max tokens', '**Feature Toggles**: Enable/disable specific capabilities', '**Cost Controls**: Budget limits and usage monitoring', '**Debug Options**: Logging and completion recording']",
          "Security Considerations": [
            "**API Key Protection**: Secure credential handling",
            "**Request Sanitization**: Input validation and cleaning",
            "**Response Filtering**: Output safety checks",
            "**Rate Limiting**: Built-in request throttling",
            "**Audit Logging**: Comprehensive request/response logging"
          ],
          "Usage Examples": {
            "Basic Synchronous Usage": "```\nfrom openhands.llm.llm import LLM\nfrom openhands.core.config import LLMConfig\n\nconfig = LLMConfig(model=\"gpt-4\", temperature=0.7)\nllm = LLM(config=config, service_id=\"main\")\n\nresponse = llm.completion(messages=[\n    {\"role\": \"user\", \"content\": \"Hello, world!\"}\n])\n```",
            "Asynchronous Usage": "```\nfrom openhands.llm.async_llm import AsyncLLM\n\nasync_llm = AsyncLLM(config=config, service_id=\"async\")\nresponse = await async_llm.async_completion(messages=messages)\n```",
            "Streaming Usage": "```\nfrom openhands.llm.streaming_llm import StreamingLLM\n\nstreaming_llm = StreamingLLM(config=config, service_id=\"stream\")\nasync for chunk in streaming_llm.async_streaming_completion(messages=messages):\n    print(chunk['choices'][0]['delta'].get('content', ''), end='')\n```"
          },
          "Future Enhancements": [
            "**Multi-modal Expansion**: Enhanced vision and audio support",
            "**Advanced Caching**: Semantic caching and cross-session persistence",
            "**Performance Optimization**: Request batching and connection pooling",
            "**Enhanced Monitoring**: Real-time dashboards and alerting",
            "**Provider Extensions**: Support for emerging LLM providers"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "state_management",
      "description": null,
      "content": {
        "State Management Module": {
          "Overview": "This module serves as the backbone for maintaining agent state throughout their lifecycle, from initialization to completion. It handles complex scenarios including multi-agent delegation, resource limiting, session persistence, and state recovery. The module ensures that agents can be paused, resumed, and controlled effectively while maintaining data integrity and operational continuity.",
          "Architecture": "```\ngraph TB\n    subgraph \"State Management Core\"\n        State[State Class]\n        TCS[TrafficControlState]\n        CF[ControlFlag Base]\n        ICF[IterationControlFlag]\n        BCF[BudgetControlFlag]\n    end\n    \n    subgraph \"External Dependencies\"\n        FS[FileStore]\n        ES[EventStream]\n        Metrics[Metrics System]\n        ConvStats[ConversationStats]\n    end\n    \n    subgraph \"Agent System\"\n        Agent[Agent Controller]\n        Events[Event History]\n        Memory[Memory View]\n    end\n    \n    State --> CF\n    CF --> ICF\n    CF --> BCF\n    State --> TCS\n    State --> FS\n    State --> ES\n    State --> Metrics\n    State --> ConvStats\n    \n    Agent --> State\n    Events --> State\n    Memory --> State\n    \n    classDef core fill:#e1f5fe\n    classDef external fill:#f3e5f5\n    classDef agent fill:#e8f5e8\n    \n    class State,TCS,CF,ICF,BCF core\n    class FS,ES,Metrics,ConvStats external\n    class Agent,Events,Memory agent\n```",
          "Core Components": {
            "State Class": "The `State` class is the central component that encapsulates all runtime information for an agent:\n\n**Key Responsibilities:**\n\n['**Session Management**: Handles saving and restoring agent state across sessions', '**Multi-agent Coordination**: Manages delegate levels and parent-child relationships', '**Resource Tracking**: Monitors iterations, budget, and other resource constraints', '**Event History**: Maintains chronological record of agent actions and observations', '**Persistence**: Serializes state data for storage and recovery']\n\n**Core Attributes:**\n\n['`session_id`: Unique identifier for the current session', '`agent_state`: Current operational state (LOADING, RUNNING, PAUSED, etc.)', '`history`: Complete event history for the agent', '`delegate_level`: Hierarchical level for multi-agent scenarios', '`iteration_flag`: Controls iteration limits and progression', '`budget_flag`: Manages cost/resource budget constraints']",
            "Control Flags System": {
              "IterationControlFlag": "Manages the number of steps an agent can take:\n\n['**Limit Tracking**: Monitors current vs. maximum iterations', '**Dynamic Expansion**: Allows limit increases in interactive mode', '**Step Control**: Increments iteration count and enforces limits']",
              "BudgetControlFlag": "Controls resource consumption (typically cost-related):\n\n['**Budget Monitoring**: Tracks spending against allocated budget', '**Flexible Limits**: Supports dynamic budget adjustments', '**Cost Control**: Prevents runaway resource consumption']"
            },
            "TrafficControlState (Deprecated)": "Legacy enumeration for rate limiting states:\n\n['`NORMAL`: Default operation mode', '`THROTTLING`: Rate-limited operation', '`PAUSED`: Temporarily suspended operation']\n\n*Note: This component is deprecated and maintained for backward compatibility.*"
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Agent\n    participant State\n    participant ControlFlags\n    participant FileStore\n    participant EventStream\n    \n    Agent->>State: Initialize session\n    State->>ControlFlags: Setup resource limits\n    \n    loop Agent Operation\n        Agent->>State: Execute action\n        State->>ControlFlags: Check limits\n        ControlFlags-->>State: Limit status\n        \n        alt Limit reached\n            State->>Agent: Pause/Error\n            Agent->>State: Request limit increase\n            State->>ControlFlags: Increase limits\n        else Normal operation\n            State->>EventStream: Record event\n            State->>State: Update metrics\n        end\n    end\n    \n    Agent->>State: Save session\n    State->>FileStore: Persist state\n    \n    Note over Agent,FileStore: Session can be restored later\n    \n    Agent->>State: Restore session\n    State->>FileStore: Load state\n    State->>EventStream: Rebuild history\n    State-->>Agent: Ready for operation\n```",
          "Integration Points": {
            "Core Agent System Integration": "The state_management module integrates closely with the [core_agent_system](core_agent_system.md):\n\n['**Agent Controller**: Provides state tracking and control flow management', '**Action Processing**: Records action execution and maintains event history', '**Traffic Control**: Implements resource limiting and flow control']",
            "Storage System Integration": "Integrates with the [storage_system](storage_system.md) for persistence:\n\n['**Session Storage**: Saves and restores complete agent state', '**Event Persistence**: Coordinates with event storage systems', '**File Management**: Handles state serialization and file operations']",
            "Events and Actions Integration": "Works with the [events_and_actions](events_and_actions.md) system:\n\n['**Event History**: Maintains chronological record of all events', '**Action Tracking**: Records agent actions and their outcomes', '**Observation Management**: Stores environmental observations']"
          },
          "State Lifecycle": "```\nstateDiagram-v2\n    [*] --> LOADING: Initialize\n    LOADING --> RUNNING: Start execution\n    RUNNING --> PAUSED: User pause/limit reached\n    RUNNING --> AWAITING_USER_INPUT: Requires input\n    RUNNING --> FINISHED: Task complete\n    RUNNING --> ERROR: Exception occurred\n    \n    PAUSED --> RUNNING: Resume\n    AWAITING_USER_INPUT --> RUNNING: Input provided\n    FINISHED --> [*]: Session end\n    ERROR --> [*]: Session end\n    \n    PAUSED --> SAVED: Save session\n    AWAITING_USER_INPUT --> SAVED: Save session\n    FINISHED --> SAVED: Save session\n    \n    SAVED --> LOADING: Restore session\n    \n    note right of RUNNING\n        Control flags monitor:\n        - Iteration limits\n        - Budget constraints\n        - Resource usage\n    end note\n    \n    note right of SAVED\n        State persisted with:\n        - Event history\n        - Metrics data\n        - Control flag state\n        - Session metadata\n    end note\n```",
          "Key Features": {
            "Session Persistence": "The module provides robust session management:\n\n```\n# Save current state\nstate.save_to_session(session_id, file_store, user_id)\n\n# Restore previous state\nrestored_state = State.restore_from_session(session_id, file_store, user_id)\n```\n\n**Features:**\n\n['**Serialization**: Uses pickle and base64 encoding for reliable storage', '**Backward Compatibility**: Handles state format migrations', '**Error Recovery**: Graceful handling of corrupted or missing state files', '**User Isolation**: Supports multi-user environments with proper isolation']",
            "Multi-Agent Support": "Sophisticated support for agent delegation and hierarchy:\n\n['**Delegate Levels**: Tracks hierarchical relationships between agents', '**Metrics Isolation**: Maintains separate metrics for parent and child agents', '**State Inheritance**: Proper state management across delegation boundaries', '**Resource Sharing**: Coordinated resource management across agent hierarchy']",
            "Resource Control": "Advanced resource management capabilities:\n\n['**Iteration Limits**: Prevents infinite loops and runaway execution', '**Budget Control**: Manages cost constraints for LLM operations', '**Dynamic Adjustment**: Interactive limit increases in non-headless mode', '**Graceful Degradation**: Proper error handling when limits are exceeded']",
            "Memory and History Management": "Efficient event history and memory management:\n\n['**Event Caching**: Optimized view generation with checksum-based caching', '**Memory Views**: Provides filtered and processed views of event history', '**History Reconstruction**: Rebuilds event history from persistent storage', '**Selective Persistence**: Optimizes storage by excluding transient data']"
          },
          "Usage Patterns": {
            "Basic State Management": "```\n# Initialize state\nstate = State(session_id=\"session_123\")\n\n# Configure control flags\nstate.iteration_flag = IterationControlFlag(\n    limit_increase_amount=100,\n    current_value=0,\n    max_value=100\n)\n\n# Execute with control\ntry:\n    state.iteration_flag.step()\n    # Perform agent action\nexcept RuntimeError as e:\n    # Handle limit exceeded\n    pass\n```",
            "Session Persistence": "```\n# Save state\nstate.save_to_session(session_id, file_store, user_id)\n\n# Later, restore state\nrestored_state = State.restore_from_session(session_id, file_store, user_id)\n\n# Continue operation\nif restored_state.resume_state:\n    # Handle resumption logic\n    pass\n```",
            "Multi-Agent Delegation": "```\n# Parent agent creates child state\nchild_state = State(\n    session_id=parent_state.session_id,\n    delegate_level=parent_state.delegate_level + 1,\n    parent_metrics_snapshot=parent_state.metrics.copy(),\n    parent_iteration=parent_state.iteration_flag.current_value\n)\n\n# Child operates independently\n# Parent can access child metrics via get_local_metrics()\n```"
          },
          "Error Handling and Recovery": "The module implements comprehensive error handling:\n\n['**Graceful Degradation**: Continues operation when possible despite errors', '**State Recovery**: Attempts to restore from corrupted or incomplete state', '**Limit Enforcement**: Proper error reporting when resource limits are exceeded', '**Backward Compatibility**: Handles legacy state formats during restoration']",
          "Performance Considerations": [
            "**Lazy Loading**: Event history and views are computed on-demand",
            "**Caching Strategy**: Checksum-based caching for expensive view operations",
            "**Selective Serialization**: Excludes transient data from persistence",
            "**Memory Management**: Efficient handling of large event histories"
          ],
          "Future Enhancements": "The module is designed for extensibility:\n\n['**Additional Control Flags**: Framework supports new resource types', '**Enhanced Persistence**: Pluggable storage backends', '**Advanced Metrics**: More sophisticated resource tracking', '**Distributed State**: Support for distributed agent operations']\n\nThis state management system provides the foundation for reliable, scalable, and maintainable agent operations in the OpenHands ecosystem."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "type_definitions",
      "description": null,
      "content": {
        "Type Definitions Module": {
          "Overview": "The type_definitions module serves as the foundational schema layer for the OpenHands system, defining the core enumeration types that standardize action and observation types across the entire platform. This module provides the essential type definitions that enable consistent communication between agents, runtime systems, and the event processing framework.",
          "Core Components": {
            "ActionType Enumeration": [
              "**Purpose**: Defines all possible action types that can be performed within the OpenHands system",
              "**Location**: `openhands.core.schema.action.ActionType`",
              "**Type**: String-based enumeration extending both `str` and `Enum`"
            ],
            "ObservationType Enumeration": [
              "**Purpose**: Defines all possible observation types that can be generated as responses to actions",
              "**Location**: `openhands.core.schema.observation.ObservationType`",
              "**Type**: String-based enumeration extending both `str` and `Enum`"
            ]
          },
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Type Definitions Module\"\n        AT[ActionType Enum]\n        OT[ObservationType Enum]\n    end\n    \n    subgraph \"Event Foundation\"\n        A[Action Classes]\n        O[Observation Classes]\n    end\n    \n    subgraph \"Core Agent System\"\n        AG[Agent]\n        AP[ActionParser]\n        RP[ResponseParser]\n    end\n    \n    subgraph \"Agent Implementations\"\n        CA[CodeActAgent]\n        BA[BrowsingAgent]\n        VA[VisualBrowsingAgent]\n        LA[LocAgent]\n        RA[ReadOnlyAgent]\n    end\n    \n    AT --> A\n    OT --> O\n    A --> AG\n    O --> AG\n    A --> AP\n    O --> RP\n    AG --> CA\n    AG --> BA\n    AG --> VA\n    AG --> LA\n    AG --> RA\n    \n    style AT fill:#e1f5fe\n    style OT fill:#e8f5e8\n```",
          "ActionType Detailed Specification": {
            "Communication Actions": [
              "**MESSAGE**: Represents a standard message",
              "**SYSTEM**: Represents a system-level message",
              "**CHAT**: User communication (referenced in observations)"
            ],
            "Task Management Actions": [
              "**START**: Initiates a new development task or user chat session",
              "**FINISH**: Completes a task after verification",
              "**REJECT**: Refuses a task due to impossibility or constraints",
              "**PAUSE**: Temporarily suspends task execution",
              "**RESUME**: Continues a paused task",
              "**STOP**: Terminates task execution completely"
            ],
            "File Operations": [
              "**READ**: Retrieves file content",
              "**WRITE**: Creates or overwrites file content",
              "**EDIT**: Modifies existing file content using drafts"
            ],
            "Code Execution": [
              "**RUN**: Executes shell commands",
              "**RUN_IPYTHON**: Executes IPython/Jupyter cells"
            ],
            "Web Interaction": [
              "**BROWSE**: Opens and retrieves web page content",
              "**BROWSE_INTERACTIVE**: Performs interactive browser operations"
            ],
            "Advanced Operations": [
              "**MCP**: Interacts with Model Context Protocol servers",
              "**DELEGATE**: Assigns tasks to other agents",
              "**THINK**: Records internal reasoning processes",
              "**RECALL**: Retrieves content from workspace or microagents",
              "**CONDENSATION**: Summarizes event sequences",
              "**CONDENSATION_REQUEST**: Requests event summarization",
              "**TASK_TRACKING**: Manages task lists and progress"
            ],
            "Version Control": [
              "**PUSH**: Pushes branches to GitHub",
              "**SEND_PR**: Creates pull requests"
            ],
            "State Management": [
              "**CHANGE_AGENT_STATE**: Modifies agent operational state",
              "**NULL**: Represents empty or undefined actions"
            ]
          },
          "ObservationType Detailed Specification": {
            "File Operation Results": [
              "**READ**: Content retrieved from file reading",
              "**WRITE**: Confirmation of file writing operations",
              "**EDIT**: Results of file editing operations"
            ],
            "Execution Results": [
              "**RUN**: Output from command execution",
              "**RUN_IPYTHON**: Results from IPython cell execution"
            ],
            "Web Operation Results": [
              "**BROWSE**: HTML content from web browsing",
              "**DOWNLOAD**: Results from file downloads via browser"
            ],
            "Communication Results": [
              "**CHAT**: Messages from users",
              "**MESSAGE**: General message observations"
            ],
            "Task Management Results": [
              "**SUCCESS**: Successful operation completion",
              "**ERROR**: Error conditions and failures",
              "**USER_REJECTED**: User rejection of proposed actions"
            ],
            "Advanced Operation Results": [
              "**DELEGATE**: Results from delegated tasks",
              "**RECALL**: Retrieved workspace or microagent content",
              "**MCP**: Results from MCP server interactions",
              "**CONDENSE**: Summarized event sequences",
              "**TASK_TRACKING**: Task management operation results"
            ],
            "State and Control Results": [
              "**AGENT_STATE_CHANGED**: Notifications of agent state modifications",
              "**THINK**: Recorded thought processes",
              "**NULL**: Empty or undefined observations"
            ]
          },
          "Data Flow Architecture": "```\nsequenceDiagram\n    participant Agent\n    participant ActionParser\n    participant Runtime\n    participant ResponseParser\n    \n    Agent->>ActionParser: Create Action with ActionType\n    ActionParser->>Runtime: Execute typed action\n    Runtime->>ResponseParser: Return result\n    ResponseParser->>Agent: Generate Observation with ObservationType\n    \n    Note over Agent,ResponseParser: Type safety ensured by enumerations\n```",
          "Integration Patterns": {
            "Type Safety Pattern": "```\ngraph LR\n    subgraph \"Type Definitions\"\n        AT[ActionType]\n        OT[ObservationType]\n    end\n    \n    subgraph \"Implementation Layer\"\n        AC[Action Classes]\n        OC[Observation Classes]\n    end\n    \n    subgraph \"Processing Layer\"\n        AP[ActionParser]\n        RP[ResponseParser]\n    end\n    \n    AT --> AC\n    OT --> OC\n    AC --> AP\n    OC --> RP\n    \n    style AT fill:#ffebee\n    style OT fill:#e8f5e8\n```",
            "Event Processing Flow": "```\nflowchart TD\n    A[Action Created] --> B{ActionType Validation}\n    B -->|Valid| C[Action Processing]\n    B -->|Invalid| D[Type Error]\n    C --> E[Runtime Execution]\n    E --> F[Result Generation]\n    F --> G{ObservationType Assignment}\n    G --> H[Observation Created]\n    \n    style B fill:#fff3e0\n    style G fill:#e8f5e8\n```"
          },
          "Module Dependencies": {
            "Upstream Dependencies": "This module has minimal dependencies and serves as a foundational layer:\n\n[\"Python's built-in `enum` module\", 'No external dependencies']",
            "Downstream Dependencies": "The type definitions are consumed by:\n\n['**[event_foundation](event_foundation.md)**: Action and Observation base classes', '**[core_agent_system](core_agent_system.md)**: Agent implementations and parsers', '**[agent_implementations](agent_implementations.md)**: Specific agent types', '**[runtime_system](runtime_system.md)**: Runtime execution engines']"
          },
          "Usage Patterns": {
            "Action Type Usage": "```\nfrom openhands.core.schema.action import ActionType\n\n# Type-safe action creation\naction_type = ActionType.READ\nif action_type == ActionType.WRITE:\n    # Handle write operations\n    pass\n```",
            "Observation Type Usage": "```\nfrom openhands.core.schema.observation import ObservationType\n\n# Type-safe observation processing\nobs_type = ObservationType.SUCCESS\nif obs_type in [ObservationType.ERROR, ObservationType.USER_REJECTED]:\n    # Handle error conditions\n    pass\n```"
          },
          "Extension Guidelines": {
            "Adding New Action Types": [
              "Add the new enum value to `ActionType`",
              "Update corresponding action classes in [event_foundation](event_foundation.md)",
              "Implement parsing logic in [action_processing](action_processing.md)",
              "Add runtime support in [runtime_system](runtime_system.md)"
            ],
            "Adding New Observation Types": [
              "Add the new enum value to `ObservationType`",
              "Update corresponding observation classes in [event_foundation](event_foundation.md)",
              "Implement generation logic in response parsers",
              "Update agent handling logic as needed"
            ]
          },
          "Quality Assurance": {
            "Type Safety Features": [
              "String-based enums provide both type safety and serialization compatibility",
              "Exhaustive enumeration prevents undefined action/observation types",
              "IDE support for autocompletion and validation"
            ],
            "Consistency Guarantees": [
              "Centralized type definitions ensure system-wide consistency",
              "Single source of truth for all action and observation types",
              "Version-controlled schema evolution"
            ]
          },
          "Related Documentation": [
            "**[event_foundation](event_foundation.md)**: Base classes that implement these type definitions",
            "**[core_agent_system](core_agent_system.md)**: Agent system that processes these types",
            "**[action_processing](action_processing.md)**: Action parsing and validation",
            "**[runtime_system](runtime_system.md)**: Runtime execution of typed actions"
          ],
          "Summary": "The type_definitions module provides the essential schema foundation for the OpenHands system through two critical enumerations: ActionType and ObservationType. These type definitions ensure type safety, consistency, and clear communication protocols across all system components. The module's strategic position as a foundational layer makes it a dependency for virtually all other system modules, emphasizing the importance of careful schema design and evolution management."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "llm_risk_analysis",
      "description": null,
      "content": {
        "LLM Risk Analysis Module": {
          "Overview": "The LLM Risk Analysis module provides a specialized security analyzer that leverages Large Language Model (LLM) assessments to evaluate the security risks of agent actions. This module is part of the broader [security_system](security_system.md) and implements a trust-based approach where the LLM's own risk assessments are respected and utilized for security decision-making.",
          "Core Purpose": "The module serves as a bridge between AI-driven risk assessment and the OpenHands security framework, allowing the system to:\n\n['**Trust LLM Judgments**: Respect security risk assessments provided directly by the LLM', '**Fallback Handling**: Provide appropriate defaults when LLM assessments are unavailable', '**Integration Point**: Seamlessly integrate with the broader security analysis pipeline', '**API Compatibility**: Maintain compatibility with the security analyzer interface']",
          "Architecture": "```\ngraph TB\n    subgraph \"LLM Risk Analysis Module\"\n        LRA[LLMRiskAnalyzer]\n    end\n    \n    subgraph \"Security System\"\n        SA[SecurityAnalyzer]\n        ASR[ActionSecurityRisk]\n    end\n    \n    subgraph \"Events & Actions\"\n        A[Action]\n        E[Event]\n    end\n    \n    subgraph \"Core Infrastructure\"\n        L[Logger]\n        R[Request]\n    end\n    \n    LRA -.->|inherits| SA\n    LRA -->|analyzes| A\n    LRA -->|returns| ASR\n    LRA -->|logs to| L\n    LRA -->|handles| R\n    A -.->|extends| E\n    \n    style LRA fill:#e1f5fe\n    style SA fill:#f3e5f5\n    style A fill:#fff3e0\n```",
          "Component Details": {
            "LLMRiskAnalyzer": {
              "Key Responsibilities": [
                "**LLM Risk Assessment Processing**: Extracts and validates security risk assessments from LLM-generated actions",
                "**Risk Level Validation**: Ensures risk levels conform to the `ActionSecurityRisk` enumeration",
                "**Fallback Logic**: Provides `UNKNOWN` risk level when assessments are unavailable or invalid",
                "**API Request Handling**: Implements the required API interface for security analyzers"
              ],
              "Risk Assessment Flow": "```\nflowchart TD\n    A[Action Received] --> B{Has security_risk attribute?}\n    B -->|No| C[Return UNKNOWN]\n    B -->|Yes| D[Get security_risk value]\n    D --> E{Valid risk level?}\n    E -->|Yes| F[Return risk level]\n    E -->|No| G[Log warning]\n    G --> H[Return UNKNOWN]\n    \n    style A fill:#e8f5e8\n    style C fill:#fff2cc\n    style F fill:#d4edda\n    style H fill:#fff2cc\n```"
            }
          },
          "Integration with Security System": {
            "Security Analyzer Hierarchy": "```\nclassDiagram\n    class SecurityAnalyzer {\n        <<abstract>>\n        +handle_api_request(request) Any\n        +security_risk(action) ActionSecurityRisk\n        +close() None\n    }\n    \n    class LLMRiskAnalyzer {\n        +handle_api_request(request) Any\n        +security_risk(action) ActionSecurityRisk\n    }\n    \n    class InvariantAnalyzer {\n        +handle_api_request(request) Any\n        +security_risk(action) ActionSecurityRisk\n    }\n    \n    SecurityAnalyzer <|-- LLMRiskAnalyzer\n    SecurityAnalyzer <|-- InvariantAnalyzer\n    \n    note for LLMRiskAnalyzer \"Trusts LLM assessments\"\n    note for InvariantAnalyzer \"Uses rule-based analysis\"\n```",
            "Risk Level Enumeration": "The module utilizes the `ActionSecurityRisk` enumeration to standardize risk assessments:\n\n['**UNKNOWN (-1)**: Default when no assessment is available or invalid', '**LOW (0)**: Minimal security risk', '**MEDIUM (1)**: Moderate security risk requiring attention', '**HIGH (2)**: Significant security risk requiring immediate action']"
          },
          "Data Flow": "```\nsequenceDiagram\n    participant LLM as Large Language Model\n    participant A as Action\n    participant LRA as LLMRiskAnalyzer\n    participant SS as Security System\n    \n    LLM->>A: Generate action with security_risk attribute\n    SS->>LRA: Request security analysis\n    LRA->>A: Check for security_risk attribute\n    \n    alt Has valid security_risk\n        A-->>LRA: Return security_risk value\n        LRA->>LRA: Validate risk level\n        LRA-->>SS: Return validated risk level\n    else No security_risk or invalid\n        LRA->>LRA: Log warning (if invalid)\n        LRA-->>SS: Return UNKNOWN\n    end\n```",
          "API Interface": {
            "Security Risk Assessment": "```\nasync def security_risk(self, action: Action) -> ActionSecurityRisk\n```\n\n**Purpose**: Evaluates an action for security risks based on LLM assessments\n\n**Parameters**:\n\n['`action`: The action to analyze for security risks']\n\n**Returns**: `ActionSecurityRisk` enumeration value\n\n**Logic**:\n\n['Check if action has `security_risk` attribute', 'Validate the risk level against known values', 'Return the risk level or `UNKNOWN` with appropriate logging']",
            "API Request Handling": "```\nasync def handle_api_request(self, request: Request) -> Any\n```\n\n**Purpose**: Handles incoming API requests for the security analyzer\n\n**Parameters**:\n\n['`request`: FastAPI request object']\n\n**Returns**: Status response indicating successful handling"
          },
          "Error Handling and Logging": {
            "Warning Scenarios": [
              "**Unrecognized Risk Values**: When an action contains a `security_risk` attribute with an invalid value",
              "**Attribute Validation**: Ensures type safety and value validation"
            ],
            "Logging Strategy": "```\nlogger.warning(f'Unrecognized security_risk value: {security_risk}')\n```\n\nThe module uses the OpenHands logger to track:\n\n['Invalid security risk values', 'Unexpected attribute states', 'Processing anomalies']"
          },
          "Dependencies": {
            "Internal Dependencies": [
              "**[security_system](security_system.md)**: Base `SecurityAnalyzer` class",
              "**[events_and_actions](events_and_actions.md)**: `Action` and `ActionSecurityRisk` types",
              "**Core Infrastructure**: Logging and request handling utilities"
            ],
            "External Dependencies": [
              "**FastAPI**: For request handling interface",
              "**Python Standard Library**: Enum and typing support"
            ]
          },
          "Usage Patterns": {
            "Basic Implementation": "```\nfrom openhands.security.llm.analyzer import LLMRiskAnalyzer\n\n# Initialize the analyzer\nanalyzer = LLMRiskAnalyzer()\n\n# Analyze an action\nrisk_level = await analyzer.security_risk(action)\n\n# Handle API requests\nresponse = await analyzer.handle_api_request(request)\n```",
            "Integration with Security Pipeline": "The analyzer is typically used as part of a broader security analysis pipeline where multiple analyzers may be chained or used in parallel to provide comprehensive security assessment."
          },
          "Configuration and Deployment": "The module requires no specific configuration and can be deployed as part of the broader OpenHands security system. It automatically integrates with:\n\n['**Logging System**: Uses the standard OpenHands logger', '**Security Framework**: Implements the required `SecurityAnalyzer` interface', '**Action Processing**: Works with any `Action` object in the system']",
          "Future Considerations": {
            "Potential Enhancements": [
              "**Confidence Scoring**: Add confidence levels to LLM assessments",
              "**Risk Reasoning**: Capture and log the reasoning behind risk assessments",
              "**Threshold Configuration**: Allow customizable risk thresholds",
              "**Audit Trail**: Enhanced logging for security audit purposes"
            ],
            "Scalability Considerations": [
              "The module is designed to be stateless and can handle concurrent requests",
              "Memory footprint is minimal as it doesn't maintain persistent state",
              "Performance is primarily dependent on the underlying action processing pipeline"
            ]
          },
          "Related Documentation": [
            "**[security_system](security_system.md)**: Overall security architecture and analyzer framework",
            "**[events_and_actions](events_and_actions.md)**: Action types and event system",
            "**[core_agent_system](core_agent_system.md)**: Agent architecture and action processing",
            "**[llm_integration](llm_integration.md)**: LLM system integration and interfaces"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "builder_system",
      "description": null,
      "content": {
        "Builder System Documentation": {
          "Overview": "The Builder System is a critical component of the OpenHands runtime infrastructure that provides an abstract interface for building runtime container images. This module defines the contract for runtime image builders and enables different runtime implementations to create and manage their execution environments.\n\nThe builder system serves as the foundation for creating containerized environments where OpenHands agents execute their tasks, ensuring consistent and reproducible runtime environments across different deployment scenarios.",
          "Core Architecture": {
            "RuntimeBuilder Abstract Base Class": "The `RuntimeBuilder` is the central abstraction that defines the interface for all runtime image builders in the OpenHands ecosystem.\n\n```\nclassDiagram\n    class RuntimeBuilder {\n        <<abstract>>\n        +build(path: str, tags: list[str], platform: str, extra_build_args: list[str]) str\n        +image_exists(image_name: str, pull_from_repo: bool) bool\n    }\n    \n    class DockerBuilder {\n        +build(path, tags, platform, extra_build_args) str\n        +image_exists(image_name, pull_from_repo) bool\n    }\n    \n    class KubernetesBuilder {\n        +build(path, tags, platform, extra_build_args) str\n        +image_exists(image_name, pull_from_repo) bool\n    }\n    \n    RuntimeBuilder <|-- DockerBuilder\n    RuntimeBuilder <|-- KubernetesBuilder\n    \n    note for RuntimeBuilder \"Abstract base class defining\\nthe contract for runtime builders\"\n    note for DockerBuilder \"Docker-specific implementation\\nfor container image building\"\n    note for KubernetesBuilder \"Kubernetes-specific implementation\\nfor pod image building\"\n```",
            "Key Methods": {
              "build()": [
                "**Purpose**: Builds runtime images from source directories",
                "**Parameters**:",
                [
                  "`path`: Build directory containing Dockerfile and context",
                  "`tags`: List of tags to apply to the built image",
                  "`platform`: Target platform for multi-architecture builds",
                  "`extra_build_args`: Additional build arguments"
                ],
                "**Returns**: Final image name:tag for runtime usage",
                "**Raises**: `AgentRuntimeBuildError` on build failures"
              ],
              "image_exists()": [
                "**Purpose**: Checks if a runtime image exists locally or remotely",
                "**Parameters**:",
                [
                  "`image_name`: Name of the image to check",
                  "`pull_from_repo`: Whether to pull from remote repository"
                ],
                "**Returns**: Boolean indicating image availability"
              ]
            }
          },
          "Integration with Runtime System": {
            "Runtime Dependencies": "The builder system supports various runtime implementations:\n\n['**[Local Runtime](runtime_implementations.md#local-runtime)**: Uses Docker builders for containerized execution', '**[CLI Runtime](runtime_implementations.md#cli-runtime)**: May use builders for isolated environments', '**[Kubernetes Runtime](runtime_implementations.md#kubernetes-runtime)**: Leverages Kubernetes-specific builders']"
          },
          "Build Process Flow": "```\nsequenceDiagram\n    participant R as Runtime\n    participant B as RuntimeBuilder\n    participant I as Image Registry\n    participant C as Container Engine\n    \n    R->>B: build(path, tags, platform, args)\n    B->>B: Validate build context\n    B->>C: Execute build command\n    C->>C: Build image layers\n    C->>I: Push to registry (if configured)\n    I-->>C: Confirm push\n    C-->>B: Return built image ID\n    B->>B: Apply tags and mutations\n    B-->>R: Return final image name:tag\n    \n    Note over R,C: Build process with error handling\n    \n    R->>B: image_exists(image_name, pull_from_repo)\n    B->>I: Check remote registry\n    I-->>B: Image availability status\n    B->>C: Check local cache\n    C-->>B: Local availability status\n    B-->>R: Combined availability result\n```",
          "Error Handling": {
            "AgentRuntimeBuildError": [
              "Raised when image builds fail",
              "Contains detailed error information",
              "Enables runtime recovery strategies"
            ],
            "Common Error Scenarios": [
              "**Build Context Issues**: Missing Dockerfile, invalid paths",
              "**Resource Constraints**: Insufficient memory/disk space",
              "**Network Failures**: Registry connectivity issues",
              "**Permission Errors**: Docker daemon access, registry authentication"
            ]
          },
          "Configuration Integration": "The builder system integrates with the [core configuration system](core_configuration.md):\n\n```\ngraph LR\n    subgraph \"Configuration\"\n        A[OpenHandsConfig] --> B[SandboxConfig]\n        B --> C[runtime_container_image]\n        B --> D[base_container_image]\n        B --> E[build_args]\n    end\n    \n    subgraph \"Builder System\"\n        F[RuntimeBuilder] --> G[\"build()\"]\n        G --> H[Image Building]\n    end\n    \n    C --> F\n    D --> F\n    E --> G\n    \n    style A fill:#fff3e0\n    style F fill:#e1f5fe\n```",
          "Plugin Integration": {
            "Plugin-Aware Building": [
              "Builders can incorporate plugin requirements into images",
              "Dynamic plugin installation during build process",
              "Plugin-specific build arguments and configurations"
            ],
            "Build-Time Plugin Setup": "```\ngraph TD\n    A[Plugin Requirements] --> B[RuntimeBuilder]\n    B --> C[Generate Build Context]\n    C --> D[Include Plugin Dependencies]\n    D --> E[Build Runtime Image]\n    E --> F[Plugin-Ready Runtime]\n    \n    style A fill:#e8f5e8\n    style B fill:#e1f5fe\n    style F fill:#f3e5f5\n```"
          },
          "Security Considerations": {
            "Build Security": [
              "Secure build contexts with minimal attack surface",
              "Validation of build arguments and parameters",
              "Isolation of build processes from host system"
            ],
            "Image Security": [
              "Base image vulnerability scanning",
              "Minimal runtime dependencies",
              "Secure default configurations"
            ]
          },
          "Performance Optimization": {
            "Build Caching": [
              "Layer caching for faster subsequent builds",
              "Multi-stage build optimization",
              "Shared base image layers"
            ],
            "Resource Management": [
              "Build resource limits and quotas",
              "Parallel build capabilities",
              "Build artifact cleanup"
            ]
          },
          "Extension Points": {
            "Custom Builder Implementation": "```\nclass CustomRuntimeBuilder(RuntimeBuilder):\n    def build(self, path: str, tags: list[str], \n              platform: str | None = None,\n              extra_build_args: list[str] | None = None) -> str:\n        # Custom build logic\n        pass\n    \n    def image_exists(self, image_name: str, \n                     pull_from_repo: bool = True) -> bool:\n        # Custom existence check\n        pass\n```",
            "Builder Factory Pattern": [
              "Dynamic builder selection based on runtime type",
              "Configuration-driven builder instantiation",
              "Plugin-based builder extensions"
            ]
          },
          "Monitoring and Observability": {
            "Build Metrics": [
              "Build duration and success rates",
              "Image size and layer optimization",
              "Resource utilization during builds"
            ],
            "Logging and Debugging": [
              "Detailed build logs and error traces",
              "Build context inspection capabilities",
              "Performance profiling for build optimization"
            ]
          },
          "Related Documentation": [
            "**[Runtime System](runtime_system.md)**: Overall runtime architecture",
            "**[Runtime Implementations](runtime_implementations.md)**: Specific runtime types",
            "**[Plugin System](plugin_system.md)**: Plugin architecture and integration",
            "**[Core Configuration](core_configuration.md)**: Configuration management",
            "**[Security System](security_system.md)**: Security considerations"
          ],
          "Future Enhancements": {
            "Planned Features": [
              "Multi-architecture build support",
              "Advanced caching strategies",
              "Build pipeline integration",
              "Custom registry support"
            ],
            "Extensibility Roadmap": [
              "Builder plugin architecture",
              "Dynamic build optimization",
              "Cloud-native build services",
              "Integration with CI/CD pipelines"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "api_services",
      "description": null,
      "content": {
        "API Services Module": {
          "Overview": "The API Services module serves as the frontend's primary interface layer for communicating with the OpenHands backend system. This module provides a comprehensive set of TypeScript service classes that encapsulate all HTTP API interactions, offering a clean abstraction layer between the frontend components and backend endpoints.\n\nThe module consists of four core service classes that handle different aspects of the system:\n\n['**OpenHands**: Main service for conversation management, workspace operations, and core functionality', '**AuthService**: Authentication and authorization operations', '**GitService**: Git repository and version control operations  ', '**UserService**: User profile and account management']",
          "Architecture Overview": "```\ngraph TB\n    subgraph \"Frontend Components\"\n        FC[Frontend Components]\n        SH[State Hooks]\n        UI[UI Components]\n    end\n    \n    subgraph \"API Services Layer\"\n        OH[OpenHands Service]\n        AS[AuthService]\n        GS[GitService]\n        US[UserService]\n        AX[Axios Instance]\n    end\n    \n    subgraph \"Backend APIs\"\n        CA[Conversation API]\n        AA[Auth API]\n        GA[Git API]\n        UA[User API]\n        BA[Billing API]\n        FA[Feedback API]\n    end\n    \n    FC --> OH\n    SH --> AS\n    UI --> GS\n    FC --> US\n    \n    OH --> AX\n    AS --> AX\n    GS --> AX\n    US --> AX\n    \n    AX --> CA\n    AX --> AA\n    AX --> GA\n    AX --> UA\n    AX --> BA\n    AX --> FA\n    \n    style OH fill:#e1f5fe\n    style AS fill:#f3e5f5\n    style GS fill:#e8f5e8\n    style US fill:#fff3e0\n```",
          "Core Components": {
            "OpenHands Service": "The primary service class that handles the majority of application functionality including conversation management, workspace operations, and system integrations.\n\n**Key Responsibilities:**\n\n['Conversation lifecycle management (create, start, stop, delete)', 'Workspace file operations and downloads', 'Feedback and rating systems', 'Billing and subscription management', 'Git change tracking and diff operations', 'Microagent management', 'Development environment integration (VSCode, web hosts)']\n\n**Session Management:**\nThe service implements a sophisticated session management system with conversation-specific URLs and API keys:\n\n```\nsequenceDiagram\n    participant FC as Frontend Component\n    participant OH as OpenHands Service\n    participant BE as Backend API\n    \n    FC->>OH: setCurrentConversation(conversation)\n    OH->>OH: Store conversation with session_api_key\n    FC->>OH: API call with conversationId\n    OH->>OH: getConversationUrl(conversationId)\n    OH->>OH: getConversationHeaders()\n    OH->>BE: HTTP request with X-Session-API-Key\n    BE->>OH: Response\n    OH->>FC: Processed data\n```",
            "AuthService": "Handles authentication flows for both SaaS and OSS deployment modes.\n\n**Key Features:**\n\n['Multi-mode authentication (SaaS vs OSS)', 'GitHub OAuth integration via Keycloak', 'Session management and logout functionality']\n\n**Authentication Flow:**\n\n```\nflowchart TD\n    A[User Login Request] --> B{App Mode?}\n    B -->|SaaS| C[Keycloak Authentication]\n    B -->|OSS| D[Direct Access]\n    C --> E[GitHub OAuth]\n    E --> F[Access Token Exchange]\n    F --> G[Authenticated Session]\n    D --> G\n    G --> H[API Access Granted]\n```",
            "GitService": "Comprehensive Git integration service supporting multiple providers (GitHub, GitLab, Bitbucket).\n\n**Core Capabilities:**\n\n['Repository search and browsing', 'Branch management and search', 'Installation-based repository access', 'Microagent repository integration', 'Multi-provider support with unified interface']\n\n**Repository Access Patterns:**\n\n```\ngraph LR\n    subgraph \"Repository Access\"\n        A[User Repositories] --> B[Search Repositories]\n        A --> C[Installation Repositories]\n        B --> D[Repository Selection]\n        C --> D\n        D --> E[Branch Management]\n        E --> F[Microagent Access]\n    end\n    \n    subgraph \"Providers\"\n        G[GitHub]\n        H[GitLab]\n        I[Bitbucket]\n    end\n    \n    A -.-> G\n    A -.-> H\n    A -.-> I\n```",
            "UserService": "Simple service for user profile management and account information retrieval.\n\n**Functionality:**\n\n['User profile data retrieval', 'Git user information management', 'Account details access']"
          },
          "Data Flow Architecture": "```\nflowchart TD\n    subgraph \"Frontend State\"\n        CS[Conversation State]\n        FS[File State]\n        US[User State]\n        AS[Auth State]\n    end\n    \n    subgraph \"API Services\"\n        OH[OpenHands]\n        AUTH[AuthService]\n        GIT[GitService]\n        USER[UserService]\n    end\n    \n    subgraph \"Backend Systems\"\n        CM[Conversation Manager]\n        SM[Session Manager]\n        GM[Git Manager]\n        UM[User Manager]\n    end\n    \n    CS <--> OH\n    FS <--> OH\n    AS <--> AUTH\n    US <--> USER\n    \n    OH <--> CM\n    OH <--> SM\n    AUTH <--> UM\n    GIT <--> GM\n    USER <--> UM\n    \n    style CS fill:#e3f2fd\n    style FS fill:#e8f5e8\n    style AS fill:#f3e5f5\n    style US fill:#fff3e0\n```",
          "Integration Points": {
            "Server and API Integration": "The API Services module integrates closely with the [server_and_api](server_and_api.md) module, particularly:\n\n['**ConversationManager**: For conversation lifecycle operations', '**WebSession**: For session management and authentication', '**UserAuth**: For authentication and authorization flows']",
            "Storage System Integration": "Connects with the [storage_system](storage_system.md) for:\n\n['**ConversationStore**: Conversation persistence and retrieval', '**FileStore**: Workspace file management', '**SecretsStore**: Secure credential storage']",
            "Git Integrations": "Leverages the [git_integrations](git_integrations.md) module for:\n\n['**GitService**: Multi-provider Git operations', '**BaseGitService**: Common Git functionality', 'Provider-specific implementations (GitHub, GitLab, Bitbucket)']"
          },
          "Error Handling and Resilience": "The API services implement comprehensive error handling patterns:\n\n```\nflowchart TD\n    A[API Call] --> B{Request Success?}\n    B -->|Yes| C[Return Data]\n    B -->|No| D[Error Analysis]\n    D --> E{Error Type?}\n    E -->|Network| F[Retry Logic]\n    E -->|Auth| G[Re-authenticate]\n    E -->|Validation| H[Return Error]\n    F --> A\n    G --> A\n    H --> I[Error Response]\n```\n\n**Error Handling Features:**\n\n['Automatic retry mechanisms for network failures', 'Authentication token refresh handling', 'Graceful degradation for optional features', 'Comprehensive error reporting to frontend components']",
          "Security Considerations": {
            "Authentication Security": [
              "Session-based API key management",
              "Secure token storage and transmission",
              "Multi-provider OAuth integration",
              "Automatic session cleanup on logout"
            ],
            "Data Protection": [
              "Secure file upload handling",
              "Protected conversation data access",
              "Provider-specific credential management",
              "CORS and request validation"
            ]
          },
          "Performance Optimizations": {
            "Request Optimization": [
              "Pagination support for large datasets",
              "Efficient search implementations",
              "Batch operations for feedback and data retrieval",
              "Streaming support for large file operations"
            ],
            "Caching Strategy": "```\ngraph LR\n    A[API Request] --> B{Cache Available?}\n    B -->|Yes| C[Return Cached Data]\n    B -->|No| D[Fetch from API]\n    D --> E[Update Cache]\n    E --> F[Return Fresh Data]\n    C --> G[Check Expiry]\n    G -->|Expired| D\n    G -->|Valid| H[Return Data]\n```"
          },
          "Usage Patterns": {
            "Conversation Management": "```\n// Create and start a conversation\nconst conversation = await OpenHands.createConversation(\n  selectedRepository,\n  gitProvider,\n  initialMessage\n);\n\nawait OpenHands.startConversation(conversation.conversation_id, providers);\n```",
            "File Operations": "```\n// Upload files to workspace\nconst result = await OpenHands.uploadFiles(conversationId, files);\n\n// Download workspace\nconst zipBlob = await OpenHands.getWorkspaceZip(conversationId);\n```",
            "Git Operations": "```\n// Search repositories\nconst repos = await GitService.searchGitRepositories(query, perPage, provider);\n\n// Get branches\nconst branches = await GitService.getRepositoryBranches(repository, page);\n```"
          },
          "Future Enhancements": {
            "Planned Improvements": [
              "WebSocket integration for real-time updates",
              "Enhanced caching mechanisms",
              "Improved error recovery strategies",
              "Extended microagent management capabilities",
              "Advanced search and filtering options"
            ],
            "Scalability Considerations": [
              "Connection pooling optimization",
              "Request batching improvements",
              "Progressive loading implementations",
              "Enhanced pagination strategies"
            ]
          },
          "Dependencies": {
            "Internal Dependencies": [
              "[frontend_state_management](frontend_state_management.md): State synchronization",
              "[server_and_api](server_and_api.md): Backend API endpoints",
              "[storage_system](storage_system.md): Data persistence",
              "[git_integrations](git_integrations.md): Version control operations"
            ],
            "External Dependencies": [
              "**Axios**: HTTP client library",
              "**TypeScript**: Type safety and development experience",
              "**Browser APIs**: File handling and blob operations"
            ]
          },
          "Conclusion": "The API Services module provides a robust, type-safe, and comprehensive interface layer that abstracts the complexity of backend communications while providing a clean, consistent API for frontend components. Its modular design, comprehensive error handling, and integration with the broader OpenHands ecosystem make it a critical component for the application's functionality and user experience."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "action_processing",
      "description": null,
      "content": {
        "Action Processing Module": {
          "Overview": {
            "Key Responsibilities": [
              "**Response Parsing**: Convert raw LLM responses into structured action strings",
              "**Action Parsing**: Transform action strings into executable Action objects",
              "**Error Handling**: Provide robust error handling for unparseable responses",
              "**Extensibility**: Support multiple parsing strategies through a plugin-like architecture"
            ]
          },
          "Architecture": "```\ngraph TB\n    subgraph \"Action Processing Module\"\n        RP[ResponseParser]\n        AP[ActionParser]\n        APE[ActionParseError]\n    end\n    \n    subgraph \"External Dependencies\"\n        LLM[LLM Response]\n        ACTION[Action Object]\n        EVENT[Event System]\n    end\n    \n    subgraph \"Core Agent System\"\n        AGENT[Agent]\n        STATE[State Management]\n    end\n    \n    LLM --> RP\n    RP --> AP\n    AP --> ACTION\n    ACTION --> EVENT\n    \n    AGENT -.-> RP\n    STATE -.-> RP\n    \n    AP -.-> APE\n    RP -.-> APE\n    \n    classDef moduleClass fill:#e1f5fe\n    classDef externalClass fill:#f3e5f5\n    classDef coreClass fill:#e8f5e8\n    \n    class RP,AP,APE moduleClass\n    class LLM,ACTION,EVENT externalClass\n    class AGENT,STATE coreClass\n```",
          "Core Components": {
            "ResponseParser (Abstract Base Class)": {
              "Key Methods": [
                "**`parse(response: Any) -> Action`**: Main entry point that converts a raw LLM response into an Action object",
                "**`parse_response(response: Any) -> str`**: Extracts the action string from the raw response",
                "**`parse_action(action_str: str) -> Action`**: Converts an action string into an Action object using registered parsers"
              ],
              "Design Pattern": "The ResponseParser implements a **Template Method Pattern** where the parsing process is broken down into discrete steps:\n\n['Parse the raw response to extract action string', 'Iterate through registered ActionParsers to find a suitable parser', 'Use the selected parser to create the Action object']"
            },
            "ActionParser (Abstract Base Class)": {
              "Key Methods": [
                "**`check_condition(action_str: str) -> bool`**: Determines if this parser can handle the given action string",
                "**`parse(action_str: str) -> Action`**: Converts the action string into a concrete Action object"
              ],
              "Chain of Responsibility": "```\nsequenceDiagram\n    participant RP as ResponseParser\n    participant AP1 as ActionParser1\n    participant AP2 as ActionParser2\n    participant AP3 as ActionParser3\n    \n    RP->>AP1: check_condition(action_str)\n    AP1-->>RP: False\n    \n    RP->>AP2: check_condition(action_str)\n    AP2-->>RP: True\n    \n    RP->>AP2: parse(action_str)\n    AP2-->>RP: Action object\n```"
            },
            "ActionParseError": "A specialized exception class for handling parsing failures, providing detailed error information for debugging and logging purposes."
          },
          "Data Flow": "```\nflowchart TD\n    A[LLM Response] --> B[ResponseParser.parse]\n    B --> C[parse_response]\n    C --> D[Action String]\n    D --> E[parse_action]\n    E --> F{Find Suitable Parser}\n    \n    F --> G[ActionParser1.check_condition]\n    G --> H{Can Parse?}\n    H -->|No| I[ActionParser2.check_condition]\n    H -->|Yes| J[ActionParser1.parse]\n    \n    I --> K{Can Parse?}\n    K -->|No| L[ActionParser3.check_condition]\n    K -->|Yes| M[ActionParser2.parse]\n    \n    L --> N{Can Parse?}\n    N -->|No| O[ActionParseError]\n    N -->|Yes| P[ActionParser3.parse]\n    \n    J --> Q[Action Object]\n    M --> Q\n    P --> Q\n    \n    O --> R[Exception Raised]\n    Q --> S[Return to Agent]\n    \n    classDef processClass fill:#e3f2fd\n    classDef errorClass fill:#ffebee\n    classDef successClass fill:#e8f5e8\n    \n    class A,B,C,D,E,F,G,I,L processClass\n    class O,R errorClass\n    class Q,S successClass\n```",
          "Integration with Core System": {
            "Relationship with Agent Management": "The action_processing module is tightly integrated with the [agent_management](agent_management.md) module:\n\n```\ngraph LR\n    subgraph \"Agent Management\"\n        AGENT[Agent.step]\n        LLM_CALL[LLM Interaction]\n    end\n    \n    subgraph \"Action Processing\"\n        RP[ResponseParser]\n        AP[ActionParser]\n    end\n    \n    subgraph \"Events & Actions\"\n        ACTION[Action Object]\n        EVENT[Event Stream]\n    end\n    \n    AGENT --> LLM_CALL\n    LLM_CALL --> RP\n    RP --> AP\n    AP --> ACTION\n    ACTION --> EVENT\n    EVENT --> AGENT\n```",
            "Relationship with Events and Actions": "The module produces Action objects that are part of the [events_and_actions](events_and_actions.md) system:\n\n['**Input**: Raw LLM responses (strings, dictionaries, or other formats)', '**Output**: Structured Action objects that inherit from the Event base class', '**Error Handling**: ActionParseError exceptions for unparseable responses']",
            "Relationship with State Management": "The parsing process may depend on current system state from [state_management](state_management.md):\n\n['Parsers may need access to current state to determine parsing context', 'State information can influence which parser is selected', 'Parsed actions may affect subsequent state transitions']"
          },
          "Implementation Patterns": {
            "Extensibility Pattern": "The module uses a **Strategy Pattern** combined with **Chain of Responsibility**:\n\n```\n# Example implementation pattern\nclass ConcreteResponseParser(ResponseParser):\n    def __init__(self):\n        super().__init__()\n        # Register specific parsers in order of priority\n        self.action_parsers = [\n            HighPriorityActionParser(),\n            MediumPriorityActionParser(),\n            FallbackActionParser()\n        ]\n    \n    def parse_response(self, response: Any) -> str:\n        # Extract action string from response\n        pass\n    \n    def parse_action(self, action_str: str) -> Action:\n        for parser in self.action_parsers:\n            if parser.check_condition(action_str):\n                return parser.parse(action_str)\n        raise ActionParseError(\"No suitable parser found\")\n```",
            "Error Handling Pattern": "```\ngraph TD\n    A[Parse Attempt] --> B{Success?}\n    B -->|Yes| C[Return Action]\n    B -->|No| D[Log Error Details]\n    D --> E[Raise ActionParseError]\n    E --> F[Agent Error Handling]\n    F --> G{Retry?}\n    G -->|Yes| H[Generate New Response]\n    G -->|No| I[Fallback Action]\n    H --> A\n```"
          },
          "Configuration and Customization": {
            "Parser Registration": "Concrete implementations can customize parsing behavior by:\n\n['**Parser Selection**: Choosing which ActionParser implementations to include', '**Parser Ordering**: Arranging parsers by priority or specificity', '**Custom Parsers**: Implementing domain-specific ActionParser subclasses']",
            "Response Format Support": "The abstract design allows support for various LLM response formats:\n\n['**Text-based responses**: Simple string parsing', '**Structured responses**: JSON or XML parsing', '**Multi-modal responses**: Handling images, code blocks, etc.']"
          },
          "Error Handling and Debugging": {
            "Common Error Scenarios": [
              "**Malformed Responses**: LLM returns unparseable content",
              "**Unknown Action Types**: Response contains unrecognized action formats",
              "**Missing Parameters**: Action string lacks required parameters",
              "**Type Conversion Errors**: Parameter values cannot be converted to expected types"
            ],
            "Debugging Support": "The ActionParseError provides detailed error information:\n\n```\ntry:\n    action = parser.parse(response)\nexcept ActionParseError as e:\n    logger.error(f\"Failed to parse action: {e.error}\")\n    # Error contains specific details about parsing failure\n```"
          },
          "Performance Considerations": {
            "Parser Efficiency": [
              "**Early Termination**: Chain of responsibility stops at first successful parser",
              "**Condition Checking**: Lightweight `check_condition` methods for fast filtering",
              "**Parser Ordering**: Most common parsers should be registered first"
            ],
            "Memory Management": [
              "**Stateless Parsers**: ActionParser instances should be stateless for reusability",
              "**Response Caching**: Consider caching parsed responses for repeated use"
            ]
          },
          "Future Extensions": {
            "Potential Enhancements": [
              "**Parallel Parsing**: Support for concurrent parser evaluation",
              "**Machine Learning Integration**: AI-powered parser selection",
              "**Dynamic Parser Registration**: Runtime parser addition/removal",
              "**Validation Framework**: Built-in action validation before execution",
              "**Metrics Collection**: Parsing performance and success rate tracking"
            ],
            "Integration Opportunities": [
              "**Security Integration**: Connect with [security_system](security_system.md) for action validation",
              "**LLM Integration**: Enhanced integration with [llm_integration](llm_integration.md) for response preprocessing",
              "**Runtime Integration**: Direct connection with [runtime_system](runtime_system.md) for action execution"
            ]
          },
          "Related Documentation": [
            "[core_agent_system](core_agent_system.md) - Parent system architecture",
            "[agent_management](agent_management.md) - Agent implementation details",
            "[events_and_actions](events_and_actions.md) - Action and Event system",
            "[state_management](state_management.md) - System state handling",
            "[llm_integration](llm_integration.md) - LLM interaction patterns"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "provider_implementations",
      "description": null,
      "content": {
        "Provider Implementations Module": {
          "Overview": "The `provider_implementations` module provides concrete implementations of Git service providers within the OpenHands system. This module serves as the foundation for integrating with major Git hosting platforms including GitHub, GitLab, and Bitbucket. Each provider implementation extends the base Git service architecture with platform-specific functionality while maintaining a consistent interface for the broader system.\n\nThe module implements the adapter pattern to provide unified access to different Git platforms, handling authentication, API communication, and data transformation specific to each provider's requirements.",
          "Architecture": "```\ngraph TB\n    subgraph \"Provider Implementations Layer\"\n        GHB[GitHubMixinBase]\n        GLB[GitLabMixinBase]\n        BBB[BitBucketMixinBase]\n    end\n    \n    subgraph \"Service Foundation Layer\"\n        BGS[BaseGitService]\n        GS[GitService]\n    end\n    \n    subgraph \"Protocol Layer\"\n        HC[HTTPClient]\n        RM[RequestMethod]\n    end\n    \n    subgraph \"External APIs\"\n        GHAPI[GitHub API]\n        GLAPI[GitLab API]\n        BBAPI[Bitbucket API]\n    end\n    \n    GHB --> BGS\n    GLB --> BGS\n    BBB --> BGS\n    \n    GHB --> HC\n    GLB --> HC\n    BBB --> HC\n    \n    BGS --> GS\n    \n    GHB --> GHAPI\n    GLB --> GLAPI\n    BBB --> BBAPI\n    \n    classDef provider fill:#e1f5fe\n    classDef foundation fill:#f3e5f5\n    classDef protocol fill:#e8f5e8\n    classDef external fill:#fff3e0\n    \n    class GHB,GLB,BBB provider\n    class BGS,GS foundation\n    class HC,RM protocol\n    class GHAPI,GLAPI,BBAPI external\n```",
          "Core Components": {
            "GitHubMixinBase": "The GitHub provider implementation that handles GitHub-specific API interactions and authentication patterns.\n\n**Key Features:**\n\n['OAuth Bearer token authentication', 'GitHub REST API v3 integration', 'GraphQL API support for complex queries', 'Automatic token refresh handling', 'GitHub-specific error handling and response parsing']\n\n**Authentication Flow:**\n\n```\nsequenceDiagram\n    participant Client\n    participant GHB as GitHubMixinBase\n    participant GH as GitHub API\n    participant Store as Settings Store\n    \n    Client->>GHB: Request operation\n    GHB->>Store: Get latest token\n    Store-->>GHB: Return token\n    GHB->>GH: API request with Bearer token\n    alt Token expired\n        GH-->>GHB: 401 Unauthorized\n        GHB->>Store: Refresh token\n        Store-->>GHB: New token\n        GHB->>GH: Retry with new token\n    end\n    GH-->>GHB: API response\n    GHB-->>Client: Processed response\n```",
            "GitLabMixinBase": "The GitLab provider implementation supporting both GitLab.com and self-hosted GitLab instances.\n\n**Key Features:**\n\n['Bearer token authentication', 'Support for self-hosted GitLab instances', 'GraphQL API integration', 'Project ID extraction and URL encoding', 'Content-type aware response handling']\n\n**Project ID Handling:**\n\n```\nflowchart TD\n    A[Repository String] --> B{Contains domain?}\n    B -->|Yes| C[Extract domain/owner/repo]\n    B -->|No| D[Use owner/repo format]\n    C --> E[URL encode as owner%2Frepo]\n    D --> E\n    E --> F[Use as GitLab Project ID]\n```",
            "BitBucketMixinBase": "The Bitbucket provider implementation with support for both OAuth and Basic authentication.\n\n**Key Features:**\n\n['Dual authentication support (OAuth Bearer and Basic Auth)', 'Pagination handling for large datasets', 'Workspace/repository slug parsing', 'Repository metadata extraction', 'Microagent file discovery']\n\n**Authentication Strategy:**\n\n```\nflowchart TD\n    A[Token Input] --> B{Contains colon?}\n    B -->|Yes| C[Base64 encode as Basic Auth]\n    B -->|No| D[Use as Bearer token]\n    C --> E[Authorization: Basic <encoded>]\n    D --> F[Authorization: Bearer <token>]\n    E --> G[API Request]\n    F --> G\n```"
          },
          "Data Flow": {
            "Request Processing Flow": "```\nflowchart TD\n    A[Client Request] --> B[Provider Mixin]\n    B --> C[Get Headers]\n    C --> D[Token Available?]\n    D -->|No| E[Get Latest Token]\n    D -->|Yes| F[Make HTTP Request]\n    E --> F\n    F --> G[Response Status]\n    G -->|401| H[Token Expired?]\n    G -->|Success| I[Parse Response]\n    G -->|Error| J[Handle Error]\n    H -->|Yes| K[Refresh Token]\n    H -->|No| J\n    K --> F\n    I --> L[Return Data]\n    J --> M[Throw Exception]\n```",
            "User Information Retrieval": "```\nsequenceDiagram\n    participant C as Client\n    participant P as Provider\n    participant API as Git Provider API\n    \n    C->>P: get_user()\n    P->>P: _get_headers()\n    P->>API: GET /user\n    API-->>P: User data response\n    P->>P: Parse to User object\n    P-->>C: Standardized User\n    \n    Note over P: Each provider maps<br/>platform-specific fields<br/>to common User structure\n```"
          },
          "Component Interactions": {
            "Provider Integration Pattern": "```\nclassDiagram\n    class BaseGitService {\n        +token: SecretStr\n        +refresh: bool\n        +get_latest_token()\n        +verify_access()\n        +get_user()\n    }\n    \n    class HTTPClient {\n        +execute_request()\n        +handle_http_status_error()\n        +handle_http_error()\n    }\n    \n    class GitHubMixinBase {\n        +BASE_URL: str\n        +GRAPHQL_URL: str\n        +_get_headers()\n        +_make_request()\n        +execute_graphql_query()\n    }\n    \n    class GitLabMixinBase {\n        +BASE_URL: str\n        +GRAPHQL_URL: str\n        +_extract_project_id()\n        +execute_graphql_query()\n    }\n    \n    class BitBucketMixinBase {\n        +BASE_URL: str\n        +_extract_owner_and_repo()\n        +_fetch_paginated_data()\n        +_parse_repository()\n    }\n    \n    BaseGitService <|-- GitHubMixinBase\n    BaseGitService <|-- GitLabMixinBase\n    BaseGitService <|-- BitBucketMixinBase\n    \n    HTTPClient <|-- GitHubMixinBase\n    HTTPClient <|-- GitLabMixinBase\n    HTTPClient <|-- BitBucketMixinBase\n```"
          },
          "Error Handling Strategy": {
            "HTTP Error Processing": "```\nflowchart TD\n    A[HTTP Request] --> B[Response Received]\n    B --> C{Status Code}\n    C -->|2xx| D[Success Path]\n    C -->|401| E[Token Expired]\n    C -->|4xx| F[Client Error]\n    C -->|5xx| G[Server Error]\n    \n    E --> H[Refresh Token]\n    H --> I[Retry Request]\n    I --> C\n    \n    F --> J[handle_http_status_error]\n    G --> J\n    J --> K[Throw Specific Exception]\n    \n    D --> L[Parse Response]\n    L --> M[Return Data]\n```"
          },
          "Integration Points": {
            "Service Foundation Integration": "The provider implementations integrate with the [service_foundation](service_foundation.md) module through:\n\n['**BaseGitService**: Provides the common interface and base functionality', '**GitService**: Defines the service contract for Git operations', '**User Model**: Standardized user representation across providers', '**Repository Model**: Common repository metadata structure']",
            "Authentication Flow": "```\nsequenceDiagram\n    participant App as Application\n    participant Provider as Provider Mixin\n    participant Store as Settings Store\n    participant API as Git Provider API\n    \n    App->>Provider: Initialize with token\n    Provider->>Store: Store token securely\n    \n    loop For each API call\n        Provider->>Store: Get current token\n        Store-->>Provider: Return token\n        Provider->>API: Request with token\n        alt Token valid\n            API-->>Provider: Success response\n        else Token expired\n            API-->>Provider: 401 Unauthorized\n            Provider->>Store: Request token refresh\n            Store-->>Provider: New token\n            Provider->>API: Retry with new token\n            API-->>Provider: Success response\n        end\n    end\n```"
          },
          "Configuration and Setup": {
            "Provider-Specific Configuration": "Each provider requires specific configuration parameters:\n\n**GitHub:**\n\n['Base URL: `https://api.github.com`', 'GraphQL URL: `https://api.github.com/graphql`', 'Authentication: OAuth Bearer token', 'Headers: GitHub API v3 Accept header']\n\n**GitLab:**\n\n['Base URL: Configurable (GitLab.com or self-hosted)', 'GraphQL URL: `{base_url}/api/graphql`', 'Authentication: OAuth Bearer token', 'Project ID: URL-encoded namespace/project format']\n\n**Bitbucket:**\n\n['Base URL: `https://api.bitbucket.org/2.0`', 'Authentication: OAuth Bearer or Basic Auth', 'Pagination: Cursor-based pagination support', 'Repository format: workspace/repo_slug']"
          },
          "Performance Considerations": {
            "Request Optimization": "```\nflowchart LR\n    A[Request] --> B[Token Cache]\n    B --> C[HTTP Connection Pool]\n    C --> D[Response Cache]\n    D --> E[Parsed Data]\n    \n    subgraph \"Optimization Strategies\"\n        F[Token Reuse]\n        G[Connection Pooling]\n        H[Response Caching]\n        I[Pagination Handling]\n    end\n```",
            "Pagination Strategies": [
              "**GitHub**: Link header-based pagination",
              "**GitLab**: Link header with total count",
              "**Bitbucket**: Cursor-based pagination with next URL"
            ]
          },
          "Security Features": {
            "Token Management": "```\nflowchart TD\n    A[Token Input] --> B[SecretStr Wrapper]\n    B --> C[Secure Storage]\n    C --> D[Runtime Access]\n    D --> E[Automatic Refresh]\n    E --> F[Secure Disposal]\n    \n    subgraph \"Security Measures\"\n        G[No Plain Text Logging]\n        H[Memory Protection]\n        I[Automatic Expiry]\n        J[Refresh Mechanism]\n    end\n```"
          },
          "Extension Points": {
            "Adding New Providers": "To add a new Git provider:\n\n['**Create Provider Mixin**: Extend `BaseGitService` and `HTTPClient`', '**Implement Required Methods**: `_get_headers()`, `_make_request()`, `get_user()`', '**Handle Authentication**: Provider-specific token handling', '**Error Mapping**: Map provider errors to standard exceptions', '**Data Transformation**: Convert provider responses to standard models']",
            "Custom Authentication": "```\nflowchart TD\n    A[Custom Provider] --> B[Implement _get_headers]\n    B --> C[Handle Token Format]\n    C --> D[Implement Refresh Logic]\n    D --> E[Error Handling]\n    E --> F[Integration Testing]\n```"
          },
          "Dependencies": {
            "Internal Dependencies": [
              "[service_foundation](service_foundation.md): Base service interfaces and models",
              "[events_and_actions](events_and_actions.md): Event handling for Git operations",
              "[storage_system](storage_system.md): Token and settings storage"
            ],
            "External Dependencies": [
              "`httpx`: Async HTTP client for API communication",
              "`pydantic`: Data validation and SecretStr handling",
              "Provider-specific API libraries and authentication flows"
            ]
          },
          "Testing Strategy": {
            "Provider Testing Pattern": "```\nflowchart TD\n    A[Unit Tests] --> B[Mock API Responses]\n    B --> C[Authentication Tests]\n    C --> D[Error Handling Tests]\n    D --> E[Integration Tests]\n    E --> F[Live API Tests]\n    \n    subgraph \"Test Categories\"\n        G[Token Management]\n        H[Request/Response]\n        I[Error Scenarios]\n        J[Pagination]\n    end\n```"
          },
          "Future Enhancements": {
            "Planned Improvements": [
              "**Rate Limiting**: Implement provider-specific rate limiting",
              "**Caching Layer**: Add response caching for frequently accessed data",
              "**Webhook Support**: Integrate with provider webhook systems",
              "**Advanced Authentication**: Support for App installations and JWT tokens",
              "**Metrics Collection**: Add performance and usage metrics"
            ],
            "Extensibility Roadmap": "```\ntimeline\n    title Provider Implementation Roadmap\n    \n    section Current\n        GitHub Support    : GitHub REST API\n                          : GitHub GraphQL\n                          : OAuth Bearer Auth\n        \n        GitLab Support    : GitLab REST API\n                          : Self-hosted Support\n                          : Project ID Handling\n        \n        Bitbucket Support : Bitbucket REST API\n                          : Dual Auth Methods\n                          : Pagination Support\n    \n    section Near Term\n        Enhanced Features : Rate Limiting\n                          : Response Caching\n                          : Webhook Integration\n    \n    section Future\n        New Providers     : Azure DevOps\n                          : Gitea Support\n                          : Custom Git Servers\n```\n\nThis module serves as the critical bridge between the OpenHands system and external Git hosting platforms, providing a unified interface while handling the complexities of each provider's unique API characteristics and authentication requirements."
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "event_streaming",
      "description": null,
      "content": {
        "Event Streaming Module": {
          "Overview": "The event_streaming module provides the core infrastructure for real-time event distribution and persistent storage within the OpenHands system. It implements a publish-subscribe pattern with asynchronous event processing, enabling decoupled communication between system components while maintaining event persistence and ordering guarantees.\n\nThis module serves as the backbone for system-wide event coordination, handling everything from agent actions to runtime observations, ensuring all components can react to system state changes in real-time while maintaining a complete audit trail.",
          "Architecture": "The event streaming system is built around two primary abstractions:\n\n['**EventStreamSubscriber**: Defines subscriber types and manages real-time event distribution', '**EventStoreABC**: Provides the abstract interface for event persistence and retrieval']\n\n```\ngraph TB\n    subgraph \"Event Streaming Architecture\"\n        ES[EventStream] --> |implements| ESA[EventStoreABC]\n        ES --> |manages| SUB[Subscribers]\n        ES --> |processes| Q[Event Queue]\n        \n        subgraph \"Subscriber Types\"\n            AC[AGENT_CONTROLLER]\n            SRV[SERVER]\n            RT[RUNTIME]\n            MEM[MEMORY]\n            RES[RESOLVER]\n            MAIN[MAIN]\n            TEST[TEST]\n        end\n        \n        SUB --> AC\n        SUB --> SRV\n        SUB --> RT\n        SUB --> MEM\n        SUB --> RES\n        SUB --> MAIN\n        SUB --> TEST\n        \n        subgraph \"Storage Layer\"\n            FS[FileStore]\n            CACHE[Page Cache]\n            SECRETS[Secret Management]\n        end\n        \n        ES --> FS\n        ES --> CACHE\n        ES --> SECRETS\n    end\n```",
          "Core Components": {
            "EventStreamSubscriber": "An enumeration defining the different types of subscribers in the system:\n\n['**AGENT_CONTROLLER**: Handles agent lifecycle and coordination events', '**SERVER**: Processes web server and API-related events  ', '**RUNTIME**: Manages runtime environment events', '**MEMORY**: Handles memory and state persistence events', '**RESOLVER**: Processes resolution and conflict management events', '**MAIN**: Handles main application flow events', '**TEST**: Manages testing and validation events']",
            "EventStoreABC": "Abstract base class defining the interface for event storage and retrieval:\n\n```\nclass EventStoreABC:\n    def search_events(self, start_id: int = 0, end_id: int | None = None, \n                     reverse: bool = False, filter: EventFilter | None = None,\n                     limit: int | None = None) -> Iterable[Event]\n    \n    def get_event(self, id: int) -> Event\n    def get_latest_event(self) -> Event\n    def get_latest_event_id(self) -> int\n```",
            "EventStream Implementation": "The concrete implementation provides:\n\n['**Real-time Event Distribution**: Asynchronous pub-sub with thread-safe operations', '**Persistent Storage**: File-based event persistence with caching', '**Secret Management**: Automatic secret redaction in stored events', '**Queue Processing**: Background thread for event processing', '**Subscriber Management**: Dynamic subscription/unsubscription with cleanup']"
          },
          "Event Flow Architecture": "```\nsequenceDiagram\n    participant C as Component\n    participant ES as EventStream\n    participant Q as Queue\n    participant S as Subscribers\n    participant FS as FileStore\n    \n    C->>ES: add_event(event, source)\n    ES->>ES: assign ID & timestamp\n    ES->>ES: replace secrets\n    ES->>FS: persist event\n    ES->>Q: enqueue event\n    \n    loop Background Processing\n        Q->>S: distribute to subscribers\n        S->>S: execute callbacks\n    end\n```",
          "Data Flow Patterns": "```\nflowchart LR\n    subgraph \"Event Ingestion\"\n        E[Event] --> V[Validation]\n        V --> ID[ID Assignment]\n        ID --> TS[Timestamp]\n        TS --> SR[Secret Replacement]\n    end\n    \n    subgraph \"Persistence Layer\"\n        SR --> JSON[JSON Serialization]\n        JSON --> CACHE[Page Cache]\n        JSON --> FILE[File Storage]\n    end\n    \n    subgraph \"Distribution Layer\"\n        SR --> QUEUE[Event Queue]\n        QUEUE --> DIST[Distributor]\n        DIST --> SUB1[Subscriber 1]\n        DIST --> SUB2[Subscriber 2]\n        DIST --> SUBN[Subscriber N]\n    end\n```",
          "Component Interactions": "```\ngraph TB\n    subgraph \"System Integration\"\n        ES[EventStream] --> |stores| EF[Event Foundation]\n        ES --> |uses| SS[Storage System]\n        ES --> |coordinates with| CAS[Core Agent System]\n        ES --> |serves| SAS[Server and API]\n        \n        subgraph \"Event Foundation\"\n            EV[Events]\n            ACT[Actions] \n            OBS[Observations]\n        end\n        \n        subgraph \"Storage Integration\"\n            FS[FileStore]\n            CONV[ConversationStore]\n        end\n        \n        subgraph \"Agent Integration\"\n            CTRL[Agent Controller]\n            STATE[State Management]\n        end\n        \n        EF --> EV\n        EF --> ACT\n        EF --> OBS\n        \n        SS --> FS\n        SS --> CONV\n        \n        CAS --> CTRL\n        CAS --> STATE\n    end\n```",
          "Key Features": {
            "Thread-Safe Event Processing": "The EventStream uses multiple synchronization mechanisms:\n\n['**Threading.Lock**: Protects critical sections during event addition', '**Queue.Queue**: Thread-safe event queuing', '**ThreadPoolExecutor**: Isolated callback execution per subscriber', '**Event Loop Management**: Separate async loops for each callback']",
            "Caching Strategy": "Events are cached in pages to optimize read performance:\n\n['**Write Page Cache**: Accumulates events before writing to storage', '**Cache Size Management**: Configurable page sizes for memory efficiency', '**Lazy Loading**: Cache pages are loaded on-demand during reads']",
            "Secret Management": "Automatic secret redaction ensures sensitive data doesn't persist:\n\n['**Configurable Secrets**: Dynamic secret dictionary updates', '**Recursive Replacement**: Deep traversal of event data structures', '**Protected Fields**: System metadata fields are preserved']",
            "Error Handling": "Robust error handling across async operations:\n\n[\"**Callback Isolation**: Errors in one subscriber don't affect others\", '**Resource Cleanup**: Automatic cleanup of threads and event loops', '**Graceful Shutdown**: Coordinated shutdown with pending task completion']"
          },
          "Integration Points": {
            "With Event Foundation": [
              "Consumes [Event](event_foundation.md) objects for processing",
              "Handles [Action](event_foundation.md) and [Observation](event_foundation.md) events",
              "Maintains event ordering and causality chains"
            ],
            "With Storage System": [
              "Uses [FileStore](storage_system.md) for persistent event storage",
              "Integrates with [ConversationStore](storage_system.md) for session management",
              "Provides event retrieval for conversation reconstruction"
            ],
            "With Core Agent System": [
              "Distributes events to [Agent Controllers](core_agent_system.md)",
              "Coordinates with [State Management](core_agent_system.md) for consistency",
              "Supports agent lifecycle events"
            ],
            "With Server and API": [
              "Provides real-time event streams to [WebSession](server_and_api.md)",
              "Supports [ConversationManager](server_and_api.md) event coordination",
              "Enables real-time UI updates"
            ]
          },
          "Usage Patterns": {
            "Basic Subscription": "```\n# Subscribe to events\nevent_stream.subscribe(\n    EventStreamSubscriber.AGENT_CONTROLLER,\n    callback=handle_agent_event,\n    callback_id=\"agent_handler\"\n)\n\n# Add events\nevent_stream.add_event(action_event, EventSource.AGENT)\n```",
            "Event Filtering and Search": "```\n# Search with filters\nevents = event_stream.search_events(\n    start_id=100,\n    filter=EventFilter(\n        include_types=(ActionEvent,),\n        source=EventSource.AGENT\n    ),\n    limit=50\n)\n```",
            "Session Management": "```\n# Check session existence\nexists = await session_exists(session_id, file_store, user_id)\n\n# Initialize event stream for session\nstream = EventStream(session_id, file_store, user_id)\n```"
          },
          "Performance Considerations": {
            "Scalability Features": [
              "**Asynchronous Processing**: Non-blocking event distribution",
              "**Page-based Caching**: Efficient bulk operations for large event streams",
              "**Thread Pool Management**: Controlled resource usage per subscriber",
              "**Queue-based Decoupling**: Prevents slow subscribers from blocking producers"
            ],
            "Memory Management": [
              "**Bounded Queues**: Prevents unbounded memory growth",
              "**Cache Eviction**: Automatic cleanup of old cache pages",
              "**Resource Cleanup**: Proper disposal of threads and event loops",
              "**Secret Scrubbing**: Prevents sensitive data accumulation"
            ]
          },
          "Configuration": "The module supports various configuration options:\n\n['**Cache Size**: Configurable page sizes for performance tuning', '**Thread Pool Sizes**: Adjustable concurrency per subscriber', '**Queue Timeouts**: Configurable blocking behavior', '**Secret Patterns**: Dynamic secret replacement rules']",
          "Error Scenarios and Recovery": {
            "Common Error Patterns": [
              "**Subscriber Callback Failures**: Isolated error handling prevents cascade failures",
              "**Storage Failures**: Graceful degradation with in-memory fallback",
              "**Thread Pool Exhaustion**: Automatic resource management and cleanup",
              "**Queue Overflow**: Backpressure mechanisms and monitoring"
            ],
            "Recovery Mechanisms": [
              "**Automatic Retry**: Built-in retry logic for transient failures",
              "**Circuit Breaker**: Protection against cascading failures",
              "**Graceful Degradation**: Continued operation with reduced functionality",
              "**Resource Cleanup**: Automatic cleanup of failed components"
            ]
          },
          "Monitoring and Observability": "The module provides extensive logging and metrics:\n\n['**Event Processing Metrics**: Throughput and latency tracking', '**Subscriber Health**: Callback success/failure rates', '**Storage Performance**: File I/O and cache hit rates', '**Resource Usage**: Thread pool and memory utilization']\n\nThis event streaming infrastructure enables the OpenHands system to maintain real-time coordination between all components while ensuring complete event persistence and auditability."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "security_infrastructure",
      "description": null,
      "content": {
        "Security Infrastructure Module": {
          "Overview": "The security_infrastructure module serves as the primary security gateway for enterprise deployments, handling:\n\n['**Authentication State Management**: Maintains and refreshes authentication tokens automatically', '**Cookie Security**: Implements secure cookie handling with domain and SameSite policies', '**Terms of Service Enforcement**: Ensures users have accepted current terms before accessing protected resources', '**Email Verification**: Enforces email verification requirements for sensitive operations', '**Token Lifecycle Management**: Handles token refresh, validation, and cleanup', '**Security Policy Enforcement**: Applies security rules consistently across all API endpoints']",
          "Architecture": "```\ngraph TB\n    subgraph \"Security Infrastructure\"\n        SACM[SetAuthCookieMiddleware]\n        \n        subgraph \"Authentication Flow\"\n            KC[Keycloak Cookie]\n            JWT[JWT Token]\n            TOS[TOS Validation]\n            EMAIL[Email Verification]\n        end\n        \n        subgraph \"Token Management\"\n            TM[Token Manager]\n            RT[Refresh Token]\n            AT[Access Token]\n        end\n        \n        subgraph \"Security Policies\"\n            SP[Security Policies]\n            RLE[Rate Limiting]\n            AUTH[Authorization]\n        end\n    end\n    \n    subgraph \"External Dependencies\"\n        UA[UserAuth System]\n        CONFIG[Server Config]\n        KEYCLOAK[Keycloak IdP]\n        GITLAB[GitLab Integration]\n    end\n    \n    SACM --> KC\n    SACM --> JWT\n    SACM --> TOS\n    SACM --> EMAIL\n    SACM --> TM\n    TM --> RT\n    TM --> AT\n    SACM --> SP\n    \n    SACM --> UA\n    SACM --> CONFIG\n    TM --> KEYCLOAK\n    SACM --> GITLAB\n    \n    classDef middleware fill:#e1f5fe\n    classDef auth fill:#f3e5f5\n    classDef token fill:#e8f5e8\n    classDef policy fill:#fff3e0\n    classDef external fill:#fafafa\n    \n    class SACM middleware\n    class KC,JWT,TOS,EMAIL auth\n    class TM,RT,AT token\n    class SP,RLE,AUTH policy\n    class UA,CONFIG,KEYCLOAK,GITLAB external\n```",
          "Core Components": {
            "SetAuthCookieMiddleware": {
              "Key Responsibilities": [
                "**Authentication State Validation**",
                [
                  "Validates Keycloak authentication cookies",
                  "Handles JWT token decoding and verification",
                  "Manages authentication state across requests"
                ],
                "**Token Lifecycle Management**",
                [
                  "Automatically refreshes expired tokens",
                  "Updates authentication cookies with new tokens",
                  "Handles token cleanup on authentication errors"
                ],
                "**Security Policy Enforcement**",
                [
                  "Enforces Terms of Service acceptance",
                  "Validates email verification status",
                  "Applies endpoint-specific security rules"
                ],
                "**Error Handling and Recovery**",
                [
                  "Graceful handling of authentication errors",
                  "Automatic logout on invalid tokens",
                  "Cookie cleanup on authentication failures"
                ]
              ],
              "Authentication Flow": "```\nsequenceDiagram\n    participant Client\n    participant Middleware as SetAuthCookieMiddleware\n    participant UserAuth\n    participant TokenManager\n    participant Keycloak\n    participant GitLab\n    \n    Client->>Middleware: Request with Cookie\n    Middleware->>Middleware: Extract keycloak_auth cookie\n    Middleware->>Middleware: Validate TOS acceptance\n    Middleware->>UserAuth: Get user authentication\n    \n    alt Token needs refresh\n        UserAuth->>TokenManager: Refresh tokens\n        TokenManager->>Keycloak: Request new tokens\n        Keycloak-->>TokenManager: New access/refresh tokens\n        TokenManager-->>UserAuth: Updated tokens\n        UserAuth->>UserAuth: Mark as refreshed\n    end\n    \n    Middleware->>Middleware: Process request\n    \n    alt Authentication refreshed\n        Middleware->>Client: Set updated cookie\n        Middleware->>GitLab: Schedule repo sync\n    end\n    \n    alt Email not verified\n        Middleware-->>Client: 403 Forbidden\n    end\n    \n    alt Authentication error\n        Middleware->>TokenManager: Logout\n        Middleware->>Client: Delete auth cookie\n        Middleware-->>Client: 401 Unauthorized\n    end\n```"
            }
          },
          "Security Policies": {
            "Terms of Service Enforcement": "The middleware implements a three-state TOS acceptance model:\n\n[\"**`null`**: User hasn't re-logged in since TOS changes (legacy state)\", \"**`false`**: User was shown TOS but hasn't accepted\", '**`true`**: User has accepted current TOS']\n\n```\nstateDiagram-v2\n    [*] --> Legacy: accepted_tos = null\n    [*] --> NotAccepted: accepted_tos = false\n    [*] --> Accepted: accepted_tos = true\n    \n    Legacy --> Accepted: User re-authenticates\n    NotAccepted --> Accepted: User accepts TOS\n    Accepted --> [*]: Continue request\n    NotAccepted --> TosError: Access protected endpoint\n    \n    state TosError {\n        [*] --> Block: Return 403\n    }\n```",
            "Email Verification Requirements": "Email verification is enforced for most API endpoints except:\n\n['`/api/email/*` - Email management endpoints', '`/api/settings` - User settings', '`/api/logout` - Logout endpoint', '`/api/authenticate` - Authentication endpoint']",
            "Endpoint Protection Strategy": "The middleware applies different security policies based on request characteristics:\n\n```\nflowchart TD\n    Request[Incoming Request] --> Method{Method = OPTIONS?}\n    Method -->|Yes| Allow[Allow Request]\n    Method -->|No| Path{Check Path}\n    \n    Path --> API{Starts with /api?}\n    Path --> MCP{Starts with /mcp?}\n    \n    API -->|Yes| Excluded{Excluded endpoint?}\n    API -->|No| Allow\n    MCP -->|Yes| Protect[Apply Protection]\n    MCP -->|No| Allow\n    \n    Excluded -->|Yes| Allow\n    Excluded -->|No| Protect\n    \n    Protect --> Auth[Check Authentication]\n    Auth --> TOS[Validate TOS]\n    TOS --> Email[Check Email Verification]\n    Email --> Process[Process Request]\n    \n    classDef decision fill:#fff2cc\n    classDef action fill:#d5e8d4\n    classDef protect fill:#f8cecc\n    \n    class Method,Path,API,MCP,Excluded decision\n    class Allow,Process action\n    class Protect,Auth,TOS,Email protect\n```"
          },
          "Integration Points": {
            "Authentication System Integration": "The security infrastructure integrates closely with the [authentication_system](authentication_system.md) module:\n\n['**UserAuth Interface**: Leverages the abstract UserAuth system for authentication operations', '**Token Management**: Coordinates with token managers for refresh operations', '**Settings Integration**: Accesses user settings through the authentication system']",
            "Server Infrastructure Integration": "Integration with [web_infrastructure](web_infrastructure.md) components:\n\n['**Rate Limiting**: Works alongside RateLimitMiddleware for comprehensive request control', '**Cookie Management**: Coordinates with server routing for secure cookie handling', \"**Error Handling**: Integrates with FastAPI's error handling mechanisms\"]",
            "Configuration Management": "Relies on [security_configuration](security_configuration.md) for:\n\n['**JWT Secret Management**: Secure token signing and validation', '**Security Analyzer Configuration**: Integration with security analysis tools', '**Confirmation Mode**: Enhanced security validation when enabled']"
          },
          "Security Features": {
            "Token Security": [
              "**JWT Validation**",
              [
                "Cryptographic signature verification",
                "Expiration time validation",
                "Issuer and audience validation"
              ],
              "**Secure Cookie Handling**",
              [
                "HttpOnly cookies for XSS protection",
                "Secure flag for HTTPS enforcement",
                "SameSite policies for CSRF protection",
                "Domain-specific cookie scoping"
              ],
              "**Token Refresh Strategy**",
              [
                "Automatic token refresh before expiration",
                "Graceful handling of refresh failures",
                "Background token cleanup"
              ]
            ],
            "Error Handling and Logging": "```\ngraph LR\n    subgraph \"Error Types\"\n        ENE[EmailNotVerifiedError]\n        NCE[NoCredentialsError]\n        AE[AuthError]\n        TNAE[TosNotAcceptedError]\n    end\n    \n    subgraph \"Response Actions\"\n        R403[403 Forbidden]\n        R401[401 Unauthorized]\n        LOGOUT[Automatic Logout]\n        COOKIE[Delete Cookie]\n    end\n    \n    subgraph \"Logging\"\n        INFO[Info Level]\n        WARN[Warning Level]\n        DEBUG[Debug Level]\n    end\n    \n    ENE --> R403\n    TNAE --> R403\n    NCE --> R401\n    NCE --> INFO\n    AE --> R401\n    AE --> LOGOUT\n    AE --> COOKIE\n    AE --> WARN\n    \n    classDef error fill:#ffebee\n    classDef response fill:#e3f2fd\n    classDef log fill:#f1f8e9\n    \n    class ENE,NCE,AE,TNAE error\n    class R403,R401,LOGOUT,COOKIE response\n    class INFO,WARN,DEBUG log\n```"
          },
          "Configuration": {
            "Environment Variables": "The security infrastructure relies on several configuration parameters:\n\n```\n# JWT Configuration\njwt_secret: \"your-jwt-secret-key\"\n\n# Cookie Configuration\ncookie_domain: \"your-domain.com\"\ncookie_samesite: \"lax\"\n\n# Security Features\nconfirmation_mode: false\nsecurity_analyzer: \"default\"\n```",
            "Deployment Considerations": [
              "**HTTPS Requirements**",
              [
                "Secure cookies require HTTPS in production",
                "Localhost development allows HTTP for testing"
              ],
              "**Domain Configuration**",
              [
                "Proper cookie domain configuration for subdomain access",
                "SameSite policy alignment with frontend architecture"
              ],
              "**Token Expiration**",
              [
                "Balance between security and user experience",
                "Automatic refresh reduces authentication friction"
              ]
            ]
          },
          "Monitoring and Observability": {
            "Security Metrics": "The middleware provides comprehensive logging for security monitoring:\n\n['**Authentication Events**: Login, logout, token refresh', '**Security Violations**: TOS violations, email verification failures', '**Error Patterns**: Authentication errors, token validation failures', '**Performance Metrics**: Middleware processing time, token refresh frequency']",
            "Audit Trail": "Security events are logged with structured data for audit purposes:\n\n```\n{\n  \"event\": \"auth_error\",\n  \"user_id\": \"user-123\",\n  \"error_type\": \"InvalidTokenError\",\n  \"endpoint\": \"/api/protected\",\n  \"timestamp\": \"2024-01-01T12:00:00Z\",\n  \"ip_address\": \"192.168.1.1\"\n}\n```"
          },
          "Best Practices": {
            "Security Hardening": [
              "**Token Management**",
              [
                "Use strong JWT secrets with sufficient entropy",
                "Implement proper token rotation policies",
                "Monitor for token abuse patterns"
              ],
              "**Cookie Security**",
              [
                "Always use Secure flag in production",
                "Implement proper SameSite policies",
                "Use HttpOnly to prevent XSS attacks"
              ],
              "**Error Handling**",
              [
                "Avoid information disclosure in error messages",
                "Implement consistent error responses",
                "Log security events for monitoring"
              ]
            ],
            "Performance Optimization": [
              "**Caching Strategy**",
              [
                "Cache user authentication state appropriately",
                "Minimize database queries for token validation",
                "Use efficient JWT libraries"
              ],
              "**Request Processing**",
              [
                "Optimize middleware order for performance",
                "Implement early returns for excluded endpoints",
                "Use async/await patterns consistently"
              ]
            ]
          },
          "Related Documentation": [
            "[authentication_system](authentication_system.md) - Core authentication interfaces and implementations",
            "[web_infrastructure](web_infrastructure.md) - Server middleware and request handling",
            "[security_configuration](security_configuration.md) - Security configuration management",
            "[enterprise_server](enterprise_server.md) - Enterprise server architecture overview"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "router_system",
      "description": null,
      "content": {
        "Router System Documentation": {
          "Overview": "The Router System is a sophisticated LLM routing framework within OpenHands that enables intelligent selection and delegation between multiple Language Learning Models (LLMs) based on request characteristics, content type, and resource constraints. This system provides a unified interface while optimizing performance, cost, and capabilities by routing requests to the most appropriate underlying LLM.",
          "Architecture": "The Router System is built around the `RouterLLM` base class, which inherits from the core `LLM` class and provides a foundation for implementing various routing strategies. The system seamlessly integrates with the broader [LLM Integration](llm_integration.md) module while maintaining full compatibility with existing OpenHands components.\n\n```\ngraph TB\n    subgraph \"Router System Architecture\"\n        RouterLLM[RouterLLM Base Class]\n        MultimodalRouter[MultimodalRouter Implementation]\n        NoopRouter[Noop Router]\n        \n        subgraph \"Core Components\"\n            LLMRegistry[LLM Registry]\n            ModelRoutingConfig[Model Routing Config]\n            AgentConfig[Agent Config]\n        end\n        \n        subgraph \"Available LLMs\"\n            PrimaryLLM[Primary LLM]\n            SecondaryLLM[Secondary LLM]\n            RoutingLLMs[Additional Routing LLMs]\n        end\n        \n        RouterLLM --> MultimodalRouter\n        RouterLLM --> NoopRouter\n        RouterLLM --> LLMRegistry\n        RouterLLM --> ModelRoutingConfig\n        RouterLLM --> AgentConfig\n        \n        MultimodalRouter --> PrimaryLLM\n        MultimodalRouter --> SecondaryLLM\n        RouterLLM --> RoutingLLMs\n    end\n```",
          "Core Components": {
            "RouterLLM Base Class": "The `RouterLLM` class serves as the foundation for all routing implementations:\n\n**Key Features:**\n\n['**Unified Interface**: Inherits from `LLM` class, providing seamless integration', '**Multiple LLM Management**: Manages primary and routing LLMs through configuration', '**Dynamic Routing**: Routes requests based on implemented `_select_llm()` logic', '**State Management**: Tracks current LLM and routing decisions', '**Transparent Delegation**: Delegates all non-routing operations to selected LLM']\n\n**Core Methods:**\n\n['`_select_llm(messages)`: Abstract method for routing logic implementation', '`completion`: Intercepts and routes completion requests', '`_get_llm_by_key(llm_key)`: Retrieves LLM instances by configuration key']",
            "MultimodalRouter Implementation": "The `MultimodalRouter` provides intelligent routing based on content type and resource constraints:\n\n**Routing Logic:**\n\n['**Multimodal Content Detection**: Routes to primary LLM when images are detected', '**Token Limit Management**: Switches to primary LLM when secondary model limits are exceeded', '**Fallback Strategy**: Maintains state to prevent repeated token limit violations']\n\n**Configuration Requirements:**\n\n['Requires `secondary_model` configuration in `llms_for_routing`', 'Primary LLM serves as the high-capability fallback model', 'Secondary LLM optimized for text-only, cost-effective processing']"
          },
          "System Integration": "```\ngraph LR\n    subgraph \"OpenHands Core\"\n        Agent[Agent]\n        Controller[Controller]\n        ActionParser[Action Parser]\n    end\n    \n    subgraph \"Router System\"\n        RouterLLM[Router LLM]\n        MultimodalRouter[Multimodal Router]\n    end\n    \n    subgraph \"LLM Integration\"\n        LLMRegistry[LLM Registry]\n        BaseLLM[Base LLM]\n        AsyncLLM[Async LLM]\n    end\n    \n    subgraph \"Configuration\"\n        AgentConfig[Agent Config]\n        ModelRoutingConfig[Model Routing Config]\n        LLMConfig[LLM Config]\n    end\n    \n    Agent --> RouterLLM\n    Controller --> RouterLLM\n    ActionParser --> RouterLLM\n    \n    RouterLLM --> LLMRegistry\n    RouterLLM --> BaseLLM\n    MultimodalRouter --> RouterLLM\n    \n    RouterLLM --> AgentConfig\n    AgentConfig --> ModelRoutingConfig\n    ModelRoutingConfig --> LLMConfig\n    \n    LLMRegistry --> BaseLLM\n    LLMRegistry --> AsyncLLM\n```",
          "Configuration System": {
            "Model Routing Configuration": "The routing system is configured through the `ModelRoutingConfig` class:\n\n```\nclass ModelRoutingConfig:\n    router_name: str = 'noop_router'  # Router implementation to use\n    llms_for_routing: dict[str, LLMConfig] = {}  # Additional LLMs for routing\n```\n\n**Configuration Options:**\n\n['`noop_router`: No routing, uses primary LLM directly', '`multimodal_router`: Routes based on content type and resource constraints', 'Custom router implementations can be registered in `ROUTER_LLM_REGISTRY`']",
            "Integration with Agent Configuration": "The router system integrates seamlessly with agent configuration:\n\n```\nsequenceDiagram\n    participant AC as Agent Config\n    participant MRC as Model Routing Config\n    participant LR as LLM Registry\n    participant RL as Router LLM\n    participant LLM as Selected LLM\n    \n    AC->>MRC: Get routing config\n    AC->>LR: Request router instance\n    LR->>RL: Create router with config\n    RL->>RL: Initialize available LLMs\n    \n    Note over RL: Request Processing\n    RL->>RL: _select_llm(messages)\n    RL->>LLM: Route to selected LLM\n    LLM->>RL: Return response\n    RL->>AC: Return response\n```"
          },
          "Routing Strategies": {
            "Content-Based Routing": "The system supports intelligent routing based on message content:\n\n**Multimodal Detection:**\n\n['Analyzes messages for image content', 'Routes multimodal requests to vision-capable models', 'Maintains text-only requests on cost-effective models']\n\n**Token Management:**\n\n['Monitors token usage against model limits', 'Implements fallback strategies for oversized requests', 'Tracks state to prevent repeated limit violations']",
            "Performance Optimization": "```\ngraph TD\n    subgraph \"Routing Decision Flow\"\n        Start[Incoming Request]\n        ContentCheck{Contains Images?}\n        TokenCheck{Exceeds Token Limit?}\n        StateCheck{Max Token Exceeded?}\n        \n        PrimaryRoute[Route to Primary LLM]\n        SecondaryRoute[Route to Secondary LLM]\n        \n        Start --> ContentCheck\n        ContentCheck -->|Yes| PrimaryRoute\n        ContentCheck -->|No| StateCheck\n        StateCheck -->|Yes| PrimaryRoute\n        StateCheck -->|No| TokenCheck\n        TokenCheck -->|Yes| PrimaryRoute\n        TokenCheck -->|No| SecondaryRoute\n    end\n```"
          },
          "Metrics and Monitoring": "The router system integrates with the OpenHands metrics framework:\n\n**Tracked Metrics:**\n\n['Routing decisions and patterns', 'Cost optimization through model selection', 'Token usage across different models', 'Response latency by routing choice']\n\n**Integration Points:**\n\n['Inherits metrics tracking from base `LLM` class', 'Delegates metrics collection to selected LLM instances', 'Provides routing-specific logging and debugging']",
          "Extension Points": {
            "Custom Router Implementation": "Developers can create custom routing strategies by extending `RouterLLM`:\n\n```\nclass CustomRouter(RouterLLM):\n    def _select_llm(self, messages: list[Message]) -> str:\n        # Implement custom routing logic\n        # Return key from self.available_llms\n        pass\n```\n\n**Registration:**\nCustom routers must be registered in the `ROUTER_LLM_REGISTRY` for discovery.",
            "Configuration Extension": "The system supports extensible configuration through:\n\n['Custom LLM configurations in `llms_for_routing`', 'Flexible router naming and registration', 'Integration with existing configuration validation']"
          },
          "Error Handling and Resilience": "The router system implements robust error handling:\n\n**Fallback Mechanisms:**\n\n['Automatic fallback to primary LLM on routing failures', 'Graceful handling of unavailable routing LLMs', 'State recovery for persistent routing decisions']\n\n**Validation:**\n\n['Configuration validation at initialization', 'Runtime validation of LLM availability', 'Clear error messages for misconfiguration']",
          "Performance Considerations": {
            "Optimization Strategies": "**Lazy Initialization:**\n\n['LLM instances created on-demand', 'Configuration validation deferred until use', 'Memory-efficient multi-model management']\n\n**Caching and State Management:**\n\n['Routing decisions cached to avoid repeated analysis', 'State persistence for token limit tracking', 'Efficient message analysis for routing decisions']",
            "Resource Management": "The system optimizes resource usage through:\n\n['Selective model loading based on routing needs', 'Shared configuration and registry management', 'Efficient delegation to underlying LLM instances']"
          },
          "Dependencies": "The Router System depends on several core OpenHands modules:\n\n['**[Core LLM Implementation](core_llm_implementation.md)**: Base LLM functionality and interfaces', '**[Core Configuration](core_configuration.md)**: Configuration management and validation', '**[Utility Mixins](utility_mixins.md)**: Retry and debug functionality through inheritance']",
          "Future Enhancements": "**Planned Features:**\n\n['Advanced routing algorithms based on request complexity', 'Dynamic model selection based on real-time performance metrics', 'Integration with cost optimization and budget management', 'Support for streaming and async routing decisions']\n\n**Extensibility:**\n\n['Plugin architecture for custom routing strategies', 'Integration with external model selection services', 'Advanced analytics and routing optimization tools']\n\nThe Router System represents a sophisticated approach to LLM management, providing the flexibility to optimize for different use cases while maintaining a simple, unified interface for the rest of the OpenHands system."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "kubernetes_configuration",
      "description": null,
      "content": {
        "Kubernetes Configuration Module": {
          "Overview": "The `kubernetes_configuration` module provides configuration management for Kubernetes-based runtime environments in OpenHands. This module defines the `KubernetesConfig` class, which encapsulates all necessary parameters for deploying and managing OpenHands runtime pods in Kubernetes clusters.\n\nThe module serves as the configuration foundation for the [kubernetes_runtime](runtime_implementations.md#kubernetes-runtime) implementation, enabling containerized execution environments with full Kubernetes orchestration capabilities including resource management, networking, storage, and security configurations.",
          "Architecture": "```\ngraph TB\n    subgraph \"Configuration Layer\"\n        KC[KubernetesConfig]\n        TOML[TOML Configuration]\n    end\n    \n    subgraph \"Runtime Layer\"\n        KR[KubernetesRuntime]\n        K8sClient[Kubernetes Client]\n    end\n    \n    subgraph \"Kubernetes Resources\"\n        Pod[Runtime Pod]\n        PVC[Persistent Volume Claim]\n        Svc[Services]\n        Ing[Ingress]\n    end\n    \n    TOML --> KC\n    KC --> KR\n    KR --> K8sClient\n    K8sClient --> Pod\n    K8sClient --> PVC\n    K8sClient --> Svc\n    K8sClient --> Ing\n    \n    classDef config fill:#e1f5fe\n    classDef runtime fill:#f3e5f5\n    classDef k8s fill:#e8f5e8\n    \n    class KC,TOML config\n    class KR,K8sClient runtime\n    class Pod,PVC,Svc,Ing k8s\n```",
          "Core Components": {
            "KubernetesConfig": {
              "Resource Management": [
                "**CPU and Memory**: Configurable resource requests and limits for runtime pods",
                "**Storage**: Persistent volume claim configuration with customizable size and storage class",
                "**Privileged Mode**: Support for Docker-in-Docker scenarios"
              ],
              "Networking Configuration": [
                "**Ingress**: Domain configuration and TLS secret management",
                "**Service Discovery**: Internal cluster networking setup",
                "**Port Management**: Container and service port configuration"
              ],
              "Security and Access Control": [
                "**Image Pull Secrets**: Support for private container registries",
                "**Node Scheduling**: Node selector and toleration configurations",
                "**TLS Configuration**: Secure ingress with certificate management"
              ],
              "Namespace Management": [
                "**Multi-tenancy**: Configurable Kubernetes namespace isolation",
                "**Resource Organization**: Logical grouping of related resources"
              ]
            }
          },
          "Configuration Schema": "```\nclassDiagram\n    class KubernetesConfig {\n        +str namespace\n        +str ingress_domain\n        +str pvc_storage_size\n        +str|None pvc_storage_class\n        +str resource_cpu_request\n        +str resource_memory_request\n        +str resource_memory_limit\n        +str|None image_pull_secret\n        +str|None ingress_tls_secret\n        +str|None node_selector_key\n        +str|None node_selector_val\n        +str|None tolerations_yaml\n        +bool privileged\n        +from_toml_section(data: dict) dict[str, KubernetesConfig]\n    }\n    \n    class BaseModel {\n        <<Pydantic>>\n    }\n    \n    KubernetesConfig --|> BaseModel\n```",
          "Configuration Parameters": {
            "Core Settings": "| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `namespace` | `str` | `'default'` | Kubernetes namespace for OpenHands resources |\n| `ingress_domain` | `str` | `'localhost'` | Base domain for ingress resources |\n| `privileged` | `bool` | `False` | Enable privileged mode for Docker-in-Docker |",
            "Resource Configuration": "| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `resource_cpu_request` | `str` | `'1'` | CPU request for runtime pods |\n| `resource_memory_request` | `str` | `'1Gi'` | Memory request for runtime pods |\n| `resource_memory_limit` | `str` | `'2Gi'` | Memory limit for runtime pods |",
            "Storage Configuration": "| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `pvc_storage_size` | `str` | `'2Gi'` | Size of persistent volume claim |\n| `pvc_storage_class` | `str \\| None` | `None` | Storage class for PVCs |",
            "Security Configuration": "| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `image_pull_secret` | `str \\| None` | `None` | Secret for private registries |\n| `ingress_tls_secret` | `str \\| None` | `None` | TLS secret for ingress |",
            "Scheduling Configuration": "| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `node_selector_key` | `str \\| None` | `None` | Node selector key for pod scheduling |\n| `node_selector_val` | `str \\| None` | `None` | Node selector value for pod scheduling |\n| `tolerations_yaml` | `str \\| None` | `None` | YAML string defining pod tolerations |"
          },
          "Integration with Runtime System": "```\nsequenceDiagram\n    participant Config as Configuration\n    participant Runtime as KubernetesRuntime\n    participant K8sAPI as Kubernetes API\n    participant Resources as K8s Resources\n    \n    Config->>Runtime: Initialize with KubernetesConfig\n    Runtime->>Runtime: Validate configuration\n    Runtime->>K8sAPI: Create Kubernetes client\n    Runtime->>Resources: Create PVC with storage config\n    Runtime->>Resources: Create Pod with resource limits\n    Runtime->>Resources: Create Services for networking\n    Runtime->>Resources: Create Ingress with domain config\n    Resources-->>Runtime: Resources created successfully\n    Runtime-->>Config: Runtime ready\n```",
          "Configuration Loading": "The module supports loading configuration from TOML files through the `from_toml_section` class method:\n\n```\n# Example TOML configuration\n[kubernetes]\nnamespace = \"openhands-dev\"\ningress_domain = \"dev.example.com\"\npvc_storage_size = \"5Gi\"\npvc_storage_class = \"fast-ssd\"\nresource_cpu_request = \"2\"\nresource_memory_request = \"2Gi\"\nresource_memory_limit = \"4Gi\"\nimage_pull_secret = \"registry-secret\"\ningress_tls_secret = \"tls-secret\"\nprivileged = true\n```",
          "Error Handling and Validation": "```\nflowchart TD\n    A[Load TOML Config] --> B{Valid Configuration?}\n    B -->|Yes| C[Create KubernetesConfig]\n    B -->|No| D[ValidationError]\n    C --> E[Initialize Runtime]\n    D --> F[Raise ValueError]\n    E --> G{Runtime Creation Success?}\n    G -->|Yes| H[Runtime Ready]\n    G -->|No| I[Runtime Error]\n    \n    classDef success fill:#d4edda\n    classDef error fill:#f8d7da\n    classDef process fill:#fff3cd\n    \n    class C,E,H success\n    class D,F,I error\n    class A,B,G process\n```",
          "Dependencies": "The kubernetes_configuration module integrates with several other system components:\n\n['**[runtime_system](runtime_system.md)**: Provides the base runtime infrastructure', '**[kubernetes_runtime](runtime_implementations.md#kubernetes-runtime)**: Implements the actual Kubernetes runtime using this configuration', '**[core_configuration](core_configuration.md)**: Part of the broader configuration management system', '**[security_configuration](security_configuration.md)**: Works alongside security settings for comprehensive runtime security']",
          "Usage Examples": {
            "Basic Configuration": "```\nfrom openhands.core.config.kubernetes_config import KubernetesConfig\n\n# Create basic configuration\nconfig = KubernetesConfig(\n    namespace=\"my-namespace\",\n    ingress_domain=\"my-app.example.com\",\n    pvc_storage_size=\"10Gi\"\n)\n```",
            "Advanced Configuration with Security": "```\n# Advanced configuration with security and scheduling\nconfig = KubernetesConfig(\n    namespace=\"production\",\n    ingress_domain=\"prod.example.com\",\n    pvc_storage_size=\"50Gi\",\n    pvc_storage_class=\"premium-ssd\",\n    resource_cpu_request=\"4\",\n    resource_memory_request=\"8Gi\",\n    resource_memory_limit=\"16Gi\",\n    image_pull_secret=\"prod-registry-secret\",\n    ingress_tls_secret=\"prod-tls-cert\",\n    node_selector_key=\"workload-type\",\n    node_selector_val=\"openhands\",\n    privileged=True\n)\n```",
            "Loading from TOML": "```\n# Load from TOML configuration\ntoml_data = {\n    \"namespace\": \"staging\",\n    \"ingress_domain\": \"staging.example.com\",\n    \"pvc_storage_size\": \"20Gi\",\n    \"resource_cpu_request\": \"2\",\n    \"resource_memory_request\": \"4Gi\"\n}\n\nconfig_mapping = KubernetesConfig.from_toml_section(toml_data)\nkubernetes_config = config_mapping[\"kubernetes\"]\n```"
          },
          "Best Practices": {
            "Resource Planning": [
              "**CPU Requests**: Set based on expected workload requirements",
              "**Memory Limits**: Configure to prevent resource exhaustion",
              "**Storage Size**: Plan for workspace and temporary file requirements"
            ],
            "Security Considerations": [
              "**Image Pull Secrets**: Always use for production deployments with private registries",
              "**TLS Configuration**: Enable TLS for all external-facing ingress resources",
              "**Privileged Mode**: Only enable when Docker-in-Docker functionality is required"
            ],
            "Operational Excellence": [
              "**Namespace Isolation**: Use dedicated namespaces for different environments",
              "**Node Scheduling**: Leverage node selectors and tolerations for workload placement",
              "**Storage Classes**: Choose appropriate storage classes based on performance requirements"
            ]
          },
          "Monitoring and Observability": "The configuration enables comprehensive monitoring through:\n\n['**Resource Metrics**: CPU, memory, and storage utilization tracking', '**Network Monitoring**: Ingress and service connectivity metrics', '**Security Auditing**: Access control and privilege escalation monitoring', '**Operational Metrics**: Pod lifecycle and scheduling effectiveness']\n\nThis module forms the foundation for robust, scalable, and secure Kubernetes-based runtime environments in the OpenHands system."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "agent_management",
      "description": null,
      "content": {
        "Agent Management Module": {
          "Overview": "The agent_management module is a critical component of the [core_agent_system](core_agent_system.md) that establishes the contract and lifecycle management for AI agents. It provides:\n\n['**Agent Registry**: A centralized system for registering and retrieving agent classes', '**Agent Lifecycle**: Methods for initialization, execution, and reset operations', '**LLM Integration**: Seamless integration with the [llm_integration](llm_integration.md) system', '**Tool Management**: Support for MCP (Model Context Protocol) tools and function calling', '**System Message Generation**: Automated system message creation with prompt management']",
          "Architecture": "```\ngraph TB\n    subgraph \"Agent Management Core\"\n        A[Agent Abstract Base Class]\n        AR[Agent Registry]\n        PM[Prompt Manager]\n        SM[System Message Generation]\n    end\n    \n    subgraph \"Dependencies\"\n        LLM[LLM Registry]\n        CONFIG[Agent Config]\n        EVENTS[Event System]\n        PLUGINS[Plugin System]\n    end\n    \n    subgraph \"Agent Implementations\"\n        CA[CodeAct Agent]\n        BA[Browsing Agent]\n        VBA[Visual Browsing Agent]\n        LA[Loc Agent]\n        ROA[ReadOnly Agent]\n    end\n    \n    A --> AR\n    A --> PM\n    A --> SM\n    A --> LLM\n    A --> CONFIG\n    A --> EVENTS\n    A --> PLUGINS\n    \n    CA -.-> A\n    BA -.-> A\n    VBA -.-> A\n    LA -.-> A\n    ROA -.-> A\n    \n    style A fill:#e1f5fe\n    style AR fill:#f3e5f5\n    style PM fill:#e8f5e8\n    style SM fill:#fff3e0\n```",
          "Core Components": {
            "Agent Abstract Base Class": {
              "Key Responsibilities": [
                "**Abstract Interface**: Defines the contract that all agent implementations must follow",
                "**Registry Management**: Maintains a centralized registry of available agent types",
                "**LLM Integration**: Manages LLM instances through the registry system",
                "**Tool Management**: Handles MCP tools and function calling capabilities",
                "**Lifecycle Management**: Controls agent execution state and reset operations"
              ],
              "Core Methods": [
                "**`step(state: State) -> Action`**: Abstract method that must be implemented by subclasses to define agent behavior",
                "**`get_system_message() -> SystemMessageAction`**: Generates system messages with tools for agent initialization",
                "**`reset()`**: Resets agent execution state while preserving LLM metrics",
                "**`set_mcp_tools(mcp_tools)`**: Configures MCP tools for the agent"
              ]
            }
          },
          "Agent Registry System": {
            "Registry Operations": [
              "**Registration**: `Agent.register(name, agent_cls)` adds new agent types",
              "**Retrieval**: `Agent.get_cls(name)` gets agent classes by name",
              "**Listing**: `Agent.list_agents()` returns all registered agent names"
            ]
          },
          "Integration with Other Modules": {
            "LLM Integration": "The agent management module integrates closely with the [llm_integration](llm_integration.md) system:\n\n```\ngraph LR\n    subgraph \"Agent Management\"\n        A[Agent Instance]\n        AC[Agent Config]\n    end\n    \n    subgraph \"LLM Integration\"\n        LR[LLM Registry]\n        LLM[LLM Instance]\n    end\n    \n    A --> LR\n    AC --> LR\n    LR --> LLM\n    LLM --> A\n    \n    style A fill:#e1f5fe\n    style LR fill:#f3e5f5\n```",
            "State Management": "Agents interact with the [state_management](state_management.md) system through the `step` method:\n\n```\nsequenceDiagram\n    participant Controller\n    participant Agent\n    participant State\n    participant ActionParser\n    \n    Controller->>Agent: step(state)\n    Agent->>State: read current state\n    State-->>Agent: state information\n    Agent->>Agent: process and decide action\n    Agent-->>Controller: return Action\n    Controller->>ActionParser: parse action\n```",
            "Event System": "Agents generate events through the [events_and_actions](events_and_actions.md) system:\n\n```\ngraph TB\n    A[Agent] --> SM[System Message Action]\n    A --> EA[Event Actions]\n    SM --> ES[Event Stream]\n    EA --> ES\n    ES --> ESS[Event Stream Subscribers]\n    \n    style A fill:#e1f5fe\n    style ES fill:#e8f5e8\n```"
          },
          "Agent Lifecycle": {
            "Lifecycle Phases": [
              "**Initialization**: Agent is created with configuration and LLM registry",
              "**System Message**: Initial system message is generated with tools",
              "**Execution Loop**: Agent processes states and generates actions",
              "**Completion**: Agent marks task as complete",
              "**Reset**: Agent state is reset for new tasks"
            ]
          },
          "Tool Management": {
            "Tool Integration Process": [
              "**Tool Registration**: MCP tools are registered with the agent",
              "**Tool Validation**: Duplicate tools are detected and skipped",
              "**Tool Integration**: Tools are added to the agent's tool list",
              "**System Message**: Tools are included in system messages for LLM context"
            ]
          },
          "Configuration": "Agents are configured through the `AgentConfig` class from the [core_configuration](core_configuration.md) module:\n\n```\ngraph LR\n    subgraph \"Configuration\"\n        AC[Agent Config]\n        CC[CLI Config]\n        SC[Security Config]\n    end\n    \n    subgraph \"Agent\"\n        A[Agent Instance]\n        CM[CLI Mode]\n    end\n    \n    AC --> A\n    CC --> AC\n    SC --> AC\n    A --> CM\n    \n    style A fill:#e1f5fe\n    style AC fill:#f3e5f5\n```",
          "Error Handling": "The module defines specific exceptions for agent management:\n\n['**`AgentAlreadyRegisteredError`**: Thrown when attempting to register a duplicate agent name', '**`AgentNotRegisteredError`**: Thrown when attempting to retrieve an unregistered agent']",
          "Usage Examples": {
            "Registering a New Agent": "```\nfrom openhands.controller.agent import Agent\nfrom openhands.core.config import AgentConfig\n\nclass CustomAgent(Agent):\n    def step(self, state):\n        # Implementation logic\n        pass\n\n# Register the agent\nAgent.register(\"CustomAgent\", CustomAgent)\n\n# Retrieve and instantiate\nagent_cls = Agent.get_cls(\"CustomAgent\")\nagent = agent_cls(config, llm_registry)\n```",
            "Agent Execution": "```\n# Initialize agent\nagent = Agent.get_cls(\"CodeActAgent\")(config, llm_registry)\n\n# Get system message\nsystem_msg = agent.get_system_message()\n\n# Execute agent step\naction = agent.step(current_state)\n\n# Check completion\nif agent.complete:\n    print(\"Task completed\")\n```"
          },
          "Related Modules": [
            "**[core_agent_system](core_agent_system.md)**: Parent module containing the complete agent system",
            "**[agent_implementations](agent_implementations.md)**: Concrete agent implementations",
            "**[llm_integration](llm_integration.md)**: LLM management and integration",
            "**[state_management](state_management.md)**: State tracking and control",
            "**[events_and_actions](events_and_actions.md)**: Event system for agent communication",
            "**[core_configuration](core_configuration.md)**: Configuration management"
          ],
          "Best Practices": [
            "**Agent Implementation**: Always implement the abstract `step` method in subclasses",
            "**Registry Usage**: Use descriptive names when registering agents",
            "**Tool Management**: Validate MCP tools before setting them on agents",
            "**Error Handling**: Handle agent registration and retrieval errors appropriately",
            "**State Management**: Ensure proper state handling in the `step` method",
            "**Resource Cleanup**: Use the `reset` method to clean up agent state between tasks"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "browsing_agents",
      "description": null,
      "content": {
        "Browsing Agents Module": {
          "Overview": {
            "Key Components": [
              "**BrowsingAgent**: Text-based web browsing agent using accessibility trees",
              "**VisualBrowsingAgent**: Enhanced browsing agent with visual screenshot capabilities"
            ]
          },
          "Architecture": "```\ngraph TB\n    subgraph \"Browsing Agents Module\"\n        BA[BrowsingAgent]\n        VBA[VisualBrowsingAgent]\n        BRP[BrowsingResponseParser]\n    end\n    \n    subgraph \"Core Dependencies\"\n        Agent[Agent Base Class]\n        State[State Management]\n        LLM[LLM Integration]\n    end\n    \n    subgraph \"Browser Integration\"\n        BG[BrowserGym]\n        HLA[HighLevelActionSet]\n        AXT[Accessibility Tree]\n    end\n    \n    subgraph \"Events & Actions\"\n        BIA[BrowseInteractiveAction]\n        BOO[BrowserOutputObservation]\n        MA[MessageAction]\n        AFA[AgentFinishAction]\n    end\n    \n    BA --> Agent\n    VBA --> Agent\n    BA --> BRP\n    VBA --> BRP\n    \n    BA --> BG\n    VBA --> BG\n    BG --> HLA\n    BG --> AXT\n    \n    BA --> BIA\n    VBA --> BIA\n    BA --> BOO\n    VBA --> BOO\n    \n    Agent --> State\n    Agent --> LLM\n    \n    BIA --> MA\n    BIA --> AFA\n```",
          "Component Details": {
            "BrowsingAgent": {
              "Key Features": [
                "**Accessibility Tree Navigation**: Uses flattened accessibility trees for page understanding",
                "**Configurable Action Space**: Supports chat, bid (browser element identification), and navigation actions",
                "**Error Recovery**: Implements error accumulation and recovery mechanisms",
                "**Evaluation Mode Support**: Special handling for benchmark evaluations (WebArena, MiniWoB)"
              ],
              "Configuration Options": "```\n# Environment variables affecting behavior\nUSE_NAV = True/False          # Enable/disable navigation actions\nUSE_CONCISE_ANSWER = True/False  # Return concise answers for benchmarks\n```",
              "Action Flow": "```\nsequenceDiagram\n    participant User\n    participant BA as BrowsingAgent\n    participant BG as BrowserGym\n    participant LLM\n    \n    User->>BA: Initialize with goal\n    BA->>BG: Setup action space\n    \n    loop Browsing Session\n        BA->>BG: Execute browser action\n        BG->>BA: Return observation\n        BA->>BA: Process accessibility tree\n        BA->>LLM: Generate next action\n        LLM->>BA: Return action command\n        \n        alt Error Detected\n            BA->>BA: Increment error counter\n            BA->>LLM: Add error recovery prompt\n        end\n        \n        alt Task Complete\n            BA->>User: Send message/finish\n        end\n    end\n```"
            },
            "VisualBrowsingAgent": {
              "Enhanced Features": [
                "**Screenshot Integration**: Processes webpage screenshots with Set-of-Marks (SOM) annotations",
                "**Multi-modal Input**: Handles both text and image inputs for goal specification",
                "**Tab Management**: Advanced tab handling and navigation",
                "**Visual Element Detection**: Enhanced element identification through visual cues"
              ],
              "Visual Processing Pipeline": "```\nflowchart TD\n    A[Browser State] --> B[Capture Screenshot]\n    B --> C[Generate SOM Annotations]\n    C --> D[Extract Accessibility Tree]\n    D --> E[Combine Visual + Text Data]\n    E --> F[LLM Processing]\n    F --> G[Generate Action]\n    G --> H[Execute Browser Command]\n    H --> A\n    \n    subgraph \"Multi-modal Input\"\n        I[Goal Text]\n        J[Goal Images]\n        K[Screenshot]\n        L[AX Tree]\n    end\n    \n    I --> E\n    J --> E\n    K --> E\n    L --> E\n```"
            }
          },
          "Integration Points": {
            "Core Agent System Integration": "Both browsing agents inherit from the base [Agent](core_agent_system.md) class and integrate with:\n\n['**State Management**: Uses [TrafficControlState](state_management.md) for session state', '**Action Processing**: Leverages [ActionParser](action_processing.md) for command interpretation', '**LLM Integration**: Connects to [LLM services](llm_integration.md) for decision making']",
            "Event System Integration": "The agents interact with the [events_and_actions](events_and_actions.md) system through:\n\n['**BrowseInteractiveAction**: Primary action type for browser commands', '**BrowserOutputObservation**: Receives browser state and feedback', '**MessageAction**: Communicates with users', '**AgentFinishAction**: Signals task completion']",
            "Runtime Integration": "Browsing agents operate within the [runtime_system](runtime_system.md) environment:\n\n['**Plugin Requirements**: Minimal sandbox plugin requirements', '**Browser Environment**: Requires browser runtime capabilities', '**Resource Management**: Handles browser process lifecycle']"
          },
          "Data Flow": "```\nflowchart LR\n    subgraph \"Input Processing\"\n        A[User Goal] --> B[System Message]\n        C[Browser State] --> D[Accessibility Tree]\n        E[Screenshots] --> F[Visual Processing]\n    end\n    \n    subgraph \"Agent Processing\"\n        B --> G[Prompt Construction]\n        D --> G\n        F --> G\n        G --> H[LLM Completion]\n        H --> I[Response Parsing]\n    end\n    \n    subgraph \"Action Execution\"\n        I --> J[Browser Action]\n        J --> K[State Update]\n        K --> L[Observation]\n        L --> C\n    end\n    \n    subgraph \"Output Generation\"\n        I --> M[Message to User]\n        I --> N[Task Completion]\n    end\n```",
          "Configuration and Usage": {
            "Basic Configuration": "```\nfrom openhands.agenthub.browsing_agent import BrowsingAgent\nfrom openhands.core.config import AgentConfig\nfrom openhands.llm.llm_registry import LLMRegistry\n\n# Initialize browsing agent\nconfig = AgentConfig()\nllm_registry = LLMRegistry()\nagent = BrowsingAgent(config, llm_registry)\n\n# For visual browsing\nfrom openhands.agenthub.visualbrowsing_agent import VisualBrowsingAgent\nvisual_agent = VisualBrowsingAgent(config, llm_registry)\n```",
            "Action Space Configuration": "The agents support configurable action spaces:\n\n['**chat**: Communication with users', '**bid**: Browser element identification and interaction', '**nav**: Navigation actions (URL changes, back/forward)', '**tab**: Tab management (VisualBrowsingAgent only)', '**infeas**: Infeasibility reporting (VisualBrowsingAgent only)']"
          },
          "Error Handling and Recovery": {
            "Error Accumulation": [
              "Track consecutive errors",
              "Implement error recovery prompts",
              "Fail gracefully after threshold (5 errors)"
            ],
            "Error Types": [
              "Browser action failures",
              "Accessibility tree processing errors",
              "Timeout handling",
              "Element interaction failures"
            ]
          },
          "Performance Considerations": {
            "BrowsingAgent Optimizations": [
              "Lightweight text-based processing",
              "Efficient accessibility tree parsing",
              "Minimal memory footprint"
            ],
            "VisualBrowsingAgent Considerations": [
              "Image processing overhead",
              "Screenshot capture latency",
              "Multi-modal LLM requirements",
              "Higher memory usage"
            ]
          },
          "Evaluation and Benchmarking": {
            "Benchmark Support": [
              "**WebArena**: Web-based task evaluation",
              "**MiniWoB++**: Mini web-based tasks",
              "**VisualWebArena**: Visual web task evaluation"
            ],
            "Evaluation Features": [
              "Concise answer mode",
              "Navigation action control",
              "Initial state handling",
              "Performance metrics collection"
            ]
          },
          "Dependencies": {
            "External Dependencies": [
              "**BrowserGym**: Core browser interaction framework",
              "**Playwright**: Browser automation engine"
            ],
            "Internal Dependencies": [
              "[core_agent_system](core_agent_system.md): Base agent functionality",
              "[events_and_actions](events_and_actions.md): Event handling system",
              "[llm_integration](llm_integration.md): Language model services",
              "[runtime_system](runtime_system.md): Execution environment"
            ]
          },
          "Future Enhancements": {
            "Planned Improvements": [
              "Enhanced visual understanding capabilities",
              "Multi-page task coordination",
              "Advanced error recovery strategies",
              "Performance optimization for large-scale deployments"
            ],
            "Integration Opportunities": [
              "[security_system](security_system.md): Web security analysis",
              "[microagent_system](microagent_system.md): Specialized web task agents",
              "[storage_system](storage_system.md): Session and interaction persistence"
            ]
          },
          "Related Documentation": [
            "[agent_implementations](agent_implementations.md): Overview of all agent types",
            "[core_agent_system](core_agent_system.md): Base agent architecture",
            "[events_and_actions](events_and_actions.md): Event system details",
            "[llm_integration](llm_integration.md): Language model integration",
            "[runtime_system](runtime_system.md): Execution environment"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "security_configuration",
      "description": null,
      "content": {
        "Security Configuration Module": {
          "Overview": "The SecurityConfig class serves as the primary configuration interface for security-related functionalities within OpenHands. It manages settings that control how the system handles security analysis, user confirmations for potentially risky actions, and integration with various security analyzers.",
          "Architecture": "```\ngraph TB\n    subgraph \"Security Configuration Module\"\n        SC[SecurityConfig]\n        SC --> CM[confirmation_mode]\n        SC --> SA[security_analyzer]\n    end\n    \n    subgraph \"Security System Integration\"\n        SEC_SYS[Security System]\n        SEC_SYS --> ANALYZER[SecurityAnalyzer]\n        SEC_SYS --> INV[InvariantAnalyzer]\n        SEC_SYS --> LLM[LLMRiskAnalyzer]\n    end\n    \n    subgraph \"Core Configuration System\"\n        CORE_CONFIG[Core Configuration]\n        CORE_CONFIG --> CLI[CLIConfig]\n        CORE_CONFIG --> K8S[KubernetesConfig]\n        CORE_CONFIG --> MCP[OpenHandsMCPConfig]\n        CORE_CONFIG --> SC\n    end\n    \n    SC -.->|configures| SEC_SYS\n    SC -.->|analyzer selection| ANALYZER\n    \n    style SC fill:#e1f5fe\n    style SEC_SYS fill:#f3e5f5\n    style CORE_CONFIG fill:#e8f5e8\n```",
          "Core Components": {
            "SecurityConfig": {
              "Key Features": [
                "**Validation**: Uses Pydantic for automatic validation and type checking",
                "**TOML Integration**: Supports loading configuration from TOML files",
                "**Strict Mode**: Forbids extra fields to ensure configuration integrity",
                "**Default Values**: Provides sensible defaults for all configuration options"
              ],
              "Configuration Fields": "| Field | Type | Default | Description |\n|-------|------|---------|-------------|\n| `confirmation_mode` | `bool` | `False` | Enables user confirmation prompts for potentially risky actions |\n| `security_analyzer` | `str \\| None` | `None` | Specifies which security analyzer to use for risk assessment |"
            }
          },
          "Configuration Flow": "```\nsequenceDiagram\n    participant TOML as TOML Config File\n    participant SC as SecurityConfig\n    participant SYS as Security System\n    participant ANALYZER as Security Analyzer\n    \n    TOML->>SC: Load [security] section\n    SC->>SC: Validate configuration\n    SC->>SYS: Apply security settings\n    \n    alt security_analyzer specified\n        SYS->>ANALYZER: Initialize selected analyzer\n        ANALYZER->>SYS: Ready for risk assessment\n    end\n    \n    alt confirmation_mode enabled\n        SYS->>SYS: Enable user confirmation prompts\n    end\n```",
          "Integration with Security System": {
            "Security Analyzer Integration": "```\ngraph LR\n    subgraph \"Configuration Layer\"\n        SC[SecurityConfig]\n        SC --> SA_NAME[security_analyzer: str]\n    end\n    \n    subgraph \"Security Analyzer Implementations\"\n        BASE[SecurityAnalyzer]\n        INV[InvariantAnalyzer]\n        LLM[LLMRiskAnalyzer]\n        \n        BASE --> INV\n        BASE --> LLM\n    end\n    \n    SA_NAME -.->|selects| INV\n    SA_NAME -.->|selects| LLM\n    \n    style SC fill:#e1f5fe\n    style BASE fill:#fff3e0\n    style INV fill:#f1f8e9\n    style LLM fill:#fce4ec\n```",
            "Supported Security Analyzers": [
              "**InvariantAnalyzer**: Policy-based security analysis using Docker containers",
              "**LLMRiskAnalyzer**: LLM-driven risk assessment for actions",
              "**Custom Analyzers**: Extensible framework for additional security analyzers"
            ]
          },
          "Configuration Management": {
            "TOML Configuration Loading": "The `from_toml_section` class method enables loading security configuration from TOML files:\n\n```\n# Example TOML configuration\n[security]\nconfirmation_mode = true\nsecurity_analyzer = \"invariant\"\n```",
            "Configuration Validation": "```\nflowchart TD\n    START[Load TOML Data] --> VALIDATE[Validate with Pydantic]\n    VALIDATE --> SUCCESS{Validation Success?}\n    SUCCESS -->|Yes| CREATE[Create SecurityConfig Instance]\n    SUCCESS -->|No| ERROR[Raise ValidationError]\n    CREATE --> RETURN[Return Configuration Mapping]\n    ERROR --> FAIL[Configuration Failed]\n    \n    style START fill:#e3f2fd\n    style CREATE fill:#e8f5e8\n    style ERROR fill:#ffebee\n    style FAIL fill:#ffcdd2\n```"
          },
          "Usage Patterns": {
            "Basic Configuration": "```\nfrom openhands.core.config.security_config import SecurityConfig\n\n# Create with defaults\nconfig = SecurityConfig()\n\n# Create with custom settings\nconfig = SecurityConfig(\n    confirmation_mode=True,\n    security_analyzer=\"invariant\"\n)\n```",
            "TOML Integration": "```\n# Load from TOML section\ntoml_data = {\n    \"confirmation_mode\": True,\n    \"security_analyzer\": \"llm\"\n}\n\nconfig_mapping = SecurityConfig.from_toml_section(toml_data)\nsecurity_config = config_mapping[\"security\"]\n```"
          },
          "Security Considerations": {
            "Confirmation Mode": "When `confirmation_mode` is enabled:\n\n['Users receive prompts before executing potentially risky actions', 'Provides an additional layer of human oversight', 'Integrates with the [events_and_actions](events_and_actions.md) system for action interception']",
            "Analyzer Selection": "The `security_analyzer` field determines the risk assessment strategy:\n\n['**None**: No security analysis performed', '**\"invariant\"**: Uses policy-based analysis with Docker containers', '**\"llm\"**: Leverages LLM-provided risk assessments']"
          },
          "Dependencies": {
            "Internal Dependencies": [
              "**[core_configuration](core_configuration.md)**: Part of the broader configuration system",
              "**[security_system](security_system.md)**: Provides security analyzer implementations",
              "**[events_and_actions](events_and_actions.md)**: Action interception for confirmation mode"
            ],
            "External Dependencies": [
              "**Pydantic**: Configuration validation and serialization",
              "**TOML**: Configuration file format support"
            ]
          },
          "Error Handling": {
            "Common Error Scenarios": [
              "**Invalid Field Types**: Non-boolean values for `confirmation_mode`",
              "**Unknown Analyzers**: Specifying non-existent security analyzers",
              "**Extra Fields**: Including unsupported configuration options",
              "**TOML Parsing**: Malformed TOML configuration files"
            ]
          },
          "Best Practices": {
            "Configuration Management": [
              "**Use TOML Files**: Leverage TOML configuration for environment-specific settings",
              "**Validate Early**: Perform configuration validation during application startup",
              "**Default Safety**: Keep security features disabled by default for backward compatibility",
              "**Documentation**: Document all security configuration options clearly"
            ],
            "Security Settings": [
              "**Enable Confirmation Mode**: For production environments handling sensitive operations",
              "**Choose Appropriate Analyzers**: Select analyzers based on security requirements and infrastructure",
              "**Monitor Configuration**: Log security configuration changes for audit trails",
              "**Test Configurations**: Validate security settings in staging environments"
            ]
          },
          "Future Enhancements": {
            "Planned Features": [
              "**Dynamic Configuration**: Runtime configuration updates without restart",
              "**Multiple Analyzers**: Support for running multiple security analyzers simultaneously",
              "**Risk Thresholds**: Configurable risk level thresholds for different actions",
              "**Audit Logging**: Enhanced logging for security configuration changes"
            ],
            "Extension Points": [
              "**Custom Analyzers**: Framework for implementing domain-specific security analyzers",
              "**Policy Integration**: Integration with external policy management systems",
              "**Compliance Frameworks**: Support for industry-specific compliance requirements"
            ]
          },
          "Related Documentation": [
            "[security_system](security_system.md) - Security analyzer implementations and risk assessment",
            "[core_configuration](core_configuration.md) - Overall configuration management system",
            "[events_and_actions](events_and_actions.md) - Action processing and event handling",
            "[server_and_api](server_and_api.md) - Server-side security middleware integration"
          ]
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "type_system",
      "description": null,
      "content": {
        "Type System Module": {
          "Overview": "The type_system module serves as the foundational type layer for the microagent system, defining:\n\n['Microagent classification and categorization', 'Metadata structures for microagent configuration', 'Response models for API interactions', 'Input/output data contracts']\n\nThis module ensures type safety and provides clear interfaces for microagent operations, supporting the broader [microagent_system](microagent_system.md) architecture.",
          "Architecture": "```\ngraph TB\n    subgraph \"Type System Module\"\n        MT[MicroagentType Enum]\n        IM[InputMetadata Model]\n        MM[MicroagentMetadata Model]\n        MR[MicroagentResponse Model]\n        MCR[MicroagentContentResponse Model]\n    end\n    \n    subgraph \"External Dependencies\"\n        MCP[MCPConfig]\n        PYDANTIC[Pydantic BaseModel]\n        ENUM[Python Enum]\n        DT[datetime]\n    end\n    \n    subgraph \"Dependent Modules\"\n        MA[MicroAgent Implementation]\n        API[API Endpoints]\n        STORAGE[Storage Layer]\n    end\n    \n    MT --> MM\n    IM --> MM\n    MCP --> MM\n    PYDANTIC --> IM\n    PYDANTIC --> MM\n    PYDANTIC --> MR\n    PYDANTIC --> MCR\n    ENUM --> MT\n    DT --> MR\n    \n    MM --> MA\n    MR --> API\n    MCR --> API\n    MT --> STORAGE\n    \n    style MT fill:#e1f5fe\n    style MM fill:#f3e5f5\n    style MR fill:#e8f5e8\n    style MCR fill:#fff3e0\n```",
          "Core Components": {
            "MicroagentType Enum": "The `MicroagentType` enum defines the classification system for different types of microagents:\n\n```\nclass MicroagentType(str, Enum):\n    KNOWLEDGE = 'knowledge'      # Optional microagent, triggered by keywords\n    REPO_KNOWLEDGE = 'repo'      # Always active microagent\n    TASK = 'task'               # Special type for task microagents that require user input\n```\n\n**Type Categories:**\n\n['**KNOWLEDGE**: Optional microagents activated by specific keywords or triggers', '**REPO_KNOWLEDGE**: Always-active microagents that provide repository-wide context', '**TASK**: Interactive microagents requiring user input for task execution']",
            "Metadata Models": {
              "InputMetadata": "Defines the structure for task microagent input specifications:\n\n```\nclass InputMetadata(BaseModel):\n    name: str\n    description: str\n```\n\nThis model ensures that task microagents can clearly specify their input requirements to users.",
              "MicroagentMetadata": "Comprehensive metadata model for all microagent types:\n\n```\nclass MicroagentMetadata(BaseModel):\n    name: str = 'default'\n    type: MicroagentType = Field(default=MicroagentType.REPO_KNOWLEDGE)\n    version: str = Field(default='1.0.0')\n    agent: str = Field(default='CodeActAgent')\n    triggers: list[str] = []\n    inputs: list[InputMetadata] = []\n    mcp_tools: MCPConfig | None = None\n```\n\n**Key Features:**\n\n['**Versioning**: Supports microagent version management', '**Agent Integration**: Links to specific agent implementations from [agent_implementations](agent_implementations.md)', '**Trigger System**: Defines activation keywords for knowledge microagents', '**Input Specification**: Describes required inputs for task microagents', '**MCP Integration**: Optional MCP tools configuration via [mcp_configuration](core_configuration.md)']"
            },
            "Response Models": {
              "MicroagentResponse": "Basic response model for microagent listing endpoints:\n\n```\nclass MicroagentResponse(BaseModel):\n    name: str\n    path: str\n    created_at: datetime\n```\n\nProvides essential metadata without requiring full content parsing.",
              "MicroagentContentResponse": "Detailed response model for individual microagent content:\n\n```\nclass MicroagentContentResponse(BaseModel):\n    content: str\n    path: str\n    triggers: list[str] = []\n    git_provider: str | None = None\n```\n\nIncludes full content and additional context information for microagent execution."
            }
          },
          "Data Flow": "```\nsequenceDiagram\n    participant Client\n    participant API\n    participant TypeSystem\n    participant MicroAgent\n    participant Storage\n    \n    Client->>API: Request microagent list\n    API->>TypeSystem: Create MicroagentResponse\n    TypeSystem->>Storage: Query metadata\n    Storage-->>TypeSystem: Return basic info\n    TypeSystem-->>API: MicroagentResponse objects\n    API-->>Client: JSON response\n    \n    Client->>API: Request specific microagent\n    API->>TypeSystem: Create MicroagentContentResponse\n    TypeSystem->>MicroAgent: Load content\n    MicroAgent-->>TypeSystem: Full content + metadata\n    TypeSystem-->>API: MicroagentContentResponse\n    API-->>Client: Detailed JSON response\n```",
          "Type Relationships": "```\nclassDiagram\n    class MicroagentType {\n        <<enumeration>>\n        +KNOWLEDGE: str\n        +REPO_KNOWLEDGE: str\n        +TASK: str\n    }\n    \n    class InputMetadata {\n        +name: str\n        +description: str\n    }\n    \n    class MicroagentMetadata {\n        +name: str\n        +type: MicroagentType\n        +version: str\n        +agent: str\n        +triggers: list[str]\n        +inputs: list[InputMetadata]\n        +mcp_tools: MCPConfig\n    }\n    \n    class MicroagentResponse {\n        +name: str\n        +path: str\n        +created_at: datetime\n    }\n    \n    class MicroagentContentResponse {\n        +content: str\n        +path: str\n        +triggers: list[str]\n        +git_provider: str\n    }\n    \n    MicroagentMetadata --> MicroagentType\n    MicroagentMetadata --> InputMetadata\n    MicroagentMetadata --> MCPConfig\n```",
          "Integration Points": {
            "Configuration System": [
              "**MCP Integration**: Links to [mcp_configuration](core_configuration.md) for tool configuration",
              "**Agent Selection**: References agent types from [agent_implementations](agent_implementations.md)"
            ],
            "Storage System": [
              "**Metadata Persistence**: Works with [storage_system](storage_system.md) for microagent metadata storage",
              "**Content Management**: Supports file-based microagent storage"
            ],
            "API Layer": [
              "**Response Serialization**: Provides structured responses for [server_and_api](server_and_api.md)",
              "**Type Validation**: Ensures data integrity across API boundaries"
            ]
          },
          "Usage Patterns": {
            "Microagent Registration": "```\n# Define microagent metadata\nmetadata = MicroagentMetadata(\n    name=\"code_reviewer\",\n    type=MicroagentType.KNOWLEDGE,\n    version=\"1.2.0\",\n    agent=\"CodeActAgent\",\n    triggers=[\"review\", \"code quality\", \"lint\"],\n    mcp_tools=mcp_config\n)\n```",
            "Task Microagent Definition": "```\n# Task microagent with input requirements\ntask_metadata = MicroagentMetadata(\n    name=\"bug_fixer\",\n    type=MicroagentType.TASK,\n    inputs=[\n        InputMetadata(\n            name=\"bug_description\",\n            description=\"Detailed description of the bug to fix\"\n        ),\n        InputMetadata(\n            name=\"priority\",\n            description=\"Bug priority level (low, medium, high, critical)\"\n        )\n    ]\n)\n```",
            "API Response Handling": "```\n# List microagents\nresponse = MicroagentResponse(\n    name=\"repo_analyzer\",\n    path=\"/microagents/repo_analyzer.md\",\n    created_at=datetime.now()\n)\n\n# Get microagent content\ncontent_response = MicroagentContentResponse(\n    content=\"# Repository Analyzer\\n...\",\n    path=\"/microagents/repo_analyzer.md\",\n    triggers=[\"analyze\", \"repository\", \"structure\"],\n    git_provider=\"github\"\n)\n```"
          },
          "Validation and Constraints": "The type system enforces several important constraints:\n\n['**Type Consistency**: Ensures microagent types match their operational behavior', '**Input Validation**: Validates that task microagents specify required inputs', '**Trigger Specification**: Ensures knowledge microagents define activation triggers', '**Version Management**: Supports semantic versioning for microagent evolution']",
          "Error Handling": "The type system provides structured error handling through Pydantic validation:\n\n['**Type Validation**: Automatic validation of enum values and data types', '**Required Fields**: Enforcement of mandatory metadata fields', '**Format Validation**: Ensures proper structure for complex fields like triggers and inputs']",
          "Future Considerations": "The type system is designed to support future enhancements:\n\n['**Extended Metadata**: Additional fields for advanced microagent features', '**Type Hierarchies**: Support for microagent inheritance and specialization', '**Dynamic Types**: Runtime type registration and discovery', '**Integration Metadata**: Enhanced integration with external systems']\n\nThis type system provides the foundational structure for the microagent ecosystem, ensuring consistent interfaces and enabling robust microagent management within the OpenHands platform."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "utility_mixins",
      "description": null,
      "content": {
        "Utility Mixins Module": {
          "Overview": "This module contains two core mixin classes:\n\n['**RetryMixin**: Implements configurable retry logic for handling transient LLM failures', '**DebugMixin**: Provides comprehensive logging and debugging capabilities for LLM interactions']\n\nThese mixins are designed to be composed with LLM classes to provide robust error handling and observability without duplicating code across different LLM implementations.",
          "Architecture": "```\nclassDiagram\n    class RetryMixin {\n        +retry_decorator(**kwargs) Callable\n        +log_retry_attempt(retry_state) None\n        -_handle_temperature_adjustment(retry_state)\n    }\n    \n    class DebugMixin {\n        +log_prompt(messages) None\n        +log_response(resp) None\n        +vision_is_active() bool\n        -_format_message_content(message) str\n        -_format_content_element(element) str\n    }\n    \n    class LLM {\n        <<inherits RetryMixin, DebugMixin>>\n        +completion() Callable\n        +get_token_count() int\n        +vision_is_active() bool\n    }\n    \n    class AsyncLLM {\n        <<inherits LLM>>\n        +async_completion() Callable\n    }\n    \n    RetryMixin <|-- LLM\n    DebugMixin <|-- LLM\n    LLM <|-- AsyncLLM\n    \n    RetryMixin --> \"uses\" TenacityLibrary\n    RetryMixin --> \"handles\" LLMNoResponseError\n    DebugMixin --> \"uses\" LoggingSystem\n```",
          "Component Dependencies": "```\ngraph TD\n    A[utility_mixins] --> B[tenacity]\n    A --> C[openhands.core.exceptions]\n    A --> D[openhands.core.logger]\n    A --> E[openhands.utils.tenacity_stop]\n    \n    F[core_llm_implementation] --> A\n    G[router_system] --> A\n    \n    A --> H[LLMNoResponseError]\n    A --> I[llm_prompt_logger]\n    A --> J[llm_response_logger]\n    A --> K[stop_if_should_exit]\n    \n    style A fill:#e1f5fe\n    style F fill:#f3e5f5\n    style G fill:#f3e5f5\n```",
          "Core Components": {
            "RetryMixin": {
              "Key Features": [
                "**Configurable Retry Parameters**: Supports customizable retry counts, wait times, and multipliers",
                "**Exception-Specific Handling**: Targets specific exception types for retry logic",
                "**Temperature Adjustment**: Automatically adjusts temperature for `LLMNoResponseError` cases",
                "**Exponential Backoff**: Implements exponential backoff with jitter for optimal retry timing",
                "**Graceful Exit Handling**: Integrates with system shutdown signals"
              ],
              "Retry Strategy": "```\nflowchart TD\n    A[LLM Request] --> B{Request Successful?}\n    B -->|Yes| C[Return Response]\n    B -->|No| D{Retryable Exception?}\n    D -->|No| E[Raise Exception]\n    D -->|Yes| F{Max Retries Reached?}\n    F -->|Yes| E\n    F -->|No| G[Log Retry Attempt]\n    G --> H{LLMNoResponseError?}\n    H -->|Yes| I[Adjust Temperature to 1.0]\n    H -->|No| J[Keep Original Parameters]\n    I --> K[Wait with Exponential Backoff]\n    J --> K\n    K --> L{Should Exit?}\n    L -->|Yes| E\n    L -->|No| A\n```",
              "Configuration Parameters": "| Parameter | Description | Default Behavior |\n|-----------|-------------|------------------|\n| `num_retries` | Maximum number of retry attempts | Configurable per LLM |\n| `retry_exceptions` | Tuple of exception types to retry | LLM-specific exceptions |\n| `retry_min_wait` | Minimum wait time between retries | Exponential backoff minimum |\n| `retry_max_wait` | Maximum wait time between retries | Exponential backoff maximum |\n| `retry_multiplier` | Backoff multiplier | Exponential growth factor |\n| `retry_listener` | Callback for retry events | Optional notification handler |"
            },
            "DebugMixin": {
              "Key Features": [
                "**Prompt Logging**: Detailed logging of input messages and prompts",
                "**Response Logging**: Comprehensive logging of LLM responses including tool calls",
                "**Multi-format Support**: Handles various message formats (text, images, tool calls)",
                "**Vision Content Handling**: Special handling for vision-enabled models",
                "**Performance Optimization**: Conditional logging based on debug level"
              ],
              "Logging Flow": "```\nsequenceDiagram\n    participant Client\n    participant LLM\n    participant DebugMixin\n    participant Logger\n    \n    Client->>LLM: completion(messages)\n    LLM->>DebugMixin: log_prompt(messages)\n    DebugMixin->>DebugMixin: _format_message_content()\n    DebugMixin->>Logger: llm_prompt_logger.debug()\n    \n    LLM->>LLM: call_llm_api()\n    LLM->>DebugMixin: log_response(response)\n    DebugMixin->>DebugMixin: extract_tool_calls()\n    DebugMixin->>Logger: llm_response_logger.debug()\n    \n    LLM->>Client: return response\n```"
            }
          },
          "Integration with LLM System": {
            "Mixin Composition": "The utility mixins are composed with LLM classes using multiple inheritance:\n\n```\nclass LLM(RetryMixin, DebugMixin):\n    def __init__(self, config, service_id, metrics=None, retry_listener=None):\n        # Initialize LLM-specific functionality\n        self.retry_listener = retry_listener\n        \n        # Apply retry decorator to completion function\n        @self.retry_decorator(\n            num_retries=self.config.num_retries,\n            retry_exceptions=LLM_RETRY_EXCEPTIONS,\n            retry_min_wait=self.config.retry_min_wait,\n            retry_max_wait=self.config.retry_max_wait,\n            retry_multiplier=self.config.retry_multiplier,\n            retry_listener=self.retry_listener,\n        )\n        def wrapper(*args, **kwargs):\n            # Log prompt\n            self.log_prompt(messages)\n            \n            # Make LLM call\n            resp = self._completion_unwrapped(*args, **kwargs)\n            \n            # Log response\n            self.log_response(resp)\n            \n            return resp\n        \n        self._completion = wrapper\n```",
            "Error Handling Integration": "```\ngraph TD\n    A[LLM Request] --> B[RetryMixin.retry_decorator]\n    B --> C[DebugMixin.log_prompt]\n    C --> D[LLM API Call]\n    D --> E{Exception Occurred?}\n    E -->|No| F[DebugMixin.log_response]\n    E -->|Yes| G[RetryMixin.log_retry_attempt]\n    G --> H{Retryable?}\n    H -->|Yes| I[Apply Backoff]\n    H -->|No| J[Raise Exception]\n    I --> K{LLMNoResponseError?}\n    K -->|Yes| L[Adjust Temperature]\n    K -->|No| M[Retry Request]\n    L --> M\n    M --> D\n    F --> N[Return Response]\n    J --> O[Propagate Error]\n```"
          },
          "Error Handling Strategies": {
            "Exception Types": "The retry system handles specific exception types:\n\n['**Rate Limiting (429)**: Exponential backoff with jitter', '**Service Unavailable (503)**: Retry with increasing delays', '**Connection Errors**: Network-level retry logic', '**LLMNoResponseError**: Special handling with temperature adjustment']",
            "Temperature Adjustment Logic": "For `LLMNoResponseError` (primarily seen in Gemini models):\n\n['**Detection**: Identify LLMNoResponseError during retry', '**Temperature Check**: Verify current temperature setting', '**Adjustment**: Set temperature to 1.0 if currently 0', '**Logging**: Log the temperature adjustment', '**Retry**: Attempt request with adjusted parameters']"
          },
          "Logging and Observability": {
            "Log Levels and Destinations": "```\ngraph LR\n    A[Debug Messages] --> B[llm_prompt_logger]\n    A --> C[llm_response_logger]\n    A --> D[openhands_logger]\n    \n    B --> E[Prompt Content]\n    C --> F[Response Content]\n    C --> G[Tool Calls]\n    D --> H[Retry Attempts]\n    D --> I[Error Messages]\n    \n    style B fill:#e8f5e8\n    style C fill:#e8f5e8\n    style D fill:#fff3e0\n```",
            "Message Formatting": "The debug system handles various content types:\n\n['**Text Messages**: Direct string logging', '**Image Content**: URL logging for vision models', '**Tool Calls**: Function name and arguments', '**Multi-part Content**: Structured formatting']"
          },
          "Performance Considerations": {
            "Conditional Logging": "```\ndef log_prompt(self, messages):\n    if not logger.isEnabledFor(DEBUG):\n        # Skip expensive string operations if not debugging\n        return\n    \n    # Proceed with detailed logging\n    debug_message = MESSAGE_SEPARATOR.join(\n        self._format_message_content(msg) for msg in messages\n    )\n```",
            "Memory Optimization": [
              "**Lazy Evaluation**: String formatting only when needed",
              "**Conditional Processing**: Skip operations when debug disabled",
              "**Efficient Serialization**: Optimized message formatting"
            ]
          },
          "Configuration Integration": {
            "Retry Configuration": "The mixins integrate with the broader configuration system:\n\n```\n# From LLMConfig\nnum_retries: int = 8\nretry_min_wait: int = 15\nretry_max_wait: int = 120\nretry_multiplier: float = 2\n```",
            "Debug Configuration": "```\n# From LLMConfig\nlog_completions: bool = False\nlog_completions_folder: Optional[str] = None\n```"
          },
          "Usage Patterns": {
            "Basic Usage": "```\n# Mixins are automatically applied to all LLM instances\nllm = LLM(config=llm_config, service_id=\"main\")\n\n# Retry and debug functionality is transparent\nresponse = llm.completion(messages=[{\"role\": \"user\", \"content\": \"Hello\"}])\n```",
            "Custom Retry Listeners": "```\ndef retry_callback(attempt: int, max_retries: int):\n    print(f\"Retry attempt {attempt}/{max_retries}\")\n\nllm = LLM(config=llm_config, service_id=\"main\", retry_listener=retry_callback)\n```"
          },
          "Related Documentation": [
            "[llm_integration](llm_integration.md) - Overall LLM system architecture",
            "[core_llm_implementation](core_llm_implementation.md) - Base LLM classes",
            "[router_system](router_system.md) - LLM routing and load balancing",
            "[events_and_actions](events_and_actions.md) - Event system integration"
          ],
          "Future Enhancements": {
            "Planned Improvements": [
              "**Adaptive Retry Strategies**: Dynamic adjustment based on error patterns",
              "**Circuit Breaker Pattern**: Prevent cascading failures",
              "**Metrics Integration**: Enhanced observability with custom metrics",
              "**Structured Logging**: JSON-formatted logs for better parsing",
              "**Retry Budget Management**: Global retry limits across requests"
            ],
            "Extension Points": [
              "**Custom Retry Strategies**: Pluggable retry algorithms",
              "**Enhanced Debug Formatters**: Custom message formatting",
              "**Telemetry Integration**: OpenTelemetry support",
              "**Performance Profiling**: Request timing and resource usage"
            ]
          }
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    },
    {
      "title": "cli_configuration",
      "description": null,
      "content": {
        "CLI Configuration Module": {
          "Overview": "The `cli_configuration` module contains a single core component that manages CLI-specific settings, particularly editor modes and interface behaviors. It leverages Pydantic for robust configuration validation and type safety.",
          "Architecture": {
            "Core Components": "```\nclassDiagram\n    class CLIConfig {\n        +vi_mode: bool\n        +model_config: dict\n    }\n    \n    class BaseModel {\n        <<Pydantic>>\n    }\n    \n    CLIConfig --|> BaseModel\n    \n    note for CLIConfig \"CLI-specific configuration\\nwith validation\"\n```",
            "Module Structure": "```\ngraph TB\n    subgraph \"CLI Configuration Module\"\n        A[CLIConfig]\n    end\n    \n    subgraph \"External Dependencies\"\n        B[Pydantic BaseModel]\n        C[Pydantic Field]\n    end\n    \n    subgraph \"Related Modules\"\n        D[Security Configuration]\n        E[Kubernetes Configuration]\n        F[MCP Configuration]\n    end\n    \n    A --> B\n    A --> C\n    A -.-> D\n    A -.-> E\n    A -.-> F\n    \n    style A fill:#e1f5fe\n    style D fill:#f3e5f5\n    style E fill:#f3e5f5\n    style F fill:#f3e5f5\n```"
          },
          "Core Component Details": {
            "CLIConfig": "The `CLIConfig` class is a Pydantic model that manages CLI-specific configuration settings.\n\n**Key Features:**\n\n['**Vi Mode Support**: Configurable vi-style editing mode for CLI interactions', '**Validation**: Built-in Pydantic validation with strict field control', '**Type Safety**: Strongly typed configuration fields', '**Immutability**: Extra fields are forbidden to prevent configuration drift']\n\n**Configuration Fields:**\n\n['`vi_mode` (bool): Enables/disables vi-style editing mode in CLI interfaces (default: False)']\n\n**Model Configuration:**\n\n[\"`extra='forbid'`: Prevents addition of undefined configuration fields, ensuring strict configuration schema adherence\"]"
          },
          "Integration Patterns": {
            "Configuration Hierarchy": "```\ngraph TD\n    subgraph \"Configuration System\"\n        A[Core Configuration] --> B[CLI Configuration]\n        A --> C[Security Configuration]\n        A --> D[Kubernetes Configuration]\n        A --> E[MCP Configuration]\n    end\n    \n    subgraph \"Usage Context\"\n        F[CLI Runtime] --> B\n        G[Command Interface] --> B\n        H[Interactive Shell] --> B\n    end\n    \n    style B fill:#e1f5fe\n    style F fill:#e8f5e8\n    style G fill:#e8f5e8\n    style H fill:#e8f5e8\n```",
            "Data Flow": "```\nsequenceDiagram\n    participant User as User Input\n    participant CLI as CLI Interface\n    participant Config as CLIConfig\n    participant Runtime as CLI Runtime\n    \n    User->>CLI: CLI Command/Interaction\n    CLI->>Config: Load Configuration\n    Config->>Config: Validate Settings\n    Config->>CLI: Return Config Object\n    CLI->>Runtime: Apply Configuration\n    \n    alt vi_mode enabled\n        Runtime->>Runtime: Enable Vi Keybindings\n    else vi_mode disabled\n        Runtime->>Runtime: Use Default Keybindings\n    end\n    \n    Runtime->>User: Configured CLI Experience\n```"
          },
          "Usage Examples": {
            "Basic Configuration": "```\nfrom openhands.core.config.cli_config import CLIConfig\n\n# Default configuration\nconfig = CLIConfig()\nprint(config.vi_mode)  # False\n\n# Enable vi mode\nvi_config = CLIConfig(vi_mode=True)\nprint(vi_config.vi_mode)  # True\n```",
            "Configuration Validation": "```\n# Valid configuration\ntry:\n    config = CLIConfig(vi_mode=True)\n    print(\"Configuration valid\")\nexcept ValueError as e:\n    print(f\"Configuration error: {e}\")\n\n# Invalid configuration (extra fields forbidden)\ntry:\n    config = CLIConfig(vi_mode=True, invalid_field=\"value\")\nexcept ValueError as e:\n    print(f\"Validation error: {e}\")\n```"
          },
          "Integration with Other Modules": {
            "CLI Runtime Integration": "The CLI configuration directly influences the behavior of CLI runtime components:\n\n```\ngraph LR\n    subgraph \"Configuration Layer\"\n        A[CLIConfig]\n    end\n    \n    subgraph \"Runtime Layer\"\n        B[CLI Runtime]\n    end\n    \n    subgraph \"User Interface\"\n        C[Command Interface]\n        D[Interactive Shell]\n    end\n    \n    A --> B\n    B --> C\n    B --> D\n    \n    style A fill:#e1f5fe\n    style B fill:#fff3e0\n    style C fill:#e8f5e8\n    style D fill:#e8f5e8\n```",
            "Related Configuration Modules": [
              "**[Security Configuration](security_configuration.md)**: Handles security-related settings",
              "**[Kubernetes Configuration](kubernetes_configuration.md)**: Manages Kubernetes runtime settings",
              "**[MCP Configuration](mcp_configuration.md)**: Configures Model Context Protocol settings"
            ]
          },
          "Configuration Lifecycle": "```\nstateDiagram-v2\n    [*] --> Created: CLIConfig()\n    Created --> Validated: Pydantic Validation\n    Validated --> Applied: Runtime Application\n    Applied --> Active: CLI Operations\n    Active --> Updated: Configuration Change\n    Updated --> Validated: Re-validation\n    Active --> [*]: CLI Shutdown\n```",
          "Best Practices": {
            "Configuration Management": [
              "**Use Default Values**: Rely on sensible defaults for most use cases",
              "**Validate Early**: Leverage Pydantic validation to catch configuration errors early",
              "**Immutable Configuration**: Avoid modifying configuration objects after creation",
              "**Type Safety**: Always use type hints and Pydantic fields"
            ],
            "Error Handling": "```\nfrom pydantic import ValidationError\n\ntry:\n    config = CLIConfig(vi_mode=\"invalid\")  # Should be boolean\nexcept ValidationError as e:\n    print(f\"Configuration validation failed: {e}\")\n    # Handle configuration error appropriately\n```"
          },
          "Extension Points": "While the current CLI configuration is minimal, it can be extended for additional CLI features:\n\n```\n# Potential extensions (not implemented)\nclass ExtendedCLIConfig(CLIConfig):\n    color_scheme: str = Field(default=\"default\")\n    auto_complete: bool = Field(default=True)\n    history_size: int = Field(default=1000, ge=0)\n```",
          "Dependencies": {
            "External Dependencies": [
              "**Pydantic**: Configuration validation and serialization",
              "**Python Standard Library**: Type hints and basic functionality"
            ],
            "Internal Dependencies": [
              "Part of the broader OpenHands configuration system",
              "Integrates with [runtime_system](runtime_system.md) for CLI runtime behavior"
            ]
          },
          "Summary": "The CLI Configuration module provides a focused, type-safe approach to managing CLI-specific settings within the OpenHands system. Its simple design prioritizes reliability and extensibility while maintaining strict validation standards. The module serves as a foundational component for CLI behavior customization and integrates seamlessly with the broader configuration management system."
        }
      },
      "metadata": {
        "source": "deepwiki"
      },
      "subpages": []
    }
  ]
}